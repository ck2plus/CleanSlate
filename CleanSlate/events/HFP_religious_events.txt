# Written by Flavio (HFP.23001 - HFP.23027)

namespace = HFP

# Son/Daughter sent to the monastery
character_event = {
	id = HFP.23001
	picture = GFX_evt_monastery_monks
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESCAHFP23001
		trigger = {
			FROM = {
				is_female = no

				OR = {
					trait = ambitious
					trait = stubborn
					trait = wroth
				}

				NOR = {
					trait = kind
					trait = humble
					trait = content
				}
			}
		}
	}
	desc = {
		text = EVTDESCBHFP23001
		trigger = {
			FROM = {
				is_female = yes

				OR = {
					trait = ambitious
					trait = stubborn
					trait = wroth
				}

				NOR = {
					trait = kind
					trait = humble
					trait = content
				}
			}
		}
	}
	desc = {
		text = EVTDESCCHFP23001
		trigger = {
			FROM = {
				is_female = no

				NOR = {
					trait = ambitious
					trait = stubborn
					trait = wroth
					trait = kind
					trait = humble
					trait = content
				}
			}
		}
	}
	desc = {
		text = EVTDESCDHFP23001
		trigger = {
			FROM = {
				is_female = yes

				NOR = {
					trait = ambitious
					trait = stubborn
					trait = wroth
					trait = kind
					trait = humble
					trait = content
				}
			}
		}
	}
	desc = {
		text = EVTDESCEHFP23001
		trigger = {
			FROM = {
				is_female = no

				NOR = {
					trait = ambitious
					trait = stubborn
					trait = wroth
				}

				OR = {
					trait = kind
					trait = humble
					trait = content
				}
			}
		}
	}
	desc = {
		text = EVTDESCFHFP23001
		trigger = {
			FROM = {
				is_female = yes

				NOR = {
					trait = ambitious
					trait = stubborn
					trait = wroth
				}

				OR = {
					trait = kind
					trait = humble
					trait = content
				}
			}
		}
	}

	is_triggered_only = yes # order_to_take_vows, dynasty_decisions.txt

	option = {
		name = EVTOPTAHFP23001

		trigger = { is_evil_trigger = yes }

		random = {
			chance = 10
			remove_trait_stressed_effect = yes
		}
	}

	option = {
		name = EVTOPTBHFP23001

		trigger = {
			is_evil_trigger = no
			is_benevolent_trigger = no
		}
	}

	option = {
		name = EVTOPTCHFP23001

		trigger = { is_benevolent_trigger = yes }

		random = {
			chance = 10
			add_trait_stressed_effect = yes
		}
	}
}

# Hidden event assigning cooldown on Excommunication requests
# ROOT is Excommunicated person
# FROM is Asker
# FFROMFROM is Religious head
character_event = {
	id = HFP.23002

	is_triggered_only = yes # on_excommunicate_interaction
	hide_window = yes

	immediate = {
		FROMFROM = {
			opinion = {
				name = opinion_requested_excommunication
				who = ROOT_FROM
				months = 6
			}
		}
	}
}

## New Lifting Excommunication Revamped event chain ##
# Religious Head receives event determining punishment
character_event = {
	id = HFP.23003

	is_triggered_only = yes # issue_declaration_of_repentance
	hide_window = yes

	immediate = {
		random_list = {
			# Possible impositions:

			# Tiered Money
			# Tiered Prestige
			# Vow of Celibacy
			# Son/Daughter must take vows
			# Abdication-> Become Monk/Nun
			# Enforce Papal Succession (Kings/Emperors)
			# Change succession to Gavelkind (unless Elective or worse) (King/Emperors)
			# Give Italian lands back (Emperors)
			# Give Independence to Papacy (Emperors)
			# Request vassalization (Italian Dukes)

			30 = {
				# Pay tiered money
				trigger = {
					opinion = {
						who = FROM
						value > -100
					}
				}

				mult_modifier = {
					factor = 0.5
					vassal_of = FROM
				}

				mult_modifier = { # Supported Pope more likely to ask for little
					factor = 1.5

					has_opinion_modifier = {
						name = opinion_supported_pope
						who = FROM
					}
				}

				mult_modifier = {
					factor = 0.25

					higher_real_tier_than = DUKE
					wealth < 5
				}

				mult_modifier = {
					factor = 0.5

					higher_real_tier_than = DUKE
					wealth < 250
				}

				mult_modifier = {
					factor = 0.2

					opinion = {
						who = FROM
						value < -80
					}
				}

				mult_modifier = {
					factor = 0.3

					opinion = {
						who = FROM
						value < -60
					}
				}

				mult_modifier = {
					factor = 0.4

					opinion = {
						who = FROM
						value < -40
					}
				}

				mult_modifier = {
					factor = 0.5

					opinion = {
						who = FROM
						value < -20
					}
				}

				mult_modifier = {
					factor = 0.6

					opinion = {
						who = FROM
						value < 0
					}
				}

				mult_modifier = {
					factor = 1.25

					opinion = {
						who = FROM
						value >= 20
					}
				}

				mult_modifier = {
					factor = 1.5

					opinion = {
						who = FROM
						value >= 40
					}
				}

				mult_modifier = {
					factor = 1.5

					opinion = {
						who = FROM
						value >= 60
					}
				}

				mult_modifier = {
					factor = 1.5

					opinion = {
						who = FROM
						value >= 80
					}
				}

				mult_modifier = {
					factor = 1.5

					opinion = {
						who = FROM
						value >= 100
					}
				}

				mult_modifier = {
					factor = 1.5
					trait = greedy
				}

				mult_modifier = {
					factor = 0.5
					trait = zealous
				}

				FROM = {
					letter_event = { id = HFP.23004 } # Asks for Gold
				}
			}

			30 = {
				# Pay tiered Prestige
				trigger = {
					FROM = { higher_real_tier_than = DUKE }
				}

				mult_modifier = {
					factor = 0.5
					vassal_of = FROM
				}

				mult_modifier = {
					factor = 1.5
					trait = proud
				}

				mult_modifier = {
					factor = 0.5
					trait = cynical
				}

				FROM = {
					letter_event = { id = HFP.23006 } # Asks for Prestige
				}
			}

			20 = {
				# Impose celibacy
				trigger = {
					FROM = {
						has_living_children = yes

						NOR = {
							trait = celibate
							trait = eunuch
							trait = chaste
						}
					}
				}

				mult_modifier = {
					factor = 0.5
					vassal_of = FROM
				}

				mult_modifier = {
					factor = 1.5
					trait = chaste
				}

				mult_modifier = {
					factor = 1.5
					trait = celibate
				}

				mult_modifier = {
					factor = 0.5
					trait = lustful
				}

				mult_modifier = {
					factor = 0.5
					FROM = { trait = humble }
				}

				mult_modifier = {
					factor = 1.5
					FROM = { trait = lustful }
				}

				mult_modifier = {
					factor = 1.5
					FROM = { has_character_modifier = adulterer }
				}

				mult_modifier = {
					factor = 1.5
					FROM = { has_character_modifier = adulteress }
				}

				mult_modifier = {
					factor = 1.75
					FROM = { has_character_modifier = incestuous_adulterer }
				}

				mult_modifier = {
					factor = 1.75
					FROM = { has_character_modifier = incestuous_adulteress }
				}

				mult_modifier = {
					factor = 10

					has_opinion_modifier = {
						name = opinion_pope_ex_demands_celibacy
						who = FROM
					}
				}

				FROM = {
					letter_event = { id = HFP.23008 } # Impose Celibacy
				}
			}

			10 = { # Send Son/Daughter to monastery
				trigger = {
					OR = {
						religion_group = christian
						has_religion_feature = religion_monastic
					}

					FROM = {
						any_child = {
							is_adult = yes
							vassal_of = PREV
							is_married = no
							is_ruler = no
							prisoner = no
							is_incapable = no
							has_inheritance_blocker = no

							PREV = {
								player_heir = {
									NOT = { character = PREVPREV }
								}
							}
						}
					}
				}

				mult_modifier = {
					factor = 1.5

					FROM = {
						any_child = {
							count >= 3

							is_adult = yes
							vassal_of = PREV
							is_married = no
							is_ruler = no
							prisoner = no
							is_incapable = no
							has_inheritance_blocker = no

							PREV = {
								player_heir = {
									NOT = { character = PREVPREV }
								}
							}
						}
					}
				}

				mult_modifier = {
					factor = 1.5

					FROM = {
						any_child = {
							count >= 4

							is_adult = yes
							vassal_of = PREV
							is_married = no
							is_ruler = no
							prisoner = no
							is_incapable = no
							has_inheritance_blocker = no

							PREV = {
								player_heir = {
									NOT = { character = PREVPREV }
								}
							}
						}
					}
				}

				mult_modifier = {
					factor = 1.5

					FROM = {
						any_child = {
							count >= 5

							is_adult = yes
							vassal_of = PREV
							is_married = no
							is_ruler = no
							prisoner = no
							is_incapable = no
							has_inheritance_blocker = no

							PREV = {
								player_heir = {
									NOT = { character = PREVPREV }
								}
							}
						}
					}
				}

				mult_modifier = {
					factor = 1.5

					FROM = {
						any_child = {
							count >= 6

							is_adult = yes
							vassal_of = PREV
							is_married = no
							is_ruler = no
							prisoner = no
							is_incapable = no
							has_inheritance_blocker = no

							PREV = {
								player_heir = {
									NOT = { character = PREVPREV }
								}
							}
						}
					}
				}

				mult_modifier = {
					factor = 0.25
					trait = cynical
				}

				mult_modifier = {
					factor = 10

					has_opinion_modifier = {
						name = opinion_pope_ex_demands_child
						who = FROM
					}
				}

				FROM = {
					letter_event = { id = HFP.23010 } # Send child to monastery/nunnery
				}
			}

			3 = {
				# Force abdication
				trigger = {
					OR = {
						religion_group = christian
						has_religion_feature = religion_monastic
					}

					FROM = {
						higher_real_tier_than = DUKE
						player_heir = { always = yes } # Do not impose a game over
					}
				}

				mult_modifier = {
					factor = 0.15
					vassal_of = FROM
				}

				mult_modifier = {
					factor = 10

					FROM = {
						OR = {
							trait = kinslayer
							trait = familial_kinslayer
							trait = dynastic_kinslayer
							has_character_modifier = rampant_sinner_christian
							has_character_modifier = rampant_sinner_dharmic
							has_character_modifier = known_satanist
							has_character_modifier = known_witch
						}
					}
				}

				mult_modifier = {
					factor = 1.5
					trait = proud
				}

				mult_modifier = {
					factor = 1.5
					trait = envious
				}

				mult_modifier = {
					factor = 0.5
					trait = cynical
				}

				mult_modifier = {
					factor = 0.5
					trait = kind
				}

				mult_modifier = {
					factor = 1.5
					trait = zealous
				}

				mult_modifier = {
					factor = 1.5
					is_rival = FROM
				}

				mult_modifier = {
					factor = 0.25
					is_friend = FROM
				}

				mult_modifier = {
					factor = 0.25
					is_lover = FROM
				}

				mult_modifier = {
					factor = 1.75

					opinion = {
						who = FROM
						value <= -100
					}
				}

				mult_modifier = {
					factor = 1.75

					opinion = {
						who = FROM
						value < -80
					}
				}

				mult_modifier = {
					factor = 1.5

					opinion = {
						who = FROM
						value < -60
					}
				}

				mult_modifier = {
					factor = 1.5

					opinion = {
						who = FROM
						value < -40
					}
				}

				mult_modifier = {
					factor = 1.25

					opinion = {
						who = FROM
						value < -20
					}
				}

				mult_modifier = {
					factor = 0.85

					opinion = {
						who = FROM
						value >= 20
					}
				}

				mult_modifier = {
					factor = 0.85

					opinion = {
						who = FROM
						value >= 40
					}
				}

				mult_modifier = {
					factor = 0.75

					opinion = {
						who = FROM
						value >= 60
					}
				}

				mult_modifier = {
					factor = 0.5

					opinion = {
						who = FROM
						value >= 80
					}
				}

				mult_modifier = {
					factor = 0.9
					FROM = { trait = zealous }
				}

				mult_modifier = {
					factor = 0.9
					FROM = { trait = baptized_by_pope }
				}

				mult_modifier = {
					factor = 0.9
					FROM = { piety >= 100 }
				}

				mult_modifier = {
					factor = 0.9
					FROM = { piety >= 150 }
				}

				mult_modifier = {
					factor = 0.8
					FROM = { piety >= 250 }
				}

				mult_modifier = {
					factor = 10

					has_opinion_modifier = {
						name = opinion_pope_ex_demands_abdication
						who = FROM
					}
				}

				FROM = {
					letter_event = { id = HFP.23012 } # Impose abdication
				}
			}

			30 = { # Impose Papal Investiture
				trigger = {
					FROM = { has_law = investiture_law_1 }
				}

				mult_modifier = {
					factor = 1.5
					FROM = { real_tier = EMPEROR }
				}

				mult_modifier = {
					factor = 1.75
					FROM = { has_landed_title = e_hre }
				}

				mult_modifier = {
					factor = 1.5
					real_tier = KING
				}

				mult_modifier = {
					factor = 1.5
					trait = envious
				}

				mult_modifier = {
					factor = 1.75
					independent = yes
				}

				mult_modifier = {
					factor = 10

					has_opinion_modifier = {
						name = opinion_pope_ex_demands_investiture
						who = FROM
					}
				}

				FROM = {
					letter_event = { id = HFP.23014 } # Impose Papal Investiture
				}
			}

			5 = { # Impose Gavelkind
				trigger = {
					FROM = {
						realm_size >= 100
						higher_real_tier_than = DUKE
						is_law_potential = succ_gavelkind
						is_law_allowed = succ_gavelkind

						NOR = {
							has_law = succ_gavelkind
							has_law = succ_elective_gavelkind
							has_law = succ_feudal_elective
							has_law = succ_hre_elective
						}
					}
				}

				mult_modifier = {
					factor = 1.5
					FROM = { real_tier = EMPEROR }
				}

				mult_modifier = {
					factor = 2
					FROM = { trait = ambitious } # Hubris
				}

				mult_modifier = {
					factor = 0.5
					FROM = { has_children = no }
				}

				mult_modifier = {
					factor = 1.5
					FROM = { num_of_children >= 3 }
				}

				mult_modifier = {
					factor = 1.5
					FROM = { num_of_children >= 5 }
				}

				mult_modifier = {
					factor = 1.5
					FROM = { num_of_children >= 7 }
				}

				mult_modifier = {
					factor = 1.5
					FROM = { num_of_children >= 9 }
				}

				mult_modifier = {
					factor = 1.5
					real_tier = EMPEROR
				}

				mult_modifier = {
					factor = 1.5
					trait = envious
				}

				mult_modifier = {
					factor = 1.75
					independent = yes
				}

				mult_modifier = {
					factor = 10

					has_opinion_modifier = {
						name = opinion_pope_ex_demands_gavelkind
						who = FROM
					}
				}

				FROM = {
					letter_event = { id = HFP.23016 } # Impose Gavelkind
				}
			}

			20 = { # Request Italian Lands
				trigger = {
					religion_group = christian
					is_alternate_start = no # Only matters for historical Papacy

					FROM = {
						higher_real_tier_than = KING

						# Check if you or your vassals hold lands within Italy
						any_realm_title = {
							OR = {
								title = d_latium
								title = d_spoleto
								title = d_ancona
								title = d_ferrara
								title = d_benevento
								de_jure_vassal_or_below = d_latium
								de_jure_vassal_or_below = d_spoleto
								de_jure_vassal_or_below = d_ancona
								de_jure_vassal_or_below = d_ferrara
								de_jure_vassal_or_below = d_benevento
							}

							trigger_if = {
								limit = { holder = PREV }
								can_be_given_away = yes
							}
						}
					}

					# If Papacy already controls historical provinces, it won't be interested in gaining even more land in Italy
					NAND = {
						completely_controls = d_latium
						completely_controls = d_spoleto
						completely_controls = d_ancona
						completely_controls = d_ferrara
						completely_controls = d_benevento
					}
				}

				mult_modifier = {
					factor = 1.75

					opinion = {
						who = FROM
						value <= -100
					}
				}

				mult_modifier = {
					factor = 1.75

					opinion = {
						who = FROM
						value < -80
					}
				}

				mult_modifier = {
					factor = 1.5

					opinion = {
						who = FROM
						value < -60
					}
				}

				mult_modifier = {
					factor = 1.5

					opinion = {
						who = FROM
						value < -40
					}
				}

				mult_modifier = {
					factor = 1.25

					opinion = {
						who = FROM
						value < -20
					}
				}

				mult_modifier = {
					factor = 1.25

					opinion = {
						who = FROM
						value < 0
					}
				}

				mult_modifier = {
					factor = 0.85

					opinion = {
						who = FROM
						value >= 20
					}
				}

				mult_modifier = {
					factor = 0.85

					opinion = {
						who = FROM
						value >= 40
					}
				}

				mult_modifier = {
					factor = 0.75

					opinion = {
						who = FROM
						value >= 60
					}
				}

				mult_modifier = {
					factor = 0.5

					opinion = {
						who = FROM
						value >= 80
					}
				}

				mult_modifier = {
					factor = 0.9
					FROM = { trait = zealous }
				}

				mult_modifier = {
					factor = 0.9
					FROM = { trait = baptized_by_pope }
				}

				mult_modifier = {
					factor = 0.9
					FROM = { piety >= 100 }
				}

				mult_modifier = {
					factor = 0.9
					FROM = { piety >= 150 }
				}

				mult_modifier = {
					factor = 0.8
					FROM = { piety >= 250 }
				}

				mult_modifier = {
					factor = 0.7
					FROM = { has_law = investiture_law_0 }
				}

				# Historical Pope will want historical Vatican lands
				mult_modifier = {
					factor = 1.5

					has_landed_title = k_papacy

					c_roma = {
						OR = {
							holder_scope = {
								character = FROM
								is_vassal_or_below_of = FROM
							}

							any_de_jure_vassal_title = {
								holder_scope = {
									OR = {
										character = FROM
										is_vassal_or_below_of = FROM
									}
								}
							}
						}
					}
				}

				mult_modifier = {
					factor = 1.5

					has_landed_title = k_papacy

					d_latium = {
						OR = {
							holder_scope = {
								character = FROM
								is_vassal_or_below_of = FROM
							}

							any_de_jure_vassal_title = {
								holder_scope = {
									OR = {
										character = FROM
										is_vassal_or_below_of = FROM
									}
								}
							}
						}
					}
				}

				mult_modifier = {
					factor = 1.45

					has_landed_title = k_papacy

					d_spoleto = {
						OR = {
							holder_scope = {
								character = FROM
								is_vassal_or_below_of = FROM
							}

							any_de_jure_vassal_title = {
								holder_scope = {
									OR = {
										character = FROM
										is_vassal_or_below_of = FROM
									}
								}
							}
						}
					}
				}

				mult_modifier = {
					factor = 1.35

					has_landed_title = k_papacy

					d_ancona = {
						OR = {
							holder_scope = {
								character = FROM
								is_vassal_or_below_of = FROM
							}

							any_de_jure_vassal_title = {
								holder_scope = {
									OR = {
										character = FROM
										is_vassal_or_below_of = FROM
									}
								}
							}
						}
					}
				}

				mult_modifier = {
					factor = 1.25

					has_landed_title = k_papacy

					d_ferrara = {
						OR = {
							holder_scope = {
								character = FROM
								is_vassal_or_below_of = FROM
							}

							any_de_jure_vassal_title = {
								holder_scope = {
									OR = {
										character = FROM
										is_vassal_or_below_of = FROM
									}
								}
							}
						}
					}
				}

				mult_modifier = {
					factor = 1.15

					has_landed_title = k_papacy

					d_benevento = {
						OR = {
							holder_scope = {
								character = FROM
								is_vassal_or_below_of = FROM
							}

							any_de_jure_vassal_title = {
								holder_scope = {
									OR = {
										character = FROM
										is_vassal_or_below_of = FROM
									}
								}
							}
						}
					}
				}

				mult_modifier = {
					factor = 1.25

					has_landed_title = k_papacy
					FROM = { has_landed_title = e_hre }
				}

				mult_modifier = {
					factor = 10

					has_opinion_modifier = {
						name = opinion_pope_ex_demands_lands
						who = FROM
					}
				}

				FROM = {
					letter_event = { id = HFP.23018 } # Request Italian lands
				}
			}

			60 = {
				trigger = { vassal_of = FROM }

				mult_modifier = {
					factor = 2

					has_opinion_modifier = { # Opinion modifier keeps track of the Pope's previous decision, should the player deny his first request and then attempt to ask again immediately after for a different result.
						name = opinion_requested_independence
						who = FROM
					}
				}

				mult_modifier = {
					factor = 1.5
					has_landed_title = k_papacy
				}

				mult_modifier = {
					factor = 2

					opinion = {
						who = FROM
						value <= -100
					}
				}

				mult_modifier = {
					factor = 1.75

					opinion = {
						who = FROM
						value < -80
					}
				}

				mult_modifier = {
					factor = 1.75

					opinion = {
						who = FROM
						value < -60
					}
				}

				mult_modifier = {
					factor = 1.75

					opinion = {
						who = FROM
						value < -40
					}
				}

				mult_modifier = {
					factor = 1.5

					opinion = {
						who = FROM
						value < -20
					}
				}

				mult_modifier = {
					factor = 0.9

					opinion = {
						who = FROM
						value >= 20
					}
				}

				mult_modifier = {
					factor = 0.8

					opinion = {
						who = FROM
						value >= 40
					}
				}

				mult_modifier = {
					factor = 0.7

					opinion = {
						who = FROM
						value >= 60
					}
				}

				mult_modifier = {
					factor = 0.6

					opinion = {
						who = FROM
						value >= 80
					}
				}

				mult_modifier = {
					factor = 0.5

					opinion = {
						who = FROM
						value >= 100
					}
				}

				mult_modifier = {
					factor = 10

					has_opinion_modifier = {
						name = opinion_pope_ex_demands_independence
						who = FROM
					}
				}

				FROM = {
					letter_event = { id = HFP.23020 } # I want to be independent
				}
			}

			10 = { # Requests Vassalization
				trigger = {
					religion_group = christian
					higher_real_tier_than = DUKE
					independent = yes
					is_alternate_start = no # Only matters for historical Papacy

					FROM = { # Check if you or your vassals hold lands within Italy
						trigger_if = {
							limit = { independent = no }
							same_liege = ROOT
						}

						lower_real_tier_than = KING
						shares_realm_border_with = ROOT # Avoid creating messy borders

						# Check if you or your vassals hold lands within Italy
						any_realm_title = {
							OR = {
								title = d_latium
								title = d_spoleto
								title = d_ancona
								title = d_ferrara
								title = d_benevento
								de_jure_vassal_or_below = d_latium
								de_jure_vassal_or_below = d_spoleto
								de_jure_vassal_or_below = d_ancona
								de_jure_vassal_or_below = d_ferrara
								de_jure_vassal_or_below = d_benevento
							}

							trigger_if = {
								limit = { holder = PREV }
								can_be_given_away = yes
							}
						}
					}

					# If Papacy already controls historical provinces, it won't be interested in gaining even more land in Italy
					NAND = {
						completely_controls = d_latium
						completely_controls = d_spoleto
						completely_controls = d_ancona
						completely_controls = d_ferrara
						completely_controls = d_benevento
					}
				}

				mult_modifier = {
					factor = 1.75

					opinion = {
						who = FROM
						value <= -100
					}
				}

				mult_modifier = {
					factor = 1.75

					opinion = {
						who = FROM
						value < -80
					}
				}

				mult_modifier = {
					factor = 1.5

					opinion = {
						who = FROM
						value < -60
					}
				}

				mult_modifier = {
					factor = 1.5

					opinion = {
						who = FROM
						value < -40
					}
				}

				mult_modifier = {
					factor = 1.25

					opinion = {
						who = FROM
						value < -20
					}
				}

				mult_modifier = {
					factor = 0.85

					opinion = {
						who = FROM
						value >= 20
					}
				}

				mult_modifier = {
					factor = 0.85

					opinion = {
						who = FROM
						value >= 40
					}
				}

				mult_modifier = {
					factor = 0.75

					opinion = {
						who = FROM
						value >= 60
					}
				}

				mult_modifier = {
					factor = 0.5

					opinion = {
						who = FROM
						value >= 80
					}
				}

				mult_modifier = {
					factor = 0.9
					FROM = { trait = zealous }
				}

				mult_modifier = {
					factor = 0.9
					FROM = { trait = baptized_by_pope }
				}

				mult_modifier = {
					factor = 0.9
					FROM = { piety >= 100 }
				}

				mult_modifier = {
					factor = 0.9
					FROM = { piety >= 150 }
				}

				mult_modifier = {
					factor = 0.8
					FROM = { piety >= 250 }
				}

				mult_modifier = {
					factor = 0.7
					FROM = { has_law = investiture_law_0 }
				}

				# Historical Pope will want control over historical Vatican lands
				mult_modifier = {
					factor = 1.5

					has_landed_title = k_papacy

					c_roma = {
						OR = {
							holder_scope = {
								character = FROM
								is_vassal_or_below_of = FROM
							}

							any_de_jure_vassal_title = {
								holder_scope = {
									OR = {
										character = FROM
										is_vassal_or_below_of = FROM
									}
								}
							}
						}
					}
				}

				mult_modifier = {
					factor = 1.5

					has_landed_title = k_papacy

					d_latium = {
						OR = {
							holder_scope = {
								character = FROM
								is_vassal_or_below_of = FROM
							}

							any_de_jure_vassal_title = {
								holder_scope = {
									OR = {
										character = FROM
										is_vassal_or_below_of = FROM
									}
								}
							}
						}
					}
				}

				mult_modifier = {
					factor = 1.45

					has_landed_title = k_papacy

					d_spoleto = {
						OR = {
							holder_scope = {
								character = FROM
								is_vassal_or_below_of = FROM
							}

							any_de_jure_vassal_title = {
								holder_scope = {
									OR = {
										character = FROM
										is_vassal_or_below_of = FROM
									}
								}
							}
						}
					}
				}

				mult_modifier = {
					factor = 1.35

					has_landed_title = k_papacy

					d_ancona = {
						OR = {
							holder_scope = {
								character = FROM
								is_vassal_or_below_of = FROM
							}

							any_de_jure_vassal_title = {
								holder_scope = {
									OR = {
										character = FROM
										is_vassal_or_below_of = FROM
									}
								}
							}
						}
					}
				}

				mult_modifier = {
					factor = 1.25

					has_landed_title = k_papacy

					d_ferrara = {
						OR = {
							holder_scope = {
								character = FROM
								is_vassal_or_below_of = FROM
							}

							any_de_jure_vassal_title = {
								holder_scope = {
									OR = {
										character = FROM
										is_vassal_or_below_of = FROM
									}
								}
							}
						}
					}
				}

				mult_modifier = {
					factor = 1.15

					has_landed_title = k_papacy

					d_benevento = {
						OR = {
							holder_scope = {
								character = FROM
								is_vassal_or_below_of = FROM
							}

							any_de_jure_vassal_title = {
								holder_scope = {
									OR = {
										character = FROM
										is_vassal_or_below_of = FROM
									}
								}
							}
						}
					}
				}

				mult_modifier = {
					factor = 10

					has_opinion_modifier = {
						name = opinion_pope_ex_demands_vassalization
						who = FROM
					}
				}

				FROM = {
					letter_event = { id = HFP.23022 } # Request Vassalization
				}
			}
		}
	}
}

# Possible impositions:

# Tiered Money
# Tiered Prestige
# Vow of Celibacy
# Son/Daughter must take vows.
# Abdication-> Become Monk/Nun
# Enforce Papal Succession (Kings/Emperors)
# Change succession to Gavelkind (unless Elective or worse) (King/Emperors)
# Give Italian lands back (Emperors)
# Give Independence to Papacy (Emperors)
# Request vassalization (Italian Dukes)

# Tiered Money
letter_event = {
	id = HFP.23004
	desc = EVTDESCAHFP23004
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	trigger = {
		religion = FROM
	}

	option = {
		name = EVTOPTAHFP23004

		# Transfer scaled wealth based on Pope's opinion of you and your piety. - Count tier
		if = {
			limit = { real_tier = COUNT }

			if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < -75
					}
				}

				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 2.5 min = 350 max = 800 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 2 min = 300 max = 700 }
				}
			}

			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < -25
					}
				}

				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 1.35 min = 250 max = 600 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 1.25 min = 200 max = 500 }
				}
			}

			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < 0
					}
				}

				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 1.0 min = 150 max = 450 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 0.95 min = 100 max = 400 }
				}
			}

			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < 50
					}
				}

				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 0.85 min = 75 max = 350 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 0.75 min = 50 max = 300 }
				}
			}

			else = {
				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 0.65 min = 25 max = 250 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 0.5 min = 10 max = 150 }
				}
			}
		}

		# Transfer scaled wealth based on Pope's opinion of you and your piety. - Duke tier
		if = {
			limit = { real_tier = DUKE }

			if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < -75
					}
				}

				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 2.5 min = 750 max = 1200 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 2 min = 500 max = 700 }
				}
			}

			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < -25
					}
				}

				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 1.35 min = 500 max = 600 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 1.25 min = 300 max = 500 }
				}
			}

			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < 0
					}
				}

				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 1.0 min = 250 max = 450 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 0.95 min = 200 max = 400 }
				}
			}

			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < 50
					}
				}

				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 0.85 min = 150 max = 350 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 0.75 min = 100 max = 300 }
				}
			}

			else = {
				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 0.65 min = 75 max = 250 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 0.5 min = 50 max = 150 }
				}
			}
		}

		# Transfer scaled wealth based on Pope's opinion of you and your piety. - King tier
		else_if = {
			limit = { real_tier = KING }

			if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < -75
					}
				}

				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 2.5 min = 750 max = 1500 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 2 min = 600 max = 1200 }
				}
			}

			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < -25
					}
				}

				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 1.35 min = 500 max = 900 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 1.25 min = 400 max = 750 }
				}
			}

			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < 0
					}
				}

				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 1.0 min = 350 max = 600 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 0.95 min = 300 max = 500 }
				}
			}

			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < 50
					}
				}

				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 0.85 min = 250 max = 400 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 0.75 min = 200 max = 350 }
				}
			}

			else = {
				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 0.65 min = 175 max = 300 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 0.5 min = 150 max = 250 }
				}
			}
		}

		# Transfer scaled wealth based on Pope's opinion of you and your piety. - Emperor tier
		else_if = {
			limit = { real_tier = EMPEROR }

			if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < -75
					}
				}

				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 3 min = 950 max = 1750 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 2.5 min = 750 max = 1500 }
				}
			}

			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < -25
					}
				}

				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 2.0 min = 600 max = 1000 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 1.75 min = 500 max = 850 }
				}
			}

			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < 0
					}
				}

				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 1.5 min = 450 max = 700 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 1.35 min = 400 max = 600 }
				}
			}

			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < 50
					}
				}

				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 1.25 min = 350 max = 500 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 0.95 min = 300 max = 450 }
				}
			}

			else = {
				if = {
					limit = { piety < 350 }
					transfer_scaled_wealth = { to = FROM value = 0.85 min = 275 max = 400 }
				}
				else = {
					transfer_scaled_wealth = { to = FROM value = 0.75 min = 250 max = 350 }
				}
			}
		}

		excommunicate = no

		hidden_effect = {
			sound_effect = excommunication_lifted

			reverse_opinion = {
				name = opinion_repented_sins
				who = FROM
				years = 20
			}
		}

		character_event = { id = HFP.23005 }
	}

	option = {
		name = EVTOPTBHFP23004
		ai_chance = { factor = 0 }
	}
}

# Excommunicated ruler forced to pay money
character_event = {
	id = HFP.23005
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESCAHFP23005
		picture = GFX_evt_pope
		trigger = { religion_group = christian }
	}
	desc = {
		text = EVTDESCBHFP23005
		picture = GFX_evt_bishop
		trigger = {
			NOR = {
				religion_group = christian
				religion_group = pagan_group
			}
		}
	}
	desc = {
		text = EVTDESCBHFP23005
		picture = GFX_evt_tribal_shrine
		trigger = { religion_group = pagan_group }
	}

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTAHFP23005
	}
}

# Tiered Prestige
letter_event = {
	id = HFP.23006
	desc = EVTDESCAHFP23006
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	trigger = {
		religion = FROM
	}

	immediate = {
		# Transfer prestige based on Pope's opinion of you and your piety. - Count tier
		if = {
			limit = { real_tier = COUNT }

			if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < -75
					}
				}

				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 700 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 600 }
				}
			}
			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < -25
					}
				}

				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 500 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 400 }
				}
			}
			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < 0
					}
				}

				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 350 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 300 }
				}
			}
			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < 50
					}
				}

				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 250 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 200 }
				}
			}
			else = {
				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 150 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 100 }
				}
			}
		}

		# Transfer scaled wealth based on Pope's opinion of you and your piety. - Duke tier
		else_if = {
			limit = { real_tier = DUKE }

			if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < -75
					}
				}

				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 1200 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 900 }
				}
			}
			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < -25
					}
				}

				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 700 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 500 }
				}
			}
			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < 0
					}
				}

				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 450 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 400 }
				}
			}
			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < 50
					}
				}

				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 350 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 300 }
				}
			}
			else = {
				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 250 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 150 }
				}
			}
		}

		# Transfer scaled wealth based on Pope's opinion of you and your piety. - King tier
		else_if = {
			limit = { real_tier = KING }

			if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < -75
					}
				}

				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 1500 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 1200 }
				}
			}
			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < -25
					}
				}

				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 900 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 750 }
				}
			}
			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < 0
					}
				}

				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 600 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 500 }
				}
			}
			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < 50
					}
				}

				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 400 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 350 }
				}
			}
			else = {
				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 300 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 250 }
				}
			}
		}

		# Transfer scaled wealth based on Pope's opinion of you and your piety. - Emperor tier
		else_if = {
			limit = { real_tier = EMPEROR }

			if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < -75
					}
				}

				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 1800 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 1500 }
				}
			}
			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < -25
					}
				}

				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 1000 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 800 }
				}
			}
			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < 0
					}
				}

				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 700 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 600 }
				}
			}
			else_if = {
				limit = {
					reverse_opinion = {
						who = FROM
						value < 50
					}
				}

				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 500 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 450 }
				}
			}
			else = {
				if = {
					limit = { piety < 350 }
					set_variable = { which = local_prestige_gain value = 400 }
				}
				else = {
					set_variable = { which = local_prestige_gain value = 350 }
				}
			}
		}

		set_variable = {
			which = local_prestige_cost
			which = local_prestige_gain
		}

		multiply_variable = {
			which = local_prestige_cost
			value = -1
		}
	}

	option = {
		name = EVTOPTAHFP23006

		prestige = local_prestige_cost

		FROM = {
			show_scope_change = no

			prestige = local_prestige_gain
		}

		excommunicate = no

		hidden_effect = {
			sound_effect = excommunication_lifted

			reverse_opinion = {
				name = opinion_repented_sins
				who = FROM
				years = 20
			}
		}

		character_event = { id = HFP.23007 }
	}

	option = {
		name = EVTOPTBHFP23006

		ai_chance = { factor = 0 }
	}
}

# Excommunicated ruler forced to pay prestige
character_event = {
	id = HFP.23007
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESCAHFP23007
		picture = GFX_evt_pope
		trigger = { religion_group = christian }
	}
	desc = {
		text = EVTDESCBHFP23007
		picture = GFX_evt_bishop
		trigger = {
			NOR = {
				religion_group = christian
				religion_group = pagan_group
			}
		}
	}
	desc = {
		text = EVTDESCBHFP23007
		picture = GFX_evt_tribal_shrine
		trigger = { religion_group = pagan_group }
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTAHFP23007

		random = {
			chance = 5
			add_trait_stressed_effect = yes
		}
	}
}

# Vow of celibacy
letter_event = {
	id = HFP.23008
	desc = EVTDESCAHFP23008
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	trigger = {
		religion = FROM
	}

	option = {
		name = EVTOPTAHFP23008

		add_trait = celibate
		set_character_flag = flag_papal_celibacy
		excommunicate = no
		character_event = { id = HFP.23009 }

		hidden_effect = {
			sound_effect = excommunication_lifted

			reverse_opinion = {
				name = opinion_repented_sins
				who = FROM
				years = 20
			}
		}
	}

	option = {
		name = EVTOPTBHFP23008

		hidden_effect = {
			# Pope remembers what you asked for, no use spamming the decision, cheaty player.
			reverse_opinion = {
				name = opinion_pope_ex_demands_celibacy
				who = FROM
				years = 100
			}
		}

		ai_chance = { factor = 0 }
	}
}

# Excommunicated ruler forced to become celibate
character_event = {
	id = HFP.23009
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESCAHFP23009
		picture = GFX_evt_pope
		trigger = { religion_group = christian }
	}
	desc = {
		text = EVTDESCAHFP23009
		picture = GFX_evt_bishop
		trigger = {
			NOR = {
				religion_group = christian
				religion_group = pagan_group
			}
		}
	}
	desc = {
		text = EVTDESCAHFP23009
		picture = GFX_evt_tribal_shrine
		trigger = { religion_group = pagan_group }
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTAHFP23009
		tooltip_info = intrigue

		trigger = { intrigue >= 20 }

		remove_trait = celibate

		ai_chance = { factor = 100 }
	}

	option = {
		name = EVTOPTBHFP23009

		if = {
			limit = {
				OR = {
					trait = lustful
					trait = master_seducer
					trait = master_seductress
				}
			}

			random = {
				chance = 5
				add_trait_depressed_effect = yes
			}
		}

		ai_chance = { factor = 10 }
	}
}

# Forced to give up a son
letter_event = {
	id = HFP.23010
	desc = EVTDESCHFPA23010
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	trigger = {
		religion = FROM
	}

	immediate = {
		random_child = {
			limit = {
				is_adult = yes
				vassal_of = ROOT
				is_married = no
				is_ruler = no
				prisoner = no
				is_incapable = no
				has_inheritance_blocker = no

				ROOT = {
					player_heir = {
						NOT = { character = PREVPREV }
					}
				}
			}

			# The Pope is evil
			preferred_limit = {
				is_smart_trigger = yes
				is_strong_trigger = yes
				is_attractive_trigger = yes
			}

			preferred_limit = {
				OR = {
					is_smart_trigger = yes
					is_strong_trigger = yes
					is_attractive_trigger = yes
				}
			}

			preferred_limit = {
				is_dumb_trigger = no
				is_weak_trigger = no
				is_unattractive_trigger = no
			}

			save_event_target_as = son_monk_candidate
		}
	}

	option = {
		name = EVTOPTAHFP23010

		religion_head = {
			show_scope_change = no

			event_target:son_monk_candidate = {
				show_scope_change = no

				if = {
					limit = { is_female = yes }
					add_trait = nun
				}
				else = {
					add_trait = monk
				}

				move_character = PREV
			}
		}

		character_event = { id = HFP.23011 }
		excommunicate = no

		hidden_effect = {
			sound_effect = excommunication_lifted

			reverse_opinion = {
				name = opinion_repented_sins
				who = FROM
				years = 20
			}
		}
	}

	option = {
		name = EVTOPTBHFP23010

		hidden_effect = {
			# Pope remembers what you asked for, no use spamming the decision, cheaty player.
			reverse_opinion = {
				name = opinion_pope_ex_demands_child
				who = FROM
				years = 100
			}
		}

		ai_chance = { factor = 0 }
	}
}

character_event = {
	id = HFP.23011
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESCAHFP23011
		picture = GFX_evt_pope
		trigger = { religion_group = christian }
	}
	desc = {
		text = EVTDESCAHFP23011
		picture = GFX_evt_bishop
		trigger = {
			NOR = {
				religion_group = christian
				religion_group = pagan_group
			}
		}
	}
	desc = {
		text = EVTDESCAHFP23011
		picture = GFX_evt_tribal_shrine
		trigger = { religion_group = pagan_group }
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTAHFP23011
		tooltip_info = kind

		trigger = { trait = kind }

		random = {
			chance = 5
			add_trait_depressed_effect = yes
		}
	}

	option = {
		name = EVTOPTBHFP23011

		trigger = {
			NOT = { trait = kind }
		}
	}
}

# Forced abdication
letter_event = {
	id = HFP.23012
	desc = EVTDESCAHFP23012
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	trigger = {
		religion = FROM
	}

	option = {
		name = EVTOPTAHFP23012

		tooltip = {
			if = {
				limit = { is_female = yes }
				add_trait = nun
			}
			else = {
				add_trait = monk
			}

			excommunicate = no
			abdicate = yes
		}

		character_event = { id = HFP.23013 }

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 0.5
				trait = cynical
			}

			mult_modifier = {
				factor = 0.5
				trait = proud
			}

			mult_modifier = {
				factor = 0.5
				trait = ambitious
			}

			mult_modifier = {
				factor = 1.5
				trait = zealous
			}

			mult_modifier = {
				factor = 1.5
				trait = content
			}
		}
	}

	option = {
		name = EVTOPTBHFP23012

		hidden_effect = {
			# Pope remembers what you asked for, no use spamming the decision, cheaty player.
			reverse_opinion = {
				name = opinion_pope_ex_demands_abdication
				who = FROM
				years = 100
			}
		}

		ai_chance = { factor = 50 }
	}
}

# Ruler forced to abdicate
character_event = {
	id = HFP.23013
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESCAHFP23013
		picture = GFX_evt_pope
		trigger = { religion_group = christian }
	}
	desc = {
		text = EVTDESCAHFP23013
		picture = GFX_evt_bishop
		trigger = {
			NOR = {
				religion_group = christian
				religion_group = pagan_group
			}
		}
	}
	desc = {
		text = EVTDESCAHFP23013
		picture = GFX_evt_tribal_shrine
		trigger = { religion_group = pagan_group }
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTAHFP23013

		if = {
			limit = { is_female = yes }
			add_trait = nun
		}
		else = {
			add_trait = monk
		}

		# CleanSlate: Shouldn't characters also have to divorce all spouses and set aside all consorts?

		excommunicate = no

		hidden_effect = {
			sound_effect = excommunication_lifted
			transfer_crown_on_abdication_effect = yes

			reverse_opinion = {
				name = opinion_repented_sins
				who = FROM
				years = 20
			}

			# Send character to random theocracy within the realm
			random_realm_lord = {
				limit = {
					is_theocracy = yes
					religion = ROOT
				}

				preferred_limit = {
					reverse_opinion = {
						who = FROM
						value >= 20
					}

					vassal_of = FROM
				}

				preferred_limit = {
					vassal_of = FROM
				}

				save_event_target_as = target_theocracy_host
			}

			if = {
				limit = { can_apply_lame_nickname_trigger = yes }

				random_list = {
					20 = { }
					20 = { give_nickname = nick_the_hermit }
					20 = { give_nickname = nick_the_recluse }
					20 = { give_nickname = nick_the_absolved }

					40 = {
						if = {
							limit = { is_female = no }
							give_nickname = nick_the_monk
						}
						else = {
							give_nickname = nick_the_nun
						}
					}
				}
			}
		}

		abdicate = yes
		move_character = event_target:target_theocracy_host

		ai_chance = { factor = 100 }
	}
}

# Forced Papal Investiture
letter_event = {
	id = HFP.23014
	desc = EVTDESCAHFP23014
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	trigger = {
		religion = FROM
	}

	option = {
		name = EVTOPTAHFP23014

		primary_title = {
			show_scope_change = no

			revoke_law = investiture_law_1
			add_law_w_cooldown = investiture_law_0
		}

		excommunicate = no
		character_event = { id = HFP.23015 }

		hidden_effect = {
			sound_effect = excommunication_lifted

			reverse_opinion = {
				name = opinion_repented_sins
				who = FROM
				years = 20
			}
		}
	}

	option = {
		name = EVTOPTBHFP23014

		hidden_effect = {
			# Pope remembers what you asked for, no use spamming the decision, cheaty player.
			reverse_opinion = {
				name = opinion_pope_ex_demands_investiture
				who = FROM
				years = 100
			}
		}

		ai_chance = { factor = 0 }
	}
}

# Ruler forced to enact Papal Investiture
character_event = {
	id = HFP.23015
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESCAHFP23015
		picture = GFX_evt_pope
		trigger = { religion_group = christian }
	}
	desc = {
		text = EVTDESCBHFP23015
		picture = GFX_evt_bishop
		trigger = {
			NOR = {
				religion_group = christian
				religion_group = pagan_group
			}
		}
	}
	desc = {
		text = EVTDESCBHFP23015
		picture = GFX_evt_tribal_shrine
		trigger = { religion_group = pagan_group }
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTAHFP23015
	}
}

# Forced Gavelkind
letter_event = {
	id = HFP.23016
	desc = EVTDESCAHFP23016
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	trigger = {
		religion = FROM
	}

	option = {
		name = EVTOPTAHFP23016

		primary_title = {
			add_law = succ_gavelkind
		}

		hidden_effect = {
			any_demesne_title = {
				limit = {
					title = succ_law_title
					NOT = { has_law = succ_gavelkind }
				}

				add_law = {
					law = succ_gavelkind
					opinion_effect = no
				}
			}
		}

		excommunicate = no
		character_event = { id = HFP.23017 }

		hidden_effect = {
			sound_effect = excommunication_lifted

			reverse_opinion = {
				name = opinion_repented_sins
				who = FROM
				years = 20
			}
		}
	}

	option = {
		name = EVTOPTBHFP23016

		hidden_effect = {
			# Pope remembers what you asked for, no use spamming the decision, cheaty player.
			reverse_opinion = {
				name = opinion_pope_ex_demands_gavelkind
				who = FROM
				years = 100
			}
		}

		ai_chance = { factor = 0 }
	}
}

# Ruler forced to enact Gavelkind succession
character_event = {
	id = HFP.23017
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESCAHFP23017
		picture = GFX_evt_pope
		trigger = { religion_group = christian }
	}
	desc = {
		text = EVTDESCBHFP23017
		picture = GFX_evt_bishop
		trigger = {
			NOR = {
				religion_group = christian
				religion_group = pagan_group
			}
		}
	}
	desc = {
		text = EVTDESCBHFP23017
		picture = GFX_evt_tribal_shrine
		trigger = { religion_group = pagan_group }
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTAHFP23017
	}
}

# Pope wants a piece of Italy
letter_event = {
	id = HFP.23018
	desc = EVTDESCHFPA23018
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	trigger = {
		OR = {
			religion = catholic
			religion = fraticelli
		}
	}

	option = {
		name = EVTOPTAHFP23018

		excommunicate = no
		character_event = { id = HFP.23019 }

		hidden_effect = {
			sound_effect = excommunication_lifted

			reverse_opinion = {
				name = opinion_repented_sins
				who = FROM
				years = 20
			}
		}

		# First of all, if the ruler has Rome, it is asked automatically as an additional gift
		c_roma = {
			show_scope_change = no

			if = {
				limit = { holder = ROOT }

				grant_title = FROM

				# Pope vassalizes all vassal titles in the scope
				any_de_jure_vassal = {
					show_scope_change = no

					limit = {
						vassal_of = ROOT
						NOT = { character = ROOT }
					}

					set_defacto_liege = FROM
					character_event = { id = HF.20230 }
				}

				# Pope takes over any titles under the title he's taking over from you
				any_de_jure_vassal_title = {
					show_scope_change = no

					limit = { holder = ROOT }

					grant_title = FROM
				}
			}
		}

		# Secondly, check for all Duchies within the borders of the historical Donation of Pepin (Latium, Spoleto, Ancona, Ferrara, Benevento).
		# If the ruler owns them directly, the Pope takes the title, if his vassals do, said vassals will become the Papacy's vassals.
		any_title_under = {
			show_scope_change = no

			limit = {
				OR = {
					title = d_latium
					title = d_spoleto
					title = d_ancona
					title = d_ferrara
					title = d_benevento
				}
			}

			if = {
				limit = {
					holder = ROOT
					can_be_given_away = yes
				}

				grant_title = FROM

				any_de_jure_vassal = {
					show_scope_change = no

					limit = {
						vassal_of = ROOT
						NOT = { character = ROOT }
					}

					set_defacto_liege = FROM
					character_event = { id = HF.20230 }
				}

				any_de_jure_vassal_title = {
					show_scope_change = no

					limit = { holder = ROOT }

					grant_title = FROM
				}
			}
			else = {
				holder_scope = {
					show_scope_change = no

					if = {
						limit = {
							vassal_of = ROOT
							lower_real_tier_than = FROM
						}

						set_defacto_liege = FROM
						character_event = { id = HF.20230 }
					}
				}
			}
		}
	}

	option = {
		name = EVTOPTBHFP23018

		hidden_effect = {
			# Pope remembers what you asked for, no use spamming the decision, cheaty player.
			reverse_opinion = {
				name = opinion_pope_ex_demands_lands
				who = FROM
				years = 100
			}
		}

		ai_chance = { factor = 0 }
	}
}

# Ruler forced to give up Italian Lands
character_event = {
	id = HFP.23019
	desc = EVTDESCAHFP23019
	picture = GFX_evt_pope
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTAHFP23019
	}
}

# Pope requests independence
letter_event = {
	id = HFP.23020
	desc = EVTDESCHFPA23020
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	trigger = {
		OR = {
			religion = catholic
			religion = fraticelli
		}
	}

	option = {
		name = EVTOPTAHFP23020

		custom_tooltip = {
			text = TT_EVTOPTAHFP23020

			sound_effect = excommunication_lifted

			reverse_opinion = {
				name = opinion_repented_sins
				who = FROM
				years = 20
			}

			FROM = {
				set_defacto_liege = THIS
			}
		}

		excommunicate = no
		character_event = { id = HFP.23021 }
	}

	option = {
		name = EVTOPTBHFP23020

		hidden_effect = {
			# Pope remembers what you asked for, no use spamming the decision, cheaty player.
			reverse_opinion = {
				name = opinion_pope_ex_demands_independence
				who = FROM
				years = 100
			}
		}

		ai_chance = { factor = 0 }
	}
}

# Ruler forced to give independence to Papcy
character_event = {
	id = HFP.23021
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESCAHFP23021
		picture = GFX_evt_pope
		trigger = { religion_group = christian }
	}
	desc = {
		text = EVTDESCBHFP23021
		picture = GFX_evt_bishop
		trigger = {
			NOR = {
				religion_group = christian
				religion_group = pagan_group
			}
		}
	}
	desc = {
		text = EVTDESCBHFP23021
		picture = GFX_evt_tribal_shrine
		trigger = { religion_group = pagan_group }
	}

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTAHFP23021
	}
}

# Pope demands to become your liege.
letter_event = {
	id = HFP.23022
	desc = EVTDESCHFPA23022
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	trigger = {
		OR = {
			religion = catholic
			religion = fraticelli
		}
	}

	option = {
		name = EVTOPTAHFP23022

		excommunicate = no
		set_defacto_liege = FROM
		character_event = { id = HFP.23023 }

		hidden_effect = {
			sound_effect = excommunication_lifted

			reverse_opinion = {
				name = opinion_repented_sins
				who = FROM
				years = 20
			}
		}
	}

	option = {
		name = EVTOPTBHFP23022

		hidden_effect = {
			# Pope remembers what you asked for, no use spamming the decision, cheaty player.
			reverse_opinion = {
				name = opinion_pope_ex_demands_vassalization
				who = FROM
				years = 100
			}
		}

		ai_chance = { factor = 0 }
	}
}

# Ruler forced to become Papal vassal
character_event = {
	id = HFP.23023
	desc = EVTDESCAHFP23023
	picture = GFX_evt_pope
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTAHFP23023
	}
}

# on_war_ended_victory: restore spouse under enemy's concubinage
# FROM is Attacker
# ROOT is Defender
character_event = {
	id = HFP.23025

	is_triggered_only = yes # on_war_ended_victory
	hide_window = yes

	trigger = {
		ROOT = {
			any_consort = {
				FROM = {
					has_opinion_modifier = {
						name = opinion_abducted_spouse
						who = PREV
					}
				}
			}
		}
	}

	immediate = {
		ROOT = {
			any_consort = {
				limit = {
					FROM = {
						has_opinion_modifier = {
							name = opinion_abducted_spouse
							who = PREV
						}
					}
				}

				ROOT = { remove_consort = PREV }
				move_character = FROM
			}
		}
	}
}

# on_war_ended_defeat: restore spouse under enemy's concubinage
# FROM is Attacker
# ROOT is Defender
character_event = {
	id = HFP.23026

	is_triggered_only = yes
	hide_window = yes

	trigger = {
		FROM = {
			any_consort = {
				ROOT = {
					has_opinion_modifier = {
						name = opinion_abducted_spouse
						who = PREV
					}
				}
			}
		}
	}

	immediate = {
		FROM = {
			any_consort = {
				limit = {
					ROOT = {
						has_opinion_modifier = {
							name = opinion_abducted_spouse
							who = PREV
						}
					}
				}

				FROM = { remove_consort = PREV }
				move_character = ROOT
			}
		}
	}
}

# African rulers can pick a random Abrahamic sympathy
character_event = {
	id = HFP.23027
	desc = EVTDESCHFP23027
	picture = GFX_evt_church_council
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # african_tolerate_abrahamics, religious_decisions.txt

	option = { # Christianity
		name = {
			text = EVTOPTAHF23003
			trigger = { is_alternate_start = no }
		}
		name = {
			text = EVTOPTAHF23003_ALT
			trigger = { is_alternate_start = yes }
		}

		trigger = {
			OR = {
				any_neighbor_independent_ruler = {
					religion_group = christian
				}

				any_liege = {
					religion_group = christian
				}
			}

			NOT = { religion_group = christian } # Random World safety check
		}

		add_trait = sympathy_christendom
		clr_character_flag = flag_picking_sympathy

		ai_chance = {
			factor = 25

			trigger = {
				liege = {
					NOR = {
						trait = sympathy_islam
						trait = sympathy_judaism
					}
				}

				top_liege = {
					NOR = {
						trait = sympathy_islam
						trait = sympathy_judaism
					}
				}
			}

			mult_modifier = {
				factor = 0.25

				any_spouse = {
					OR = {
						trait = sympathy_islam
						trait = sympathy_judaism
					}
				}
			}

			mult_modifier = {
				factor = 1.5

				any_demesne_province = {
					religion_group = christian
					owned_by = PREV
				}
			}

			mult_modifier = {
				factor = 1.5
				any_courtier_or_vassal = { religion_group = christian }
			}
		}
	}

	option = { # Islam
		name = {
			text = EVTOPTBHF23003
			trigger = { is_alternate_start = no }
		}
		name = {
			text = EVTOPTBHF23003_ALT
			trigger = { is_alternate_start = yes }
		}

		trigger = {
			OR = {
				any_neighbor_independent_ruler = {
					religion_group = muslim
				}

				any_liege = {
					religion_group = muslim
				}
			}

			NOT = { religion_group = muslim } # Random World safety check
		}

		add_trait = sympathy_islam
		clr_character_flag = flag_picking_sympathy

		ai_chance = {
			factor = 25

			trigger = {
				liege = {
					NOR = {
						trait = sympathy_christendom
						trait = sympathy_judaism
					}
				}

				top_liege = {
					NOR = {
						trait = sympathy_christendom
						trait = sympathy_judaism
					}
				}
			}

			mult_modifier = {
				factor = 0.25

				spouse = {
					OR = {
						trait = sympathy_christendom
						trait = sympathy_judaism
					}
				}
			}

			mult_modifier = {
				factor = 1.5

				any_demesne_province = {
					religion_group = muslim
					owned_by = PREV
				}
			}

			mult_modifier = {
				factor = 1.5
				any_courtier_or_vassal = { religion_group = muslim }
			}
		}
	}

	option = { # Jews
		name = {
			text = EVTOPTCHF23003
			trigger = { is_alternate_start = no }
		}
		name = {
			text = EVTOPTCHF23003_ALT
			trigger = { is_alternate_start = yes }
		}

		trigger = {
			OR = {
				any_neighbor_independent_ruler = {
					religion_group = jewish_group
				}

				any_liege = {
					religion_group = jewish_group
				}
			}

			NOT = { religion_group = jewish_group } # Random World safety check
		}

		add_trait = sympathy_judaism
		clr_character_flag = flag_picking_sympathy

		ai_chance = {
			factor = 25

			trigger = {
				liege = {
					NOR = {
						trait = sympathy_islam
						trait = sympathy_christendom
					}
				}

				top_liege = {
					NOR = {
						trait = sympathy_islam
						trait = sympathy_christendom
					}
				}
			}

			mult_modifier = {
				factor = 0.25

				spouse = {
					OR = {
						trait = sympathy_islam
						trait = sympathy_christendom
					}
				}
			}

			mult_modifier = {
				factor = 1.5

				any_demesne_province = {
					religion_group = jewish_group
					owned_by = PREV
				}
			}

			mult_modifier = {
				factor = 1.5
				any_courtier_or_vassal = { religion_group = jewish_group }
			}
		}
	}

	option = { # Changed mind
		name = EVTOPTDHFP23027

		ai_chance = { factor = 0 }
	}
}

# on_startup: Cleanup the Maniots on Charlemagne start if Hellenism is off
character_event = {
	id = HFP.23028

	is_triggered_only = yes # on_startup
	hide_window = yes

	trigger = {
		owns = event_target:pulse_province
		is_save_game = no
		year < 800
		is_alternate_start = no

		has_game_rule = {
			name = hellenism_rule
			value = off
		}
	}

	immediate = {
		c_monemvasia = {
			location = {
				religion = orthodox
			}
		}
	}
}