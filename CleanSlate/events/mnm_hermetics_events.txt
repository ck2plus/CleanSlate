###########################################
#                                         #
# M&M Hermetics Society Events            #
#                                         #
# ID MNM.1000-MNM.1979                    #
#                                         #
###########################################

# IDs:
# 1000-1099 David
# 1100-1199 Henrik
# 1200-1399 Milla
# 1400-1599 Mathilda
# 1600-1799 Drikus
# 1800-1899 Joel
# 1900-1999 Emil


namespace = MNM

### JOINING ###

# ROOT is character
# FROM is society
letter_event = {
	id = MNM.100
	desc = EVTDESC_MNM_100 # Shamefully borrowing from the Pomandres
	border = GFX_event_letter_frame_religion
	portrait = event_target:inviter

	is_triggered_only = yes # on_character_ask_to_join_society

	trigger = {
		FROM = { is_society = hermetics }
	}

	immediate = {
		set_character_flag = society_join_block

		# Find a non-imprisoned member
		FROM = {
			if = {
				limit = {
					leader = { prisoner = yes }

					any_society_member = {
						prisoner = no
						is_society_grandmaster = no
					}
				}

				random_society_member = {
					limit = {
						is_society_grandmaster = no
						prisoner = no
					}

					preferred_limit = { society_rank == 4 }
					preferred_limit = { society_rank == 3 }
					preferred_limit = { society_rank == 2 }

					save_event_target_as = inviter
				}
			}
			# Grandmaster is not in prison, or everyone is somehow in prison so just use the leader anyway
			else = {
				leader = { save_event_target_as = inviter }
			}
		}
	}

	option = {
		name = EVTOPTA_MNM_100

		join_society = hermetics
		clr_character_flag = society_join_block
	}
}

# MISSIONS

# Mission tombola
# CleanSlate: Offset to avoid firing events on same day as random society events. Previously occured between tombola and quest event.
character_event = {
	id = MNM.1000

	hide_window = yes
	is_triggered_only = yes # on_society_bi_yearly_pulse

	immediate = {
		character_event = {
			id = MNM.1001
			days = 7
			random = 7
		}
	}
}

# Mission tombola
character_event = {
	id = MNM.1001

	hide_window = yes
	is_triggered_only = yes

	only_capable = yes
	prisoner = no

	trigger = {
		society_member_of = hermetics
		has_any_quest = no
		is_inaccessible_trigger = no
		NOT = { has_character_modifier = quest_cooldown_timer }

		society = {
			any_society_member = {
				NOT = { character = ROOT }
				prisoner = no
				is_within_diplo_range = ROOT
				opinion = { who = ROOT value >= 0 }
			}
		}
	}

	immediate = {
		# Picks out mission giver
		random_list = {
			20 = { # International society member
				society = {
					random_society_member = {
						limit = {
							NOT = { character = ROOT }
							prisoner = no
							is_within_diplo_range = ROOT
							opinion = { who = ROOT value >= 0 }
						}

						save_event_target_as = hermetic_collaborator
					}
				}
			}

			40 = { # Realm society member
				trigger = {
					society = {
						any_society_member = {
							NOT = { character = ROOT }
							prisoner = no
							is_within_diplo_range = ROOT
							opinion = { who = ROOT value >= 0 }
							same_realm = ROOT
						}
					}
				}

				society = {
					random_society_member = {
						limit = {
							NOT = { character = ROOT }
							prisoner = no
							is_within_diplo_range = ROOT
							opinion = { who = ROOT value >= 0 }
							same_realm = ROOT
						}

						save_event_target_as = hermetic_collaborator
					}
				}
			}

			40 = { # Apprentice
				trigger = {
					any_courtier_or_vassal = {
						has_minor_title = title_hermetics_apprentice
						prisoner = no
					}
				}

				random_courtier_or_vassal = {
					limit = { has_minor_title = title_hermetics_apprentice }
					save_event_target_as = hermetic_collaborator
				}
			}
		}


		# Randomizes mission
		random_list = {

			20 = { # Find an apprentice
				trigger = {
					ai = no
					NOT = { has_assigned_minor_title = title_hermetics_apprentice }
				}

				society_quest_event = { id = MNM.1405 }
			}

			20 = { # Build a laboratory
				trigger = {
					trigger_if = {
						limit = { ai = yes }

						is_landed = yes
						society_rank == 4
					}

					NOR = {
						has_character_flag = building_laboratory
						has_character_flag = built_laboratory
					}
				}

				society_quest_event = { id = MNM.1121 }
			}

			15 = { # Find a rare scroll/book/tablet
				trigger = { is_landed = yes }
				society_quest_event = { id = MNM.1418 }
			}

			10 = { # Infiltrate lab
				trigger = {
					society = {
						any_society_member = {
							is_within_diplo_range = ROOT
							reverse_opinion = { who = event_target:hermetic_collaborator value < 20 }
							reverse_opinion = { who = ROOT value < 20 }

							NOR = {
								character = ROOT
								character = event_target:hermetic_collaborator
								has_character_flag = infiltration_rival
								has_character_flag = infiltration_mutual_dislike
								has_character_flag = infiltration_rich
							}
						}
					}
				}

				society_quest_event = { id = MNM.1431 }
			}

			20 = { # Acquire/gather ingredients
				trigger = {
					is_landed = yes
					NOT = {
						any_artifact = { has_artifact_flag = ingredient }
					}
					event_target:hermetic_collaborator = { ai = yes }
				}

				society_quest_event = { id = MNM.1802 }
			}

			10 = { # Observe stars
				society_quest_event = { id = MNM.1829 }
			}

			105 = { # AI bypasses missions at times
				trigger = { ai = yes }

				random_list = {
					70 = {
						mult_modifier = {
							factor = 0.9
							society_influence >= 30
						}
						mult_modifier = {
							factor = 0.9
							society_influence >= 40
						}
						mult_modifier = {
							factor = 0.8
							society_influence >= 50
						}
						mult_modifier = {
							factor = 0.7
							society_influence >= 70
						}
						mult_modifier = {
							factor = 0.6
							society_influence >= 80
						}
						mult_modifier = {
							factor = 0.5
							society_influence >= 90
						}

						add_mission_succeed_influence_effect = yes
					}

					30 = { add_mission_fail_influence_effect = yes }
				}
			}

			175 = {
				trigger = { ai = yes }
				# Do nothing for AI
			}
		}
	}
}

# Mission: Building a Laboratory
# Flags:
# Temporary:
# building_laboratory (cleared at end)
# decided_on_glass (cleared at end)
# decided_on_crucibles (cleared at end)
# decided_on_tools (cleared at end)
# decided_on_books (cleared at end)
# Not Temporary:
# built_laboratory (not cleared -> set at end, marks this as done for this character)
# hidden_lab (not cleared -> to be used to weight stealing of secrets)
# very_hidden_lab (not cleared -> to be used to weight stealing of secrets)
character_event = {
	id = MNM.1100
	desc = EVTDESC_MNM_1100
	picture = GFX_evt_castle_construction
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # mnm_hermetics_decisions.txt

	option = {
		name = EVTOPTA_MNM_1100

		hidden_effect = {
			set_variable = { which = local_laboratory_level value = 1 }
		}

		character_event = { id = MNM.1101 days = 7 }
	}

	option = {
		name = EVTOPTB_MNM_1100

		wealth = 50
		clr_character_flag = building_laboratory
	}
}

# Where should the Laboratory be built?
character_event = {
	id = MNM.1101
	desc = EVTDESC_MNM_1101
	picture = GFX_evt_castle_construction
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		has_quest = quest_hermetics_build_laboratory
	}

	option = {
		name = EVTOPTA_MNM_1101 # In my Castle, hidden away

		custom_tooltip = {
			text = hidden_lab_tooltip
			set_character_flag = hidden_lab
			change_variable = { which = local_laboratory_level value = 2 }
		}
	}

	option = {
		name = EVTOPTB_MNM_1101 # In an accessible place

		custom_tooltip = {
			text = accessible_lab_tooltip
			change_variable = { which = local_laboratory_level value = 5 }
		}
	}

	option = {
		# On an island or other very remote place
		name = {
			text = EVTOPTC_MNM_1101
			trigger = {
				capital_scope = { is_coastal = yes }
			}
		}
		name = {
			text = EVTOPTD_MNM_1101
			trigger = {
				capital_scope = { is_coastal = no }
			}
		}

		trigger = {
			OR = {
				intrigue >= 15
				trait = paranoid
			}
		}

		custom_tooltip = {
			text = very_hidden_lab_tooltip
			set_character_flag = very_hidden_lab
			change_variable = { which = local_laboratory_level value = 3 }
		}
	}

	after = {
		character_event = { id = MNM.1102 months = 1 }
	}
}

# What kind of laboratory should we build?
character_event = {
	id = MNM.1102
	desc = EVTDESC_MNM_1102
	picture = GFX_evt_weaponsmith
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1102

		custom_tooltip = {
			text = cheap_laboratory_setup

			change_variable = { which = local_laboratory_level value = 1 }
			set_variable = { which = local_lab_ambition value = 1 }

			random_list = { # Accidents
				25 = { } # Nothing Happens
				25 = { character_event = { id = MNM.1113 months = 1 } }
				25 = { character_event = { id = MNM.1114 months = 1 } }
				25 = { character_event = { id = MNM.1115 months = 1 } }
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_1102

		wealth = -20

		custom_tooltip = {
			text = efficient_laboratory_setup

			change_variable = { which = local_laboratory_level value = 3 }
			set_variable = { which = local_lab_ambition value = 2 }

			random_list = { # Accidents
				25 = { } # Nothing Happens
				25 = { character_event = { id = MNM.1113 days = 45 } }
				25 = { character_event = { id = MNM.1114 days = 45 } }
				25 = { character_event = { id = MNM.1115 days = 45 } }
			}
		}
	}

	option = {
		name = EVTOPTC_MNM_1102 # State of the Art.

		trigger = {
			OR = {
				learning >= 15
				AND = { # Both master and apprentice have acceptable learning
					learning >= 12
					any_courtier_or_vassal = {
						has_minor_title = title_hermetics_apprentice
						learning >= 12
					}
				}
			}
		}

		wealth = -35

		custom_tooltip = {
			text = large_laboratory_setup

			change_variable = { which = local_laboratory_level value = 5 }
			set_variable = { which = local_lab_ambition value = 3 }

			random_list = { # Accidents
				25 = { } # Nothing Happens
				25 = { character_event = { id = MNM.1113 days = 45 } }
				25 = { character_event = { id = MNM.1114 days = 45 } }
				25 = { character_event = { id = MNM.1115 days = 45 } }
			}
		}
	}

	option = {
		name = EVTOPTD_MNM_1102 # Experimental setup

		trigger = {
			trigger_if = { # Both have good learning
				limit = {
					any_courtier_or_vassal = {
						has_minor_title = title_hermetics_apprentice
						learning >= 15
					}
				}
				learning >= 15
			}
			trigger_else = {
				learning >= 25
			}
		}

		wealth = -50

		custom_tooltip = {
			text = extravagant_laboratory_setup

			change_variable = { which = local_laboratory_level value = 8 }
			set_variable = { which = local_lab_ambition value = 4 }

			random_list = { # Accidents
				25 = { } # Nothing Happens
				25 = { character_event = { id = MNM.1113 days = 45 } }
				25 = { character_event = { id = MNM.1114 days = 45 } }
				25 = { character_event = { id = MNM.1115 days = 45 } }
			}
		}
	}

	after = {
		hidden_effect = {
			random_list = {
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_glass } }
					character_event = { id = MNM.1103 months = 1 }
				}
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_crucibles } }
					character_event = { id = MNM.1104 months = 1 }
				}
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_tools } }
					character_event = { id = MNM.1105 months = 1 }
				}
				25 = {
					trigger = { NOT = { has_character_flag = decided_on_books } }
					character_event = { id = MNM.1106 months = 1 }
				}
			}
		}
	}
}

# What kind of equipment do we need?
# Variant 1 - Flasks, Alembics, test tubes, etc
character_event = {
	id = MNM.1103
	desc = EVTDESC_MNM_1103
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		set_character_flag = decided_on_glass
	}

	option = {
		name = EVTOPTA_MNM_1103

		custom_tooltip = {
			text = non_fancy_laboratory_glass_tooltip

			change_variable = { which = local_laboratory_level value = 1 }
		}
	}
	option = {
		name = EVTOPTB_MNM_1103

		wealth = -20

		custom_tooltip = {
			text = fancy_laboratory_glass_tooltip

			change_variable = { which = local_laboratory_level value = 2 }
		}
	}

	after = {
		hidden_effect = {
			change_variable = { which = local_lab_ambition value = -1 }

			if = {
				limit = {
					check_variable = {
						which = local_lab_ambition
						value >= 1
					}
				}

				random_list = {
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						character_event = { id = MNM.1103 months = 1 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						character_event = { id = MNM.1104 months = 1 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						character_event = { id = MNM.1105 months = 1 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						character_event = { id = MNM.1106 months = 1 }
					}
				}
			}
			else = {
				character_event = { id = MNM.1107 months = 2 }
			}
		}
	}
}

# Variant 2 - Crucibles
character_event = {
	id = MNM.1104
	desc = EVTDESC_MNM_1104
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		set_character_flag = decided_on_crucibles
	}

	option = {
		name = EVTOPTA_MNM_1104

		custom_tooltip = {
			text = non_fancy_laboratory_crucibles_tooltip

			change_variable = { which = local_laboratory_level value = 1 }
		}
	}

	option = {
		name = EVTOPTB_MNM_1104

		wealth = -20

		custom_tooltip = {
			text = fancy_laboratory_crucibles_tooltip

			change_variable = { which = local_laboratory_level value = 2 }
		}
	}

	after = {
		hidden_effect = {
			change_variable = { which = local_lab_ambition value = -1 }

			if = {
				limit = {
					check_variable = {
						which = local_lab_ambition
						value >= 1
					}
				}

				random_list = {
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						character_event = { id = MNM.1103 months = 1 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						character_event = { id = MNM.1104 months = 1 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						character_event = { id = MNM.1105 months = 1 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						character_event = { id = MNM.1106 months = 1 }
					}
				}
			}
			else = {
				character_event = { id = MNM.1107 months = 2 }
			}
		}
	}
}

# Variant 3 - Iron Tools
character_event = {
	id = MNM.1105
	desc = EVTDESC_MNM_1105
	picture = GFX_evt_weaponsmith
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		set_character_flag = decided_on_tools
	}

	option = {
		name = EVTOPTA_MNM_1105

		custom_tooltip = {
			text = non_fancy_laboratory_tools_tooltip

			change_variable = { which = local_laboratory_level value = 1 }
		}
	}
	option = {
		name = EVTOPTB_MNM_1105

		wealth = -20

		custom_tooltip = {
			text = fancy_laboratory_tools_tooltip

			change_variable = { which = local_laboratory_level value = 2 }
		}
	}

	after = {
		hidden_effect = {
			change_variable = { which = local_lab_ambition value = -1 }

			if = {
				limit = {
					check_variable = {
						which = local_lab_ambition
						value >= 1
					}
				}

				random_list = {
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						character_event = { id = MNM.1103 months = 1 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						character_event = { id = MNM.1104 months = 1 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						character_event = { id = MNM.1105 months = 1 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						character_event = { id = MNM.1106 months = 1 }
					}
				}
			}
			else = {
				character_event = { id = MNM.1107 months = 2 }
			}
		}
	}
}

# Variant 4 - Books
# Herbals, Lapidarii, etc
character_event = {
	id = MNM.1106
	desc = EVTDESC_MNM_1106
	picture = GFX_evt_book_carolingian_script
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		set_character_flag = decided_on_books
	}

	option = {
		name = EVTOPTA_MNM_1106

		custom_tooltip = {
			text = non_fancy_laboratory_books_tooltip

			change_variable = { which = local_laboratory_level value = 1 }
		}
	}

	option = {
		name = EVTOPTB_MNM_1106

		wealth = -20

		custom_tooltip = {
			text = fancy_laboratory_books_tooltip

			change_variable = { which = local_laboratory_level value = 2 }
		}
	}

	after = {
		hidden_effect = {
			change_variable = { which = local_lab_ambition value = -1 }

			if = {
				limit = {
					check_variable = {
						which = local_lab_ambition
						value >= 1
					}
				}

				random_list = {
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						character_event = { id = MNM.1103 months = 1 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						character_event = { id = MNM.1104 months = 1 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						character_event = { id = MNM.1105 months = 1 }
					}
					25 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						character_event = { id = MNM.1106 months = 1 }
					}
				}
			}
			else = {
				character_event = { id = MNM.1107 months = 2 }
			}
		}
	}
}

# Work is done
character_event = {
	id = MNM.1107

	hide_window = yes
	is_triggered_only = yes

	immediate = {
		set_character_flag = built_laboratory
		clr_character_flag = building_laboratory
		clr_character_flag = decided_on_glass
		clr_character_flag = decided_on_crucibles
		clr_character_flag = decided_on_tools
		clr_character_flag = decided_on_books

		if = {
			limit = {
				check_variable = {
					which = local_laboratory_level
					value < 6
				}
			}

			character_event = { id = MNM.1108 } # Cheap Laboratory
		}
		else_if = {
			limit = {
				check_variable = {
					which = local_laboratory_level
					value < 12
				}
			}

			character_event = { id = MNM.1109 } # Normal Laboratory
		}
		else_if = {
			limit = {
				check_variable = {
					which = local_laboratory_level
					value < 18
				}
			}

			character_event = { id = MNM.1110 } # Good Laboratory
		}
		else_if = {
			limit = {
				check_variable = {
					which = local_laboratory_level
					value < 23
				}
			}

			narrative_event = { id = MNM.1111 } # Great Laboratory
		}
		else = {
			narrative_event = { id = MNM.1112 } # Best Laboratory
		}
	}
}

# Finished Cheap Lab
character_event = {
	id = MNM.1108
	desc = EVTDESC_MNM_1108
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1108

		add_character_modifier = {
			name = cheap_laboratory
			duration = -1
		}

		character_event = { id = MNM.1122 }
	}
}

# Finished Normal Lab
character_event = {
	id = MNM.1109
	desc = EVTDESC_MNM_1109
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1109

		economy_techpoints = 5

		add_character_modifier = {
			name = normal_laboratory
			duration = -1
		}

		character_event = { id = MNM.1122 }
	}
}

# Finished Good Lab
character_event = {
	id = MNM.1110
	desc = EVTDESC_MNM_1110
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1110

		economy_techpoints = 15

		add_character_modifier = {
			name = good_laboratory
			duration = -1
		}

		character_event = { id = MNM.1122 }
	}
}

# Finished Great Lab
narrative_event = {
	id = MNM.1111
	title = EVTNAME_MNM_1111
	desc = EVTDESC_MNM_1111
	picture = GFX_evt_experiment
	border = GFX_event_narrative_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1111

		economy_techpoints = 30

		add_character_modifier = {
			name = great_laboratory
			duration = -1
		}

		character_event = { id = MNM.1122 }
	}
}

# Finished Best Lab
narrative_event = {
	id = MNM.1112
	title = EVTNAME_MNM_1112
	desc = EVTDESC_MNM_1112
	picture = GFX_evt_experiment
	border = GFX_event_narrative_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1112

		economy_techpoints = 50

		add_character_modifier = {
			name = best_laboratory
			duration = -1
		}

		character_event = { id = MNM.1122 }
	}
}

# Laboratory Accidents
character_event = {
	id = MNM.1113
	desc = EVTDESC_MNM_1113
	picture = GFX_evt_burning_house_arabic
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		any_courtier = {
			score_value = { # Prioritizes selecting an interesting courtier...
				value = 10

				interesting_courtier_selection_score = yes
				prev_dislikes_this_score = yes
			}

			save_event_target_as = sacrifice_for_science
		}
	}

	option = {
		name = EVTOPTA_MNM_1113

		hidden_effect = {
			change_variable = { which = local_laboratory_level value = -2 }
		}
	}

	option = {
		name = EVTOPTB_MNM_1113

		custom_tooltip = {
			text = efforts_to_improve_lab_security_tooltip

			change_variable = { which = local_laboratory_level value = -1 }
		}

		wealth = -10
	}

	after = {
		if = {
			limit = { has_character_flag = hidden_lab } # Lab built in castle

			event_target:sacrifice_for_science = {
				show_scope_change = no

				add_maimed_trait_effect = yes

				if = {
					limit = {
						is_close_relative = ROOT
						NOT = { trait = cruel }
					}

					random = {
						chance = 20

						ROOT = {
							show_scope_change = no
							add_trait_depressed_effect = yes
						}
					}
				}
			}
		}

		# destroy ingredients
		if = {
			limit = {
				any_artifact = { has_artifact_flag = ingredient }
			}

			destroy_random_ingredients_effect = yes
		}
	}
}

# Locals are gossiping
character_event = {
	id = MNM.1114
	desc = EVTDESC_MNM_1114
	picture = GFX_evt_riots_byzantine
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1114

		custom_tooltip = {
			text = accomodate_gossipers_tooltip

			change_variable = { which = local_laboratory_level value = -2 }
		}

	}

	option = {
		name = EVTOPTB_MNM_1114

		prestige = -50
	}
}

# Rotting Ingredients
character_event = {
	id = MNM.1115
	desc = EVTDESC_MNM_1115
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1115

		hidden_effect = {
			change_variable = { which = local_laboratory_level value = -1 }
		}
	}

	option = {
		name = EVTOPTB_MNM_1115

		wealth = -25

		hidden_effect = {
			change_variable = { which = local_laboratory_level value = 1 }
		}
	}

	after = {
		# destroy ingredients
		if = {
			limit = {
				OR = {
					has_a_herb_ingredient_trigger = yes
					has_an_animal_part_ingredient_trigger = yes
				}
			}

			custom_tooltip = {
				text = random_ingredients_are_destroyed_tt
				destroy_random_herb_or_animal_part_ingredients_effect = yes
			}
		}
	}
}

# Mission: Build a Laboratory
# Letter from quest giver
society_quest_event = {
	id = MNM.1121

	desc = {
		text = EVTDESC_MNM_1121
		trigger = {
			event_target:hermetic_collaborator = {
				NOT = { has_minor_title = title_hermetics_apprentice }
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1121_apprentice
		trigger = {
			event_target:hermetic_collaborator = {
				has_minor_title = title_hermetics_apprentice
			}
		}
	}

	is_triggered_only = yes

	option = {
		name = ACCEPT

		set_quest = quest_hermetics_build_laboratory
	}

	option = {
		name = DECLINE

		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			days = 1000
			hidden = yes
		}

		ai_chance = { factor = 0 }
	}
}

# Quest Completed
character_event = {
	id = MNM.1122
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	desc = {
		text = EVTDESC_MNM_1122_normal
		trigger = {
			NOR = {
				has_character_modifier = good_laboratory
				has_character_modifier = great_laboratory
				has_character_modifier = best_laboratory
			}
		}
	}

	desc = {
		text = EVTDESC_MNM_1122_rich
		trigger = {
			OR = {
				has_character_modifier = good_laboratory
				has_character_modifier = great_laboratory
				has_character_modifier = best_laboratory
			}
		}
	}

	trigger = { has_quest = quest_hermetics_build_laboratory }

	option = {
		name = EVTOPTA_MNM_1122

		clr_quest = quest_hermetics_find_apprentice
		sound_effect = hermetic_society_perform_experiment

		if = {
			limit = { has_character_modifier = best_laboratory }
			add_society_currency_major_effect = yes
		}
		else_if = {
			limit = {
				OR = {
					has_character_modifier = good_laboratory
					has_character_modifier = great_laboratory
				}
			}

			add_society_currency_medium_effect = yes
		}
		else = {
			add_society_currency_minor_effect = yes
		}
	}
}


# Mission: Find an apprentice
society_quest_event = {
	id = MNM.1405
	desc = EVTDESC_MNM_1405

	is_triggered_only = yes

	option = {
		name = ACCEPT

		set_quest = quest_hermetics_find_apprentice

		character_event = {
			id = MNM.1408
			months = 5
			random = 50
		}
	}

	option = {
		name = DECLINE

		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			days = 1000
			hidden = yes
		}

		ai_chance = { factor = 0 }
	}
}

# Still no apprentice? Make one
# What about this servant?
character_event = {
	id = MNM.1408
	desc = EVTDESC_MNM_1408
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { has_quest = quest_hermetics_find_apprentice }

	immediate = {
		random_list = {
			50 = {
				mult_modifier = {
					factor = 1.5
					is_female = no
				}

				create_random_priest = {
					random_traits = yes
					dynasty = none
					female = yes
					age = 28
				}
			}

			50 = {
				mult_modifier = {
					factor = 1.5
					is_female = yes
				}

				create_random_priest = {
					random_traits = yes
					dynasty = none
					female = no
					age = 28
				}
			}
		}

		new_character = {
			save_event_target_as = apprentice_candidate
			remove_trait = slow
			remove_trait = imbecile
			remove_trait = inbred
			remove_trait = dull
			remove_trait = zealous
			remove_trait = cynical
			remove_trait = genius
			remove_trait = quick
			remove_trait = shrewd
			remove_trait = slothful

			# Add great trait
			random_list = {
				10 = { add_trait = genius }
				10 = { add_trait = quick }
				10 = { add_trait = shrewd }
				10 = { add_trait = mystic }
				10 = { add_trait = gardener }
				10 = { trigger = { NOT = { religion_group = muslim } } add_trait = scholar }
				10 = { trigger = { religion_group = muslim } add_trait = faqih }
				10 = { trigger = { has_dlc = Reapers } add_trait = physician }
				40 = { } # Nothing
			}

			# Add good trait
			random_list = {
				10 = { add_trait = erudite }
				10 = { add_trait = diligent }

				10 = {
					remove_trait = wroth
					add_trait = patient
				}

				10 = {
					remove_trait = lustful
					add_trait = chaste
				}

				30 = {
					remove_trait = content
					add_trait = ambitious
				}
			}

			while = {
				limit = { learning < 10 }
				change_learning = 1
			}
		}
	}

	option = {
		name = EVTOPTA_MNM_1408

		event_target:apprentice_candidate = {
			show_scope_change = no

			give_minor_title = title_hermetics_apprentice
		}

		clr_quest = quest_hermetics_find_apprentice
		sound_effect = hermetic_society_perform_experiment
		add_society_currency_minor_effect = yes
	}

	option = {
		name = EVTOPTB_MNM_1408

		custom_tooltip = { text = EVTOPTB_MNM_1408_TT }
	}
}

# You completed the quest by assigning someone the title
character_event = {
	id = MNM.1409
	desc = EVTDESC_MNM_1409
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # triggered from the title_hermetics_apprentice gain_effect

	option = {
		name = EVTOPTA_MNM_1409

		clr_quest = quest_hermetics_find_apprentice
		sound_effect = hermetic_society_perform_experiment

		if = {
			limit = { FROM = { learning < 12 } }
			add_society_currency_minor_effect = yes
		}
		else = {
			add_society_currency_medium_effect = yes
		}
	}
}

# Misc: apprenticeship
# Ping event for apprenticeship completion
character_event = {
	id = MNM.1413

	hide_window = yes
	is_triggered_only = yes # triggered from the title_hermetics_apprentice gain_effect

	trigger = {
		liege = {
			character = FROMFROM
			is_alive = yes
			society_member_of = hermetics
		}

		has_minor_title = title_hermetics_apprentice
	}

	immediate = {
		FROMFROM = { character_event = { id = MNM.1414 } }
	}
}

# Apprenticeship completion
character_event = {
	id = MNM.1414
	desc = EVTDESC_MNM_1414
	picture = GFX_evt_gathering_of_minds
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1414

		add_society_currency_major_effect = yes

		FROM = {
			show_scope_change = no
			set_character_flag = completed_apprenticeship
			remove_title = title_hermetics_apprentice
			change_learning = 2
		}
	}
}

# Apprentice died
character_event = {
	id = MNM.1415

	hide_window = yes
	is_triggered_only = yes # on_death

	is_in_society = yes
	ai = yes

	trigger = {
		society_member_of = hermetics
		has_minor_title = title_hermetics_apprentice

		NOR = {
			death_no_trace_trigger = yes
			death_in_china_trigger = yes
		}
	}

	immediate = {
		any_player = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					name = opinion_hermetic_apprentice
				}
			}

			character_event = { id = MNM.1416 }

			if = {
				limit = { has_character_flag = apprentice_hermetic_gathering }
				clear_delayed_event = { id = MNM.1825 }
				character_event = { id = MNM.1825 }
			}
		}
	}
}

# Notification of dead apprentice
character_event = {
	id = MNM.1416
	picture = GFX_evt_death
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1416_A
		trigger = {
			opinion = { who = FROM value >= 0 }
			FROM = { learning >= 12 }
		}
	}
	desc = {
		text = EVTDESC_MNM_1416_B
		trigger = {
			OR = {
				opinion = { who = FROM value < 0 }
				FROM = { learning < 12 }
			}
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1416
	}
}

# Clear Apprentice title upon death or leaving Hermetics
character_event = {
	id = MNM.1611

	is_triggered_only = yes # on_character_leave_society, on_death
	hide_window = yes

	trigger = { society_member_of = hermetics }

	immediate = {
		any_courtier_or_vassal = {
			limit = { has_minor_title = title_hermetics_apprentice }
			remove_title = title_hermetics_apprentice
		}
	}
}


# Mission: Find rare scroll/tome/tablet
society_quest_event = {
	id = MNM.1418
	desc = EVTDESC_MNM_1418
	portrait = event_target:hermetic_collaborator

	is_triggered_only = yes

	option = {
		name = ACCEPT

		event_target:hermetic_collaborator = {
			show_scope_change = no

			set_quest_target = {
				id = quest_hermetics_find_text
				holder = ROOT
			}
		}

		letter_event = { id = MNM.1420 days = 5 }
	}

	option = {
		name = DECLINE

		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			days = 1000
			hidden = yes
		}

		ai_chance = { factor = 0 }
	}
}

# Where should we go looking?
letter_event = {
	id = MNM.1420
	border = GFX_event_letter_frame_religion
	portrait = event_target:hermetic_collaborator

	is_triggered_only = yes

	trigger = { has_quest = quest_hermetics_find_text }

	immediate = {
		set_character_flag = do_not_disturb

		event_target:hermetic_collaborator = { # Chance of having Alexandria as an option
			random = {
				chance = 10

				mult_modifier = {
					factor = 1.2
					learning >= 12
				}
				mult_modifier = {
					factor = 1.2
					learning >= 14
				}
				mult_modifier = {
					factor = 1.2
					learning >= 16
				}
				mult_modifier = {
					factor = 1.2
					learning >= 18
				}
				mult_modifier = {
					factor = 1.2
					learning >= 20
				}

				ROOT = { set_character_flag = alexandria }
			}
		}

		# Locations
		random_independent_ruler = {
			limit = {
				is_within_diplo_range = ROOT
				NOT = { same_realm = ROOT }

				any_realm_province = {
					is_capital = no
					held_under_PREV = yes
				}
			}

			random_realm_province = {
				limit = {
					is_capital = no
					held_under_PREV = yes
				}

				save_event_target_as = ruin_site
			#	owner = { top_liege = { save_event_target_as = ruin_site_top_liege } }
			}
		}

		if = {
			limit = { ai = no }
			random_independent_ruler = {
				limit = {
					is_within_diplo_range = ROOT
					NOT = { same_realm = ROOT }

					any_realm_title = {
						real_tier = DUKE

						OR = {
							title = d_alexandria
							title = d_damietta
							title = d_cairo
							title = d_aswan
							title = d_nobatia
							region = world_middle_east_jerusalem
							region = world_europe_south_east
							region = world_asia_minor
						}
					}
				}

				random_realm_province = {
					limit = { held_under_PREV = yes }

					save_event_target_as = ruin_site
				#	owner = { top_liege = { save_event_target_as = ruin_site_top_liege } }
				}
			}
		}

		random_realm_province = {
			limit = { held_under_PREV = yes }

			preferred_limit = {
				any_province_holding = { holding_type = temple }
				is_capital = no
			}

			save_event_target_as = temple_site
		}
	}

	desc = {
		text = EVTDESC_MNM_1420_A
		trigger = {
			OR = {
				NOT = { has_character_flag = alexandria }
				has_artifact = emerald_tablet
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1420_B
		trigger = {
			has_character_flag = alexandria
			NOT = { has_artifact = emerald_tablet }
		}
	}

	# Go to Alexandria!
	option = {
		name = EVTOPTA_MNM_1420

		trigger = {
			has_character_flag = alexandria
			NOT = { has_artifact = emerald_tablet }
		}

		custom_tooltip = { text = EVTOPTA_MNM_1420_TT }

		scaled_wealth = { value = -1 min = -200 }

		random_list = {
			20 = {
				mult_modifier = { learning >= 8 factor = 1.2 }
				mult_modifier = { learning >= 11 factor = 1.2 }
				mult_modifier = { learning >= 14 factor = 1.2 }
				mult_modifier = { learning >= 17 factor = 1.2 }
				mult_modifier = { learning >= 20 factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 8 } factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 11 } factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 14 } factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 17 } factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 20 } factor = 1.2 }

				custom_tooltip = { text = EVTOPTX_MNM_1420_SUCCESS }
				set_character_flag = A_SUCCESS
				tooltip = { add_society_currency_massive_effect = yes }
			}

			80 = {
				set_character_flag = A_FAIL

				tooltip = {
					clr_quest = {
						id = quest_hermetics_find_text
						failure = yes
					}
				}
			}
		}

		character_event = {
			id = MNM.1421
			months = 10
			random = 150
		}

		ai_chance = {
			factor = 1

			trigger = {
				scaled_wealth = 1
				wealth >= 200
			}
		}
	}

	# Search foreign ruin
	option = {
		name = EVTOPTB_MNM_1420

		custom_tooltip = { text = EVTOPTB_MNM_1420_TT }

		scaled_wealth = { value = -0.5 min = -100 }

		random_list = {
			35 = {
				mult_modifier = { learning >= 8 factor = 1.2 }
				mult_modifier = { learning >= 11 factor = 1.2 }
				mult_modifier = { learning >= 14 factor = 1.2 }
				mult_modifier = { learning >= 17 factor = 1.2 }
				mult_modifier = { learning >= 20 factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 8 } factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 11 } factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 14 } factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 17 } factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 20 } factor = 1.2 }

				custom_tooltip = { text = EVTOPTX_MNM_1420_SUCCESS }
				set_character_flag = B_SUCCESS
				tooltip = { add_society_currency_major_effect = yes }
			}

			65 = {
				set_character_flag = B_FAIL

				tooltip = {
					clr_quest = {
						id = quest_hermetics_find_text
						failure = yes
					}
				}
			}
		}

		character_event = {
			id = MNM.1421
			months = 5
			random = 75
		}

		ai_chance = {
			factor = 1

			trigger = {
				scaled_wealth = 0.5
				wealth >= 100
			}
		}
	}

	# Search local ruin
	option = {
		name = EVTOPTC_MNM_1420

		custom_tooltip = { text = EVTOPTC_MNM_1420_TT }

		scaled_wealth = { value = -0.2 min = -40 }

		random_list = {
			55 = {
				mult_modifier = { learning >= 8 factor = 1.2 }
				mult_modifier = { learning >= 11 factor = 1.2 }
				mult_modifier = { learning >= 14 factor = 1.2 }
				mult_modifier = { learning >= 17 factor = 1.2 }
				mult_modifier = { learning >= 20 factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 8 } factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 11 } factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 14 } factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 17 } factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 20 } factor = 1.2 }

				custom_tooltip = { text = EVTOPTX_MNM_1420_SUCCESS }
				set_character_flag = C_SUCCESS
				tooltip = { add_society_currency_medium_effect = yes }
			}

			45 = {
				set_character_flag = C_FAIL

				tooltip = {
					clr_quest = {
						id = quest_hermetics_find_text
						failure = yes
					}
				}
			}
		}

		character_event = {
			id = MNM.1421
			days = 100
			random = 50
		}

		ai_chance = {
			factor = 1

			trigger = {
				scaled_wealth = 0.2
				wealth >= 40
			}
		}
	}

	# Local antiquarian
	option = {
		name = EVTOPTD_MNM_1420

		custom_tooltip = { text = EVTOPTD_MNM_1420_TT }

		scaled_wealth = { value = -0.05 min = -10 }

		random_list = {
			70 = {
				mult_modifier = { learning >= 8 factor = 1.2 }
				mult_modifier = { learning >= 11 factor = 1.2 }
				mult_modifier = { learning >= 14 factor = 1.2 }
				mult_modifier = { learning >= 17 factor = 1.2 }
				mult_modifier = { learning >= 20 factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 8 } factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 11 } factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 14 } factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 17 } factor = 1.2 }
				mult_modifier = { event_target:hermetic_collaborator = { learning >= 20 } factor = 1.2 }

				custom_tooltip = { text = EVTOPTX_MNM_1420_SUCCESS }
				set_character_flag = D_SUCCESS
				tooltip = { add_society_currency_minor_effect = yes }
			}

			30 = {
				set_character_flag = D_FAIL

				tooltip = {
					clr_quest = {
						id = quest_hermetics_find_text
						failure = yes
					}
				}
			}
		}
		character_event = { id = MNM.1421 months = 1 random = 10 }
	}
}

# Ping event for outcome in book search
character_event = {
	id = MNM.1421

	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { has_quest = quest_hermetics_find_text }

			trigger_switch = {
				on_trigger 	= has_character_flag
				A_SUCCESS	= { narrative_event = { id = MNM.1422 } }
				B_SUCCESS	= { character_event = { id = MNM.1423 } }
				C_SUCCESS	= { character_event = { id = MNM.1424 } }
				D_SUCCESS	= { character_event = { id = MNM.1425 } }
				A_FAIL		= { character_event = { id = MNM.1426 } }
				B_FAIL		= { character_event = { id = MNM.1426 } }
				C_FAIL		= { character_event = { id = MNM.1426 } }
				D_FAIL		= { character_event = { id = MNM.1426 } }
			}
		}
		else = {
			clr_character_flag = A_FAIL
			clr_character_flag = B_FAIL
			clr_character_flag = C_FAIL
			clr_character_flag = D_FAIL
		}

		clr_character_flag = A_SUCCESS
		clr_character_flag = B_SUCCESS
		clr_character_flag = C_SUCCESS
		clr_character_flag = D_SUCCESS
		clr_character_flag = alexandria
		clr_character_flag = do_not_disturb
	}
}

# Emerald tablet in library of Alexandria
narrative_event = {
	id = MNM.1422
	title = EVTTITLE_MNM_1422
	desc = EVTDESC_MNM_1422
	picture = GFX_evt_religious_exultation
	border = GFX_event_narrative_frame_religion
	portrait = event_target:hermetic_collaborator

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1422

		add_artifact = emerald_tablet

		clr_quest = quest_hermetics_find_text
		sound_effect = hermetic_society_recover_scroll
		add_society_currency_massive_effect = yes

		hidden_effect = {
			opinion = {
				name = epic_adventure
				who = event_target:hermetic_collaborator
				years = 30
			}
		}

		reverse_opinion = {
			name = epic_adventure
			who = event_target:hermetic_collaborator
			years = 30
		}
	}
}

# You found tablet in old ruin
character_event = {
	id = MNM.1423
	desc = EVTDESC_MNM_1423
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_religion
	portrait = event_target:hermetic_collaborator

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1423

		clr_quest = quest_hermetics_find_text
		sound_effect = hermetic_society_recover_scroll
		add_society_currency_major_effect = yes

		hidden_effect = {
			opinion = {
				who = event_target:hermetic_collaborator
				name = great_adventure
				years = 30
			}
		}

		reverse_opinion = {
			who = event_target:hermetic_collaborator
			name = great_adventure
			years = 30
		}
	}
}

# You found old scroll in temple
character_event = {
	id = MNM.1424
	desc = EVTDESC_MNM_1424
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_religion
	portrait = event_target:hermetic_collaborator

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1424

		clr_quest = quest_hermetics_find_text
		sound_effect = hermetic_society_recover_scroll
		add_society_currency_medium_effect = yes

		hidden_effect = {
			opinion = {
				who = event_target:hermetic_collaborator
				name = nice_adventure
				years = 30
			}
		}

		reverse_opinion = {
			who = event_target:hermetic_collaborator
			name = nice_adventure
			years = 30
		}
	}
}

# You found tome in library
character_event = {
	id = MNM.1425
	desc = EVTDESC_MNM_1425
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	portrait = event_target:hermetic_collaborator

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1425

		clr_quest = quest_hermetics_find_text
		sound_effect = hermetic_society_recover_scroll
		add_society_currency_minor_effect = yes
	}
}

# Failure
character_event = {
	id = MNM.1426
	picture = GFX_evt_desert
	border = GFX_event_normal_frame_religion
	portrait = event_target:hermetic_collaborator

	desc = {
		text = EVTDESC_MNM_1426_A
		picture = GFX_evt_desert
		trigger = { has_character_flag = A_FAIL }
	}
	desc = {
		text = EVTDESC_MNM_1426_B
		picture = GFX_evt_pagan
		trigger = { has_character_flag = B_FAIL }
	}
	desc = {
		text = EVTDESC_MNM_1426_C
		picture = GFX_evt_bishop
		trigger = { has_character_flag = C_FAIL }
	}
	desc = {
		text = EVTDESC_MNM_1426_D
		picture = GFX_evt_market
		trigger = { has_character_flag = D_FAIL }
	}

	is_triggered_only = yes

	option = {
		name = CURSES

		clr_quest = {
			id = quest_hermetics_find_text
			failure = yes
		}

		if = {
			limit = { has_character_flag = A_FAIL }
			add_rival = event_target:hermetic_collaborator
		}

		clr_character_flag = A_FAIL
		clr_character_flag = B_FAIL
		clr_character_flag = C_FAIL
		clr_character_flag = D_FAIL
	}
}


# Mission: Infiltrate laboratory
society_quest_event = {
	id = MNM.1431
	portrait = event_target:hermetic_collaborator
	quest_target = event_target:infiltration_target

	desc = {
		text = EVTDESC_MNM_1431_A
		trigger = { event_target:infiltration_target = { has_character_flag = infiltration_rival } }
	}
	desc = {
		text = EVTDESC_MNM_1431_B
		trigger = { event_target:infiltration_target = { has_character_flag = infiltration_mutual_dislike } }
	}
	desc = {
		text = EVTDESC_MNM_1431_C
		trigger = { event_target:infiltration_target = { has_character_flag = infiltration_rich } }
	}

	is_triggered_only = yes

	immediate = {
		society = {
			random_list = {
				30 = { # Their nemesis
					trigger = {
						any_society_member = {
							is_within_diplo_range = ROOT
							is_rival = event_target:hermetic_collaborator
							reverse_opinion = { who = ROOT value < 20 }

							NOR = {
								has_character_flag = infiltration_rival
								has_character_flag = infiltration_mutual_dislike
								has_character_flag = infiltration_rich
							}
						}
					}

					random_society_member = {
						limit = {
							is_within_diplo_range = ROOT
							is_rival = event_target:hermetic_collaborator
							reverse_opinion = { who = ROOT value < 20 }

							NOR = {
								has_character_flag = infiltration_rival
								has_character_flag = infiltration_mutual_dislike
								has_character_flag = infiltration_rich
							}
						}

						save_event_target_as = infiltration_target
						set_character_flag = infiltration_rival
					}
				}

				10 = { # Shared dislike
					trigger = {
						any_society_member = {
							is_within_diplo_range = ROOT
							reverse_opinion = { who = ROOT value < 0 }
							reverse_opinion = { who = event_target:hermetic_collaborator value < 0 }

							NOR = {
								has_character_flag = infiltration_rival
								has_character_flag = infiltration_mutual_dislike
								has_character_flag = infiltration_rich
							}
						}
					}

					random_society_member = {
						limit = {
							is_within_diplo_range = ROOT
							reverse_opinion = { who = ROOT value < 0 }
							reverse_opinion = { who = event_target:hermetic_collaborator value < 0 }

							NOR = {
								has_character_flag = infiltration_rival
								has_character_flag = infiltration_mutual_dislike
								has_character_flag = infiltration_rich
							}
						}

						save_event_target_as = infiltration_target
						set_character_flag = infiltration_mutual_dislike
					}
				}

				10 = { # Rich target
					trigger = {
						any_society_member = {
							is_within_diplo_range = ROOT
							reverse_opinion = { who = ROOT value < 20 }
							reverse_opinion = { who = event_target:hermetic_collaborator value < 20 }

							NOR = {
								has_character_flag = infiltration_rival
								has_character_flag = infiltration_mutual_dislike
								has_character_flag = infiltration_rich
							}

							OR = {
								any_artifact = {
									has_artifact_flag = hermetics
									has_artifact_flag = text # CleanSlate: This is literally only the emerald_tablet, perhaps also allow inventions?
								}

								wealth >= 200
								has_character_modifier = best_laboratory
								has_character_modifier = great_laboratory
							}
						}
					}

					mult_modifier = {
						factor = 2
						ROOT = {
							OR = {
								trait = greedy
								trait = ambitious
							}
						}
					}

					random_society_member = {
						limit = {
							is_within_diplo_range = ROOT
							reverse_opinion = { who = ROOT value < 20 }
							reverse_opinion = { who = event_target:hermetic_collaborator value < 20 }

							NOR = {
								has_character_flag = infiltration_rival
								has_character_flag = infiltration_mutual_dislike
								has_character_flag = infiltration_rich
							}

							OR = {
								any_artifact = {
									has_artifact_flag = hermetics
									has_artifact_flag = text # CleanSlate: This is literally only the emerald_tablet, perhaps also allow inventions?
								}

								wealth >= 200
								has_character_modifier = best_laboratory
								has_character_modifier = great_laboratory
							}
						}

						save_event_target_as = infiltration_target
						set_character_flag = infiltration_rich
					}
				}

				1 = { # Fallback
					random_society_member = {
						limit = {
							is_within_diplo_range = ROOT
							reverse_opinion = { who = ROOT value < 20 }
							reverse_opinion = { who = event_target:hermetic_collaborator value < 20 }

							NOR = {
								has_character_flag = infiltration_rival
								has_character_flag = infiltration_mutual_dislike
								has_character_flag = infiltration_rich
							}
						}

						save_event_target_as = infiltration_target
						set_character_flag = infiltration_rich
					}
				}
			}
		}
	}

	option = {
		name = ACCEPT

		event_target:infiltration_target = {
			show_scope_change = no

			set_quest_target = {
				id = quest_hermetics_infiltrate_laboratory
				holder = ROOT
			}

			character_event = { id = MNM.1456 months = 5 } # Clear flags
		}

		hidden_effect = {
			event_target:hermetic_collaborator = {
				save_event_target_as = infiltration_companion

				opinion = {
					name = opinion_infiltration_companion
					who = ROOT
					months = 100
				}
			}
		}

		# Search for lab or skip to security
		if = {
			limit = {
				event_target:infiltration_target = {
					OR = {
						has_character_flag = hidden_lab
						has_character_flag = very_hidden_lab
					}
				}
			}

			letter_event = { id = MNM.1433 days = 14 }
		}
		else = {
			character_event = { id = MNM.1435 days = 14 }
		}
	}

	option = {
		name = DECLINE

		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			days = 1000
			hidden = yes
		}

		event_target:infiltration_target = {
			character_event = { id = MNM.1456 } # Clear flags
		}

		ai_chance = { factor = 0 }
	}
}

# Find out where the laboratory is hidden
letter_event = {
	id = MNM.1433
	desc = EVTDESC_MNM_1433
	border = GFX_event_letter_frame_intrigue
	portrait = event_target:infiltration_companion

	is_triggered_only = yes


	option = {
		name = EVTOPTA_MNM_1433

		custom_tooltip = { text = EVTOPTA_MNM_1433_TT }

		hidden_effect = {
			random_list = {
				33 = { # It goes quickly
					mult_modifier = { event_target:infiltration_companion = { intrigue >= 12 } factor = 1.2 }
					mult_modifier = { event_target:infiltration_companion = { intrigue >= 14 } factor = 1.2 }
					mult_modifier = { event_target:infiltration_companion = { intrigue >= 16 } factor = 1.2 }
					mult_modifier = { event_target:infiltration_companion = { intrigue >= 18 } factor = 1.2 }

					character_event = {
						id = MNM.1435
						days = 15
						random = 10
					}
				}

				33 = { # It goes slowly
					mult_modifier = { event_target:infiltration_companion = { intrigue >= 12 } factor = 1.1 }
					mult_modifier = { event_target:infiltration_companion = { intrigue >= 14 } factor = 1.1 }
					mult_modifier = { event_target:infiltration_companion = { intrigue >= 16 } factor = 1.1 }
					mult_modifier = { event_target:infiltration_companion = { intrigue >= 18 } factor = 1.1 }

					mult_modifier = {
						factor = 1.5
						event_target:infiltration_target = { has_character_flag = hidden_lab }
					}

					character_event = {
						id = MNM.1435
						days = 45
						random = 30
					}
				}

				33 = { # It goes super slow
					mult_modifier = {
						factor = 2
						event_target:infiltration_target = { has_character_flag = very_hidden_lab }
					}

					character_event = {
						id = MNM.1435
						days = 90
						random = 45
					}
				}
			}
		}
	}
}

# Get past the guards
character_event = {
	id = MNM.1435
	picture = GFX_evt_eavesdropping
	border = GFX_event_normal_frame_intrigue
	portrait = event_target:infiltration_companion

	desc = {
		text = EVTDESC_MNM_1435_A
		trigger = { event_target:infiltration_target = { has_character_flag = very_hidden_lab } }
	}
	desc = {
		text = EVTDESC_MNM_1435_B
		trigger = { event_target:infiltration_target = { has_character_flag = hidden_lab } }
	}
	desc = {
		text = EVTDESC_MNM_1435_C
		trigger = {
			event_target:infiltration_target = {
				NOR = {
					has_character_flag = very_hidden_lab
					has_character_flag = hidden_lab
				}
			}
		}
	}

	is_triggered_only = yes

	trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

	immediate = {
		# Will select two ingredients, by prioritizing from the top, until it hits two available ones...
		select_random_hermetic_ingredient_herb_effect = yes
		select_random_hermetic_ingredient_animal_part_effect = yes
		select_random_hermetic_ingredient_powder_effect = yes
		select_random_hermetic_ingredient_liquid_effect = yes
		select_random_hermetic_ingredient_herb_effect = yes
		select_random_hermetic_ingredient_powder_effect = yes
		select_random_hermetic_ingredient_animal_part_effect = yes
		select_random_hermetic_ingredient_liquid_effect = yes
	}

	# Bribe
	option = {
		name = EVTOPTA_MNM_1435
		tooltip_info = diplomacy

		trigger = { diplomacy >= 12 }

		custom_tooltip = { text = EVTOPTA_MNM_1435_TT }

		if = {
			limit = { event_target:infiltration_target = { has_character_flag = very_hidden_lab } }
			scaled_wealth = { value = -0.75 min = -75 }
		}
		else_if = {
			limit = { event_target:infiltration_target = { has_character_flag = hidden_lab } }
			scaled_wealth = { value = -0.5 min = -50 }
		}
		else = {
			scaled_wealth = { value = -0.3 min = -30 }
		}

		set_character_flag = bribed_guards
		character_event = { id = MNM.1436 days = 7 }

		ai_chance = {
			factor = 1

			trigger = { scaled_wealth = 0.5 }
		}
	}

	# Make a sleeping potion (potentially great effect)
	option = {
		name = EVTOPTB_MNM_1435
		tooltip_info_custom = multiple_ingredient_option_available_tt

		trigger = {
			any_artifact = {
				count >= 2
				has_artifact_flag = ingredient
			}
		}

		custom_tooltip = { text = EVTOPTB_MNM_1435_TT }

		random_list = {
			60 = {
				mult_modifier = { learning >= 10 factor = 1.2 }
				mult_modifier = { learning >= 12 factor = 1.2 }
				mult_modifier = { learning >= 14 factor = 1.2 }
				mult_modifier = { learning >= 16 factor = 1.2 }
				mult_modifier = { learning >= 18 factor = 1.2 }

				mult_modifier = {
					factor = 1.1
					has_selected_herb_ingredient_1_trigger = yes
				}
				mult_modifier = {
					factor = 1.1
					has_selected_herb_ingredient_2_trigger = yes
				}
				mult_modifier = {
					factor = 1.1
					has_selected_animal_part_ingredient_1_trigger = yes
				}
				mult_modifier = {
					factor = 1.1
					has_selected_animal_part_ingredient_2_trigger = yes
				}
				mult_modifier = {
					factor = 1.5
					selected_ingredient_is_sleep_inducing_trigger = yes
				}

				custom_tooltip = { text = EVTOPTX_MNM_1435_SUCCESS_TT }
				character_event = { id = MNM.1436 days = 7 }
			}

			40 = {
				mult_modifier = {
					factor = 1.2
					event_target:infiltration_target = { has_character_flag = hidden_lab }
				}
				mult_modifier = {
					factor = 1.5
					event_target:infiltration_target = { has_character_flag = very_hidden_lab }
				}

				custom_tooltip = {
					text = EVTOPTX_MNM_1435_FAIL_TT

					random_list = {
						50 = {
							set_character_flag = guards_wake_up
							character_event = { id = MNM.1436 days = 7 } # You get detected later, but continue for now
						}

						50 = {
							character_event = { id = MNM.1437 days = 7 } # Hard fail
						}
					}
				}
			}
		}

		destroy_selected_ingredient_1_and_2_effect = yes
	}

	# Make a sleeping potion (mild effect)
	option = {
		name = EVTOPTB_MNM_1435_single_ingredient
		tooltip_info_custom = ingredient_option_available_tt

		trigger = {
			any_artifact = { has_artifact_flag = ingredient }
		}

		custom_tooltip = { text = EVTOPTB_MNM_1435_TT }

		random_list = {
			50 = {
				mult_modifier = { learning >= 10 factor = 1.2 }
				mult_modifier = { learning >= 12 factor = 1.2 }
				mult_modifier = { learning >= 14 factor = 1.2 }
				mult_modifier = { learning >= 16 factor = 1.2 }
				mult_modifier = { learning >= 18 factor = 1.2 }

				mult_modifier = {
					factor = 1.2
					selected_ingredient_is_sleep_inducing_trigger = yes
				}

				custom_tooltip = { text = EVTOPTX_MNM_1435_SUCCESS_TT }
				character_event = { id = MNM.1436 days = 7 }
			}

			50 = {
				mult_modifier = {
					factor = 1.2
					event_target:infiltration_target = { has_character_flag = hidden_lab }
				}
				mult_modifier = {
					factor = 1.5
					event_target:infiltration_target = { has_character_flag = very_hidden_lab }
				}

				custom_tooltip = {
					text = EVTOPTX_MNM_1435_FAIL_TT

					random_list = {
						50 = {
							set_character_flag = guards_wake_up
							character_event = { id = MNM.1436 days = 7 } # You get deteced later, but continue for now
						}

						50 = {
							character_event = { id = MNM.1437 days = 7 } # Hard fail
						}
					}
				}
			}
		}

		destroy_selected_ingredient_1_effect = yes
	}

	# Distraction
	option = {
		name = EVTOPTC_MNM_1435

		custom_tooltip = { text = EVTOPTC_MNM_1435_TT }

		random_list = {
			60 = {
				mult_modifier = { event_target:infiltration_companion = { intrigue >= 10 } factor = 1.2 }
				mult_modifier = { event_target:infiltration_companion = { intrigue >= 12 } factor = 1.2 }
				mult_modifier = { event_target:infiltration_companion = { intrigue >= 14 } factor = 1.2 }
				mult_modifier = { event_target:infiltration_companion = { intrigue >= 16 } factor = 1.2 }
				mult_modifier = { event_target:infiltration_companion = { intrigue >= 18 } factor = 1.2 }

				custom_tooltip = { text = EVTOPTX_MNM_1435_SUCCESS_TT }
				character_event = { id = MNM.1438 days = 7 }
			}

			40 = {
				mult_modifier = {
					factor = 1.2
					event_target:infiltration_target = { has_character_flag = hidden_lab }
				}
				mult_modifier = {
					factor = 1.5
					event_target:infiltration_target = { has_character_flag = very_hidden_lab }
				}

				custom_tooltip = {
					text = EVTOPTX_MNM_1435_FAIL_TT

					random_list = {
						50 = {
							character_event = { id = MNM.1438 days = 7 } # You get detected later, but continue for now
							set_character_flag = distraction_failed
						}

						50 = {
							character_event = { id = MNM.1439 days = 7 } # Hard fail
						}
					}
				}
			}
		}
	}

	# Bad idea
	option = {
		name = EVTOPTD_MNM_1435

		custom_tooltip = { text = EVTOPTD_MNM_1435_TT }

		clr_quest = {
			id = quest_hermetics_infiltrate_laboratory
			failure = yes
		}

		reverse_opinion = {
			name = opinion_very_disappointed
			who = event_target:infiltration_companion
			years = 10
		}

		hidden_effect = {
			reverse_remove_opinion = {
				name = opinion_infiltration_companion
				who = event_target:infiltration_companion
			}
		}
	}

	after = {
		remove_selection_of_ingredients_effect = yes
	}
}

# The sleeping potion worked/you bribed the guards
character_event = {
	id = MNM.1436
	picture = GFX_evt_drunk
	border = GFX_event_normal_frame_intrigue

	desc = {
		text = EVTDESC_MNM_1436_A
		picture = GFX_evt_shady_meeting
		trigger = { has_character_flag = bribed_guards }
	}
	desc = {
		text = EVTDESC_MNM_1436_B
		picture = GFX_evt_drunk
		trigger = { NOT = { has_character_flag = bribed_guards } }
	}

	is_triggered_only = yes

	trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

	# You destroy, I will steal
	option = {
		name = EVTOPTA_MNM_1436

		custom_tooltip = { text = EVTOPTA_MNM_1436_TT }

		if = {
			limit = { has_character_flag = guards_wake_up }

			set_character_flag = caught_stealing
			character_event = { id = MNM.1440 days = 25 } # Guards catch you stealing
		}
		else = {
			character_event = { id = MNM.1441 days = 25 } # You steal
			event_target:infiltration_companion = {
				character_event = { id = MNM.1447 days = 14 }
			}
		}
	}

	# I destroy, you steal
	option = {
		name = EVTOPTB_MNM_1436

		custom_tooltip = { text = EVTOPTA_MNM_1436_TT }

		if = {
			limit = { has_character_flag = guards_wake_up }
			set_character_flag = caught_destroying
			character_event = { id = MNM.1440 days = 25 } # Guards catch you destroying
		}
		else = {
			character_event = { id = MNM.1443 days = 25 } # You destroy
			event_target:infiltration_companion = {
				character_event = { id = MNM.1445 days = 14 }
			}
		}
	}

	# We steal
	option = {
		name = EVTOPTC_MNM_1436

		custom_tooltip = { text = EVTOPTC_MNM_1436_TT }

		if = {
			limit = { has_character_flag = guards_wake_up }
			set_character_flag = caught_stealing
			character_event = { id = MNM.1440 days = 25 } # Guards catch you stealing
		}
		else = {
			character_event = { id = MNM.1441 days = 25 } # You steal
		}
	}

	# We destroy
	option = {
		name = EVTOPTD_MNM_1436

		custom_tooltip = { text = EVTOPTC_MNM_1436_TT }

		if = {
			limit = { has_character_flag = guards_wake_up }
			set_character_flag = caught_destroying
			character_event = { id = MNM.1440 days = 25 } # Guards catch you destroying
		}
		else = {
			character_event = { id = MNM.1443 days = 25 } # You destroy
		}
	}

	after = {
		clr_character_flag = bribed_guards
	}
}

# You fail to make a sleeping potion
character_event = {
	id = MNM.1437
	desc = EVTDESC_MNM_1437
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

	option = {
		name = EVTOPTA_MNM_1437

		clr_quest = {
			id = quest_hermetics_infiltrate_laboratory
			failure = yes
		}

		reverse_opinion = {
			name = opinion_very_disappointed
			who = event_target:infiltration_companion
			years = 10
		}

		hidden_effect = {
			reverse_remove_opinion = {
				name = opinion_infiltration_companion
				who = event_target:infiltration_companion
			}
		}
	}
}

# The distraction is successful
character_event = {
	id = MNM.1438
	desc = EVTDESC_MNM_1438
	picture = GFX_evt_shadowy_cabal
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

	# Steal
	option = {
		name = EVTOPTA_MNM_1438

		if = {
			limit = { has_character_flag = distraction_failed }
			set_character_flag = caught_stealing
			character_event = { id = MNM.1440 days = 25 } # Guards catch you stealing
		}
		else = {
			character_event = { id = MNM.1441 days = 25 } # You steal
		}
	}

	# Destroy
	option = {
		name = EVTOPTB_MNM_1438

		if = {
			limit = { has_character_flag = distraction_failed }
			set_character_flag = caught_destroying
			character_event = { id = MNM.1440 days = 25 } # Guards catch you destroying
		}
		else = {
			character_event = { id = MNM.1443 days = 25 } # You destroy
		}
	}
}

# The diversion fails
character_event = {
	id = MNM.1439
	desc = EVTDESC_MNM_1439
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

	option = {
		name = EVTOPTA_MNM_1439

		clr_quest = {
			id = quest_hermetics_infiltrate_laboratory
			failure = yes
		}

		hidden_effect = {
			reverse_remove_opinion = {
				name = opinion_infiltration_companion
				who = event_target:infiltration_companion
			}
		}
	}
}

# You get caught
character_event = {
	id = MNM.1440
	picture = GFX_evt_into_the_dungeon
	border = GFX_event_normal_frame_intrigue

	desc = {
		text = EVTDESC_MNM_1440_A
		trigger = {
			has_character_flag = guards_wake_up
			has_character_flag = caught_destroying
		}
	}
	desc = {
		text = EVTDESC_MNM_1440_B
		trigger = {
			OR = {
				AND = {
					has_character_flag = distraction_failed
					has_character_flag = caught_destroying
				}
				event_target:infiltration_companion = { has_character_flag = bad_theft }
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1440_C
		trigger = {
			has_character_flag = guards_wake_up
			has_character_flag = caught_stealing
		}
	}
	desc = {
		text = EVTDESC_MNM_1440_D
		trigger = {
			has_character_flag = distraction_failed
			has_character_flag = caught_stealing
		}
	}

	is_triggered_only = yes

	trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

	option = {
		name = EVTOPTA_MNM_1440

		event_target:infiltration_target = {
			show_scope_change = no

			if = {
				limit = { is_landed = yes }

				reverse_imprison = ROOT

				if = {
					limit = { event_target:infiltration_companion = { ai = yes } }
					reverse_imprison = event_target:infiltration_companion
				}
			}

			else = {
				host = {
					show_scope_change = no

					reverse_imprison = ROOT

					if = {
						limit = { event_target:infiltration_companion = { ai = yes } }
						reverse_imprison = event_target:infiltration_companion
					}
				}
			}

			character_event = { id = MNM.1451 days = 7 }
		}

		reverse_opinion = {
			name = opinion_thief
			who = event_target:infiltration_target
			years = 20
		}

		clr_quest = {
			id = quest_hermetics_infiltrate_laboratory
			failure = yes
		}

		clr_character_flag = distraction_failed
		clr_character_flag = guards_wake_up
		clr_character_flag = caught_stealing
		clr_character_flag = caught_destroying

		hidden_effect = {
			event_target:infiltration_companion = {
				clr_character_flag = bad_theft

				reverse_opinion = {
					name = opinion_thief
					who = event_target:infiltration_target
					years = 20
				}

				remove_opinion = {
					name = opinion_infiltration_companion
					who = ROOT
				}
			}

		}
	}
}

# The captor decides what to do with you
character_event = {
	id = MNM.1451
	desc = EVTDESC_MNM_1451
	picture = GFX_evt_catching_heretic
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	# Trade secrets for freedom
	option = {
		name = EVTOPTA_MNM_1451

		trigger = {
			FROM = {
				has_society_currency_medium_trigger = yes
				prisoner = yes
			}
		}

		tooltip = {
			random_list = {
				60 = {
					mult_modifier = {
						factor = 1.5
						FROM = { trait = craven }
					}
					add_society_currency_major_effect = yes
				}
				40 = {
					mult_modifier = {
						factor = 2
						FROM = {
							OR = {
								trait = greedy
								trait = ambitious
								trait = wroth
								trait = paranoid
							}
						}
					}
					custom_tooltip = { text = EVTOPTA_MNM_1451_FAIL_TT }
				}

			}
		}

		FROM = { character_event = { id = MNM.1452 } }

		ai_chance = {
			factor = 60

			mult_modifier = {
				factor = 2
				OR = {
					trait = greedy
					trait = ambitious
					learning >= 14
				}
			}
		}
	}

	# Let them rot
	option = {
		name = EVTOPTB_MNM_1451

		if = {
			limit = { NOT = { is_rival = FROM } }
			tooltip = { add_rival = FROM }
		}

		if = {
			limit = { NOT = { is_rival = event_target:infiltration_companion } }
			add_rival = event_target:infiltration_companion
		}

		FROM = { character_event = { id = MNM.1455 } }

		ai_chance = {
			factor = 40

			mult_modifier = {
				factor = 2
				is_rival = FROM
			}
		}
	}
}

# Give me secrets, I will let you out
character_event = {
	id = MNM.1452
	desc = EVTDESC_MNM_1452
	picture = GFX_evt_catching_heretic
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	trigger = { prisoner = yes }

	# Alright...
	option = {
		name = EVTOPTA_MNM_1452

		detract_society_currency_medium_effect = yes

		tooltip = { imprison = no }

		FROM = { character_event = { id = MNM.1453 days = 3 } }

		ai_chance = {
			factor = 60

			mult_modifier = {
				factor = 1.5
				trait = craven
			}
		}
	}

	# Never!
	option = {
		name = EVTOPTB_MNM_1452

		custom_tooltip = { text = EVTOPTB_MNM_1452_TT }

		if = {
			limit = { NOT = { is_rival = FROM } }
			add_rival = FROM
		}

		FROM = { character_event = { id = MNM.1454 days = 3 } }

		ai_chance = {
			factor = 40

			mult_modifier = {
				factor = 2
				OR = {
					trait = greedy
					trait = ambitious
					trait = wroth
					trait = paranoid
				}
			}
		}
	}
}

# Infiltration target get their secrets
character_event = {
	id = MNM.1453
	desc = EVTDESC_MNM_1453
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1453

		add_society_currency_major_effect = yes

		FROM = { imprison = no }
	}
}

# Infiltration target is denied
character_event = {
	id = MNM.1454
	desc = EVTDESC_MNM_1454
	picture = GFX_evt_into_the_dungeon
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_MNM_1454

		if = {
			limit = {
				NOT = { is_rival = FROM }
			}

			tooltip = { add_rival = FROM }
		}
	}
}

# Infiltration target wants you to rot
character_event = {
	id = MNM.1455
	desc = EVTDESC_MNM_1455
	picture = GFX_evt_catching_heretic
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1455

		if = {
			limit = { NOT = { is_rival = FROM } }
			add_rival = FROM
		}
	}
}

# You steal
character_event = {
	id = MNM.1441
	picture = GFX_evt_library
	border = GFX_event_normal_frame_intrigue

	desc = {
		text = EVTDESC_MNM_1441_A
		trigger = { has_character_flag = great_theft }
	}
	desc = {
		text = EVTDESC_MNM_1441_B
		trigger = { has_character_flag = good_theft }
	}
	desc = {
		text = EVTDESC_MNM_1441_C
		trigger = { has_character_flag = ok_theft }
	}

	is_triggered_only = yes
	# hide_from = yes

	trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

	# CleanSlate: Why is thieving success based entirely off of learning rather than intrigue?
	immediate = {
		random_list = {
			33 = { # Great theft
				trigger = {
					event_target:infiltration_target = {
						any_artifact = {
							has_artifact_flag = hermetics
							has_artifact_flag = text
						}
					}
				}

				mult_modifier = { learning >= 12 factor = 1.2 }
				mult_modifier = { learning >= 13 factor = 1.2 }
				mult_modifier = { learning >= 16 factor = 1.2 }
				mult_modifier = { learning >= 18 factor = 1.2 }

				mult_modifier = {
					factor = 0.5
					event_target:infiltration_target = { ai = no }
				}

				set_character_flag = great_theft
			}

			33 = { # Good theft
				trigger = {
					event_target:infiltration_target = {
						any_artifact = {
							has_artifact_flag = hermetics
							has_artifact_flag = ingredient
						}
					}
				}

				mult_modifier = { learning >= 10 factor = 1.2 }
				mult_modifier = { learning >= 12 factor = 1.1 }
				mult_modifier = { learning >= 13 factor = 1.1 }
				mult_modifier = { learning >= 16 factor = 1.1 }
				mult_modifier = { learning >= 18 factor = 1.1 }

				set_character_flag = good_theft
			}

			33 = { # Ok theft
				mult_modifier = {
					factor = 1.2
					event_target:infiltration_target = { has_character_flag = hidden_lab }
				}
				mult_modifier = {
					factor = 1.5
					event_target:infiltration_target = { has_character_flag = very_hidden_lab }
				}

				set_character_flag = ok_theft
			}
		}
	}

	# Great theft
	option = {
		name = EVTOPTA_MNM_1441

		trigger = { has_character_flag = great_theft }

		custom_tooltip = { text = EVTOPTA_MNM_1441_steal_text }

		if = {
			limit = {
				event_target:infiltration_target = {
					any_artifact = {
						has_artifact_flag = hermetics
						has_artifact_flag = ingredient
					}
				}
			}

			custom_tooltip = { text = EVTOPTA_MNM_1441_steal_ingredient }
		}

		# Money and knowledge
		transfer_scaled_wealth = { from = event_target:infiltration_target value = 0.5 min = 50 }
		add_society_currency_massive_effect = yes
	}

	# Good theft
	option = {
		name = EVTOPTA_MNM_1441

		trigger = { has_character_flag = good_theft }

		# You get artifacts
		custom_tooltip = { text = EVTOPTA_MNM_1441_steal_ingredient }

		# Money and knowledge
		transfer_scaled_wealth = { from = event_target:infiltration_target value = 0.25 min = 25 }
		add_society_currency_major_effect = yes
	}

	option = {
		name = EVTOPTC_MNM_1441

		trigger = { has_character_flag = ok_theft }

		# Money and knowledge
		transfer_scaled_wealth = { from = event_target:infiltration_target value = 0.1 min = 10 }
		add_society_currency_medium_effect = yes
	}

	after = {
		hidden_effect = {
			event_target:infiltration_target = { character_event = { id = MNM.1442 } }
			character_event = { id = MNM.1450 days = 40 }
		}
	}
}

# Person who gets stolen from gets notified
character_event = {
	id = MNM.1442
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_intrigue

	desc = {
		text = EVTDESC_MNM_1442_A
		trigger = { FROM = { has_character_flag = great_theft } }
	}
	desc = {
		text = EVTDESC_MNM_1442_B
		trigger = { FROM = { has_character_flag = good_theft } }
	}
	desc = {
		text = EVTDESC_MNM_1442_C
		trigger = { FROM = { has_character_flag = ok_theft } }
	}

	hide_from = yes
	is_triggered_only = yes


	option = {
		name = CURSES

		# Artifacts get stolen
		if = {
			limit = { FROM = { has_character_flag = great_theft } }

			random_artifact = {
				show_scope_change = no

				limit = {
					has_artifact_flag = hermetics
					has_artifact_flag = text
				}

				tooltip = { destroy_artifact = yes }

				hidden_effect = {
					transfer_artifact = {
						from = ROOT
						to = FROM
					}
				}
			}
		}

		if = {
			limit = {
				FROM = {
					OR = {
						has_character_flag = great_theft
						has_character_flag = good_theft
					}
				}

				any_artifact = {
					has_artifact_flag = hermetics
					has_artifact_flag = ingredient
				}
			}

			random_artifact = {
				show_scope_change = no

				limit = {
					has_artifact_flag = hermetics
					has_artifact_flag = ingredient
				}

				tooltip = { destroy_artifact = yes }

				hidden_effect = {
					transfer_artifact = {
						from = ROOT
						to = FROM
					}
				}
			}
		}

		# Money
		if = {
			limit = { FROM = { has_character_flag = great_theft } }
			tooltip = { scaled_wealth = { value = -0.5 min = -50 } }
		}
		else_if = {
			limit = { FROM = { has_character_flag = good_theft } }
			tooltip = { scaled_wealth = { value = -0.25 min = -25 } }
		}
		else_if = {
			limit = { FROM = { has_character_flag = ok_theft } }
			tooltip = { scaled_wealth = { value = -0.1 min = -10 } }
		}

		FROM = {
			clr_character_flag = great_theft
			clr_character_flag = good_theft
			clr_character_flag = ok_theft
		}
	}
}

# You destroy
character_event = {
	id = MNM.1443
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_from = yes

	desc = {
		text = EVTDESC_MNM_1443_A
		trigger = { has_character_flag = lab_destruction }
	}
	desc = {
		text = EVTDESC_MNM_1443_B
		trigger = { has_character_flag = lab_damage }
	}
	desc = {
		text = EVTDESC_MNM_1443_C
		trigger = { has_character_flag = lab_explosion_death }
	}

	trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

	immediate = {
		random_list = {
			40 = { # Total destruction
				trigger = { event_target:infiltration_target = { has_character_flag = built_laboratory } }

				mult_modifier = { learning >= 12 factor = 1.2 }
				mult_modifier = { learning >= 13 factor = 1.2 }
				mult_modifier = { learning >= 16 factor = 1.2 }
				mult_modifier = { learning >= 18 factor = 1.2 }

				set_character_flag = lab_destruction
			}

			55 = { # Major damage
				mult_modifier = { learning >= 10 factor = 1.2 }
				mult_modifier = { learning >= 12 factor = 1.1 }
				mult_modifier = { learning >= 13 factor = 1.1 }
				mult_modifier = { learning >= 16 factor = 1.1 }
				mult_modifier = { learning >= 18 factor = 1.1 }

				set_character_flag = lab_damage
			}

			5 = { # You die in an accident
				trigger = { event_target:infiltration_target = { has_character_flag = built_laboratory } }

				mult_modifier = { learning < 10 factor = 1.5 }
				mult_modifier = { learning < 8 factor = 2 }
				mult_modifier = { learning < 6 factor = 2 }

				mult_modifier = {
					factor = 1.2
					event_target:infiltration_target = { has_character_flag = hidden_lab }
				}
				mult_modifier = {
					factor = 1.5
					event_target:infiltration_target = { has_character_flag = very_hidden_lab }
				}

				set_character_flag = lab_explosion_death
			}
		}
	}

	option = {
		name = EVTOPTA_MNM_1443

		trigger = { has_character_flag = lab_destruction }

		event_target:infiltration_target = {
			show_scope_change = no

			tooltip = {
				trigger_switch = {
					on_trigger = has_character_modifier
					cheap_laboratory  = { remove_character_modifier = cheap_laboratory }
					normal_laboratory = { remove_character_modifier = normal_laboratory }
					good_laboratory   = { remove_character_modifier = good_laboratory }
					great_laboratory  = { remove_character_modifier = great_laboratory }
					best_laboratory   = { remove_character_modifier = best_laboratory }
				}

				destroy_all_ingredients_effect = yes
			}
		}

		add_society_currency_major_effect = yes
	}

	option = {
		name = EVTOPTA_MNM_1443

		trigger = { has_character_flag = lab_damage }

		tooltip = {
			event_target:infiltration_target = {
				show_scope_change = no

				scaled_wealth = { value = -0.3 min = -30 }
				destroy_random_ingredients_effect = yes
			}
		}

		add_society_currency_medium_effect = yes
	}

	option = {
		name = EVTOPTC_MNM_1443

		trigger = { has_character_flag = lab_explosion_death }

		death = { death_reason = death_accident }
	}

	after = {
		hidden_effect = {
			event_target:infiltration_target = { character_event = { id = MNM.1444 } }
			character_event = { id = MNM.1450 days = 40 }
		}
	}
}

# Infiltration target gets notified of destroyed lab
character_event = {
	id = MNM.1444
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_intrigue

	desc = {
		text = EVTDESC_MNM_1444_A
		trigger = { FROM = { has_character_flag = lab_destruction } }
	}
	desc = {
		text = EVTDESC_MNM_1444_B
		trigger = { FROM = { has_character_flag = lab_damage } }
	}
	desc = {
		text = EVTDESC_MNM_1444_C
		trigger = {
			FROM = {
				NOR = {
					has_character_flag = lab_destruction
					has_character_flag = lab_damage
				}
			}
		}
	}

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = CURSES

		trigger = {
			FROM = {
				OR = {
					has_character_flag = lab_destruction
					has_character_flag = lab_damage
				}
			}
		}

		if = {
			limit = { FROM = { has_character_flag = lab_destruction } }

			destroy_all_ingredients_effect = yes
			clr_character_flag = built_laboratory
			clr_character_flag = hidden_lab
			clr_character_flag = very_hidden_lab

			trigger_switch = {
				on_trigger = has_character_modifier
				cheap_laboratory 	= { remove_character_modifier = cheap_laboratory }
				normal_laboratory 	= { remove_character_modifier = normal_laboratory }
				good_laboratory 	= { remove_character_modifier = good_laboratory }
				great_laboratory 	= { remove_character_modifier = great_laboratory }
				best_laboratory 	= { remove_character_modifier = best_laboratory }
			}
		}
		else = {
			scaled_wealth = { value = -0.3 min = -30 }
			destroy_random_ingredients_effect = yes
		}

		hidden_effect = {
			FROM = {
				clr_character_flag = lab_destruction
				clr_character_flag = lab_damage
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_1444

		trigger = {
			FROM = {
				NOR = {
					has_character_flag = lab_destruction
					has_character_flag = lab_damage
				}
			}
		}
	}
}

# Companion attempts to steal
character_event = {
	id = MNM.1445

	hide_window = yes
	is_triggered_only = yes

	trigger = { FROM = { has_quest = quest_hermetics_infiltrate_laboratory } }

	immediate = {
		random_list = {
			40 = { # Good theft
				trigger = {
					any_artifact = {
						has_artifact_flag = hermetics
						has_artifact_flag = ingredient
					}
				}

				mult_modifier = { learning >= 10 factor = 1.2 }
				mult_modifier = { learning >= 12 factor = 1.1 }
				mult_modifier = { learning >= 13 factor = 1.1 }
				mult_modifier = { learning >= 16 factor = 1.1 }
				mult_modifier = { learning >= 18 factor = 1.1 }

				set_character_flag = good_theft
				FROM = { character_event = { id = MNM.1446 days = 20 } }
			}

			40 = { # Ok theft
				set_character_flag = ok_theft
				FROM = { character_event = { id = MNM.1446 days = 20 } }
			}

			20 = { # Bad theft
				mult_modifier = { learning < 10 factor = 1.5 }
				mult_modifier = { learning < 8 factor = 2 }
				mult_modifier = { intrigue < 10 factor = 1.5 }
				mult_modifier = { intrigue < 8 factor = 2 }

				mult_modifier = {
					factor = 1.2
					event_target:infiltration_target = { has_character_flag = hidden_lab }
				}
				mult_modifier = {
					factor = 1.5
					event_target:infiltration_target = { has_character_flag = very_hidden_lab }
				}

				set_character_flag = bad_theft
				FROM = { character_event = { id = MNM.1440 } }
			}
		}
	}
}

# Companion steal attempt good/ok outcome
character_event = {
	id = MNM.1446
	picture = GFX_evt_library
	border = GFX_event_normal_frame_intrigue
	# portrait = event_target:infiltration_companion

	desc = {
		text = EVTDESC_MNM_1446_A
		trigger = { FROM = { has_character_flag = good_theft } }
	}
	desc = {
		text = EVTDESC_MNM_1446_B
		trigger = { FROM = { has_character_flag = ok_theft } }
	}

	is_triggered_only = yes

	trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

	option = {
		name = EVTOPTA_MNM_1446

		trigger = { FROM = { has_character_flag = good_theft } }

		add_artifact = ingredient_metal_exotic5
		add_society_currency_minor_effect = yes

		hidden_effect = { FROM = { clr_character_flag = good_theft } }
	}

	option = {
		name = EVTOPTA_MNM_1446

		trigger = { FROM = { has_character_flag = ok_theft } }

		add_society_currency_minor_effect = yes
		hidden_effect = { FROM = { clr_character_flag = ok_theft } }
	}
}

# Companion attempts to destroy
character_event = {
	id = MNM.1447
	hide_window = yes
	is_triggered_only = yes

	trigger = { FROM = { has_quest = quest_hermetics_infiltrate_laboratory } }

	immediate = {
		random_list = {
			90 = { # Lab damage
				mult_modifier = { learning >= 10 factor = 1.2 }
				mult_modifier = { learning >= 12 factor = 1.1 }
				mult_modifier = { learning >= 13 factor = 1.1 }
				mult_modifier = { learning >= 16 factor = 1.1 }
				mult_modifier = { learning >= 18 factor = 1.1 }

				FROM = { character_event = { id = MNM.1448 days = 20 } }
			}

			10 = { # They die
				mult_modifier = { learning < 10 factor = 1.5 }
				mult_modifier = { learning < 8 factor = 2 }
				mult_modifier = { intrigue < 10 factor = 1.5 }
				mult_modifier = { intrigue < 8 factor = 2 }

				mult_modifier = {
					factor = 1.2
					event_target:infiltration_target = { has_character_flag = hidden_lab }
				}
				mult_modifier = {
					factor = 1.5
					event_target:infiltration_target = { has_character_flag = very_hidden_lab }
				}

				FROM = { character_event = { id = MNM.1449 } }
			}
		}
	}
}

# Companion manages to damage lab
character_event = {
	id = MNM.1448
	desc = EVTDESC_MNM_1448
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_intrigue
	# portrait = event_target:infiltration_companion

	is_triggered_only = yes

	trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

	option = {
		name = EVTOPTA_MNM_1448

		add_society_currency_minor_effect = yes
	}
}

# Companion dies in an explotion
character_event = {
	id = MNM.1449
	desc = EVTDESC_MNM_1449
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_intrigue
	# portrait = event_target:infiltration_companion

	is_triggered_only = yes

	trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

	option = {
		name = EVTOPTA_MNM_1449

		event_target:infiltration_companion = {
			show_scope_change = no
			death = { death_reason = death_accident }
		}

		clr_quest = { id = quest_hermetics_infiltrate_laboratory failure = yes }
	}
}

# You escape and mission is complete
character_event = {
	id = MNM.1450
	desc = EVTDESC_MNM_1450
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	trigger = { has_quest = quest_hermetics_infiltrate_laboratory }

	option = {
		name = EVTOPTA_MNM_1450

		clr_quest = quest_hermetics_infiltrate_laboratory
		sound_effect = hermetic_society_perform_experiment

		hidden_effect = {
			reverse_remove_opinion = {
				name = opinion_infiltration_companion
				who = event_target:infiltration_companion
			}
		}

		if = {
			limit = {
				opinion = {
					who = event_target:infiltration_companion
					value >= 40
				}

				reverse_opinion = {
					who = event_target:infiltration_companion
					value >= 40
				}

				NOT = { is_friend = event_target:infiltration_companion }
			}

			add_friend = event_target:infiltration_companion
		}
		else = {
			reverse_opinion = {
				name = opinion_accomplice
				who = event_target:infiltration_companion
				years = 10
			}

			hidden_effect = {
				opinion = {
					name = opinion_accomplice
					who = event_target:infiltration_companion
					years = 10
				}
			}
		}
	}
}

# Clears flags from infiltration target
character_event = {
	id = MNM.1456

	hide_window = yes
	is_triggered_only = yes

	immediate = {
		clr_character_flag = infiltration_rival
		clr_character_flag = infiltration_mutual_dislike
		clr_character_flag = infiltration_rich
	}
}

############
# POWERS
############

####################### Start of Scrying events #######################
######## Power: Perform Scrying - what do you want to look for? #######
character_event = {
	id = MNM.1200
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1200_A
		trigger = { NOT = { any_artifact = { has_artifact_flag = ingredient } } }
	}
	desc = {
		text = EVTDESC_MNM_1200_B
		trigger = { any_artifact = { has_artifact_flag = ingredient } }
	}

	is_triggered_only = yes # hermetics_perform_scrying, mnm_hermetics_decisions.txt

	has_dlc = "Mystics"

	trigger = { has_an_omen_modifier_trigger = no }

	immediate = {
		if = {
			limit = {
				any_artifact = { has_artifact_flag = ingredient }
			}
			select_random_hermetic_ingredient_effect = yes
		}
	}

	option = { # I want to know about battles to come
		name = EVTOPTA_MNM_1200

		set_character_flag = battle_focused_scrying_flag
	}

	option = { # I want to know where my relationships will lead
		name = EVTOPTB_MNM_1200

		set_character_flag = relationship_focused_scrying_flag
	}

	option = { # I want to find out how to increase my power
		name = EVTOPTC_MNM_1200

		set_character_flag = power_hungry_scrying_flag
	}

	option = { # I am gonna throw some ingredients into the water...
		name = {
			text = EVTOPTD_MNM_1200_herb
			trigger = {
				any_artifact = {
					has_artifact_flag = selected_ingredient
					is_ingredient_herb_trigger = yes
				}
			}
		}
		name = {
			text = EVTOPTD_MNM_1200_animal_part
			trigger = {
				any_artifact = {
					has_artifact_flag = selected_ingredient
					is_ingredient_animal_part_trigger = yes
				}
			}
		}
		name = {
			text = EVTOPTD_MNM_1200_powder
			trigger = {
				any_artifact = {
					has_artifact_flag = selected_ingredient
					is_ingredient_powder_trigger = yes
				}
			}
		}
		name = {
			text = EVTOPTD_MNM_1200_liquid
			trigger = {
				any_artifact = {
					has_artifact_flag = selected_ingredient
					is_ingredient_liquid_trigger = yes
				}
			}
		}

		tooltip_info_custom = ingredient_option_available_tt

		trigger = {
			any_artifact = { has_artifact_flag = ingredient }
		}

		custom_tooltip = { 
			text = EVTOPTD_MNM_1200_tt

			random_list = {
				33 = { set_character_flag = battle_focused_scrying_flag }
				33 = { set_character_flag = relationship_focused_scrying_flag }
				33 = { set_character_flag = power_hungry_scrying_flag }
			}
		}

		set_character_flag = used_ingredient_flag
		destroy_selected_ingredient_1_effect = yes

		ai_chance = { # AI should use ingredients if they can
			factor = 100

			mult_modifier = {
				factor = 50
				trait = ambitious
			}
		}

	}

	after = {
		remove_selection_of_ingredients_effect = yes

		character_event = {
			id = MNM.1201
			days = 5
			random = 1
		}
	}
}

# You see something in the water and react well or poorly to it
character_event = {
	id = MNM.1201
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1201_BATTLE_A
		trigger = { has_character_flag = battle_focused_scrying_flag }
	}
	desc = {
		text = EVTDESC_MNM_1201_BATTLE_B
		trigger = { has_character_flag = battle_focused_scrying_flag }
	}
	desc = {
		text = EVTDESC_MNM_1201_BATTLE_C
		trigger = { has_character_flag = battle_focused_scrying_flag }
	}

	desc = {
		text = EVTDESC_MNM_1201_RELATIONSHIP_A
		trigger = { has_character_flag = relationship_focused_scrying_flag }
	}
	desc = {
		text = EVTDESC_MNM_1201_RELATIONSHIP_B
		trigger = { has_character_flag = relationship_focused_scrying_flag }
	}
	desc = {
		text = EVTDESC_MNM_1201_RELATIONSHIP_C
		trigger = { has_character_flag = relationship_focused_scrying_flag }
	}

	desc = {
		text = EVTDESC_MNM_1201_POWER_A
		trigger = { has_character_flag = power_hungry_scrying_flag }
	}
	desc = {
		text = EVTDESC_MNM_1201_POWER_B
		trigger = { has_character_flag = power_hungry_scrying_flag }
	}
	desc = {
		text = EVTDESC_MNM_1201_POWER_C
		trigger = { has_character_flag = power_hungry_scrying_flag }
	}

	is_triggered_only = yes

	has_dlc = "Mystics"

	trigger = {
		has_an_omen_modifier_trigger = no
		society_member_of = hermetics
	}

	immediate = {
		random_list = {
			50 = {
				mult_modifier = {
					factor = 1.5
					has_character_flag = used_ingredient_flag
				}

				set_character_flag = positive_reaction_to_scrying_flag
			}

			50 = { set_character_flag = negative_reaction_to_scrying_flag }
		}
	}

	option = {
		name = EVTOPTA_MNM_1201

		trigger = { has_character_flag = positive_reaction_to_scrying_flag }

		trigger_switch = {
			on_trigger = has_character_flag

			battle_focused_scrying_flag = {
				add_character_modifier = {
					name = good_battle_omen
					duration = -1
				}
			}
			relationship_focused_scrying_flag = {
				add_character_modifier = {
					name = good_relationship_omen
					duration = -1
				}
			}
			power_hungry_scrying_flag = {
				add_character_modifier = {
					name = good_power_omen
					duration = -1
				}
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_1201

		trigger = { has_character_flag = negative_reaction_to_scrying_flag }

		trigger_switch = {
			on_trigger = has_character_flag

			battle_focused_scrying_flag = {
				add_character_modifier = {
					name = bad_battle_omen
					duration = -1
				}
			}
			relationship_focused_scrying_flag = {
				add_character_modifier = {
					name = bad_relationship_omen
					duration = -1
				}
			}
			power_hungry_scrying_flag = {
				add_character_modifier = {
					name = bad_power_omen
					duration = -1
				}
			}
		}
	}

	after = {
		hidden_effect = {
			random_list = { # For sending fallbacks, in case nothing else triggers from the omen-modifiers during the next few years
				33 = {
					character_event = {
						id = MNM.1225
						days = 1500
						random = 300
					}
				}

				33 = {
					character_event = {
						id = MNM.1226
						days = 1500
						random = 300
					}
				}

				33 = {
					character_event = {
						id = MNM.1227
						days = 1500
						random = 300
					}
				}
			}

			remove_character_modifier = scrying_cooldown
			clr_character_flag = battle_focused_scrying_flag
			clr_character_flag = relationship_focused_scrying_flag
			clr_character_flag = power_hungry_scrying_flag
			clr_character_flag = used_ingredient_flag
		}
	}
}

# Gain a leadership trait
character_event = {
	id = MNM.1202
	title = the_battle_at_location
	picture = GFX_evt_battle
	border = GFX_event_normal_frame_war

	desc = {
		text = EVTDESC_MNM_1202_A
		trigger = { has_character_modifier = good_battle_omen }
	}
	desc = {
		text = EVTDESC_MNM_1202_B
		trigger = { has_character_modifier = bad_battle_omen }
	}

	is_triggered_only = yes # on_combat_pulse

	has_dlc = "Mystics"

	trigger = {
		has_battle_omen_modifier_trigger = yes
		can_have_more_leadership_traits = yes

		NAND = {
			trait = direct_leader
			trait = unyielding_leader
			trait = inspiring_leader
		}
	}

	immediate = {
		disallow_new_battle_events_effect = yes

		random_list = {
			33 = {
				trigger = { NOT = { trait = direct_leader } }
				set_character_flag = gain_direct_leader
			}

			33 = {
				trigger = { NOT = { trait = unyielding_leader } }
				set_character_flag = gain_unyielding_leader
			}

			33 = {
				trigger = { NOT = { trait = inspiring_leader } }
				set_character_flag = gain_inspiring_leader
			}
		}
	}

	option = { # Gain Direct Leader
		name = EVTOPTA_MNM_1202

		trigger = { has_character_flag = gain_direct_leader }

		add_trait = direct_leader
	}

	option = { # Gain Unyielding
		name = EVTOPTB_MNM_1202

		trigger = { has_character_flag = gain_unyielding_leader }

		add_trait = unyielding_leader
	}

	option = { # Gain Inspiring Leader
		name = EVTOPTC_MNM_1202

		trigger = { has_character_flag = gain_inspiring_leader }

		add_trait = inspiring_leader
	}

	after = {
		if = {
			limit = { has_character_modifier = good_battle_omen }
			upgrade_seer_modifier_effect = yes
		}
		else = {
			downgrade_seer_modifier_effect = yes
		}

		remove_scrying_omen_modifiers_effect = yes
		clr_character_flag = gain_direct_leader
		clr_character_flag = gain_unyielding_leader
		clr_character_flag = gain_inspiring_leader
		allow_new_battle_events_effect = yes
	}
}

# Fight goes badly
character_event = {
	id = MNM.1203
	title = the_battle_at_location
	picture = GFX_evt_battle
	border = GFX_event_normal_frame_war

	desc = {
		text = EVTDESC_MNM_1203_A
		trigger = { has_character_modifier = bad_battle_omen }
	}
	desc = {
		text = EVTDESC_MNM_1203_B
		trigger = { has_character_modifier = good_battle_omen }
	}

	is_triggered_only = yes # on_combat_pulse, via HFP.11000

	has_dlc = "Mystics"

	trigger = { has_battle_omen_modifier_trigger = yes }

	immediate = {
		disallow_new_battle_events_effect = yes
	}

	option = { # At least I was right
		name = EVTOPTA_MNM_1203

		trigger = { has_character_modifier = bad_battle_omen }

		upgrade_seer_modifier_effect = yes
	}

	option = { # Curses! Where's the glory in this?!
		name = EVTOPTB_MNM_1203

		trigger = { has_character_modifier = good_battle_omen }

		downgrade_seer_modifier_effect = yes
	}

	after = {
		random_list = {
			40 = { add_trait_wounded_effect = yes }

			40 = {
				trigger = {
					has_dlc = "Reapers"
					NOT = { trait = one_legged }
				}

				add_trait = one_legged
				character_event = { id = RIP.11503 } # Notify one-legged

				if = {
					limit = {
						NOT = { trait = severely_injured }
					}

					add_trait = severely_injured
					resolve_severely_injured_effect = yes
				}
			}

			5 = {
				death = { death_reason = death_battle }
			}
		}

		remove_scrying_omen_modifiers_effect = yes
		allow_new_battle_events_effect = yes
	}
}

# A Child is born - you have a good feeling about the kid!
character_event = {
	id = MNM.1204
	picture = GFX_evt_state_diplomacy
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1204_A
		trigger = { has_character_modifier = good_relationship_omen }
	}
	desc = {
		text = EVTDESC_MNM_1204_B
		trigger = { has_character_modifier = bad_relationship_omen }
	}

	is_triggered_only = yes # on_birth (MNM.1204)

	has_dlc = "Mystics"

	trigger = {
		has_relationship_omen_modifier_trigger = yes
		FROM = { is_alive = yes }
	}

	immediate = {
		if = {
			limit = { has_character_modifier = good_relationship_omen }
			upgrade_seer_modifier_effect = yes
		}
		else = {
			downgrade_seer_modifier_effect = yes
		}
	}

	option = { # I knew something great would happen!
		name = EVTOPTA_MNM_1204

		trigger = { has_character_modifier = good_relationship_omen }
	}

	option = { # I am not sure I interpreted the omen correctly...
		name = EVTOPTB_MNM_1204

		trigger = { has_character_modifier = bad_relationship_omen }
	}

	after = {
		remove_scrying_omen_modifiers_effect = yes
	}
}

# A Child is born - you're not impressed
character_event = {
	id = MNM.1205
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1205_A
		trigger = { has_character_modifier = bad_relationship_omen }
	}
	desc = {
		text = EVTDESC_MNM_1205_B
		trigger = { has_character_modifier = good_relationship_omen }
	}

	is_triggered_only = yes # on_birth

	has_dlc = "Mystics"

	trigger = {
		has_relationship_omen_modifier_trigger = yes
		FROM = { is_alive = yes }
	}

	immediate = {
		if = {
			limit = { has_character_modifier = bad_relationship_omen }
			upgrade_seer_modifier_effect = yes
		}
		else = {
			downgrade_seer_modifier_effect = yes
		}
	}

	option = { # I knew something bad would happen!
		name = EVTOPTA_MNM_1205
		trigger = { has_character_modifier = bad_relationship_omen }
	}

	option = { # I am not sure I interpreted the omen correctly...
		name = EVTOPTB_MNM_1205
		trigger = { has_character_modifier = good_relationship_omen }
	}

	after = {
		remove_scrying_omen_modifiers_effect = yes
	}
}

# Newborn sends event to parents
character_event = {
	id = MNM.1206

	is_triggered_only = yes
	hide_window = yes

	has_dlc = "Mystics"

	trigger = {
		OR = {
			father = { has_relationship_omen_modifier_trigger = yes }
			mother = { has_relationship_omen_modifier_trigger = yes }
		}

		OR = {
			is_smart_trigger = yes
			is_strong_trigger = yes
			has_negative_congenital_trigger = yes
		}
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 5

			OR = {
				has_character_modifier = bad_relationship_omen
				has_character_modifier = good_relationship_omen
			}
		}
	}

	immediate = {
		if = {
			limit = { has_negative_congenital_trigger = no }

			mother = { character_event = { id = MNM.1204 days = 15 } }
			father = { character_event = { id = MNM.1204 days = 15 } }
		}
		else = {
			mother = { character_event = { id = MNM.1205 days = 15 } }
			father = { character_event = { id = MNM.1205 days = 15 } }
		}
	}
}

# PING/Set-up event: Someone dies - is this what you foretold?
character_event = {
	id = MNM.1207

	hide_window = yes
	is_triggered_only = yes # on_death, random_events

	trigger = {
		death_no_trace_trigger = no
		death_in_china_trigger = no

		OR = {
			any_lover = {
				is_incapable = no
				has_relationship_omen_modifier_trigger = yes
			}

			any_friend = {
				is_incapable = no
				has_relationship_omen_modifier_trigger = yes
			}

			trigger_if = {
				limit = { is_adult = yes }

				any_rival = {
					is_incapable = no
					has_relationship_omen_modifier_trigger = yes
				}
			}

			any_child = {
				is_adult = yes
				is_incapable = no
				has_relationship_omen_modifier_trigger = yes
			}

			mother = {
				is_incapable = no
				has_relationship_omen_modifier_trigger = yes
			}

			father = {
				is_incapable = no
				has_relationship_omen_modifier_trigger = yes
			}
		}
	}

	option = {
		save_event_target_as = mnm_scrying_dead

		# Lover gets event
		random_lover = {
			limit = {
				is_incapable = no
				has_relationship_omen_modifier_trigger = yes
			}

			character_event = { id = MNM.1208 days = 20 }
		}

		# Friend gets event
		random_friend = {
			limit = {
				is_incapable = no
				has_relationship_omen_modifier_trigger = yes
			}

			character_event = { id = MNM.1209 months = 1 }
		}

		# Rival gets event
		random_rival = {
			limit = {
				is_incapable = no
				has_relationship_omen_modifier_trigger = yes
			}

			character_event = { id = MNM.1210 months = 1 }
		}

		# Adult child gets event
		random_child = {
			limit = {
				is_adult = yes
				is_incapable = no
				has_relationship_omen_modifier_trigger = yes
			}

			character_event = { id = MNM.1211 months = 1 }
		}

		# Parent
		mother = {
			if = {
				limit = {
					is_incapable = no
					has_relationship_omen_modifier_trigger = yes
				}

				character_event = { id = MNM.1212 months = 1 }
			}
		}

		father = {
			if = {
				limit = {
					is_incapable = no
					has_relationship_omen_modifier_trigger = yes
				}

				character_event = { id = MNM.1212 months = 1 }
			}
		}
	}
}

# Scrying vision result: the passing of a lover
character_event = {
	id = MNM.1208
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1208_A
		trigger = { has_character_modifier = bad_relationship_omen }
	}
	desc = {
		text = EVTDESC_MNM_1208_B
		trigger = { has_character_modifier = good_relationship_omen }
	}

	is_triggered_only = yes

	only_capable = yes

	trigger = { has_relationship_omen_modifier_trigger = yes }

	option = {
		name = EVTOPTA_MNM_1208

		trigger = { has_character_modifier = bad_relationship_omen }

		upgrade_seer_modifier_effect = yes
	}

	option = {
		name = EVTOPTB_MNM_1208

		trigger = { has_character_modifier = good_relationship_omen }

		downgrade_seer_modifier_effect = yes
	}

	after = {
		remove_scrying_omen_modifiers_effect = yes
	}
}

# Scrying vision result: the passing of a friend
character_event = {
	id = MNM.1209
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1209_A
		trigger = { has_character_modifier = bad_relationship_omen }
	}
	desc = {
		text = EVTDESC_MNM_1209_B
		trigger = { has_character_modifier = good_relationship_omen }
	}

	is_triggered_only = yes

	only_capable = yes

	trigger = { has_relationship_omen_modifier_trigger = yes }

	option = {
		name = EVTOPTA_MNM_1209

		trigger = { has_character_modifier = bad_relationship_omen }

		upgrade_seer_modifier_effect = yes
	}

	option = {
		name = EVTOPTB_MNM_1209

		trigger = { has_character_modifier = good_relationship_omen }

		downgrade_seer_modifier_effect = yes
	}

	after = {
		remove_scrying_omen_modifiers_effect = yes
	}
}

# Scrying vision result: the passing of a rival
character_event = {
	id = MNM.1210
	picture = GFX_evt_state_diplomacy
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1210_A
		trigger = { has_character_modifier = bad_relationship_omen }
	}
	desc = {
		text = EVTDESC_MNM_1210_B
		trigger = { has_character_modifier = good_relationship_omen }
	}

	is_triggered_only = yes

	only_capable = yes

	trigger = { has_relationship_omen_modifier_trigger = yes }

	option = {
		name = EVTOPTA_MNM_1210

		trigger = { has_character_modifier = good_relationship_omen }

		upgrade_seer_modifier_effect = yes
	}

	option = {
		name = EVTOPTB_MNM_1210

		trigger = { has_character_modifier = bad_relationship_omen }

		downgrade_seer_modifier_effect = yes
	}

	after = {
		remove_scrying_omen_modifiers_effect = yes
	}
}

# Scrying vision result: the passing of a parent
character_event = {
	id = MNM.1211
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1211_A
		trigger = { has_character_modifier = bad_relationship_omen }
	}
	desc = {
		text = EVTDESC_MNM_1211_B
		trigger = { has_character_modifier = good_relationship_omen }
	}

	is_triggered_only = yes

	only_capable = yes

	trigger = { has_relationship_omen_modifier_trigger = yes }

	option = {
		name = EVTOPTA_MNM_1211

		trigger = { has_character_modifier = bad_relationship_omen }

		upgrade_seer_modifier_effect = yes
	}

	option = {
		name = EVTOPTB_MNM_1211

		trigger = { has_character_modifier = good_relationship_omen }

		downgrade_seer_modifier_effect = yes
	}

	after = {
		remove_scrying_omen_modifiers_effect = yes
	}
}

# Scrying vision result: the passing of a child
character_event = {
	id = MNM.1212
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1212_A
		trigger = { has_character_modifier = bad_relationship_omen }
	}
	desc = {
		text = EVTDESC_MNM_1212_B
		trigger = { has_character_modifier = good_relationship_omen }
	}

	is_triggered_only = yes

	only_capable = yes

	trigger = { has_relationship_omen_modifier_trigger = yes }

	option = {
		name = EVTOPTA_MNM_1212

		trigger = { has_character_modifier = bad_relationship_omen }

		upgrade_seer_modifier_effect = yes
	}

	option = {
		name = EVTOPTB_MNM_1212

		trigger = { has_character_modifier = good_relationship_omen }

		downgrade_seer_modifier_effect = yes
	}

	after = {
		remove_scrying_omen_modifiers_effect = yes
	}
}

# Ping event for pets
character_event = {
	id = MNM.1213

	hide_window = yes
	is_triggered_only = yes # triggered from events where a pet dies

	trigger = {
		OR = {
			has_character_flag = cat_death_omen
			has_character_flag = dog_death_omen
		}
	}

	immediate = {
		if = {
			limit = {
				has_relationship_omen_modifier_trigger = yes
				is_incapable = no
			}

			character_event = { id = MNM.1214 }
		}
		else = {
			clr_character_flag = cat_death_omen
			clr_character_flag = dog_death_omen
		}
	}
}

# Scrying vision result: Cat/Dog death (other pet?)
character_event = {
	id = MNM.1214
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1214_A
		trigger = {
			has_character_modifier = bad_relationship_omen
			NOT = { trait = lunatic }
		}
	}
	desc = {
		text = EVTDESC_MNM_1214_B
		trigger = {
			has_character_modifier = good_relationship_omen
			NOT = { trait = lunatic }
		}
	}
	desc = {
		text = EVTDESC_MNM_1214_A_lunatic
		trigger = {
			has_character_modifier = bad_relationship_omen
			trait = lunatic
		}
	}
	desc = {
		text = EVTDESC_MNM_1214_B_lunatic
		trigger = {
			has_character_modifier = good_relationship_omen
			trait = lunatic
		}
	}

	is_triggered_only = yes

	only_capable = yes

	trigger = {
		has_relationship_omen_modifier_trigger = yes

		OR = {
			has_character_flag = cat_death_omen
			has_character_flag = dog_death_omen
		}
	}

	option = {
		name = {
			text = EVTOPTA_MNM_1214_cat
			trigger = { has_character_flag = cat_death_omen }
		}
		name = {
			text = EVTOPTA_MNM_1214_dog
			trigger = { has_character_flag = dog_death_omen }
		}
		name = {
			text = EVTOPTA_MNM_1214_other
			trigger = {
				NOR = {
					has_character_flag = cat_death_omen
					has_character_flag = dog_death_omen
				}
			}
		}

		trigger = { has_character_modifier = bad_relationship_omen }

		upgrade_seer_modifier_effect = yes
	}

	option = {
		name = {
			text = EVTOPTB_MNM_1214_cat
			trigger = { has_character_flag = cat_death_omen }
		}
		name = {
			text = EVTOPTB_MNM_1214_dog
			trigger = { has_character_flag = dog_death_omen }
		}
		name = {
			text = EVTOPTB_MNM_1214_other
			trigger = {
				NOR = {
					has_character_flag = cat_death_omen
					has_character_flag = dog_death_omen
				}
			}
		}

		trigger = { has_character_modifier = good_relationship_omen }

		downgrade_seer_modifier_effect = yes
	}

	after = {
		clr_character_flag = cat_death_omen
		clr_character_flag = dog_death_omen
		remove_scrying_omen_modifiers_effect = yes
	}
}

# Scrying vision result: gaining a new title
character_event = {
	id = MNM.1215
	picture = GFX_evt_gathering_of_minds
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1215_A
		trigger = { has_character_modifier = good_power_omen }
	}
	desc = {
		text = EVTDESC_MNM_1215_B
		trigger = { has_character_modifier = bad_power_omen }
	}

	is_triggered_only = yes # on_new_holder(_inheritance/usurpation)

	only_capable = yes

	trigger = { has_power_omen_modifier_trigger = yes }

	option = {
		name = EVTOPTA_MNM_1215

		trigger = { has_character_modifier = good_power_omen }

		upgrade_seer_modifier_effect = yes
	}

	option = {
		name = EVTOPTB_MNM_1215

		trigger = { has_character_modifier = bad_power_omen }

		downgrade_seer_modifier_effect = yes
	}

	after = {
		remove_scrying_omen_modifiers_effect = yes
	}
}

### To handle loss of titles:

# 1: new holder of title gets exception flag, if the title was granted voluntarily
diploresponse_event = {
	id = MNM.1217

	hide_window = yes
	is_triggered_only = yes # sent from GRANT_LANDED_TITLE_INTERACTION_ACCEPT_EVENT

	immediate = {
		set_character_flag = was_granted_title_voluntarily
	}
}

# 2: gating event, to send event or clearing flag for the new holder
# ROOT is new holder of title
# FROMFROM is old holder of title
character_event = {
	id = MNM.1218

	hide_window = yes
	is_triggered_only = yes # on_new_holder(_inheritance/usurpation), 1 day delay to allow MNM.1217 to fire first.

	immediate = {
		if = {
			limit = { has_character_flag = was_granted_title_voluntarily }
			clr_character_flag = was_granted_title_voluntarily
		}
		else = {
			FROMFROM = {
				if = {
					limit = { is_alive = yes }
					character_event = { id = MNM.1219 days = 3 }
				}
			}
		}
	}
}

# 3: Scrying vision result: losing a title (not sent if given away freely via diplomatic interaction)
character_event = {
	id = MNM.1219
	picture = GFX_evt_gathering_of_minds
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1219_A
		trigger = { has_character_modifier = bad_power_omen }
	}
	desc = {
		text = EVTDESC_MNM_1219_B
		trigger = { has_character_modifier = good_power_omen }
	}

	is_triggered_only = yes

	only_capable = yes

	trigger = {
		has_power_omen_modifier_trigger = yes
	}

	option = {
		name = EVTOPTA_MNM_1219

		trigger = { has_character_modifier = bad_power_omen }

		upgrade_seer_modifier_effect = yes
	}

	option = {
		name = EVTOPTB_MNM_1219

		trigger = { has_character_modifier = good_power_omen }

		downgrade_seer_modifier_effect = yes
	}

	after = {
		remove_scrying_omen_modifiers_effect = yes
	}
}

# Scrying vision result: you are sick
character_event = {
	id = MNM.1220
	picture = GFX_evt_recovery
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1220_A
		trigger = { has_character_modifier = bad_power_omen }
	}
	desc = {
		text = EVTDESC_MNM_1220_B
		trigger = { has_character_modifier = good_power_omen }
	}

	is_triggered_only = yes

	trigger = { has_power_omen_modifier_trigger = yes }

	option = {
		name = EVTOPTA_MNM_1220

		trigger = { has_character_modifier = bad_power_omen }

		upgrade_seer_modifier_effect = yes
	}

	option = {
		name = EVTOPTB_MNM_1220

		trigger = { has_character_modifier = good_power_omen }

		downgrade_seer_modifier_effect = yes
	}

	after = {
		remove_scrying_omen_modifiers_effect = yes
	}
}

# Scrying vision result: FROM is sick
character_event = {
	id = MNM.1221
	picture = GFX_evt_recovery
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1221_A
		trigger = {
			NOT = { character = FROM }
			has_character_modifier = bad_relationship_omen
		}
	}
	desc = {
		text = EVTDESC_MNM_1221_B
		trigger = {
			NOT = { character = FROM }
			has_character_modifier = good_relationship_omen
		}
	}
	desc = {
		text = EVTDESC_MNM_1221_C
		trigger = {
			character = FROM
			has_character_modifier = bad_relationship_omen
		}
	}
	desc = {
		text = EVTDESC_MNM_1221_D
		trigger = {
			character = FROM
			has_character_modifier = good_relationship_omen
		}
	}

	is_triggered_only = yes # scrying_omen_fulfilled_by_gaining_disease_effect

	trigger = {
		FROM = { is_alive = yes }
		has_relationship_omen_modifier_trigger = yes
	}

	option = {
		name = EVTOPTA_MNM_1221

		trigger = { has_character_modifier = bad_relationship_omen }

		upgrade_seer_modifier_effect = yes
	}

	option = {
		name = EVTOPTB_MNM_1221

		trigger = { has_character_modifier = good_relationship_omen }

		downgrade_seer_modifier_effect = yes
	}

	after = {
		remove_scrying_omen_modifiers_effect = yes
	}
}

# Scrying vision result: you are healthy!
character_event = {
	id = MNM.1222
	picture = GFX_evt_recovery
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1222_A
		trigger = { has_character_modifier = good_power_omen }
	}
	desc = {
		text = EVTDESC_MNM_1222_B
		trigger = { has_character_modifier = bad_power_omen }
	}

	is_triggered_only = yes

	trigger = { has_power_omen_modifier_trigger = yes }

	option = {
		name = EVTOPTA_MNM_1222

		trigger = { has_character_modifier = good_power_omen }

		upgrade_seer_modifier_effect = yes
	}

	option = {
		name = EVTOPTB_MNM_1222

		trigger = { has_character_modifier = bad_power_omen }

		downgrade_seer_modifier_effect = yes
	}

	after = {
		remove_scrying_omen_modifiers_effect = yes
	}
}

# Scrying vision result: FROM is healthy!
character_event = {
	id = MNM.1223
	picture = GFX_evt_recovery
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1223_A
		trigger = { has_character_modifier = good_relationship_omen }
	}
	desc = {
		text = EVTDESC_MNM_1223_B
		trigger = { has_character_modifier = bad_relationship_omen }
	}

	is_triggered_only = yes

	trigger = {
		FROM = { is_alive = yes }
		has_relationship_omen_modifier_trigger = yes
	}

	option = {
		name = EVTOPTA_MNM_1223

		trigger = { has_character_modifier = good_relationship_omen }

		upgrade_seer_modifier_effect = yes
	}

	option = {
		name = EVTOPTB_MNM_1223

		trigger = { has_character_modifier = bad_relationship_omen }

		downgrade_seer_modifier_effect = yes
	}

	after = {
		remove_scrying_omen_modifiers_effect = yes
	}
}

# FALLBACK (delayed event): Something good happens
character_event = {
	id = MNM.1225
	border = GFX_event_normal_frame_religion
	picture = GFX_evt_state_diplomacy

	desc = {
		text = EVTDESC_MNM_1225_A
		picture = GFX_evt_hunt
		trigger = { has_character_modifier = good_battle_omen }
	}
	desc = {
		text = EVTDESC_MNM_1225_B
		picture = GFX_evt_hunt
		trigger = { has_character_modifier = bad_battle_omen }
	}
	desc = {
		text = EVTDESC_MNM_1225_C
		picture = GFX_evt_state_diplomacy
		trigger = { has_character_modifier = good_relationship_omen }
	}
	desc = {
		text = EVTDESC_MNM_1225_D
		picture = GFX_evt_state_diplomacy
		trigger = { has_character_modifier = bad_relationship_omen }
	}
	desc = {
		text = EVTDESC_MNM_1225_E
		picture = GFX_evt_prospering_province
		trigger = { has_character_modifier = good_power_omen }
	}
	desc = {
		text = EVTDESC_MNM_1225_F
		picture = GFX_evt_prospering_province
		trigger = { has_character_modifier = bad_power_omen }
	}

	is_triggered_only = yes

	trigger = { has_an_omen_modifier_trigger = yes }

	immediate = {
		if = {
			limit = { has_relationship_omen_modifier_trigger = yes }

			hidden_effect = {
				#... Find a friend
				if = {
					limit = {
						any_courtier = {
							is_adult = yes
							NOR = {
								is_friend = ROOT
								is_rival = ROOT
								is_lover = ROOT
							}
						}
					}

					any_courtier = {
						limit = {
							is_adult = yes
							NOR = {
								is_friend = ROOT
								is_rival = ROOT
								is_lover = ROOT
							}
						}

						score_value = { # Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
							prev_likes_this_score = yes
						}

						save_event_target_as = envisioned_friend
					}
				}

				#... Or create a new one
				else = {
					create_character = {
						random_traits = yes
						dynasty = random
					}

					new_character = {
						save_event_target_as = envisioned_friend
					}
				}
			}
		}
	}

	option = {
		name = {
			text = EVTOPTA_MNM_1225_battle
			trigger = { has_character_modifier = good_battle_omen }
		}
		name = {
			text = EVTOPTA_MNM_1225_relationship
			trigger = { has_character_modifier = good_relationship_omen }
		}
		name = {
			text = EVTOPTA_MNM_1225_power
			trigger = { has_character_modifier = good_power_omen }
		}

		trigger = { has_positive_omen_modifier_trigger = yes }

		upgrade_seer_modifier_effect = yes
	}

	option = {
		name = {
			text = EVTOPTB_MNM_1225_battle
			trigger = { has_character_modifier = bad_battle_omen }
		}
		name = {
			text = EVTOPTB_MNM_1225_relationship
			trigger = { has_character_modifier = bad_relationship_omen }
		}
		name = {
			text = EVTOPTB_MNM_1225_power
			trigger = { has_character_modifier = bad_power_omen }
		}

		trigger = { has_negative_omen_modifier_trigger = yes }

		downgrade_seer_modifier_effect = yes
	}

	after = {
		if = {
			limit = { has_battle_omen_modifier_trigger = yes }

			capital_scope = {
				show_scope_change = no

				add_province_modifier = {
					name = proud_hunters_spirit
					years = 8
				}
			}
		}
		else_if = {
			limit = { has_relationship_omen_modifier_trigger = yes }
			add_friend = event_target:envisioned_friend
		}
		else_if = {
			limit = { has_power_omen_modifier_trigger = yes }
			add_pet_owl_effect = yes
		}

		remove_scrying_omen_modifiers_effect = yes
	}
}

# FALLBACK (delayed event): Something bad happens
character_event = {
	id = MNM.1226
	border = GFX_event_normal_frame_religion
	picture = GFX_evt_gathering_of_minds

	desc = {
		text = EVTDESC_MNM_1226_A
		picture = GFX_evt_hunt
		trigger = { has_character_modifier = bad_battle_omen }
	}
	desc = {
		text = EVTDESC_MNM_1226_B
		picture = GFX_evt_hunt
		trigger = { has_character_modifier = good_battle_omen }
	}
	desc = {
		text = EVTDESC_MNM_1226_C
		picture = GFX_evt_gathering_of_minds
		trigger = { has_character_modifier = bad_relationship_omen }
	}
	desc = {
		text = EVTDESC_MNM_1226_D
		picture = GFX_evt_gathering_of_minds
		trigger = { has_character_modifier = good_relationship_omen }
	}
	desc = {
		text = EVTDESC_MNM_1226_E
		picture = GFX_evt_prospering_province
		trigger = { has_character_modifier = bad_power_omen }
	}
	desc = {
		text = EVTDESC_MNM_1226_F
		picture = GFX_evt_prospering_province
		trigger = { has_character_modifier = good_power_omen }
	}

	is_triggered_only = yes

	trigger = { has_an_omen_modifier_trigger = yes }

	immediate = {
		if = {
			limit = { has_relationship_omen_modifier_trigger = yes }

			hidden_effect = {
				#... Find a rival
				if = {
					limit = {
						any_courtier = {
							is_adult = yes
							NOR = {
								is_friend = ROOT
								is_rival = ROOT
								is_lover = ROOT
							}
						}
					}

					any_courtier = {
						limit = {
							is_adult = yes
							NOR = {
								is_friend = ROOT
								is_rival = ROOT
								is_lover = ROOT
							}
						}

						score_value = { # Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
							prev_dislikes_this_score = yes
						}

						save_event_target_as = envisioned_rival
					}
				}

				#... Or create a new one
				else = {
					create_character = {
						random_traits = yes
						dynasty = random
					}

					new_character = {
						save_event_target_as = envisioned_rival
					}
				}
			}
		}
	}

	option = {
		name = {
			text = EVTOPTA_MNM_1226_battle
			trigger = { has_character_modifier = bad_battle_omen }
		}
		name = {
			text = EVTOPTA_MNM_1226_relationship
			trigger = { has_character_modifier = bad_relationship_omen }
		}
		name = {
			text = EVTOPTA_MNM_1226_power
			trigger = { has_character_modifier = bad_power_omen }
		}

		trigger = { has_negative_omen_modifier_trigger = yes }

		upgrade_seer_modifier_effect = yes
	}

	option = {
		name = {
			text = EVTOPTB_MNM_1226_battle
			trigger = { has_character_modifier = good_battle_omen }
		}
		name = {
			text = EVTOPTB_MNM_1226_relationship
			trigger = { has_character_modifier = good_relationship_omen }
		}
		name = {
			text = EVTOPTB_MNM_1226_power
			trigger = { has_character_modifier = good_power_omen }
		}

		trigger = { has_positive_omen_modifier_trigger = yes }

		downgrade_seer_modifier_effect = yes
	}

	after = {
		if = {
			limit = { has_battle_omen_modifier_trigger = yes }
			add_maimed_trait_effect = yes
		}
		else_if = {
			limit = { has_relationship_omen_modifier_trigger = yes }
			add_rival = event_target:envisioned_rival
		}

		remove_scrying_omen_modifiers_effect = yes
	}
}

# Scrying result fallback: Nothing happened, after all this time
character_event = {
	id = MNM.1227
	desc = EVTDESC_MNM_1227
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { has_an_omen_modifier_trigger = yes }

	option = {
		name = EVTOPTA_MNM_1227

		custom_tooltip = { text = EVTOPTA_MNM_1227_TT }

		remove_scrying_omen_modifiers_effect = yes
	}
}

######################## /end of Scrying events ########################


### POWER: Make Horoscope ####

# You prepare the horoscope (for horoscope_maker)
character_event = {
	id = MNM.1250
	desc = EVTDESC_MNM_1250
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # mnm_hermetics_decisions.txt

	has_dlc = "Mystics"

	immediate = {
		save_event_target_as = horoscope_maker

		event_target:horoscope_child = {
			set_character_flag = horoscope_path_1 # they are destined for grandeur
		}
	}

	option = { # "Come what may"
		name = EVTOPTA_MNM_1250

		custom_tooltip = { text = EVTOPTA_MNM_1250_TT }

		hidden_effect = {
			event_target:horoscope_child = {
				set_variable = { which = horoscope_destiny_points value = 0 } # to track truthfulness of horoscope
				set_character_flag = horoscope_destiny_revealed # to track and handle horoscope_maker dying
				character_event = { id = MNM.1297 days = 5 } # Gating event
			}
		}
	}
}

# Child is destined for grandeur (for horoscope_maker)
character_event = {
	id = MNM.1251
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1251_steward
		trigger = { event_target:horoscope_child = { has_character_flag = destined_steward } }
	}
	desc = {
		text = EVTDESC_MNM_1251_fighter
		trigger = { event_target:horoscope_child = { has_character_flag = destined_fighter } }
	}
	desc = {
		text = EVTDESC_MNM_1251_diplomat
		trigger = { event_target:horoscope_child = { has_character_flag = destined_diplomat } }
	}
	desc = {
		text = EVTDESC_MNM_1251_schemer
		trigger = { event_target:horoscope_child = { has_character_flag = destined_schemer } }
	}
	desc = {
		text = EVTDESC_MNM_1251_scholar
		trigger = { event_target:horoscope_child = { has_character_flag = destined_scholar } }
	}

	is_triggered_only = yes

	has_dlc = "Mystics"

	immediate = {
		event_target:horoscope_child = {
			random_list = {
				20 = { set_character_flag = destined_steward }
				20 = { set_character_flag = destined_fighter }
				20 = { set_character_flag = destined_diplomat }
				20 = { set_character_flag = destined_schemer }
				20 = { set_character_flag = destined_scholar }
			}
		}
	}

	option = { # This is exactly what I want for them
		name = EVTOPTA_MNM_1251

		custom_tooltip = { text = EVTOPTA_MNM_1251_TT }

		event_target:horoscope_child = {
			set_character_flag = encouraged_horoscope_pattern

			hidden_effect = {
				change_variable = { which = horoscope_destiny_points value = 5 } # increase likelyhood of fulfilling horoscope...
			}
		}
	}

	option = { # We need to discourage these tendencies
		name = EVTOPTB_MNM_1251

		custom_tooltip = { text = EVTOPTB_MNM_1251_TT }

		event_target:horoscope_child = {
			set_character_flag = discouraged_horoscope_pattern

			hidden_effect = {
				change_variable = { which = horoscope_destiny_points value = -5 } # decrease likelyhood of fulfilling horoscope...
			}
		}
	}

	after = {
		event_target:horoscope_child = {
			if = { limit = { ROOT = { is_female = yes } }
				set_character_flag = horoscope_maker_is_mother
			}
			else = {
				set_character_flag = horoscope_maker_is_father
			}

			set_character_flag = horoscope_child_receives_horoscope
			character_event = { id = MNM.1297 months = 2 } # gating event, then notify child of this
		}
	}
}

# Child receives horoscope (for horoscope_child)
character_event = {
	id = MNM.1252
	picture = GFX_evt_gathering_of_minds
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1252_A
		trigger = {
			has_character_flag = encouraged_horoscope_pattern
			NOT = { has_character_flag = horoscope_maker_died }
		}
	}
	desc = {
		text = EVTDESC_MNM_1252_B
		trigger = {
			has_character_flag = discouraged_horoscope_pattern
			NOT = { has_character_flag = horoscope_maker_died }
		}
	}
	desc = {
		text = EVTDESC_MNM_1252_C
		trigger = {
			has_character_flag = encouraged_horoscope_pattern
			has_character_flag = horoscope_maker_died
		}
	}
	desc = {
		text = EVTDESC_MNM_1252_D
		trigger = {
			has_character_flag = discouraged_horoscope_pattern
			has_character_flag = horoscope_maker_died
		}
	}

	is_triggered_only = yes

	has_dlc = "Mystics"

	option = { # chain continues (if horoscope_maker lives)
		name = {
			text = EVTOPTA_MNM_1252_1 # I wouldn't mind being great at something
			trigger = { has_character_flag = encouraged_horoscope_pattern }
		}
		name = {
			text = EVTOPTA_MNM_1252_2 # I hope I didn't do anything wrong
			trigger = { has_character_flag = discouraged_horoscope_pattern }
		}

		trigger = { NOT = { has_character_flag = horoscope_maker_died } }

		custom_tooltip = { text = EVTOPTA_MNM_1252_TT } # You try to put it out of your mind
		character_event = { id = MNM.1297 days = 10 } # send gating event before next step...
		set_horoscope_modifier_effect = yes
	}

	option = { # - END (if horoscope_maker is dead)
		name = {
			text = EVTOPTB_MNM_1252_1 # I wonder what they saw
			trigger = { has_character_flag = encouraged_horoscope_pattern }
		}
		name = {
			text = EVTOPTB_MNM_1252_2 # that certainly takes the pressure off!
			trigger = { has_character_flag = discouraged_horoscope_pattern }
		}

		trigger = { has_character_flag = horoscope_maker_died }

		custom_tooltip = { text = EVTOPTA_MNM_1252_TT } # You try to put it out of your mind
		hidden_effect = { clean_up_horoscope_effect = yes }
	}
}

# You receive update (for horoscope_maker, kid has to be over 6 years old?)
character_event = {
	id = MNM.1253
	picture = GFX_evt_gathering_of_minds
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1253_steward
		trigger = { event_target:horoscope_child = { has_character_flag = destined_steward } }
	}
	desc = {
		text = EVTDESC_MNM_1253_fighter
		trigger = { event_target:horoscope_child = { has_character_flag = destined_fighter } }
	}
	desc = {
		text = EVTDESC_MNM_1253_diplomat
		trigger = { event_target:horoscope_child = { has_character_flag = destined_diplomat } }
	}
	desc = {
		text = EVTDESC_MNM_1253_schemer
		trigger = { event_target:horoscope_child = { has_character_flag = destined_schemer } }
	}
	desc = {
		text = EVTDESC_MNM_1253_scholar
		trigger = { event_target:horoscope_child = { has_character_flag = destined_scholar } }
	}

	is_triggered_only = yes

	trigger = {
		event_target:horoscope_child = { is_alive = yes }
		society_member_of = hermetics
	}

	option = {
		name = EVTOPTA_MNM_1253 # This is great! Just as the stars predicted...

		trigger = { event_target:horoscope_child = { has_character_flag = encouraged_horoscope_pattern } }

		custom_tooltip = { text = EVTOPTA_MNM_1253_TT }
		hidden_effect = { event_target:horoscope_child = { change_variable = { which = horoscope_destiny_points value = 3 } } } # increase likelyhood of fulfilling horoscope...
	}

	option = {
		name = EVTOPTB_MNM_1253 # This is not so great. This is not a path I want for them...

		trigger = { event_target:horoscope_child = { has_character_flag = encouraged_horoscope_pattern } }

		custom_tooltip = { text = EVTOPTB_MNM_1253_TT }
		hidden_effect = { event_target:horoscope_child = { change_variable = { which = horoscope_destiny_points value = -7 } } } # decrease likelyhood of fulfilling horoscope...
	}

	option = {
		name = EVTOPTC_MNM_1253 # This is not so terrible, I guess. In spite of my doubts...

		trigger = { event_target:horoscope_child = { has_character_flag = discouraged_horoscope_pattern } }

		custom_tooltip = { text = EVTOPTC_MNM_1253_TT }
		hidden_effect = { event_target:horoscope_child = { change_variable = { which = horoscope_destiny_points value = 3 } } } # increase likelyhood of fulfilling horoscope...
	}

	option = {
		name = EVTOPTD_MNM_1253 # This is terrible! Still not at ALL what I want for them...!

		trigger = { event_target:horoscope_child = { has_character_flag = discouraged_horoscope_pattern } }

		custom_tooltip = { text = EVTOPTD_MNM_1253_TT }
		hidden_effect = { event_target:horoscope_child = { change_variable = { which = horoscope_destiny_points value = -7 } } } # decrease likelyhood of fulfilling horoscope...
	}

	after = {
		event_target:horoscope_child = {
			character_event = { id = MNM.1297 days = 10 }
		}
	}
}

# Child contemplates their destiny - is this what they want? (for horoscope_child)
character_event = {
	id = MNM.1254
	picture = GFX_evt_ritual_scroll
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1254_steward
		trigger = { event_target:horoscope_child = { has_character_flag = destined_steward } }
	}
	desc = {
		text = EVTDESC_MNM_1254_fighter
		trigger = { event_target:horoscope_child = { has_character_flag = destined_fighter } }
	}
	desc = {
		text = EVTDESC_MNM_1254_diplomat
		trigger = { event_target:horoscope_child = { has_character_flag = destined_diplomat } }
	}
	desc = {
		text = EVTDESC_MNM_1254_schemer
		trigger = { event_target:horoscope_child = { has_character_flag = destined_schemer } }
	}
	desc = {
		text = EVTDESC_MNM_1254_scholar
		trigger = { event_target:horoscope_child = { has_character_flag = destined_scholar } }
	}

	is_triggered_only = yes

	trigger = {
		any_courtier = {
			is_adult = yes
			prisoner = no
		}
	}

	immediate = {
		trigger_switch = { # find an appropriate inspiring adult...
			on_trigger = has_character_flag

			destined_steward = {
				any_courtier = {
					limit = {
						is_adult = yes
						prisoner = no
					}

					score_value = { # Prioritizes selecting an interesting courtier...
						value = 10

						interesting_courtier_selection_score = yes
						prev_likes_this_score = yes

						additive_modifier = {
							value = 50
							has_top_tier_education_trait_trigger = yes
						}
						additive_modifier = {
							value = 30
							has_education_stewardship_trigger = yes
						}
						additive_modifier = {
							value = 20
							is_guardian = ROOT
						}
						additive_modifier = {
							value = 10
							stewardship >= 15
						}
					}

					save_event_target_as = inspiring_adult
				}
			}

			destined_fighter = {
				any_courtier = {
					limit = {
						is_adult = yes
						prisoner = no
					}

					score_value = { # Prioritizes selecting an interesting courtier...
						value = 10

						interesting_courtier_selection_score = yes
						prev_likes_this_score = yes

						additive_modifier = {
							value = 50
							has_top_tier_education_trait_trigger = yes
						}
						additive_modifier = {
							value = 30
							has_education_martial_trigger = yes
						}
						additive_modifier = {
							value = 20
							is_guardian = ROOT
						}
						additive_modifier = {
							value = 10
							martial >= 15
						}
					}

					save_event_target_as = inspiring_adult
				}
			}

			destined_diplomat = {
				any_courtier = {
					limit = {
						is_adult = yes
						prisoner = no
					}

					score_value = { # Prioritizes selecting an interesting courtier...
						value = 10

						interesting_courtier_selection_score = yes
						prev_likes_this_score = yes

						additive_modifier = {
							value = 50
							has_top_tier_education_trait_trigger = yes
						}
						additive_modifier = {
							value = 30
							has_education_diplomacy_trigger = yes
						}
						additive_modifier = {
							value = 20
							is_guardian = ROOT
						}
						additive_modifier = {
							value = 10
							diplomacy >= 15
						}
					}

					save_event_target_as = inspiring_adult
				}
			}

			destined_schemer = {
				any_courtier = {
					limit = {
						is_adult = yes
						prisoner = no
					}

					score_value = { # Prioritizes selecting an interesting courtier...
						value = 10

						interesting_courtier_selection_score = yes
						prev_likes_this_score = yes

						additive_modifier = {
							value = 50
							has_top_tier_education_trait_trigger = yes
						}
						additive_modifier = {
							value = 30
							has_education_intrigue_trigger = yes
						}
						additive_modifier = {
							value = 20
							is_guardian = ROOT
						}
						additive_modifier = {
							value = 10
							intrigue >= 15
						}
					}

					save_event_target_as = inspiring_adult
				}
			}

			destined_scholar = {
				any_courtier = {
					limit = {
						is_adult = yes
						prisoner = no
					}

					score_value = { # Prioritizes selecting an interesting courtier...
						value = 10

						interesting_courtier_selection_score = yes
						prev_likes_this_score = yes

						additive_modifier = {
							value = 50
							has_top_tier_education_trait_trigger = yes
						}
						additive_modifier = {
							value = 30
							has_education_learning_trigger = yes
						}
						additive_modifier = {
							value = 20
							is_guardian = ROOT
						}
						additive_modifier = {
							value = 10
							learning >= 15
						}
					}

					save_event_target_as = inspiring_adult
				}
			}
		}
	}

	option = {
		name = EVTOPTA_MNM_1254 # I feel like this is what I am MEANT to be doing. Just as [parent's] horoscope predicted...

		hidden_effect = {
			change_variable = { which = horoscope_destiny_points value = 5 }
		}

		set_character_flag = embraced_destiny

		reverse_opinion = {
			name = opinion_delighted
			who = event_target:inspiring_adult
			years = 10
		}

		ai_chance = { # If ai is already on the right track...
			factor = 50

			mult_modifier = {
				factor = 1.5

				trigger_if = {
					limit = { has_character_flag = destined_steward }
					OR = {
						trait = conscientious
						trait = fussy
						trait = curious
					}
				}
				trigger_else_if = {
					limit = { has_character_flag = destined_fighter }
					OR = {
						trait = rowdy
						trait = haughty
					}
				}
				trigger_else_if = {
					limit = { has_character_flag = destined_diplomat }
					OR = {
						trait = playful
						trait = affectionate
					}
				}
				trigger_else_if = {
					limit = { has_character_flag = destined_schemer }
					OR = {
						trait = willful
						trait = brooding
						trait = indolent
					}
				}
				trigger_else_if = {
					limit = { has_character_flag = destined_scholar }
					OR = {
						trait = idolizer
						trait = timid
					}
				}
			}

			mult_modifier = {
				factor = 1.5

				trigger_if = {
					limit = { has_character_flag = destined_steward }
					stewardship >= 5
				}
				trigger_else_if = {
					limit = { has_character_flag = destined_fighter }
					martial >= 5
				}
				trigger_else_if = {
					limit = { has_character_flag = destined_diplomat }
					diplomacy >= 5
				}
				trigger_else_if = {
					limit = { has_character_flag = destined_schemer }
					intrigue >= 5
				}
				trigger_else_if = {
					limit = { has_character_flag = destined_scholar }
					learning >= 5
				}
			}

			mult_modifier = {
				factor = 1.5

				trigger_if = {
					limit = { has_character_flag = destined_steward }
					stewardship >= 7
				}
				trigger_else_if = {
					limit = { has_character_flag = destined_fighter }
					martial >= 7
				}
				trigger_else_if = {
					limit = { has_character_flag = destined_diplomat }
					diplomacy >= 7
				}
				trigger_else_if = {
					limit = { has_character_flag = destined_schemer }
					intrigue >= 7
				}
				trigger_else_if = {
					limit = { has_character_flag = destined_scholar }
					learning >= 7
				}
			}

			mult_modifier = {
				factor = 1.5

				trigger_if = {
					limit = { has_character_flag = destined_steward }
					stewardship >= 9
				}
				trigger_else_if = {
					limit = { has_character_flag = destined_fighter }
					martial >= 9
				}
				trigger_else_if = {
					limit = { has_character_flag = destined_diplomat }
					diplomacy >= 9
				}
				trigger_else_if = {
					limit = { has_character_flag = destined_schemer }
					intrigue >= 9
				}
				trigger_else_if = {
					limit = { has_character_flag = destined_scholar }
					learning >= 9
				}
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_1254  # I don't think this is my path...

		random = {
			chance = 50
			add_trait_stressed_effect = yes
		}

		hidden_effect = {
			change_variable = { which = horoscope_destiny_points value = -5 }
		}

		set_character_flag = refused_destiny

		ai_chance = { factor = 30 } # AI shouldn't pick this...
	}

	after = {
		character_event = { id = MNM.1297 days = 100 }
	}
}

# Parent receives update about how the child is taking to their destiny (for horoscope_maker)
character_event = {
	id = MNM.1255
	picture = GFX_evt_gathering_of_minds
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1255_A
		trigger = { event_target:horoscope_child = { has_character_flag = encouraged_horoscope_pattern has_character_flag = embraced_destiny } }
	}
	desc = {
		text = EVTDESC_MNM_1255_B
		trigger = { event_target:horoscope_child = { has_character_flag = discouraged_horoscope_pattern has_character_flag = embraced_destiny } }
	}
	desc = {
		text = EVTDESC_MNM_1255_C
		trigger = { event_target:horoscope_child = { has_character_flag = encouraged_horoscope_pattern has_character_flag = refused_destiny } }
	}
	desc = {
		text = EVTDESC_MNM_1255_D
		trigger = { event_target:horoscope_child = { has_character_flag = discouraged_horoscope_pattern has_character_flag = refused_destiny } }
	}

	is_triggered_only = yes

	trigger = {
		event_target:horoscope_child = { is_alive = yes }
		society_member_of = hermetics
	}

	option = {
		name = EVTOPTA_MNM_1255 # Good! I believe the heavens have a plan for [horoscope_child.GetTitledFirstName]

		custom_tooltip = { text = EVTOPTA_MNM_1255_TT }

		hidden_effect = {
			event_target:horoscope_child = {
				change_variable = { which = horoscope_destiny_points value = 2 }
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_1255 # Actually, I think the stars have something else in store for my [horoscope_child.GetDaugtherSon].

		custom_tooltip = { text = EVTOPTB_MNM_1255_TT }

		hidden_effect = {
			event_target:horoscope_child = {
				change_variable = { which = horoscope_destiny_points value = -2 }
			}
		}
	}

	after = {
		event_target:horoscope_child = {
			character_event = { id = MNM.1297 months = 1 }
		}
	}
}

# Upgrade modifiers (for horoscope_child}
character_event = {
	id = MNM.1269

	hide_window = yes
	is_triggered_only = yes # on_adulthood

	has_dlc = "Mystics"

	trigger = {
		has_childhood_horoscope_modifier_trigger = yes
		NOT = { has_character_flag = avoided_destiny }
	}

	immediate = {
		set_horoscope_modifier_effect = yes
	}
}

# Destiny fulfilled (for horoscope_child)
character_event = {
	id = MNM.1270
	picture = GFX_evt_state_diplomacy
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1270_A
		trigger = {
			event_target:horoscope_child = {
				has_character_flag = encouraged_horoscope_pattern
				has_character_flag = embraced_destiny
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1270_B
		trigger = {
			event_target:horoscope_child = {
				has_character_flag = discouraged_horoscope_pattern
				has_character_flag = embraced_destiny
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1270_C
		trigger = {
			event_target:horoscope_child = {
				has_character_flag = encouraged_horoscope_pattern
				has_character_flag = refused_destiny
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1270_D
		trigger = {
			event_target:horoscope_child = {
				has_character_flag = discouraged_horoscope_pattern
				has_character_flag = refused_destiny
			}
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1270 # Destiny fulfilled

		trigger = { has_top_tier_education_trait_trigger = no }

		trigger_switch = {
			on_trigger = has_character_flag

			destined_steward = {
				if = {
					limit = { has_education_stewardship_trigger = yes }
					upgrade_education_effect = yes
					set_character_flag = upgraded_stewardship
				}
				else = {
					change_stewardship = 1
					set_character_flag = stewardship_1
				}
			}

			destined_fighter = {
				if = {
					limit = { has_education_martial_trigger = yes }
					upgrade_education_effect = yes
					set_character_flag = upgraded_martial
				}
				else = {
					change_martial = 1
					set_character_flag = martial_1
				}
			}

			destined_diplomat = {
				if = {
					limit = { has_education_diplomacy_trigger = yes }
					upgrade_education_effect = yes
					set_character_flag = upgraded_diplomacy
				}
				else = {
					change_diplomacy = 1
					set_character_flag = diplomacy_1
				}
			}

			destined_schemer = {
				if = {
					limit = { has_education_intrigue_trigger = yes }
					upgrade_education_effect = yes
					set_character_flag = upgraded_intrigue
				}
				else = {
					change_intrigue = 1
					set_character_flag = intrigue_1
				}
			}

			destined_scholar = {
				if = {
					limit = { has_education_learning_trigger = yes }
					upgrade_education_effect = yes
					set_character_flag = upgraded_learning
				}
				else = {
					change_learning = 1
					set_character_flag = learning_1
				}
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_1270 # Destiny fulfilled (already maxed "correct" education)

		trigger = { has_top_tier_education_trait_trigger = yes }

		trigger_switch = {
			on_trigger = has_character_flag

			destined_steward = {
				if = {
					limit = { has_education_stewardship_trigger = yes }
					change_stewardship = 2
					set_character_flag = stewardship_2
				}
				else = {
					change_stewardship = 1
					set_character_flag = stewardship_1
				}
			}

			destined_fighter = {
				if = {
					limit = { has_education_martial_trigger = yes }
					change_martial = 2
					set_character_flag = martial_2
				}
				else = {
					change_martial = 1
					set_character_flag = martial_1
				}
			}

			destined_diplomat = {
				if = {
					limit = { has_education_diplomacy_trigger = yes }
					change_diplomacy = 2
					set_character_flag = diplomacy_2
				}
				else = {
					change_diplomacy = 1
					set_character_flag = diplomacy_1
				}
			}

			destined_schemer = {
				if = {
					limit = { has_education_intrigue_trigger = yes }
					change_intrigue = 2
					set_character_flag = intrigue_2
				}
				else = {
					change_intrigue = 1
					set_character_flag = intrigue_1
				}
			}

			destined_scholar = {
				if = {
					limit = { has_education_learning_trigger = yes }
					change_learning = 2
					set_character_flag = learning_2
				}
				else = {
					change_learning = 1
					set_character_flag = learning_1
				}
			}
		}
	}

	after = {
		hidden_effect = {
			event_target:horoscope_maker = {
				set_character_flag = child_fulfilled_destiny_flag
				character_event = { id = MNM.1265 }
			}

			clean_up_horoscope_effect = yes

			if = {
				limit = {
					event_target:horoscope_maker = { is_alive = no }
				}

				clr_character_flag = martial_1
				clr_character_flag = martial_2
				clr_character_flag = diplomacy_1
				clr_character_flag = diplomacy_2
				clr_character_flag = stewardship_1
				clr_character_flag = stewardship_2
				clr_character_flag = intrigue_1
				clr_character_flag = intrigue_2
				clr_character_flag = learning_1
				clr_character_flag = learning_2
				clr_character_flag = upgraded_martial
				clr_character_flag = upgraded_diplomacy
				clr_character_flag = upgraded_stewardship
				clr_character_flag = upgraded_intrigue
				clr_character_flag = upgraded_learning
			}
		}
	}
}

# Destiny avoided/backfired (for horoscope_child)
character_event = {
	id = MNM.1271
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1271_A
		trigger = { has_character_flag = horoscope_maker_died }
	}
	desc = {
		text = EVTDESC_MNM_1271_B
		trigger = { NOT = { has_character_flag = horoscope_maker_died } }
	}

	is_triggered_only = yes

	has_dlc = "Mystics"

	option = {
		name = EVTOPTA_MNM_1271 # I always had mixed feelings about this

		set_horoscope_modifier_effect = yes

		hidden_effect = {
			event_target:horoscope_maker = {
				set_character_flag = child_avoided_destiny_flag
				character_event = { id = MNM.1265 }
			}

			clean_up_horoscope_effect = yes
		}
	}
}

# Final follow-up for parent
character_event = {
	id = MNM.1265
	picture = GFX_evt_state_diplomacy
	border = GFX_event_normal_frame_religion

	desc = {
		text = final_horoscope_outcome_for_parent_desc_1
		trigger = { has_character_flag = child_avoided_destiny_flag }
	}
	desc = {
		text = final_horoscope_outcome_for_parent_desc_2
		trigger = { has_character_flag = child_fulfilled_destiny_flag }
	}

	is_triggered_only = yes

	trigger = { society_member_of = hermetics }

	option = {
		name = fina_horoscope_outcome_for_parent_opt

		event_target:horoscope_child = { # to show effects achieved for kid...
			show_scope_change = no

			trigger_switch = {
				on_trigger = has_character_flag

				martial_1            = { custom_tooltip = { text = improved_martial_1_tt } }
				martial_2            = { custom_tooltip = { text = improved_martial_2_tt } }
				diplomacy_1          = { custom_tooltip = { text = improved_diplo_1_tt } }
				diplomacy_2          = { custom_tooltip = { text = improved_diplo_2_tt } }
				stewardship_1        = { custom_tooltip = { text = improved_stew_1_tt } }
				stewardship_2        = { custom_tooltip = { text = improved_stew_2_tt } }
				intrigue_1           = { custom_tooltip = { text = improved_int_1_tt } }
				intrigue_2           = { custom_tooltip = { text = improved_int_2_tt } }
				learning_1           = { custom_tooltip = { text = improved_learn_1_tt } }
				learning_2           = { custom_tooltip = { text = improved_learn_2_tt } }
				upgraded_martial     = { custom_tooltip = { text = upgraded_martial_tt } }
				upgraded_diplomacy   = { custom_tooltip = { text = upgraded_diplo_tt } }
				upgraded_stewardship = { custom_tooltip = { text = upgraded_stew_tt } }
				upgraded_intrigue    = { custom_tooltip = { text = upgraded_int_tt } }
				upgraded_learning    = { custom_tooltip = { text = upgraded_learn_tt } }
			}

			clr_character_flag = martial_1
			clr_character_flag = martial_2
			clr_character_flag = diplomacy_1
			clr_character_flag = diplomacy_2
			clr_character_flag = stewardship_1
			clr_character_flag = stewardship_2
			clr_character_flag = intrigue_1
			clr_character_flag = intrigue_2
			clr_character_flag = learning_1
			clr_character_flag = learning_2
			clr_character_flag = upgraded_martial
			clr_character_flag = upgraded_diplomacy
			clr_character_flag = upgraded_stewardship
			clr_character_flag = upgraded_intrigue
			clr_character_flag = upgraded_learning
		}

		clr_character_flag = child_fulfilled_destiny_flag
		clr_character_flag = child_avoided_destiny_flag
	}
}

# gating event for the horoscope_child (to check status of horoscope_maker - alive or no?)
character_event = {
	id = MNM.1297

	hide_window = yes
	is_triggered_only = yes

	immediate = {
		# If horoscope maker remains alive...
		if = {
			limit = { event_target:horoscope_maker = { is_alive = yes } }

			trigger_switch = {
				on_trigger = has_character_flag # to determine which stage is on-going

				horoscope_destiny_revealed = {
					clr_character_flag = horoscope_destiny_revealed
					set_character_flag = horoscope_child_receives_horoscope
					event_target:horoscope_maker = { character_event = { id = MNM.1251 } } # for maker: the child is destined for grandeur within [horoscope_child.GetHermeticsDestinedExpertise]
				}

				horoscope_child_receives_horoscope = {
					if = {
						limit = { age >= 4 }
						clr_character_flag = horoscope_child_receives_horoscope
						set_character_flag = horoscope_maker_receives_update
						character_event = { id = MNM.1252 } # for child: child learns of their destiny
					}
					else = {
						repeat_event = { id = MNM.1297 years = 1 } # for child: loops this to check back when old enough
					}
				}

				horoscope_maker_receives_update = {
					if = {
						limit = { age >= 6 }
						clr_character_flag = horoscope_maker_receives_update
						set_character_flag = horoscope_child_contemplates_their_destiny
						event_target:horoscope_maker = { character_event = { id = MNM.1253 } } # for maker: the child is showing signs of talent
					}
					else = {
						repeat_event = { id = MNM.1297 years = 1 } # for child: loops this to check back when old enough
					}
				}

				horoscope_child_contemplates_their_destiny = {
					if = {
						limit = { age >= 13 }
						clr_character_flag = horoscope_child_contemplates_their_destiny
						set_character_flag = horoscope_parent_is_informed
						character_event = { id = MNM.1254 } # for child: the child contemplates their "destiny"
					}
					else = {
						repeat_event = { id = MNM.1297 years = 1 } # for child: loops this to check back when old enough
					}
				}

				horoscope_parent_is_informed = {
					clr_character_flag = horoscope_parent_is_informed
					set_character_flag = horoscope_child_evaluate
					event_target:horoscope_maker = { character_event = { id = MNM.1255 } } # for maker: the child is embracing/or not their destiny
				}

				horoscope_child_evaluate = {
					character_event = { id = MNM.1298 } # for child: begin evaluating
				}
			}
		}

		# If horoscope maker died along the chain...
		else = {
			set_character_flag = horoscope_maker_died

			trigger_switch = {
				on_trigger = has_character_flag # to determine which horoscope is on-going

				horoscope_destiny_revealed = { # nothing happens
					clr_character_flag = horoscope_destiny_revealed
					clean_up_horoscope_effect = yes
				}

				horoscope_child_receives_horoscope = {
					clr_character_flag = horoscope_child_receives_horoscope
					character_event = { id = MNM.1252 } # for child: child learns of their destiny (chain ENDS)
				}

				horoscope_maker_receives_update = {
					clr_character_flag = horoscope_maker_receives_update
					set_character_flag = horoscope_child_contemplates_their_destiny
					repeat_event = { id = MNM.1297 years = 1 } # for child: skips ahead to next step
				}

				horoscope_child_contemplates_their_destiny = {
					clr_character_flag = horoscope_child_contemplates_their_destiny
					if = {
						limit = { age >= 13 }
						clr_character_flag = horoscope_child_contemplates_their_destiny
						set_character_flag = horoscope_parent_is_informed
						character_event = { id = MNM.1254 } # for child: the child contemplates their "destiny"
					}
					else = {
						repeat_event = { id = MNM.1297 years = 1 } # for child: loops this to check back when old enough
					}
				}

				horoscope_parent_is_informed = {
					clr_character_flag = horoscope_parent_is_informed
					set_character_flag = horoscope_child_evaluate
					repeat_event = { id = MNM.1297 years = 1 } # for child: skips ahead to next step
				}

				horoscope_child_evaluate = {
					character_event = { id = MNM.1298 } # for child: begin evaluating
				}
			}
		}
	}
}

# evaluate outcome (for horoscope_child, sends itself again if not fulfilled)
character_event = {
	id = MNM.1298

	hide_window = yes
	is_triggered_only = yes

	has_dlc = "Mystics"

	immediate = {
		if = {
			limit = {
				age >= 17

				OR = {
					check_variable = { which = horoscope_destiny_points value >= 10 }
					check_variable = { which = horoscope_destiny_points value < -10 }
				}
			}

			if = {
				limit = { check_variable = { which = horoscope_destiny_points value >= 10 } }
				character_event = { id = MNM.1270 } # fulfilled destiny
			}
			else = {
				set_character_flag = avoided_destiny
				character_event = { id = MNM.1271 } # avoided destiny
			}
		}

		else = {
			if = {
				limit = { is_dumb_trigger = yes }
				change_variable = { which = horoscope_destiny_points value = -1 } # slowly ticking downwards
			}
			else = {
				change_variable = { which = horoscope_destiny_points value = 1 } # slowly ticking upwards
			}

			character_event = { id = MNM.1297 years = 1 random = 100 } # Destiny NOT fulfilled/avoided (send gating event again...)
		}
	}
}

### Power: Happiness potion

# Gating event to check amount of/which ingredients used
character_event = {
	id = MNM.5115
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_5115_self
		trigger = { has_character_flag = potion_target_is_self }
	}
	desc = {
		text = EVTDESC_MNM_5115_other
		trigger = { NOT = { has_character_flag = potion_target_is_self } }
	}

	is_triggered_only = yes # brew_happiness_potion, mnm_hermetics_decisions.txt

	immediate = {
		# Selects two ingredients...
		select_random_hermetic_ingredient_effect = yes
		select_random_hermetic_ingredient_effect = yes
	}

	option = { # I will use ingredient 1
		name = {
			text = EVTOPTA_MNM_5115_herb
			trigger = { has_selected_herb_ingredient_1_trigger = yes }
		}
		name = {
			text = EVTOPTA_MNM_5115_animal_part
			trigger = { has_selected_animal_part_ingredient_1_trigger = yes }
		}
		name = {
			text = EVTOPTA_MNM_5115_powder
			trigger = { has_selected_powder_ingredient_1_trigger = yes }
		}
		name = {
			text = EVTOPTA_MNM_5115_liquid
			trigger = { has_selected_liquid_ingredient_1_trigger = yes }
		}

		trigger = { selected_ingredient_1_and_2_are_same = no }

		calculate_health_level_of_ingredient_1_effect = yes
		destroy_selected_ingredient_1_effect = yes

		ai_chance = { factor = 0 }
	}

	option = { # I will use ingredient 2
		name = {
			text = EVTOPTB_MNM_5115_herb
			trigger = { has_selected_herb_ingredient_2_trigger = yes }
		}
		name = {
			text = EVTOPTB_MNM_5115_animal_part
			trigger = { has_selected_animal_part_ingredient_2_trigger = yes }
		}
		name = {
			text = EVTOPTB_MNM_5115_powder
			trigger = { has_selected_powder_ingredient_2_trigger = yes }
		}
		name = {
			text = EVTOPTB_MNM_5115_liquid
			trigger = { has_selected_liquid_ingredient_2_trigger = yes }
		}

		trigger = {
			has_selected_ingredient_2_trigger = yes
			selected_ingredient_1_and_2_are_same = no
		}

		calculate_health_level_of_ingredient_2_effect = yes
		destroy_selected_ingredient_2_effect = yes

		ai_chance = { factor = 0 }
	}

	option = { # I will only use one <ingredient_type_X> (IF DUPLICATE SELECTIONS)
		name = {
			text = EVTOPTC_MNM_5115_herb
			trigger = { has_selected_herb_ingredient_1_trigger = yes }
		}
		name = {
			text = EVTOPTC_MNM_5115_animal_part
			trigger = { has_selected_animal_part_ingredient_1_trigger = yes }
		}
		name = {
			text = EVTOPTC_MNM_5115_powder
			trigger = { has_selected_powder_ingredient_1_trigger = yes }
		}
		name = {
			text = EVTOPTC_MNM_5115_liquid
			trigger = { has_selected_liquid_ingredient_1_trigger = yes }
		}

		trigger = {
			has_selected_ingredient_2_trigger = yes
			selected_ingredient_1_and_2_are_same = yes
		}

		calculate_health_level_of_ingredient_1_effect = yes
		destroy_selected_ingredient_1_effect = yes

		ai_chance = { factor = 0 }
	}

	option = { # I will use ingredient 1 and 2
		name = {
			text = EVTOPTD_MNM_5115
			trigger = { selected_ingredient_1_and_2_are_same = no }
		}
		name = {
			text = EVTOPTD_MNM_5115_duplicate
			trigger = { selected_ingredient_1_and_2_are_same = yes }
		}

		trigger = { has_selected_ingredient_2_trigger = yes }

		calculate_health_level_of_ingredient_1_and_2_effect = yes
		destroy_selected_ingredient_1_and_2_effect = yes

		ai_chance = { factor = 25 }
	}

	option = { # I'll throw a bit of everything in there!
		name = EVTOPTE_MNM_5115

		custom_tooltip = { text = EVTOPTE_MNM_5115_tt }

		trigger = {
			any_artifact = {
				count >= 4
				has_artifact_flag = ingredient
			}
		}

		calculate_health_level_of_all_ingredients_effect = yes
		destroy_all_ingredients_effect = yes

		ai_chance = { factor = 100 }
	}

	after = {
		remove_selection_of_ingredients_effect = yes

		if = {
			limit = { has_character_flag = potion_target_is_self }
			character_event = { id = MNM.1400 days = 15 }
		}
		else = {
			clr_character_flag = preparing_potion
			event_target:potion_target = { character_event = { id = MNM.1401 days = 10 } }
		}

		clr_character_flag = potion_target_is_self
	}
}

# Giving the potion to yourself
character_event = {
	id = MNM.1400
	desc = EVTDESC_MNM_1400
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	hide_from = yes
	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1400

		clr_character_flag = preparing_potion
		remove_trait_silently_stressed_effect = yes
		remove_trait_silently_depressed_effect = yes

		if = {
			limit = { has_character_modifier = apathetic }
			remove_character_modifier = apathetic
		}

		hidden_effect = {
			random = {
				chance = 40

				mult_modifier = {
					factor = 0.5
					check_variable = { which = local_current_potion_quality value >= 1 }
				}
				mult_modifier = {
					factor = 0.5
					check_variable = { which = local_current_potion_quality value >= 2 }
				}
				mult_modifier = {
					factor = 0.5
					check_variable = { which = local_current_potion_quality value >= 4 }
				}
				mult_modifier = {
					factor = 0.5
					check_variable = { which = local_current_potion_quality value >= 6 }
				}
				mult_modifier = {
					factor = 1.1
					check_variable = { which = local_current_potion_quality value < -1 }
				}
				mult_modifier = {
					factor = 1.2
					check_variable = { which = local_current_potion_quality value < -2 }
				}
				mult_modifier = {
					factor = 1.3
					check_variable = { which = local_current_potion_quality value < -4 }
				}
				mult_modifier = {
					factor = 1.4
					check_variable = { which = local_current_potion_quality value < -6 }
				}

				character_event = {
					id = MNM.1403
					months = 5
					random = 600
				}
			}
		}
	}
}

# The other person gets offered a potion
character_event = {
	id = MNM.1401
	desc = EVTDESC_MNM_1401
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1401

		custom_tooltip = { text = EVTOPTA_MNM_1401_TT }

		tooltip = {
			remove_trait_silently_stressed_effect = yes
			remove_trait_silently_depressed_effect = yes

			if = {
				limit = { has_character_modifier = apathetic }
				remove_character_modifier = apathetic
			}
		}

		FROM = { character_event = { id = MNM.1402 } }

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 3
				society_member_of = hermetics
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_1401

		custom_tooltip = { text = EVTOPTB_MNM_1401_TT }

		reverse_opinion = {
			name = opinion_ungrateful
			who = FROM
		}

		# Does not give follow-up because if a player recieves this, the sender is a courtier

		ai_chance = {
			factor = 50

			trigger = {
				NOT = { vassal_of = FROM } # A player will always get a yes
			}

			mult_modifier = {
				factor = 3
				trait = zealous
			}
		}
	}
}

# Giving the potion to someone else
character_event = {
	id = MNM.1402
	desc = EVTDESC_MNM_1402
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1402


		FROM = {
			show_scope_change = no

			remove_trait_silently_stressed_effect = yes
			remove_trait_silently_depressed_effect = yes

			if = {
				limit = { has_character_modifier = apathetic }
				remove_character_modifier = apathetic
			}

			hidden_effect = {
				random = {
					chance = 20

					mult_modifier = {
						factor = 0.5
						check_variable = { which = local_current_potion_quality value >= 1 }
					}
					mult_modifier = {
						factor = 0.5
						check_variable = { which = local_current_potion_quality value >= 2 }
					}
					mult_modifier = {
						factor = 0.5
						check_variable = { which = local_current_potion_quality value >= 4 }
					}
					mult_modifier = {
						factor = 0.5
						check_variable = { which = local_current_potion_quality value >= 6 }
					}
					mult_modifier = {
						factor = 1.1
						check_variable = { which = local_current_potion_quality value < -1 }
					}
					mult_modifier = {
						factor = 1.2
						check_variable = { which = local_current_potion_quality value < -2 }
					}
					mult_modifier = {
						factor = 1.3
						check_variable = { which = local_current_potion_quality value < -4 }
					}
					mult_modifier = {
						factor = 1.4
						check_variable = { which = local_current_potion_quality value < -6 }
					}

					character_event = {
						id = MNM.1403
						months = 5
						random = 600
					}
				}
			}
		}

		reverse_opinion = {
			name = opinion_grateful
			who = FROM
		}
	}
}

# The good effect didn't last
character_event = {
	id = MNM.1403
	desc = EVTDESC_MNM_1403
	picture = GFX_evt_illness
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		NOT = { trait = depressed }
	}

	option = {
		name = EVTOPTA_MNM_1403

		add_trait = depressed

		add_character_modifier = {
			name = apathetic
			years = 5
		}
	}
}

####################################################
# MAGUS: POWER - Choose Hermetic Art/Lifestyle trait
####################################################

# No Previous Lifestyle trait - Choose one
character_event = {
	id = MNM.1900
	desc = EVTDESC_MNM_1900
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # choose_hermetic_art, mnm_hermetics_decisions.txt

	option = { # Choose Astrology/Scholar
		name = EVTOPTA_MNM_1900

		show_trait = scholar

		character_event = {
			id = MNM.1902
			days = 10
			random = 20
			tooltip = EVTOPTA_MNM_1900_TOOLTIP
		}

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 5
				trait = cynical
			}
			mult_modifier = {
				factor = 3
				trait = erudite
			}
		}
	}

	option = { # Choose Alchemy/Mystic
		name = EVTOPTB_MNM_1900

		show_trait = mystic

		character_event = {
			id = MNM.1904
			days = 10
			random = 20
			tooltip = EVTOPTB_MNM_1900_TOOLTIP
		}

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 5
				trait = cynical
			}
		}
	}

	option = { # Choose Theurgy/Theologian
		name = EVTOPTC_MNM_1900

		show_trait = theologian

		character_event = {
			id = MNM.1906
			days = 10
			random = 20
			tooltip = EVTOPTC_MNM_1900_TOOLTIP
		}

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 5
				trait = zealous
			}
		}
	}

	option = { # Change your mind
		name = EVTOPTD_MNM_1900

		add_society_currency_minor_effect = yes
		clr_character_flag = choosing_hermetic_art

		ai_chance = { factor = 0 }
	}
}

# Has either Scholar, Mystic, or Theologian already - Replace the existing trait
character_event = {
	id = MNM.1901
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESCA_MNM_1901
		picture = GFX_evt_comet
		trigger = { trait = scholar }
	}
	desc = {
		text = EVTDESCB_MNM_1901
		picture = GFX_evt_experiment
		trigger = { trait = mystic }
	}
	desc = {
		text = EVTDESCC_MNM_1901
		picture = GFX_evt_secluded_in_prayer
		trigger = { trait = theologian }
	}

	is_triggered_only = yes # choose_hermetic_art, mnm_hermetics_decisions.txt

	option = { # Change to Astrology/Scholar
		name = EVTOPTA_MNM_1901

		trigger = {
			NOT = { trait = scholar }
		}

		if = {
			limit = { trait = mystic }
			remove_trait = mystic
		}

		if = {
			limit = { trait = theologian }
			remove_trait = theologian
		}

		add_trait = scholar
		clr_character_flag = choosing_hermetic_art
	}

	option = { # Change to Alchemy/Mystic
		name = EVTOPTB_MNM_1901

		trigger = {
			NOT = { trait = mystic }
		}

		if = {
			limit = { trait = scholar }
			remove_trait = scholar
		}

		if = {
			limit = { trait = theologian }
			remove_trait = theologian
		}

		add_trait = mystic
		clr_character_flag = choosing_hermetic_art
	}

	option = { # Change to Theurgy/Theologian
		name = EVTOPTC_MNM_1901

		trigger = {
			NOT = { trait = theologian }
		}

		if = {
			limit = { trait = scholar }
			remove_trait = scholar
		}

		if = {
			limit = { trait = mystic }
			remove_trait = mystic
		}

		add_trait = theologian
		clr_character_flag = choosing_hermetic_art
	}

	option = { # Change your mind
		name = EVTOPTD_MNM_1901

		add_society_currency_minor_effect = yes
		clr_character_flag = choosing_hermetic_art
	}
}

# Become Scholar
character_event = {
	id = MNM.1902
	desc = EVTDESC_MNM_1902
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1902

		if = {
			limit = { has_character_flag = owns_observatory_equipment }
			custom_tooltip = { text = CUSTOM_TOOLTIP_OWNS_OBSERVATORY_EQUIPMENT }
			prestige = 25
		}
		else = {
			custom_tooltip = { text = CUSTOM_TOOLTIP_BUY_OBSERVATORY_EQUIPMENT }
			set_character_flag = owns_observatory_equipment
			scaled_wealth = { value = -0.4 min = -40 }
		}

		add_trait_silently_diligent_effect = yes
		remove_trait_silently_slothful_effect = yes

		add_character_modifier = {
			name = stargazer
			years = 10
		}
	}

	option = {
		name = EVTOPTB_MNM_1902

		random_list = {
			50 = { change_learning = 1 }

			40 = {
				trigger = {
					NOT = { trait = erudite }
				}

				add_trait = erudite
			}

			10 = {
				trigger = {
					NOR = {
						trait = shrewd
						trait = dull
					}
				}

				add_trait = shrewd
			}
		}

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 2
				trait = erudite
			}
		}
	}

	after = {
		character_event = {
			id = MNM.1903
			months = 2
			random = 30
		}
	}
}

character_event = {
	id = MNM.1903
	desc = EVTDESC_MNM_1903
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1903

		hidden_effect = {
			if = {
				limit = { lifestyle_traits > 0 }
				remove_lifestyle_trait_effect = yes
			}
		}

		add_trait = scholar
		clr_character_flag = choosing_hermetic_art
	}
}

# Become Mystic
character_event = {
	id = MNM.1904
	desc = EVTDESC_MNM_1904
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1904

		add_trait_partially_silently_diligent_effect = yes

		add_character_modifier = {
			name = experimenting_alchemist
			years = 10
		}

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 4
				trait = brave
			}
			mult_modifier = {
				factor = 3
				trait = ambitious
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_1904

		add_trait_partially_silently_patient_effect = yes

		add_character_modifier = {
			name = theoretical_alchemist
			years = 10
		}

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 4
				trait = craven
			}
			mult_modifier = {
				factor = 3
				trait = erudite
			}
		}
	}

	after = {
		character_event = {
			id = MNM.1905
			months = 2
			random = 30
		}
	}
}

character_event = {
	id = MNM.1905
	desc = EVTDESC_MNM_1905
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1905

		hidden_effect = {
			if = {
				limit = { lifestyle_traits > 0 }
				remove_lifestyle_trait_effect = yes
			}
		}

		add_trait = mystic
		clr_character_flag = choosing_hermetic_art
	}
}

# Become Theologian
character_event = {
	id = MNM.1906
	desc = EVTDESC_MNM_1906
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1906

		add_character_modifier = {
			name = divine_spirit_alliance
			years = 10
		}

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 4
				trait = zealous
			}
			mult_modifier = {
				factor = 4
				trait = honest
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_1906

		add_character_modifier = {
			name = demon_alliance
			years = 10
		}

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 5
				trait = deceitful
			}
			mult_modifier = {
				factor = 3
				trait = cynical
			}
		}
	}

	after = {
		character_event = {
			id = MNM.1907
			months = 2
			random = 30
		}
	}
}

character_event = {
	id = MNM.1907
	desc = EVTDESC_MNM_1907
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1907

		hidden_effect = {
			if = {
				limit = { lifestyle_traits > 0 }
				remove_lifestyle_trait_effect = yes
			}
		}

		add_trait = theologian
		clr_character_flag = choosing_hermetic_art
	}
}

################
# INTERACTIONS
################
# The flags hidden_lab and very_hidden_lab can be used for events about stealing secrets from others/having your secrets stolen.

# Interaction: Gathering of the Great Minds.
character_event = {
	id = MNM.1460
	desc = EVTDESC_MNM_1460
	picture = GFX_evt_gathering_of_minds
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # on_society_bi_yearly_pulse, random_events

	has_character_flag = built_laboratory
	only_rulers = yes
	only_capable = yes
	prisoner = no
	war = no

	trigger = {
		society_member_of = hermetics
		society_rank >= 2
		learning >= 10

		OR = {
			martial >= 8
			stewardship >= 8
		}

		is_landed = yes
		is_inaccessible_trigger = no
		NOT = { has_character_flag = gathering_of_the_minds }

		any_society_member = {
			count >= 4

			opinion = {
				who = ROOT
				value >= 15
			}

			reverse_opinion = {
				who = ROOT
				value >= 15
			}
		}
	}

	option = {
		name = EVTOPTA_MNM_1460

		custom_tooltip = { text = EVTOPTA_MNM_1460_TT }

		scaled_wealth = { value = -0.5 min = -20 }
		set_character_flag = gathering_of_the_minds
		character_event = { id = MNM.1461 days = 7 }
	}

	option = {
		name = EVTOPTB_MNM_1460
	}
}

# Send out letters
character_event = {
	id = MNM.1461
	desc = EVTDESC_MNM_1461
	picture = GFX_evt_recieve_letter
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	has_character_flag = gathering_of_the_minds

	immediate = {
		society = {
			# Guest of honor (1)
			random_list = {
				50 = {
					trigger = {
						any_society_member = {
							is_friend = ROOT
							ai = yes
						}
					}

					random_society_member = {
						limit = {
							is_friend = ROOT
							ai = yes
						}

						save_event_target_as = great_minds_guest_1
					}
				}

				50 = {
					trigger = {
						any_society_member = {
							ai = yes
							is_within_diplo_range = ROOT

							OR = {
								learning >= 16
								society_rank == 4
							}

							opinion = {
								who = ROOT
								value >= 20
							}

							reverse_opinion = {
								who = ROOT
								value >= 20
							}
						}
					}

					random_society_member = {
						limit = {
							ai = yes
							is_within_diplo_range = ROOT

							OR = {
								learning >= 16
								society_rank == 4
							}

							opinion = {
								who = ROOT
								value >= 20
							}

							reverse_opinion = {
								who = ROOT
								value >= 20
							}
						}

						save_event_target_as = great_minds_guest_1
					}
				}

				1 = {
					random_society_member = {
						limit = {
							ai = yes

							opinion = {
								who = ROOT
								value >= 15
							}

							reverse_opinion = {
								who = ROOT
								value >= 15
							}
						}

						save_event_target_as = great_minds_guest_1
					}
				}
			}

			# Guest 2
			random_society_member = {
				limit = {
					ai = yes
					NOT = { character = event_target:great_minds_guest_1 }

					opinion = {
						who = ROOT
						value >= 15
					}

					reverse_opinion = {
						who = ROOT
						value >= 15
					}
				}
				save_event_target_as = great_minds_guest_2
			}

			# Guest 3 and 4
			random_list = {
				70 = { # Your rival gets invited
					trigger = {
						any_society_member = {
							ai = yes

							reverse_opinion = {
								who = ROOT
								value < -30
							}
						}
					}

					ROOT = { set_character_flag = disliked_hermetic_colleague }

					random_society_member = {
						limit = {
							ai = yes

							reverse_opinion = {
								who = ROOT
								value < -30
							}
						}

						save_event_target_as = great_minds_guest_4
					}

					random_society_member = {
						limit = {
							ai = yes

							NOR = {
								character = event_target:great_minds_guest_1
								character = event_target:great_minds_guest_2
							}

							opinion = {
								who = event_target:great_minds_guest_4
								value >= 20
							}

							reverse_opinion = {
								who = ROOT
								value >= 15
							}
						}

						save_event_target_as = great_minds_guest_3
					}

					if = {
						limit = {
							NOT = { event_target:great_minds_guest_3 = { always = yes } }
						}

						random_society_member = {
							limit = {
								ai = yes

								NOR = {
									character = event_target:great_minds_guest_1
									character = event_target:great_minds_guest_2
								}

								opinion = {
									who = ROOT
									value >= 15
								}

								reverse_opinion = {
									who = ROOT
									value >= 15
								}
							}

							save_event_target_as = great_minds_guest_3
						}
					}
				}

				30 = { # Nothing special
					random_society_member = {
						limit = {
							ai = yes

							NOR = {
								character = event_target:great_minds_guest_1
								character = event_target:great_minds_guest_2
							}

							opinion = {
								who = ROOT
								value >= 15
							}

							reverse_opinion = {
								who = ROOT
								value >= 15
							}
						}

						save_event_target_as = great_minds_guest_3
					}

					random_society_member = {
						limit = {
							ai = yes

							NOR = {
								character = event_target:great_minds_guest_1
								character = event_target:great_minds_guest_2
								character = event_target:great_minds_guest_3
							}

							opinion = {
								who = ROOT
								value >= 15
							}

							reverse_opinion = {
								who = ROOT
								value >= 15
							}
						}

						save_event_target_as = great_minds_guest_4
					}
				}
			}
		}
	}

	option = {
		name = EVTOPTA_MNM_1461

		reverse_opinion = {
			name = opinion_grateful_invitation
			who = event_target:great_minds_guest_1
			months = 3
		}

		reverse_opinion = {
			name = opinion_grateful_invitation
			who = event_target:great_minds_guest_2
			months = 3
		}

		reverse_opinion = {
			name = opinion_grateful_invitation
			who = event_target:great_minds_guest_3
			months = 3
		}

		if = {
			limit = { has_character_flag = disliked_hermetic_colleague }
			clr_character_flag = disliked_hermetic_colleague
			letter_event = { id = MNM.1463 days = 10 }
		}
		else = {
			reverse_opinion = {
				name = opinion_grateful_invitation
				who = event_target:great_minds_guest_4
				months = 3
			}
			character_event = { id = MNM.1464 months = 1 }
		}
	}
}

# Another guests wants rival to come
letter_event = {
	id = MNM.1463
	desc = EVTDESC_MNM_1463
	border = GFX_event_letter_frame_religion
	portrait = event_target:great_minds_guest_3

	is_triggered_only = yes

	has_character_flag = gathering_of_the_minds

	# Diplomatic excuse
	option = {
		name = EVTOPTD_MNM_1463
		tooltip_info = diplomacy

		trigger = { diplomacy >= 12 }

		custom_tooltip = { text = EVTOPTD_MNM_1463_TT }

		clear_event_target = great_minds_guest_4
	}

	# I guess they can come
	option = {
		name = EVTOPTA_MNM_1463

		custom_tooltip = { text = EVTOPTA_MNM_1463_TT }

		show_portrait = event_target:great_minds_guest_4

		reverse_opinion = {
			name = opinion_grateful
			who = event_target:great_minds_guest_3
			years = 3
		}
	}

	# I don't want them here
	option = {
		name = EVTOPTB_MNM_1463

		custom_tooltip = { text = EVTOPTB_MNM_1463_TT }

		clear_event_target = great_minds_guest_4
		hermetics_upgrade_scandal_effect = yes

		reverse_opinion = {
			name = opinion_very_disappointed
			who = event_target:great_minds_guest_3
			years = 3
		}
	}

	# Neither are invited!
	option = {
		name = EVTOPTC_MNM_1463

		custom_tooltip = { text = EVTOPTC_MNM_1463_TT }

		clear_event_target = great_minds_guest_3
		clear_event_target = great_minds_guest_4
		set_character_flag = hermetics_minor_scandal # Will be upgraded to major in hermetics_upgrade_scandal_effect
		hermetics_upgrade_scandal_effect = yes

		reverse_opinion = {
			name = opinion_offended
			who = event_target:great_minds_guest_3
			years = 10
		}
	}

	after = {
		character_event = { id = MNM.1464 days = 20 }
	}
}

# You suggest what you make
character_event = {
	id = MNM.1464
	desc = EVTDESC_MNM_1464
	picture = GFX_evt_gathering_of_minds
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	has_character_flag = gathering_of_the_minds

	# Something for war (handgun, giant crossbow, plate armor)
	option = {
		name = EVTOPTA_MNM_1464
		tooltip_info = martial

		trigger = { martial >= 8 }

		custom_tooltip = { text = EVTOPTA_MNM_1464_TT }

		set_character_flag = war_invention
	}

	# Something for prosperity (mill, compass, blast furnace)
	option = {
		name = EVTOPTB_MNM_1464
		tooltip_info = stewardship

		trigger = { stewardship >= 8 }

		custom_tooltip = { text = EVTOPTB_MNM_1464_TT }

		set_character_flag = prosperity_invention
	}

	# Something for learning (glassess, cross staff, cipher disc)
	option = {
		name = EVTOPTD_MNM_1464
		tooltip_info = learning

		custom_tooltip = { text = EVTOPTD_MNM_1464_TT }

		set_character_flag = knowledge_invention
	}

	after = {
		hidden_effect = {
			random_list = {
				50 = {
					trigger = {
						event_target:great_minds_guest_1 = {
							OR = {
								is_dumb_trigger = yes
								trait = ambitious

								opinion = {
									who = ROOT
									value < 10
								}
							}
						}
					}

					mult_modifier = {
						factor = 3
						is_rival = event_target:great_minds_guest_1
					}

					event_target:great_minds_guest_1 = {
						save_event_target_as = great_minds_dissenter
					}

					character_event = { id = MNM.1466 days = 3 }
				}

				50 = {
					trigger = {
						event_target:great_minds_guest_2 = {
							OR = {
								is_dumb_trigger = yes
								trait = ambitious

								opinion = {
									who = ROOT
									value < 10
								}
							}
						}
					}

					mult_modifier = {
						factor = 3
						is_rival = event_target:great_minds_guest_2
					}

					event_target:great_minds_guest_2 = {
						save_event_target_as = great_minds_dissenter
					}

					character_event = { id = MNM.1466 days = 3 }
				}

				50 = {
					trigger = {
						event_target:great_minds_guest_3 = {
							OR = {
								is_dumb_trigger = yes
								trait = ambitious

								opinion = {
									who = ROOT
									value < 10
								}
							}
						}
					}

					mult_modifier = {
						factor = 3
						is_rival = event_target:great_minds_guest_3
					}

					event_target:great_minds_guest_3 = {
						save_event_target_as = great_minds_dissenter
					}

					character_event = { id = MNM.1466 days = 3 }
				}

				50 = {
					trigger = {
						event_target:great_minds_guest_4 = {
							OR = {
								is_dumb_trigger = yes
								trait = ambitious

								opinion = {
									who = ROOT
									value < 10
								}
							}
						}
					}

					mult_modifier = {
						factor = 3
						is_rival = event_target:great_minds_guest_4
					}

					event_target:great_minds_guest_4 = {
						save_event_target_as = great_minds_dissenter
					}

					character_event = { id = MNM.1466 days = 3 }
				}

				50 = { # They agree
					character_event = { id = MNM.1467 days = 3 }
				}
			}
		}
	}
}

# Someone protests and has their own suggestion
character_event = {
	id = MNM.1466
	desc = EVTDESC_MNM_1466
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_religion
	portrait = event_target:great_minds_dissenter

	is_triggered_only = yes

	has_character_flag = gathering_of_the_minds

	immediate = {
		event_target:great_minds_dissenter = {
			random_list = {
				33 = {
					trigger = { NOT = { ROOT = { has_character_flag = war_invention } } }

					mult_modifier = { has_education_martial_trigger = yes factor = 1.5 }
					mult_modifier = { has_lifestyle_martial_trigger = yes factor = 1.5 }

					set_character_flag = war_invention
				}

				33 = {
					trigger = { NOT = { ROOT = { has_character_flag = prosperity_invention } } }

					mult_modifier = { has_education_stewardship_trigger = yes factor = 1.5 }
					mult_modifier = { has_lifestyle_stewardship_trigger = yes factor = 1.5 }

					set_character_flag = prosperity_invention
				}

				33 = {
					trigger = { NOT = { ROOT = { has_character_flag = knowledge_invention } } }

					mult_modifier = { has_education_learning_trigger = yes factor = 1.5 }
					mult_modifier = { has_lifestyle_learning_trigger = yes factor = 1.5 }

					set_character_flag = knowledge_invention
				}
			}
		}
	}

	# Debate them
	option = {
		name = EVTOPTA_MNM_1466

		trigger = { learning >= 12 }

		custom_tooltip = { text = EVTOPTA_MNM_1466_TT }

		random_list = {
			50 = { # You win
				mult_modifier = { learning >=  8 factor = 1.2 }
				mult_modifier = { learning >= 10 factor = 1.2 }
				mult_modifier = { learning >= 12 factor = 1.2 }
				mult_modifier = { learning >= 14 factor = 1.2 }
				mult_modifier = { learning >= 16 factor = 1.2 }
				mult_modifier = { learning >= 18 factor = 1.2 }
				mult_modifier = { learning >= 20 factor = 1.2 }

				custom_tooltip = { text = EVTOPTA_MNM_1466_SUCCESS_TT }
				character_event = { id = MNM.1468 days = 7 }
			}
			50 = { # They win
				mult_modifier = { event_target:great_minds_dissenter = { learning >=  8 } factor = 1.2 }
				mult_modifier = { event_target:great_minds_dissenter = { learning >= 10 } factor = 1.2 }
				mult_modifier = { event_target:great_minds_dissenter = { learning >= 12 } factor = 1.2 }
				mult_modifier = { event_target:great_minds_dissenter = { learning >= 14 } factor = 1.2 }
				mult_modifier = { event_target:great_minds_dissenter = { learning >= 16 } factor = 1.2 }
				mult_modifier = { event_target:great_minds_dissenter = { learning >= 18 } factor = 1.2 }
				mult_modifier = { event_target:great_minds_dissenter = { learning >= 20 } factor = 1.2 }

				custom_tooltip = { text = EVTOPTA_MNM_1466_FAILURE_TT }
				character_event = { id = MNM.1469 days = 7 }
			}
		}
	}

	# Agree, it begins
	option = {
		name = EVTOPTB_MNM_1466

		custom_tooltip = { text = EVTOPTB_MNM_1466_TT }

		clr_character_flag = war_invention
		clr_character_flag = prosperity_invention
		clr_character_flag = knowledge_invention

		if = {
			limit = { event_target:great_minds_dissenter = { has_character_flag = war_invention } }
			event_target:great_minds_dissenter = { clr_character_flag = war_invention }
			set_character_flag = war_invention
		}
		else_if = {
			limit = { event_target:great_minds_dissenter = { has_character_flag = prosperity_invention } }
			event_target:great_minds_dissenter = { clr_character_flag = prosperity_invention }
			set_character_flag = prosperity_invention
		}
		else_if = {
			limit = { event_target:great_minds_dissenter = { has_character_flag = knowledge_invention } }
			event_target:great_minds_dissenter = { clr_character_flag = knowledge_invention }
			set_character_flag = knowledge_invention
		}

		character_event = { id = MNM.1470 months = 1 }
	}

	# Forbid, it begins
	option = {
		name = EVTOPTC_MNM_1466

		custom_tooltip = { text = EVTOPTC_MNM_1466_TT }

		reverse_opinion = {
			name = opinion_unreasonable
			who = event_target:great_minds_guest_1
			years = 5
		}

		reverse_opinion = {
			name = opinion_unreasonable
			who = event_target:great_minds_guest_2
			years = 5
		}

		if = {
			limit = { event_target:great_minds_guest_3 = { always = yes } }

			reverse_opinion = {
				name = opinion_unreasonable
				who = event_target:great_minds_guest_3
				years = 5
				}
		}

		if = {
			limit = { event_target:great_minds_guest_4 = { always = yes } }

			reverse_opinion = {
				name = opinion_unreasonable
				who = event_target:great_minds_guest_4
				years = 5
			}
		}

		hermetics_upgrade_scandal_effect = yes
		character_event = { id = MNM.1470 months = 1 }

		event_target:great_minds_dissenter = {
			clr_character_flag = war_invention
			clr_character_flag = prosperity_invention
			clr_character_flag = knowledge_invention
		}
	}
}

# They agreed, it begins
character_event = {
	id = MNM.1467
	desc = EVTDESC_MNM_1467
	picture = GFX_evt_gathering_of_minds
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1467

		custom_tooltip = { text = EVTOPTA_MNM_1467_TT }

		character_event = { id = MNM.1470 months = 1 }
	}
}

# You won debate
character_event = {
	id = MNM.1468
	desc = EVTDESC_MNM_1468
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_religion
	portrait = event_target:great_minds_dissenter

	is_triggered_only = yes

	has_character_flag = gathering_of_the_minds

	option = {
		name = EVTOPTA_MNM_1468

		custom_tooltip = { text = EVTOPTA_MNM_1467_TT }

		add_society_currency_minor_effect = yes

		character_event = { id = MNM.1470 months = 1 }

		event_target:great_minds_dissenter = {
			clr_character_flag = war_invention
			clr_character_flag = prosperity_invention
			clr_character_flag = knowledge_invention
		}
	}
}

# You lost debate
character_event = {
	id = MNM.1469
	desc = EVTDESC_MNM_1469
	picture = GFX_evt_rival_rulers
	border = GFX_event_normal_frame_religion
	portrait = event_target:great_minds_dissenter

	is_triggered_only = yes

	has_character_flag = gathering_of_the_minds

	option = {
		name = EVTOPTA_MNM_1469

		custom_tooltip = { text = EVTOPTA_MNM_1469_TT }

		prestige = -50

		clr_character_flag = war_invention
		clr_character_flag = prosperity_invention
		clr_character_flag = knowledge_invention

		if = {
			limit = { event_target:great_minds_dissenter = { has_character_flag = war_invention } }
			event_target:great_minds_dissenter = { clr_character_flag = war_invention }
			set_character_flag = war_invention
		}
		else_if = {
			limit = { event_target:great_minds_dissenter = { has_character_flag = prosperity_invention } }
			event_target:great_minds_dissenter = { clr_character_flag = prosperity_invention }
			set_character_flag = prosperity_invention
		}
		else_if = {
			limit = { event_target:great_minds_dissenter = { has_character_flag = knowledge_invention } }
			event_target:great_minds_dissenter = { clr_character_flag = knowledge_invention }
			set_character_flag = knowledge_invention
		}

		character_event = { id = MNM.1470 months = 1 }
	}
}

# Risky or safe project
character_event = {
	id = MNM.1470
	desc = EVTDESC_MNM_1470
	picture = GFX_evt_rival_rulers
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	hide_from = yes

	has_character_flag = gathering_of_the_minds

	# The safer
	option = {
		name = EVTOPTA_MNM_1470

		custom_tooltip = { text = EVTOPTA_MNM_1470_TT }

		reverse_opinion = {
			name = opinion_grateful
			who = event_target:great_minds_guest_2
			years = 5
		}

		reverse_opinion = {
			name = opinion_disappointed
			who = event_target:great_minds_guest_1
			years = 5
		}

		set_character_flag = safe_invention
	}

	# The riskier
	option = {
		name = EVTOPTB_MNM_1470

		custom_tooltip = { text = EVTOPTB_MNM_1470_TT }

		reverse_opinion = {
			name = opinion_grateful
			who = event_target:great_minds_guest_1
			years = 5
		}

		reverse_opinion = {
			name = opinion_disappointed
			who = event_target:great_minds_guest_2
			years = 5
		}

		set_character_flag = risky_invention
	}

	after = {
		hidden_effect = {
			event_target:great_minds_guest_1 = {
				opinion = {
					name = opinion_argued
					who = event_target:great_minds_guest_2
					years = 5
				}

				reverse_opinion = {
					name = opinion_argued
					who = event_target:great_minds_guest_2
					years = 5
				}
			}

			# Things that might happen
			random_list = {
				40 = { # People fight
					trigger = {
						society = {
							any_society_member = {
								OR = {
									character = event_target:great_minds_guest_1
									character = event_target:great_minds_guest_2
									character = event_target:great_minds_guest_3
									character = event_target:great_minds_guest_4
								}

								society = {
									any_society_member = {
										OR = {
											character = event_target:great_minds_guest_1
											character = event_target:great_minds_guest_2
											character = event_target:great_minds_guest_3
											character = event_target:great_minds_guest_4
										}

										opinion = {
											who = PREVPREV
											value < 10
										}
									}
								}
							}
						}
					}

					society = {
						random_society_member = {
							limit = {
								OR = {
									character = event_target:great_minds_guest_1
									character = event_target:great_minds_guest_2
									character = event_target:great_minds_guest_3
									character = event_target:great_minds_guest_4
								}

								society = {
									any_society_member = {
										OR = {
											character = event_target:great_minds_guest_1
											character = event_target:great_minds_guest_2
											character = event_target:great_minds_guest_3
											character = event_target:great_minds_guest_4
										}

										opinion = {
											who = PREVPREV
											value < 10
										}
									}
								}
							}

							save_event_target_as = arguer_2

							random_society_member = {
								limit = {
									OR = {
										character = event_target:great_minds_guest_1
										character = event_target:great_minds_guest_2
										character = event_target:great_minds_guest_3
										character = event_target:great_minds_guest_4
									}

									opinion = {
										who = event_target:arguer_2
										value < 10
									}
								}

								save_event_target_as = arguer_1
							}
						}
					}

					character_event = {
						id = MNM.1471
						days = 20
						random = 10
					}
				}

				35 = { # You agree with someone
					trigger = {
						OR = {
							opinion = { who = event_target:great_minds_guest_1 value >= 20 }
							opinion = { who = event_target:great_minds_guest_2 value >= 20 }
							opinion = { who = event_target:great_minds_guest_3 value >= 20 }
							opinion = { who = event_target:great_minds_guest_4 value >= 20 }
						}
					}

					society = {
						random_society_member = {
							limit = {
								OR = {
									character = event_target:great_minds_guest_1
									character = event_target:great_minds_guest_2
									character = event_target:great_minds_guest_3
									character = event_target:great_minds_guest_4
								}

								reverse_opinion = {
									who = ROOT
									value >= 20
								}
							}

							save_event_target_as = great_minds_agreer
						}
					}

					character_event = {
						id = MNM.1475
						days = 20
						random = 10
					}
				}

				25 = { # You have a brilliant insight
					trigger = { learning >= 12 }

					mult_modifier = { learning >= 14 factor = 1.2 }
					mult_modifier = { learning >= 16 factor = 1.2 }
					mult_modifier = { learning >= 18 factor = 1.2 }

					mult_modifier = {
						factor = 1.5
						has_character_modifier = divine_summoning_succeeded
					}

					character_event = {
						id = MNM.1476
						days = 20
						random = 10
					}
				}
			}
		}
	}
}

# Two people are arguing
character_event = {
	id = MNM.1471
	desc = EVTDESC_MNM_1471
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_war

	is_triggered_only = yes
	hide_from = yes

	has_character_flag = gathering_of_the_minds

	# Try to meddle
	option = {
		name = EVTOPTA_MNM_1471

		custom_tooltip = { text = EVTOPTA_MNM_1471_TT }

		random_list = {
			50 = { # It works
				mult_modifier = { society_rank >= 3 factor = 1.2 }
				mult_modifier = { diplomacy >= 12 factor = 1.2 }
				mult_modifier = { diplomacy >= 14 factor = 1.2 }
				mult_modifier = { diplomacy >= 16 factor = 1.2 }

				mult_modifier = {
					factor = 1.4
					reverse_opinion = { who = event_target:arguer_1 value >= 25 }
					reverse_opinion = { who = event_target:arguer_2 value >= 25 }
				}

				custom_tooltip = { text = EVTOPTA_MNM_1471_SUCCESS_TT }
				character_event = { id = MNM.1472 days = 5 }
			}

			50 = { # It didn't work
				mult_modifier = {
					factor = 1.2
					diplomacy < 10
				}
				mult_modifier = {
					factor = 1.3
					has_unpleasant_personality_trigger = yes
				}

				custom_tooltip = { text = EVTOPTA_MNM_1471_FAIL_TT }
				character_event = { id = MNM.1473 days = 5 }
			}
		}
	}

	# Person 1 goes
	option = {
		name = EVTOPTB_MNM_1471

		custom_tooltip = { text = EVTOPTB_MNM_1471_TT }

		event_target:arguer_1 = {
			if = {
				limit = { character = event_target:great_minds_guest_1 }
				clear_event_target = great_minds_guest_1
			}
			else_if = {
				limit = { character = event_target:great_minds_guest_2 }
				clear_event_target = great_minds_guest_2
			}
			else_if = {
				limit = { character = event_target:great_minds_guest_3 }
				clear_event_target = great_minds_guest_3
			}
			else_if = {
				limit = { character = event_target:great_minds_guest_4 }
				clear_event_target = great_minds_guest_4
			}
		}

		hermetics_upgrade_scandal_effect = yes

		# After some time, end result
		character_event = {
			id = MNM.1477
			months = 1
			random = 20
		}
	}

	# Person 2 goes
	option = {
		name = EVTOPTC_MNM_1471

		custom_tooltip = { text = EVTOPTC_MNM_1471_TT }

		event_target:arguer_2 = {
			if = {
				limit = { character = event_target:great_minds_guest_1 }
				clear_event_target = great_minds_guest_1
			}
			else_if = {
				limit = { character = event_target:great_minds_guest_2 }
				clear_event_target = great_minds_guest_2
			}
			else_if = {
				limit = { character = event_target:great_minds_guest_3 }
				clear_event_target = great_minds_guest_3
			}
			else_if = {
				limit = { character = event_target:great_minds_guest_4 }
				clear_event_target = great_minds_guest_4
			}
		}

		hermetics_upgrade_scandal_effect = yes

		# After some time, end result
		character_event = {
			id = MNM.1477
			months = 1
			random = 20
		}
	}
}

# You managed to make the quarrelers make up
character_event = {
	id = MNM.1472
	desc = EVTDESC_MNM_1472
	picture = GFX_evt_state_diplomacy
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	has_character_flag = gathering_of_the_minds

	option = {
		name = EVTOPTA_MNM_1472

		custom_tooltip = { text = EVTOPTA_MNM_1472_TT }

		reverse_opinion = {
			name = opinion_reasonable
			who = event_target:arguer_1
			years = 5
		}

		reverse_opinion = {
			name = opinion_reasonable
			who = event_target:arguer_2
			years = 5
		}

		# After some time, end result
		character_event = {
			id = MNM.1477
			months = 1
			random = 20
		}
	}
}

# You fail to make the quarrelers make up
character_event = {
	id = MNM.1473
	desc = EVTDESC_MNM_1473
	picture = GFX_evt_rival_rulers
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	has_character_flag = gathering_of_the_minds

	option = {
		name = EVTOPTA_MNM_1473

		custom_tooltip = { text = EVTOPTA_MNM_1473_TT }

		reverse_opinion = {
			name = opinion_unreasonable
			who = event_target:arguer_1
			years = 5
		}

		reverse_opinion = {
			name = opinion_unreasonable
			who = event_target:arguer_2
			years = 5
		}

		# No one leaves because it is sure to end here
		clr_character_flag = hermetics_minor_scandal
		set_character_flag = hermetics_major_scandal
		hermetics_upgrade_scandal_effect = yes

		# After some time, end result
		character_event = {
			id = MNM.1477
			months = 1
			random = 20
		}
	}
}

# You agree with someone, you work well together
character_event = {
	id = MNM.1475
	desc = EVTDESC_MNM_1475
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion
	portrait = event_target:great_minds_agreer

	is_triggered_only = yes

	has_character_flag = gathering_of_the_minds

	option = {
		name = EVTOPTA_MNM_1475

		# After some time, end result
		character_event = {
			id = MNM.1477
			months = 1
			random = 20
		}

		if = {
			limit = {
				NOT = { is_friend = event_target:great_minds_agreer }

				opinion = {
					who = event_target:great_minds_agreer
					value >= 40
				}

				reverse_opinion = {
					who = event_target:great_minds_agreer
					value >= 40
				}
			}

			add_friend = event_target:great_minds_agreer
		}
		else = {
			reverse_opinion = {
				name = opinion_great_minds
				who = event_target:great_minds_agreer
				years = 10
			}

			hidden_effect = {
				opinion = {
					name = opinion_great_minds
					who = event_target:great_minds_agreer
					years = 10
				}
			}
		}
	}
}

# You have a brilliant insight
character_event = {
	id = MNM.1476
	desc = EVTDESC_MNM_1476
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	hide_from = yes

	has_character_flag = gathering_of_the_minds

	option = {
		name = EVTOPTA_MNM_1476

		custom_tooltip = { text = EVTOPTA_MNM_1476_TT }

		add_character_modifier = {
			name = brilliant_insight
			years = 5
		}

		set_character_flag = brilliant_insight

		# After some time, end result
		character_event = {
			id = MNM.1477
			months = 1
			random = 20
		}
	}
}

# Event to calculate outcome
character_event = {
	id = MNM.1477

	hide_window = yes
	is_triggered_only = yes

	has_character_flag = gathering_of_the_minds

	immediate = {
		# Adds up everyone's learning
		set_variable = { which = local_collective_learning value = 0 }

		if = {
			limit = { event_target:great_minds_guest_1 = { always = yes } }
			export_to_variable = { which = local_collective_learning_temp value = learning who = event_target:great_minds_guest_1 }
			change_variable = { which = local_collective_learning which = local_collective_learning_temp }
		}

		if = {
			limit = { event_target:great_minds_guest_2 = { always = yes } }
			export_to_variable = { which = local_collective_learning_temp value = learning who = event_target:great_minds_guest_2 }
			change_variable = { which = local_collective_learning which = local_collective_learning_temp }
		}

		if = {
			limit = { event_target:great_minds_guest_3 = { always = yes } }
			export_to_variable = { which = local_collective_learning_temp value = learning who = event_target:great_minds_guest_3 }
			change_variable = { which = local_collective_learning which = local_collective_learning_temp }
		}

		if = {
			limit = { event_target:great_minds_guest_4 = { always = yes } }
			export_to_variable = { which = local_collective_learning_temp value = learning who = event_target:great_minds_guest_4 }
			change_variable = { which = local_collective_learning which = local_collective_learning_temp }
		}


		# Outcome
		random_list = {
			20 = { # Best
				trigger = { has_character_flag = risky_invention }

				mult_modifier = { learning >= 10 factor = 1.3 }
				mult_modifier = { learning >= 12 factor = 1.3 }
				mult_modifier = { learning >= 14 factor = 1.3 }
				mult_modifier = { learning >= 16 factor = 1.3 }
				mult_modifier = { learning >= 18 factor = 1.3 }
				mult_modifier = { learning >= 20 factor = 1.3 }

				mult_modifier = {
					factor = 100
					has_character_flag = brilliant_insight
				}
				mult_modifier = {
					factor = 1.4
					check_variable = { which = local_collective_learning value >= 40 }
				}
				mult_modifier = {
					factor = 1.4
					check_variable = { which = local_collective_learning value >= 50 }
				}
				mult_modifier = {
					factor = 1.4
					check_variable = { which = local_collective_learning value >= 60 }
				}

				set_character_flag = best_outcome
				character_event = { id = MNM.1478 }
			}

			30 = { # Good
				mult_modifier = { learning >= 10 factor = 1.2 }
				mult_modifier = { learning >= 12 factor = 1.2 }
				mult_modifier = { learning >= 14 factor = 1.2 }
				mult_modifier = { learning >= 16 factor = 1.2 }
				mult_modifier = { learning >= 18 factor = 1.2 }
				mult_modifier = { learning >= 20 factor = 1.2 }

				mult_modifier = {
					factor = 10
					has_character_flag = brilliant_insight
				}
				mult_modifier = {
					factor = 1.3
					check_variable = { which = local_collective_learning value >= 40 }
				}
				mult_modifier = {
					factor = 1.3
					check_variable = { which = local_collective_learning value >= 50 }
				}
				mult_modifier = {
					factor = 1.3
					check_variable = { which = local_collective_learning value >= 60 }
				}

				set_character_flag = good_outcome
				character_event = { id = MNM.1478 }
			}

			45 = { # Ok
				trigger = { has_character_flag = safe_invention }

				mult_modifier = { learning >= 10 factor = 1.1 }
				mult_modifier = { learning >= 12 factor = 1.1 }
				mult_modifier = { learning >= 14 factor = 1.1 }
				mult_modifier = { learning >= 16 factor = 1.1 }
				mult_modifier = { learning >= 18 factor = 1.1 }
				mult_modifier = { learning >= 20 factor = 1.1 }

				mult_modifier = {
					factor = 1.2
					check_variable = { which = local_collective_learning value >= 40 }
				}
				mult_modifier = {
					factor = 1.2
					check_variable = { which = local_collective_learning value >= 50 }
				}
				mult_modifier = {
					factor = 1.2
					check_variable = { which = local_collective_learning value >= 60 }
				}

				set_character_flag = ok_outcome
				character_event = { id = MNM.1478 }
			}

			25 = { # Normal failure outcome
				trigger = { has_character_flag = safe_invention }

				set_character_flag = failure_outcome
				character_event = { id = MNM.1479 }
			}

			25 = { # Dangerous failure outcome
				trigger = { has_character_flag = risky_invention }

				set_character_flag = bad_failure_outcome
				character_event = { id = MNM.1479 }
			}
		}

		clr_character_flag = brilliant_insight
	}
}

# Good outcome
character_event = {
	id = MNM.1478
	picture = GFX_evt_gathering_of_minds
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1478_A # Hand gun
		picture = GFX_evt_gathering_of_minds
		trigger = {
			has_character_flag = best_outcome
			has_character_flag = war_invention
		}
	}
	desc = {
		text = EVTDESC_MNM_1478_B # Compass
		picture = GFX_evt_gathering_of_minds
		trigger = {
			has_character_flag = best_outcome
			has_character_flag = prosperity_invention
		}
	}
	desc = {
		text = EVTDESC_MNM_1478_C # Radius astronomicus
		picture = GFX_evt_gathering_of_minds
		trigger = {
			has_character_flag = best_outcome
			has_character_flag = knowledge_invention
		}
	}
	desc = {
		text = EVTDESC_MNM_1478_D # Giant crossbow
		picture = GFX_evt_gathering_of_minds
		trigger = {
			has_character_flag = good_outcome
			has_character_flag = war_invention
		}
	}
	desc = {
		text = EVTDESC_MNM_1478_E # Blast furnace
		picture = GFX_evt_weaponsmith
		trigger = {
			has_character_flag = good_outcome
			has_character_flag = prosperity_invention
		}
	}
	desc = {
		text = EVTDESC_MNM_1478_F # Crypt and cypher machine
		picture = GFX_evt_ritual_scroll
		trigger = {
			has_character_flag = good_outcome
			has_character_flag = knowledge_invention
		}
	}
	desc = {
		text = EVTDESC_MNM_1478_G  # Plate armor
		picture = GFX_evt_weaponsmith
		trigger = {
			has_character_flag = ok_outcome
			has_character_flag = war_invention
		}
	}
	desc = {
		text = EVTDESC_MNM_1478_H # A new mill
		picture = GFX_evt_gathering_of_minds
		trigger = {
			has_character_flag = ok_outcome
			has_character_flag = prosperity_invention
		}
	}
	desc = {
		text = EVTDESC_MNM_1478_I # Glasses
		picture = GFX_evt_gathering_of_minds
		trigger = {
			has_character_flag = ok_outcome
			has_character_flag = knowledge_invention
		}
	}

	is_triggered_only = yes
	hide_from = yes

	has_character_flag = gathering_of_the_minds

	option = {
		name = EVTOPTA_MNM_1478

		trigger = {
			has_character_flag = best_outcome
			has_character_flag = war_invention
		}

		add_artifact = hermetic_handgun

		military_techpoints = 100
		add_society_currency_major_effect = yes
	}

	option = {
		name = EVTOPTB_MNM_1478

		trigger = {
			has_character_flag = best_outcome
			has_character_flag = prosperity_invention
		}

		add_artifact = hermetic_compass

		economy_techpoints = 100
		add_society_currency_major_effect = yes
	}

	option = {
		name = EVTOPTC_MNM_1478

		trigger = {
			has_character_flag = best_outcome
			has_character_flag = knowledge_invention
		}

		add_artifact = radius_astronomicus

		culture_techpoints = 100
		add_society_currency_major_effect = yes
	}

	option = {
		name = EVTOPTD_MNM_1478

		trigger = {
			has_character_flag = good_outcome
			has_character_flag = war_invention
		}

		capital_scope = {
			show_scope_change = no

			add_province_modifier = {
				name = giant_crossbow
				years = 100
			}
		}

		military_techpoints = 50
		add_society_currency_medium_effect = yes
	}

	option = {
		name = EVTOPTE_MNM_1478

		trigger = {
			has_character_flag = good_outcome
			has_character_flag = prosperity_invention
		}

		capital_scope = {
			show_scope_change = no

			add_province_modifier = {
				name = blast_furnace
				years = 100
			}
		}

		economy_techpoints = 50
		add_society_currency_medium_effect = yes
	}

	option = {
		name = EVTOPTF_MNM_1478

		trigger = {
			has_character_flag = good_outcome
			has_character_flag = knowledge_invention
		}

		add_artifact = hermetic_cypher_machine

		culture_techpoints = 50
		add_society_currency_medium_effect = yes
	}

	option = {
		name = EVTOPTG_MNM_1478

		trigger = {
			has_character_flag = ok_outcome
			has_character_flag = war_invention
		}

		add_artifact = hermetic_plate_armor

		military_techpoints = 25
		add_society_currency_minor_effect = yes
	}

	option = {
		name = EVTOPTH_MNM_1478

		trigger = {
			has_character_flag = ok_outcome
			has_character_flag = prosperity_invention
		}

		capital_scope = {
			show_scope_change = no

			add_province_modifier = {
				name = great_mill
				years = 100
			}
		}

		economy_techpoints = 25
		add_society_currency_minor_effect = yes
	}

	option = {
		name = EVTOPTI_MNM_1478

		trigger = {
			has_character_flag = ok_outcome
			has_character_flag = knowledge_invention
		}

		add_artifact = hermetic_glasses

		culture_techpoints = 25
		add_society_currency_minor_effect = yes
	}

	after = {
		clr_character_flag = gathering_of_the_minds
		clr_character_flag = war_invention
		clr_character_flag = prosperity_invention
		clr_character_flag = knowledge_invention
		clr_character_flag = best_outcome
		clr_character_flag = good_outcome
		clr_character_flag = ok_outcome
	}
}

# Failure
character_event = {
	id = MNM.1479
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1479_A
		picture = GFX_evt_quarrel
		trigger = { has_character_flag = failure_outcome }
	}
	desc = {
		text = EVTDESC_MNM_1479_B
		trigger = { has_character_flag = bad_failure_outcome }
	}

	is_triggered_only = yes
	hide_from = yes

	immediate = {
		random_list = {
			20 = { set_character_flag = invention_failure_maimed }
			20 = { set_character_flag = invention_failure_wounded }
			60 = { } # They're safe
		}

		event_target:great_minds_guest_1 = {
			random_list = {
				20 = { set_character_flag = invention_failure_death }
				20 = { set_character_flag = invention_failure_maimed }
				20 = { set_character_flag = invention_failure_wounded }
				40 = { } # They're safe
			}
		}

		event_target:great_minds_guest_2 = {
			random_list = {
				20 = { set_character_flag = invention_failure_death }
				20 = { set_character_flag = invention_failure_maimed }
				20 = { set_character_flag = invention_failure_wounded }
				40 = { } # They're safe
			}
		}

		event_target:great_minds_guest_3 = {
			random_list = {
				20 = { set_character_flag = invention_failure_death }
				20 = { set_character_flag = invention_failure_maimed }
				20 = { set_character_flag = invention_failure_wounded }
				40 = { } # They're safe
			}
		}

		event_target:great_minds_guest_4 = {
			random_list = {
				20 = { set_character_flag = invention_failure_death }
				20 = { set_character_flag = invention_failure_maimed }
				20 = { set_character_flag = invention_failure_wounded }
				40 = { } # They're safe
			}
		}
	}

	option = {
		name = EVTOPTA_MNM_1479

		trigger = { has_character_flag = failure_outcome }

		custom_tooltip = { text = EVTOPTA_MNM_1479_TT }
	}

	option = {
		name = EVTOPTB_MNM_1479

		trigger = { has_character_flag = bad_failure_outcome }

		custom_tooltip = { text = EVTOPTB_MNM_1479_TT }

		trigger_switch = {
			on_trigger = has_character_flag

			invention_failure_maimed	= { add_maimed_trait_effect = yes }
			invention_failure_wounded	= { add_trait_silently_wounded_effect = yes }
		}

		event_target:great_minds_guest_1 = {
			show_scope_change = no

			trigger_switch = {
				on_trigger = has_character_flag

				invention_failure_death 	= { death = { death_reason = death_accident } }
				invention_failure_maimed	= { add_maimed_trait_effect = yes }
				invention_failure_wounded	= { add_trait_silently_wounded_effect = yes }
			}
		}

		event_target:great_minds_guest_2 = {
			show_scope_change = no

			trigger_switch = {
				on_trigger = has_character_flag

				invention_failure_death 	= { death = { death_reason = death_accident } }
				invention_failure_maimed	= { add_maimed_trait_effect = yes }
				invention_failure_wounded	= { add_trait_silently_wounded_effect = yes }
			}
		}

		event_target:great_minds_guest_3 = {
			show_scope_change = no

			trigger_switch = {
				on_trigger = has_character_flag

				invention_failure_death 	= { death = { death_reason = death_accident } }
				invention_failure_maimed	= { add_maimed_trait_effect = yes }
				invention_failure_wounded	= { add_trait_silently_wounded_effect = yes }
			}
		}

		event_target:great_minds_guest_4 = {
			show_scope_change = no

			trigger_switch = {
				on_trigger = has_character_flag

				invention_failure_death 	= { death = { death_reason = death_accident } }
				invention_failure_maimed	= { add_maimed_trait_effect = yes }
				invention_failure_wounded	= { add_trait_silently_wounded_effect = yes }
			}
		}
	}

	after = {
		clr_character_flag = gathering_of_the_minds
		clr_character_flag = war_invention
		clr_character_flag = prosperity_invention
		clr_character_flag = knowledge_invention
		clr_character_flag = failure_outcome
		clr_character_flag = bad_failure_outcome
		clr_character_flag = invention_failure_maimed
		clr_character_flag = invention_failure_wounded

		event_target:great_minds_guest_1 = {
			clr_character_flag = invention_failure_maimed
			clr_character_flag = invention_failure_wounded
		}

		event_target:great_minds_guest_2 = {
			clr_character_flag = invention_failure_maimed
			clr_character_flag = invention_failure_wounded
		}

		event_target:great_minds_guest_3 = {
			clr_character_flag = invention_failure_maimed
			clr_character_flag = invention_failure_wounded
		}

		event_target:great_minds_guest_4 = {
			clr_character_flag = invention_failure_maimed
			clr_character_flag = invention_failure_wounded
		}
	}
}

# Major scandal
character_event = {
	id = MNM.1481
	desc = EVTDESC_MNM_1481
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # hermetics_upgrade_scandal_effect
	hide_from = yes

	option = {
		name = EVTOPTA_MNM_1481

		custom_tooltip = { text = EVTOPTA_MNM_1481_TT }

		clr_character_flag = gathering_of_the_minds
		clr_character_flag = war_invention
		clr_character_flag = prosperity_invention
		clr_character_flag = knowledge_invention
		clr_character_flag = hermetics_minor_scandal
		clr_character_flag = hermetics_major_scandal
		clr_character_flag = risky_invention
		clr_character_flag = safe_invention
		clr_character_flag = brilliant_insight

		event_target:great_minds_guest_1 = {
			clr_character_flag = war_invetion
			clr_character_flag = prosperity_invention
			clr_character_flag = knowledge_invention
		}

		event_target:great_minds_guest_2 = {
			clr_character_flag = war_invetion
			clr_character_flag = prosperity_invention
			clr_character_flag = knowledge_invention
		}

		event_target:great_minds_guest_3 = {
			clr_character_flag = war_invetion
			clr_character_flag = prosperity_invention
			clr_character_flag = knowledge_invention
		}

		event_target:great_minds_guest_4 = {
			clr_character_flag = war_invetion
			clr_character_flag = prosperity_invention
			clr_character_flag = knowledge_invention
		}
	}
}


## Divine Summoning ##

# Divine Summoning find target and Planning.
character_event = {
	id = MNM.1620
	picture = GFX_evt_shadowy_cabal
	border = GFX_event_normal_frame_religion
	portrait = event_target:divine_summoning_collaborator

	desc = {
		text = EVTDESC_MNM_1622
		trigger = {
			event_target:divine_summoning_collaborator = {
				NOT = { host = { character = ROOT } }
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1622_COURT
		trigger = {
			event_target:divine_summoning_collaborator = {
				host = { character = ROOT }
			}
		}
	}

	is_triggered_only = yes # on_society_bi_yearly_pulse, random_events

	only_playable = yes
	only_capable = yes
	prisoner = no

	trigger = {
		society_member_of = hermetics
		is_inaccessible_trigger = no
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 2.0
			society_rank >= 3
		}
		mult_modifier = {
			factor = 0.5
			society_rank == 1
		}
		mult_modifier = {
			factor = 3.0
			OR = {
				has_focus = focus_scholarship
				has_focus = focus_theology
			}
		}
		mult_modifier = {
			factor = 3.0
			trait = genius
		}
		mult_modifier = {
			factor = 3.0
			trait = mystic
		}
		mult_modifier = {
			factor = 2.0
			trait = quick
		}
		mult_modifier = {
			factor = 2.0
			trait = shrewd
		}
		mult_modifier = {
			factor = 0.5
			trait = dull
		}
		mult_modifier = {
			factor = 0.5
			trait = slow
		}
		mult_modifier = {
			factor = 0.1
			trait = imbecile
		}
		mult_modifier = {
			factor = 0.25
			has_character_flag = had_a_divine_summoning
		}
	}

	immediate = {
		# First look for someone at court
		society = {
			random_society_member = {
				limit = {
					ai = yes
					in_command = no
					is_inaccessible_or_incapable_trigger = no
					NOT = { character = ROOT }
				}

				preferred_limit = {
					host = { character = ROOT }
				}

				preferred_limit = {
					same_realm = ROOT
				}

				preferred_limit = {
					is_within_diplo_range = ROOT
				}

				save_event_target_as = divine_summoning_collaborator
			}
		}
	}

	option = {
		name = EVTOPTA_MNM_1622 # Anything to grow closer to the Divine!

		set_character_flag = had_a_divine_summoning

		hidden_effect = {
			event_target:divine_summoning_collaborator = {
				destroy_random_ingredients_effect = yes
			}
		}

		narrative_event = {
			id = MNM.1624
			days = 15
			random = 15
			tooltip = EVTTOOLTIP_MNM_1622
		}

		ai_chance = {
			factor = 100

			trigger = {
				NOT = {
					any_artifact = { has_artifact_flag = ingredient }
				}
			}

			mult_modifier = {
				factor = 50
				trait = ambitious
			}
			mult_modifier = {
				factor = 50
				trait = mystic
			}
		}
	}

	option = {
		name = EVTOPTA_MNM_1622_use_ingredients # Send them these ingredients to aid in the ritual!
		tooltip_info_custom = ingredient_option_available_tt

		trigger = {
			any_artifact = { has_artifact_flag = ingredient }
		}

		custom_tooltip = {
			text = ingredients_are_sent_tt

			hidden_effect = {
				destroy_random_ingredients_effect = yes

				event_target:divine_summoning_collaborator = {
					destroy_random_ingredients_effect = yes
				}
			}
		}

		set_character_flag = had_a_divine_summoning
		set_character_flag = used_ingredients_for_summoning

		narrative_event = {
			id = MNM.1624
			days = 15
			random = 15
			tooltip = EVTTOOLTIP_MNM_1622
		}

		ai_chance = {
			factor = 500

			mult_modifier = {
				factor = 50
				trait = ambitious
			}
			mult_modifier = {
				factor = 50
				trait = mystic
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_1622 # Even rituals carry danger

		detract_society_currency_minor_effect = yes

		reverse_opinion = {
			name = opinion_coward
			who = event_target:divine_summoning_collaborator
			years = 5
		}

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 50
				trait = craven
			}
			mult_modifier = {
				factor = 25
				trait = content
			}
		}
	}
}

# Divine Summoning - The Ritual
narrative_event = {
	id = MNM.1624
	title = EVTTITLE_MNM_1624
	desc = EVTDESC_MNM_1624
	picture = GFX_evt_magic_ritual
	border = GFX_event_narrative_frame_religion
	portrait = event_target:divine_summoning_collaborator

	is_triggered_only = yes

	option = { # Ask it the secrets of Alchemy (stewardship)
		name = EVTOPTA_MNM_1624

		set_character_flag = divine_summoning_alchemy
	}

	option = { # Ask it the secrets of Astrology (diplomacy)
		name = EVTOPTB_MNM_1624

		set_character_flag = divine_summoning_astrology
	}

	option = { # Open your mind to the Divine (learning)
		name = EVTOPTC_MNM_1624

		set_character_flag = divine_summoning_open_mind
	}

	option = { # Ask it about how the Truth has been hidden (intrigue)
		name = EVTOPTD_MNM_1624

		set_character_flag = divine_summoning_hidden_truth
	}

	after = {
		hidden_effect = {
			if = {
				limit = { learning >= 25 }

				random_list = {
					15 = { set_character_flag = divine_summoning_success }
					25 = { set_character_flag = divine_summoning_good_bonus }
					40 = { set_character_flag = divine_summoning_bonus }

					15 = {
						mult_modifier = {
							factor = 0.5
							has_character_flag = used_ingredients_for_summoning
						}

						set_character_flag = divine_summoning_penalty
					}

					 5 = {
						mult_modifier = {
							factor = 0.5
							has_character_flag = used_ingredients_for_summoning
						}

						set_character_flag = divine_summoning_bad_penalty
					}
				}
			}
			else_if = {
				limit = { learning >= 20 }

				random_list = {
					10 = { set_character_flag = divine_summoning_success }
					20 = { set_character_flag = divine_summoning_good_bonus }
					35 = { set_character_flag = divine_summoning_bonus }
					20 = { set_character_flag = divine_summoning_penalty }

					10 = {
						mult_modifier = {
							factor = 0.5
							has_character_flag = used_ingredients_for_summoning
						}

						set_character_flag = divine_summoning_bad_penalty
					}

					 5 = {
						mult_modifier = {
							factor = 0.5
							has_character_flag = used_ingredients_for_summoning
						}

						set_character_flag = divine_summoning_failure
					}
				}
			}
			else_if = {
				limit = { learning >= 15 }

				random_list = {
					 5 = { set_character_flag = divine_summoning_success }
					10 = { set_character_flag = divine_summoning_good_bonus }
					20 = { set_character_flag = divine_summoning_bonus }
					35 = { set_character_flag = divine_summoning_penalty }

					20 = {
						mult_modifier = {
							factor = 0.5
							has_character_flag = used_ingredients_for_summoning
						}

						set_character_flag = divine_summoning_bad_penalty
					}

					10 = {
						mult_modifier = {
							factor = 0.5
							has_character_flag = used_ingredients_for_summoning
						}

						set_character_flag = divine_summoning_failure
					}
				}
			}
			else = {
				random_list = {
					 5 = { set_character_flag = divine_summoning_good_bonus }
					15 = { set_character_flag = divine_summoning_bonus }
					40 = { set_character_flag = divine_summoning_penalty }

					25 = {
						mult_modifier = {
							factor = 0.5
							has_character_flag = used_ingredients_for_summoning
						}

						set_character_flag = divine_summoning_bad_penalty
					}

					15 = {
						mult_modifier = {
							factor = 0.5
							has_character_flag = used_ingredients_for_summoning
						}

						set_character_flag = divine_summoning_failure
					}
				}
			}
		}

		clr_character_flag = used_ingredients_for_summoning

		character_event = {
			id = MNM.1626
			days = 15
			random = 15
		}
	}
}

# Divine Summoning - Result
character_event = {
	id = MNM.1626
	picture = GFX_evt_shadowy_cabal
	border = GFX_event_normal_frame_religion
	portrait = event_target:divine_summoning_collaborator

	desc = {
		text = EVTDESC_MNM_1626_SUCCESS
		trigger = {
			has_character_flag = divine_summoning_success
		}
	}
	desc = {
		text = EVTDESC_MNM_1626_FAILURE
		trigger = {
			has_character_flag = divine_summoning_failure
		}
	}
	desc = {
		text = EVTDESC_MNM_1626_ALCH_BONUS
		trigger = {
			has_character_flag = divine_summoning_alchemy

			NOR = {
				has_character_flag = divine_summoning_success
				has_character_flag = divine_summoning_failure
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1626_ASTR_BONUS
		trigger = {
			has_character_flag = divine_summoning_astrology

			NOR = {
				has_character_flag = divine_summoning_success
				has_character_flag = divine_summoning_failure
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1626_MIND_BONUS
		trigger = {
			has_character_flag = divine_summoning_open_mind

			NOR = {
				has_character_flag = divine_summoning_success
				has_character_flag = divine_summoning_failure
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1626_TRUTH_BONUS
		trigger = {
			has_character_flag = divine_summoning_hidden_truth

			NOR = {
				has_character_flag = divine_summoning_success
				has_character_flag = divine_summoning_failure
			}
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1626 # Success

		trigger = {
			NOR = {
				has_character_flag = divine_summoning_success
				has_character_flag = divine_summoning_failure
			}
		}

		trigger_switch = {
			on_trigger = has_character_flag

			divine_summoning_alchemy = {
				trigger_switch = {
					on_trigger = has_character_flag

					divine_summoning_good_bonus = {
						add_character_modifier = {
							name = alchemy_good_ste_bonus
							years = 5
						}
					}

					divine_summoning_bonus = {
						add_character_modifier = {
							name = alchemy_ste_bonus
							years = 5
						}
					}

					divine_summoning_penalty = {
						add_character_modifier = {
							name = alchemy_ste_penalty
							years = 5
						}
					}

					divine_summoning_bad_penalty = {
						add_character_modifier = {
							name = alchemy_bad_ste_penalty
							years = 5
						}
					}
				}
			}

			divine_summoning_astrology = {
				trigger_switch = {
					on_trigger = has_character_flag

					divine_summoning_good_bonus = {
						add_character_modifier = {
							name = astrology_good_dip_bonus
							years = 5
						}
					}

					divine_summoning_bonus = {
						add_character_modifier = {
							name = astrology_dip_bonus
							years = 5
						}
					}

					divine_summoning_penalty = {
						add_character_modifier = {
							name = astrology_dip_penalty
							years = 5
						}
					}

					divine_summoning_bad_penalty = {
						add_character_modifier = {
							name = astrology_bad_dip_penalty
							years = 5
						}
					}
				}
			}

			divine_summoning_open_mind = {
				trigger_switch = {
					on_trigger = has_character_flag

					divine_summoning_good_bonus = {
						add_character_modifier = {
							name = open_mind_good_lea_bonus
							years = 5
						}
					}

					divine_summoning_bonus = {
						add_character_modifier = {
							name = open_mind_lea_bonus
							years = 5
						}
					}

					divine_summoning_penalty = {
						add_character_modifier = {
							name = open_mind_lea_penalty
							years = 5
						}
					}

					divine_summoning_bad_penalty = {
						add_character_modifier = {
							name = open_mind_bad_lea_penalty
							years = 5
						}
					}
				}
			}

			divine_summoning_hidden_truth = {
				trigger_switch = {
					on_trigger = has_character_flag

					divine_summoning_good_bonus = {
						add_character_modifier = {
							name = hidden_truth_good_int_bonus
							years = 5
						}
					}

					divine_summoning_bonus = {
						add_character_modifier = {
							name = hidden_truth_int_bonus
							years = 5
						}
					}

					divine_summoning_penalty = {
						add_character_modifier = {
							name = hidden_truth_int_penalty
							years = 5
						}
					}

					divine_summoning_bad_penalty = {
						add_character_modifier = {
							name = hidden_truth_bad_int_penalty
							years = 5
						}
					}
				}
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_1626 # Critical success

		trigger = { has_character_flag = divine_summoning_success }

		prestige = 100

		add_character_modifier = {
			name = divine_summoning_succeeded
			years = 10
		}

		add_society_currency_minor_effect = yes
	}

	option = {
		name = EVTOPTC_MNM_1626 # Failure

		trigger = { has_character_flag = divine_summoning_failure }

		prestige = -100

		add_character_modifier = {
			name = divine_summoning_failed
			years = 10
		}
	}

	after = {
		clr_character_flag = divine_summoning_success
		clr_character_flag = divine_summoning_failure
		clr_character_flag = divine_summoning_good_bonus
		clr_character_flag = divine_summoning_bonus
		clr_character_flag = divine_summoning_penalty
		clr_character_flag = divine_summoning_bad_penalty
		clr_character_flag = divine_summoning_alchemy
		clr_character_flag = divine_summoning_astrology
		clr_character_flag = divine_summoning_open_mind
		clr_character_flag = divine_summoning_hidden_truth
	}
}

## Write a Theorem Paper

# Write a Theory Paper - choose approach
character_event = {
	id = MNM.1630
	desc = EVTDESC_MNM_1630
	picture = GFX_evt_scientist
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # hermetics_write_theory_paper, mnm_hermetics_decisions.txt

	option = { # Normal effort
		name = EVTOPTA_MNM_1630

		custom_tooltip = { text = EVTOPTA_MNM_1630_TT }

		set_character_flag = theory_paper_normal_effort

		character_event = {
			id = MNM.1631
			months = 3
			random = 90
		}
	}

	option = { # Get help from others
		name = EVTOPTB_MNM_1630
		tooltip_info = diplomacy

		trigger = { diplomacy >= 15 }

		custom_tooltip = { text = EVTOPTB_MNM_1630_TT }

		set_character_flag = theory_paper_asked_help

		character_event = {
			id = MNM.1631
			months = 3
			random = 90
		}
	}

	option = { # Steal another's work
		name = EVTOPTC_MNM_1630
		tooltip_info = intrigue

		trigger = { intrigue >= 15 }

		custom_tooltip = { text = EVTOPTC_MNM_1630_TT }

		set_character_flag = theory_paper_stole_work

		character_event = {
			id = MNM.1631
			months = 3
			random = 90
		}
	}

	option = { # Invest heavily in research
		name = EVTOPTD_MNM_1630

		trigger = {
			NOT = { trait = content }
		}

		random = {
			chance = 10
			add_trait_ambitious_effect = yes
		}

		random = {
			chance = 10
			add_trait_stressed_effect = yes
		}

		scaled_wealth = { value = -1 min = -25 }
		piety = -50

		add_character_modifier = {
			name = theory_paper_heavy_investment
			years = 1
		}

		custom_tooltip = { text = EVTOPTD_MNM_1630_TT }
		set_character_flag = theory_paper_heavy_investment

		character_event = {
			id = MNM.1631
			months = 6
			random = 180
		}
	}
}

# Ping event for deciding success
character_event = {
	id = MNM.1631

	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_list = {
			15 = {
				mult_modifier = {
					factor = 2
					learning >= 25
				}
				mult_modifier = {
					factor = 2
					has_character_flag = theory_paper_heavy_investment
				}
				mult_modifier = {
					factor = 1.4
					has_character_flag = theory_paper_asked_help
				}
				mult_modifier = {
					factor = 1.6
					has_character_flag = theory_paper_stole_work
				}
				mult_modifier = {
					factor = 2
					trait = genius
				}
				mult_modifier = {
					factor = 0.5
					trait = imbecile
				}
				mult_modifier = {
					factor = 1.6
					trait = quick
				}
				mult_modifier = {
					factor = 0.7
					trait = slow
				}
				mult_modifier = {
					factor = 0.6
					trait = inbred
				}
				mult_modifier = {
					factor = 1.4
					trait = shrewd
				}
				mult_modifier = {
					factor = 0.8
					trait = dull
				}
				mult_modifier = {
					factor = 1.3
					trait = mastermind_theologian
				}
				mult_modifier = {
					factor = 1.4
					trait = scholar
				}
				mult_modifier = {
					factor = 1.4
					trait = mystic
				}
				mult_modifier = {
					factor = 1.4
					trait = theologian
				}
				mult_modifier = {
					factor = 1.6
					trait = diligent
				}
				mult_modifier = {
					factor = 0.7
					trait = slothful
				}
				mult_modifier = {
					factor = 1.6
					trait = ambitious
				}
				mult_modifier = {
					factor = 0.7
					trait = content
				}
				mult_modifier = {
					factor = 1.6
					trait = erudite
				}

				set_character_flag = theory_paper_revolutionary
			}

			25 = {
				mult_modifier = {
					factor = 2
					learning >= 17
					learning < 25
				}
				mult_modifier = {
					factor = 2
					has_character_flag = theory_paper_heavy_investment
				}
				mult_modifier = {
					factor = 1.3
					has_character_flag = theory_paper_asked_help
				}
				mult_modifier = {
					factor = 1.6
					has_character_flag = theory_paper_stole_work
				}
				mult_modifier = {
					factor = 2
					trait = genius
				}
				mult_modifier = {
					factor = 0.5
					trait = imbecile
				}
				mult_modifier = {
					factor = 1.6
					trait = quick
				}
				mult_modifier = {
					factor = 0.7
					trait = slow
				}
				mult_modifier = {
					factor = 0.6
					trait = inbred
				}
				mult_modifier = {
					factor = 1.4
					trait = shrewd
				}
				mult_modifier = {
					factor = 0.8
					trait = dull
				}
				mult_modifier = {
					factor = 1.3
					trait = scholarly_theologian
				}
				mult_modifier = {
					factor = 1.4
					trait = scholar
				}
				mult_modifier = {
					factor = 1.4
					trait = mystic
				}
				mult_modifier = {
					factor = 1.4
					trait = theologian
				}
				mult_modifier = {
					factor = 1.6
					trait = diligent
				}
				mult_modifier = {
					factor = 0.7
					trait = slothful
				}
				mult_modifier = {
					factor = 1.6
					trait = ambitious
				}
				mult_modifier = {
					factor = 0.7
					trait = content
				}
				mult_modifier = {
					factor = 1.6
					trait = erudite
				}

				set_character_flag = theory_paper_excellent
			}

			35 = {
				mult_modifier = {
					factor = 2
					learning >= 9
					learning < 17
				}
				mult_modifier = {
					factor = 1.3
					trait = dutiful_cleric
				}

				set_character_flag = theory_paper_average
			}

			25 = {
				mult_modifier = {
					factor = 2
					learning < 9
				}
				mult_modifier = {
					factor = 0.5
					has_character_flag = theory_paper_heavy_investment
				}
				mult_modifier = {
					factor = 0.8
					has_character_flag = theory_paper_asked_help
				}
				mult_modifier = {
					factor = 0.7
					has_character_flag = theory_paper_stole_work
				}
				mult_modifier = {
					factor = 0.5
					trait = genius
				}
				mult_modifier = {
					factor = 2
					trait = imbecile
				}
				mult_modifier = {
					factor = 2
					trait = lunatic
				}
				mult_modifier = {
					factor = 0.7
					trait = quick
				}
				mult_modifier = {
					factor = 1.6
					trait = slow
				}
				mult_modifier = {
					factor = 1.8
					trait = inbred
				}
				mult_modifier = {
					factor = 0.8
					trait = shrewd
				}
				mult_modifier = {
					factor = 1.4
					trait = dull
				}
				mult_modifier = {
					factor = 1.3
					trait = detached_priest
				}
				mult_modifier = {
					factor = 0.8
					trait = scholar
				}
				mult_modifier = {
					factor = 0.8
					trait = mystic
				}
				mult_modifier = {
					factor = 0.8
					trait = theologian
				}
				mult_modifier = {
					factor = 0.7
					trait = diligent
				}
				mult_modifier = {
					factor = 1.6
					trait = slothful
				}
				mult_modifier = {
					factor = 0.7
					trait = ambitious
				}
				mult_modifier = {
					factor = 1.6
					trait = content
				}
				mult_modifier = {
					factor = 0.7
					trait = erudite
				}

				set_character_flag = theory_paper_simplistic
			}
		}

		remove_character_modifier = theory_paper_heavy_investment
		character_event = { id = MNM.1640 }
	}
}

# Write a Theory Paper - Finished Paper
character_event = {
	id = MNM.1640
	picture = GFX_evt_scientist
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESCA_MNM_1640_RITUALS
		trigger = { has_character_flag = MNM_1640_rituals }
	}
	desc = {
		text = EVTDESCA_MNM_1640_ASCENSION
		trigger = { has_character_flag = MNM_1640_ascension }
	}
	desc = {
		text = EVTDESCA_MNM_1640_MIND_OF_GOD
		trigger = { has_character_flag = MNM_1640_mind_of_god }
	}
	desc = {
		text = EVTDESCA_MNM_1640_TRANSLATING_HIEROGLYPHICS
		trigger = { has_character_flag = MNM_1640_translating_hieroglyphics }
	}
	desc = {
		text = EVTDESCA_MNM_1640_DISTILLATION
		trigger = { has_character_flag = MNM_1640_distillation }
	}
	desc = {
		text = EVTDESCA_MNM_1640_FERMENTATION
		trigger = { has_character_flag = MNM_1640_fermentation }
	}
	desc = {
		text = EVTDESCA_MNM_1640_ELIXIR_OF_LIFE
		trigger = { has_character_flag = MNM_1640_elixir_of_life }
	}
	desc = {
		text = EVTDESCA_MNM_1640_PILOSOPHERS_STONE
		trigger = { has_character_flag = MNM_1640_philosophers_stone }
	}
	desc = {
		text = EVTDESCA_MNM_1640_PLANETS
		trigger = { has_character_flag = MNM_1640_planets }
	}
	desc = {
		text = EVTDESCA_MNM_1640_STARS
		trigger = { has_character_flag = MNM_1640_stars }
	}
	desc = {
		text = EVTDESCA_MNM_1640_MOON
		trigger = { has_character_flag = MNM_1640_moon }
	}
	desc = {
		text = EVTDESCA_MNM_1640_SUN
		trigger = { has_character_flag = MNM_1640_sun }
	}

	is_triggered_only = yes

	immediate = {
		random_list = {
			10 = {
				mult_modifier = {
					factor = 3
					trait = theologian
				}

				set_character_flag = MNM_1640_rituals
			}

			10 = {
				mult_modifier = {
					factor = 3
					trait = theologian
				}

				set_character_flag = MNM_1640_ascension
			}

			10 = {
				mult_modifier = {
					factor = 3
					trait = theologian
				}

				set_character_flag = MNM_1640_mind_of_god
			}

			10 = {
				mult_modifier = {
					factor = 3
					trait = scholar
				}
				mult_modifier = {
					factor = 2
					trait = erudite
				}

				set_character_flag = MNM_1640_translating_hieroglyphics
			}

			10 = {
				mult_modifier = {
					factor = 3
					trait = mystic
				}
				mult_modifier = {
					factor = 2
					trait = erudite
				}

				set_character_flag = MNM_1640_distillation
			}

			10 = {
				mult_modifier = {
					factor = 3
					trait = mystic
				}
				mult_modifier = {
					factor = 2
					trait = erudite
				}

				set_character_flag = MNM_1640_fermentation
			}

			10 = {
				mult_modifier = {
					factor = 3
					trait = mystic
				}

				set_character_flag = MNM_1640_elixir_of_life
			}

			10 = {
				mult_modifier = {
					factor = 3
					trait = mystic
				}

				set_character_flag = MNM_1640_philosophers_stone
			}

			10 = {
				mult_modifier = {
					factor = 3
					trait = scholar
				}
				mult_modifier = {
					factor = 3
					trait = diligent
				}

				set_character_flag = MNM_1640_planets
			}

			10 = {
				mult_modifier = {
					factor = 3
					trait = scholar
				}

				set_character_flag = MNM_1640_stars
			}

			10 = {
				mult_modifier = {
					factor = 3
					trait = scholar
				}

				set_character_flag = MNM_1640_moon
			}

			10 = {
				mult_modifier = {
					factor = 3
					trait = scholar
				}

				set_character_flag = MNM_1640_sun
			}
		}

		set_variable = {
			which = peer_review
			value = 0
		}
	}

	option = { # send it out for review!
		name = EVTOPTA_MNM_1640

		society = {
			any_society_member = {
				limit = {
					NOT = { character = ROOT }
					is_within_diplo_range = ROOT
					is_inaccessible_or_incapable_trigger = no
				}

				count = 5

				set_character_flag = peer_review@ROOT
				character_event = { id = MNM.1641 days = 15 }
			}
		}

		custom_tooltip = {
			text = EVTTOOLTIPA_MNM_1640

			set_variable = {
				which = peer_review_score
				value = 0
			}

			character_event = { id = MNM.1644 days = 100 }
		}
	}

	option = { # No, this shall never see the light of day!
		name = EVTOPTB_MNM_1640

		custom_tooltip = {
			text = EVTTOOLTIPB_MNM_1640

			clr_character_flag = theory_paper_normal_effort
			clr_character_flag = theory_paper_asked_help
			clr_character_flag = theory_paper_stole_work
			clr_character_flag = theory_paper_heavy_investment
			clr_character_flag = theory_paper_revolutionary
			clr_character_flag = theory_paper_excellent
			clr_character_flag = theory_paper_average
			clr_character_flag = theory_paper_simplistic
			clr_character_flag = MNM_1640_rituals
			clr_character_flag = MNM_1640_ascension
			clr_character_flag = MNM_1640_mind_of_god
			clr_character_flag = MNM_1640_translating_hieroglyphics
			clr_character_flag = MNM_1640_distillation
			clr_character_flag = MNM_1640_fermentation
			clr_character_flag = MNM_1640_elixir_of_life
			clr_character_flag = MNM_1640_philosophers_stone
			clr_character_flag = MNM_1640_planets
			clr_character_flag = MNM_1640_stars
			clr_character_flag = MNM_1640_moon
			clr_character_flag = MNM_1640_sun
		}
	}
}

# Theory Paper - Peer Reviewer's event
character_event = {
	id = MNM.1641
	picture = GFX_evt_gathering_of_minds
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESCA_MNM_1641_RITUALS
		trigger = {
			FROM = { has_character_flag = MNM_1640_rituals }
		}
	}
	desc = {
		text = EVTDESCA_MNM_1641_ASCENSION
		trigger = {
			FROM = { has_character_flag = MNM_1640_ascension }
		}
	}
	desc = {
		text = EVTDESCA_MNM_1641_MIND_OF_GOD
		trigger = {
			FROM = { has_character_flag = MNM_1640_mind_of_god }
		}
	}
	desc = {
		text = EVTDESCA_MNM_1641_TRANSLATING_HIEROGLYPHICS
		trigger = {
			FROM = { has_character_flag = MNM_1640_translating_hieroglyphics }
		}
	}
	desc = {
		text = EVTDESCA_MNM_1641_DISTILLATION
		trigger = {
			FROM = { has_character_flag = MNM_1640_distillation }
		}
	}
	desc = {
		text = EVTDESCA_MNM_1641_FERMENTATION
		trigger = {
			FROM = { has_character_flag = MNM_1640_fermentation }
		}
	}
	desc = {
		text = EVTDESCA_MNM_1641_ELIXIR_OF_LIFE
		trigger = {
			FROM = { has_character_flag = MNM_1640_elixir_of_life }
		}
	}
	desc = {
		text = EVTDESCA_MNM_1641_PILOSOPHERS_STONE
		trigger = {
			FROM = { has_character_flag = MNM_1640_philosophers_stone }
		}
	}
	desc = {
		text = EVTDESCA_MNM_1641_PLANETS
		trigger = {
			FROM = { has_character_flag = MNM_1640_planets }
		}
	}
	desc = {
		text = EVTDESCA_MNM_1641_STARS
		trigger = {
			FROM = { has_character_flag = MNM_1640_stars }
		}
	}
	desc = {
		text = EVTDESCA_MNM_1641_MOON
		trigger = {
			FROM = { has_character_flag = MNM_1640_moon }
		}
	}
	desc = {
		text = EVTDESCA_MNM_1641_SUN
		trigger = {
			FROM = { has_character_flag = MNM_1640_sun }
		}
	}

	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				FROM = { has_character_flag = theory_paper_stole_work }
			}

			random_list = {
				10 = { # Discovered knowledge theft
					mult_modifier = {
						factor = 1.3
						intrigue >= 2
						learning >= 2
					}
					mult_modifier = {
						factor = 1.3
						intrigue >= 4
						learning >= 4
					}
					mult_modifier = {
						factor = 1.3
						intrigue >= 6
						learning >= 6
					}
					mult_modifier = {
						factor = 1.3
						intrigue >= 8
						learning >= 8
					}
					mult_modifier = {
						factor = 1.3
						intrigue >= 10
						learning >= 10
					}
					mult_modifier = {
						factor = 1.3
						intrigue >= 12
						learning >= 12
					}
					mult_modifier = {
						factor = 1.3
						intrigue >= 14
						learning >= 14
					}
					mult_modifier = {
						factor = 1.3
						intrigue >= 16
						learning >= 16
					}
					mult_modifier = {
						factor = 1.3
						intrigue >= 18
						learning >= 18
					}
					mult_modifier = {
						factor = 1.3
						intrigue >= 20
						learning >= 20
					}

					set_character_flag = discovered_knowledge_theft
				}

				1000 = { } # no discovery
			}
		}
	}

	option = { # Endorse
		name = EVTOPTA_MNM_1641

		trigger = {
			NOT = { has_character_flag = discovered_knowledge_theft }
		}

		custom_tooltip = {
			text = EVTTOOLTIPA_MNM_1641

			FROM = {
				change_variable = {
					which = peer_review_score
					value = 1
				}

				letter_event = { id = MNM.1642 }
			}
		}

		reverse_opinion = {
			name = opinion_grateful
			who = FROM
			years = 10
		}

		ai_chance = {
			factor = 70

			mult_modifier = {
				factor = 1.3
				opinion = {
					who = ROOT
					value >= 20
				}
			}
			mult_modifier = {
				factor = 1.3
				opinion = {
					who = ROOT
					value >= 40
				}
			}
			mult_modifier = {
				factor = 1.3
				opinion = {
					who = ROOT
					value >= 60
				}
			}
			mult_modifier = {
				factor = 1.3
				opinion = {
					who = ROOT
					value >= 80
				}
			}
			mult_modifier = {
				factor = 0.5
				opinion = {
					who = ROOT
					value < 1
				}
			}
			mult_modifier = {
				factor = 0.5
				opinion = {
					who = ROOT
					value < -19
				}
			}
			mult_modifier = {
				factor = 0.5
				opinion = {
					who = ROOT
					value < -39
				}
			}
			mult_modifier = {
				factor = 1.2
				FROM = {
					OR = {
						has_character_flag = theory_paper_average
						has_character_flag = theory_paper_excellent
						has_character_flag = theory_paper_revolutionary
					}
				}

				learning >= 7
			}
			mult_modifier = {
				factor = 1.2
				FROM = {
					OR = {
						has_character_flag = theory_paper_excellent
						has_character_flag = theory_paper_revolutionary
					}
				}

				learning >= 10
			}
			mult_modifier = {
				factor = 1.2
				FROM = { has_character_flag = theory_paper_revolutionary }
				learning >= 13
			}
			mult_modifier = {
				factor = 0.6
				FROM = { has_character_flag = theory_paper_simplistic }
				learning >= 7
			}
			mult_modifier = {
				factor = 2
				FROM = { has_character_flag = theory_paper_simplistic }
				learning < 7
			}
		}
	}

	option = { # Refute
		name = EVTOPTB_MNM_1641

		trigger = {
			NOT = { has_character_flag = discovered_knowledge_theft }
		}

		custom_tooltip = { text = EVTTOOLTIPB_MNM_1641 }

		set_character_flag = refuted_paper_@FROM

		FROM = { letter_event = { id = MNM.1643 } }

		opinion = {
			name = opinion_academic_failure
			who = FROM
			years = 15
		}

		reverse_opinion = {
			name = opinion_academic_grudge
			who = FROM
			years = 15
		}

		ai_chance = { factor = 30 }
	}

	option = { # Discovered plagiarism
		name = EVTOPTC_MNM_1641

		trigger = { has_character_flag = discovered_knowledge_theft }

		add_society_currency_minor_effect = yes
		prestige = 125
		custom_tooltip = { text = EVTTOOLTIPC_MNM_1641 }
		FROM = { character_event = { id = MNM.1646 } }
	}
}

# Peer endorsed paper
letter_event = {
	id = MNM.1642
	desc = EVTDESC_MNM_1642
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	ai = no

	option = {
		name = EXCELLENT

		tooltip = {
			opinion = {
				name = opinion_grateful
				who = FROM
				years = 10
			}
		}
	}
}

# Peer refuted paper
letter_event = {
	id = MNM.1643
	desc = EVTDESC_MNM_1643
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_MNM_1643

		tooltip = {
			opinion = {
				name = opinion_academic_grudge
				who = FROM
				years = 15
			}

			reverse_opinion = {
				name = opinion_academic_failure
				who = FROM
				years = 15
			}
		}
	}
}

# Results
character_event = {
	id = MNM.1644
	picture = GFX_evt_gathering_of_minds
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESCA_MNM_1644
		trigger = { has_character_flag = paper_success }
	}
	desc = {
		text = EVTDESCB_MNM_1644
		trigger = { has_character_flag = paper_failure }
	}

	is_triggered_only = yes

	immediate = {
		# Calc success/failure
		if = {
			limit = {
				check_variable = {
					which = peer_review_score
					value >= 3
				}
			}

			set_character_flag = paper_success
		}
		else = {
			set_character_flag = paper_failure
		}
	}

	option = {
		name = EVTOPTA_MNM_1644

		trigger = { has_character_flag = paper_success }

		prestige = 75

		add_character_modifier = {
			name = published_theorem
			years = 5
		}

		add_society_currency_minor_effect = yes

		hidden_effect = {
			society = {
				any_society_member = {
					limit = { has_character_flag = peer_review@ROOT }
					set_character_flag = paper_success@ROOT
					character_event = { id = MNM.1645 }
				}
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_1644

		trigger = { has_character_flag = paper_failure }

		prestige = -75
		detract_society_currency_minor_effect = yes

		hidden_effect = {
			society = {
				any_society_member = {
					limit = { has_character_flag = peer_review@ROOT }
					set_character_flag = paper_failure@ROOT
					character_event = { id = MNM.1645 }
				}
			}
		}
	}

	after = {
		clr_character_flag = paper_success
		clr_character_flag = paper_failure
		clr_character_flag = discovered_knowledge_theft
		clr_character_flag = theory_paper_normal_effort
		clr_character_flag = theory_paper_asked_help
		clr_character_flag = theory_paper_stole_work
		clr_character_flag = theory_paper_heavy_investment
		clr_character_flag = theory_paper_revolutionary
		clr_character_flag = theory_paper_excellent
		clr_character_flag = theory_paper_average
		clr_character_flag = theory_paper_simplistic
		clr_character_flag = refuted_paper_@ROOT
		clr_character_flag = MNM_1640_rituals
		clr_character_flag = MNM_1640_ascension
		clr_character_flag = MNM_1640_mind_of_god
		clr_character_flag = MNM_1640_translating_hieroglyphics
		clr_character_flag = MNM_1640_distillation
		clr_character_flag = MNM_1640_fermentation
		clr_character_flag = MNM_1640_elixir_of_life
		clr_character_flag = MNM_1640_philosophers_stone
		clr_character_flag = MNM_1640_planets
		clr_character_flag = MNM_1640_stars
		clr_character_flag = MNM_1640_moon
		clr_character_flag = MNM_1640_sun
	}
}

# Notice event for peers who endorsed the paper
character_event = {
	id = MNM.1645
	picture = GFX_evt_gathering_of_minds
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESCA_MNM_1645
		trigger = { has_character_flag = paper_success@FROM }
	}
	desc = {
		text = EVTDESCB_MNM_1645
		trigger = { has_character_flag = paper_failure@FROM }
	}

	is_triggered_only = yes

	trigger = {
		NOT = { has_character_flag = refuted_paper_@FROM }
	}

	option = {
		name = EVTOPTA_MNM_1645

		trigger = { has_character_flag = paper_success@FROM }

		add_character_modifier = {
			name = endorsed_theorem
			years = 5
		}
	}

	option = {
		name = EVTOPTB_MNM_1645

		trigger = { has_character_flag = paper_failure@FROM }
	}

	after = {
		clr_character_flag = paper_failure@FROM
		clr_character_flag = paper_success@FROM
		clr_character_flag = peer_review@FROM
	}
}

# Discovered stealing knowledge
character_event = {
	id = MNM.1646
	desc = EVTDESC_MNM_1646
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		clear_delayed_event = { id = MNM.1644 }
	}

	option = {
		name = CURSES

		prestige = -75
		detract_society_currency_minor_effect = yes

		society = {
			show_scope_change = no

			if = {
				# Below effect doesn't show any portraits if there are more than 10
				limit = {
					any_society_member = {
						NOT = { character = ROOT }
						count >= 11
					}
				}

				tooltip = {
					any_society_member = {
						count = 10
					}
				}

				any_society_member = {
					show_scope_change = no

					limit = {
						NOT = { character = ROOT }
					}

					opinion = {
						name = opinion_knowledge_theft
						who = ROOT
						years = 20
					}
				}
			}
			else = {
				any_society_member = {
					show_scope_change = no

					limit = {
						NOT = { character = ROOT }
					}

					opinion = {
						name = opinion_knowledge_theft
						who = ROOT
						years = 20
					}
				}
			}
		}
	}
}

# event MNM.1750 moved to mnm_misc_events.txt

### Mission: Gather ingredients
character_event = {
	id = MNM.1800
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1800_A
		trigger = {
			NOT = { event_target:gathering_companion = { always = yes } }
		}
	}
	desc = {
		text = EVTDESC_MNM_1800_B
		trigger = {
			event_target:gathering_companion = { always = yes }
		}
	}

	is_triggered_only = yes # hermetics_acquire_ingredients_decision, mnm_hermetics_decisions.txt; MNM.1802

	has_dlc = "Mystics"

	immediate = {
		if = {
			limit = {
				event_target:hermetic_collaborator = { always = yes }
			}

			event_target:hermetic_collaborator = {
				save_event_target_as = gathering_companion
			}
		}
		else = {
			# Find apprentice
			random_courtier_or_vassal = {
				limit = { has_minor_title = title_hermetics_apprentice }
				save_event_target_as = gathering_companion
			}
		}
	}

	option = { # Look for herbs
		name = EVTOPTA_MNM_1800

		set_character_flag = do_not_disturb

		character_event = {
			id = MNM.1810
			days = 20
			tooltip = EVTTOOLTIPA_MNM_1800
		}

		character_event = { id = MNM.1825 days = 140 } # safety flag clearing
	}

	option = { # Hunt for animal parts
		name = EVTOPTB_MNM_1800

		set_character_flag = do_not_disturb

		character_event = {
			id = MNM.1815
			days = 20
			tooltip = EVTTOOLTIPB_MNM_1800
		}

		character_event = { id = MNM.1825 days = 140 } # safety flag clearing
	}

	option = { # Shop for ingredients
		name = EVTOPTC_MNM_1800

		set_character_flag = do_not_disturb

		character_event = {
			id = MNM.1820
			days = 20
			tooltip = EVTTOOLTIPC_MNM_1800
		}

		character_event = { id = MNM.1825 days = 140 } # safety flag clearing
	}

	option = { # I don't have time for this now
		name = EVTOPTD_MNM_1800

		ai_chance = { factor = 0 }

		hidden_effect = { remove_character_modifier = acquire_ingredients_decision_cooldown_timer }
	}
}

society_quest_event = {
	id = MNM.1802
	desc = EVTDESC_MNM_1802

	is_triggered_only = yes

	option = {
		name = ACCEPT

		tooltip = { set_quest = quest_hermetic_gather_ingredients }

		hidden_effect = {
			event_target:hermetic_collaborator = {
				set_quest_target = {
					id = quest_hermetic_gather_ingredients
					holder = ROOT
				}
			}
		}

		character_event = { id = MNM.1800 days = 5 }
	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			days = 1000
			hidden = yes
		}

		ai_chance = { factor = 0 }
	}
}

character_event = {
	id = MNM.1810
	desc = EVTDESC_MNM_1810
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { event_target:gathering_companion = { is_alive = yes } }

	option = { # Head out with companion to find herbs.
		name = {
			text = EVTOPTA_MNM_1810
			trigger = {
				stewardship >= 11
				FROM = { stewardship >= 11 }
			}
		}
		name = {
			text = EVTOPTB_MNM_1810
			trigger = {
				stewardship >= 7
				FROM = { stewardship >= 7 }

				OR = {
					stewardship < 11
					FROM = { stewardship < 11 }
				}
			}
		}
		name = {
			text = EVTOPTC_MNM_1810
			trigger = {
				OR = {
					stewardship < 7
					FROM = { stewardship < 7 }
				}
			}
		}

		event_target:gathering_companion = {
			character_event = {
				id = MNM.1811
				days = 50
				random = 40
			}
		}
	}
}

# Calculate outcome for gathering herbs
character_event = {
	id = MNM.1811

	hide_window = yes
	is_triggered_only = yes

	trigger = { FROM = { is_alive = yes } }

	immediate = {
		set_variable = {
			which = local_gath_res
			value = 0
		}

		while = {
			count = 5

			random_list = {
				50 = { # Successful gathering
					mult_modifier = {
						factor = 0.5
						FROM = { stewardship < 4 }
					}
					mult_modifier = {
						factor = 0.5
						stewardship < 4
					}
					mult_modifier = {
						factor = 0.6
						FROM = { stewardship < 6 }
					}
					mult_modifier = {
						factor = 0.6
						stewardship < 6
					}
					mult_modifier = {
						factor = 0.7
						FROM = { stewardship < 8 }
					}
					mult_modifier = {
						factor = 0.7
						stewardship < 8
					}
					mult_modifier = {
						factor = 1.2
						FROM = { stewardship >= 11 }
					}
					mult_modifier = {
						factor = 1.2
						stewardship >= 11
					}
					mult_modifier = {
						factor = 1.2
						FROM = { stewardship >= 13 }
					}
					mult_modifier = {
						factor = 1.2
						stewardship >= 13
					}
					mult_modifier = {
						factor = 1.2
						FROM = { stewardship >= 15 }
					}
					mult_modifier = {
						factor = 1.2
						stewardship >= 15
					}
					mult_modifier = {
						factor = 1.2
						FROM = { trait = gardener }
					}
					mult_modifier = {
						factor = 1.2
						trait = gardener
					}

					change_variable = {
						which = local_gath_res
						value = 1
					}
				}

				50 = { # Unsuccessful gathering
					mult_modifier = {
						factor = 1.3
						trait = drunkard
					}
				}
			}
		}

		FROM = {
			character_event = { id = MNM.1812 }
		}
	}
}

# Outcome and reaction gathering herbs
character_event = {
	id = MNM.1812
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1812_A
		trigger = {
			check_variable = {
				which = local_gath_res
				value >= 4
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1812_B
		trigger = {
			check_variable = {
				which = local_gath_res
				value < 4
			}
			check_variable = {
				which = local_gath_res
				value > 0
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1812_C
		trigger = {
			check_variable = {
				which = local_gath_res
				value < 1
			}
		}
	}

	is_triggered_only = yes

	trigger = { event_target:gathering_companion = { is_alive = yes } }

	option = {
		name = EVTOPTA_MNM_1812

		trigger = {
			check_variable = {
				which = local_gath_res
				value >= 4
			}
		}

		if = {
			limit = { has_quest = quest_hermetic_gather_ingredients }
			clr_quest = quest_hermetic_gather_ingredients
			sound_effect = hermetic_society_acquire_seed
			add_society_currency_medium_effect = yes
		}

		custom_tooltip = { text = EVTTOOLTIP_MNM_1812 }
	}

	option = {
		name = EVTOPTB_MNM_1812

		trigger = {
			check_variable = {
				which = local_gath_res
				value < 4
			}
			check_variable = {
				which = local_gath_res
				value > 0
			}
		}

		if = {
			limit = { has_quest = quest_hermetic_gather_ingredients }
			clr_quest = quest_hermetic_gather_ingredients
			sound_effect = hermetic_society_acquire_seed
			add_society_currency_minor_effect = yes
		}

		custom_tooltip = { text = EVTTOOLTIP_MNM_1812 }
	}

	option = {
		name = EVTOPTC_MNM_1812

		trigger = {
			check_variable = {
				which = local_gath_res
				value < 1
			}
		}

		if = {
			limit = { has_quest = quest_hermetic_gather_ingredients }

			clr_quest = {
				id = quest_hermetic_gather_ingredients
				failure = yes
			}
		}

		random_list = {
			2 = { } # no effect

			1 = { # poisoned
				if = {
					limit = { has_dlc = "Reapers" }
					give_food_poisoning_effect = yes
					custom_tooltip = { text = EVTTOOLTIP_MNM_1812_ILL }
				}
				else = {
					add_trait_ill_effect = yes
				}
			}
		}
	}

	after = {
		while = {
			limit = {
				check_variable = {
					which = local_gath_res
					value > 0
				}
			}

			hermetic_add_herbal_ingredient_effect = yes

			change_variable = {
				which = local_gath_res
				value = -1
			}
		}

		clr_character_flag = do_not_disturb
		clr_character_flag = apprentice_hermetic_gathering
	}
}

character_event = {
	id = MNM.1815
	desc = EVTDESC_MNM_1815
	picture = GFX_evt_hunt
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { event_target:gathering_companion = { is_alive = yes } }

	option = { # Head out with companion to find animal parts.
		name = {
			text = EVTOPTA_MNM_1815
			trigger = {
				martial >= 11
				FROM = { martial >= 11 }
			}
		}
		name = {
			text = EVTOPTB_MNM_1815
			trigger = {
				OR = {
					martial < 11
					FROM = { martial < 11 }
				}
				martial >= 7
				FROM = { martial >= 7 }
			}
		}
		name = {
			text = EVTOPTC_MNM_1815
			trigger = {
				OR = {
					martial < 7
					FROM = { martial < 7 }
				}
			}
		}

		event_target:gathering_companion = {
			character_event = {
				id = MNM.1816
				days = 50
				random = 40
			}
		}
	}
}

# Calculate outcome for gathering animal parts
character_event = {
	id = MNM.1816

	hide_window = yes
	is_triggered_only = yes

	trigger = { FROM = { is_alive = yes } }

	immediate = {
		set_variable = {
			which = local_gath_res
			value = 0
		}

		while = {
			count = 5

			random_list = {
				50 = { # Successful gathering
					mult_modifier = {
						factor = 0.5
						FROM = { martial < 4 }
					}
					mult_modifier = {
						factor = 0.5
						martial < 4
					}
					mult_modifier = {
						factor = 0.6
						FROM = { martial < 6 }
					}
					mult_modifier = {
						factor = 0.6
						martial < 6
					}
					mult_modifier = {
						factor = 0.7
						FROM = { martial < 8 }
					}
					mult_modifier = {
						factor = 0.7
						martial < 8
					}
					mult_modifier = {
						factor = 1.2
						FROM = { martial >= 11 }
					}
					mult_modifier = {
						factor = 1.2
						martial >= 11
					}
					mult_modifier = {
						factor = 1.2
						FROM = { martial >= 13 }
					}
					mult_modifier = {
						factor = 1.2
						martial >= 13
					}
					mult_modifier = {
						factor = 1.2
						FROM = { martial >= 15 }
					}
					mult_modifier = {
						factor = 1.2
						martial >= 15
					}
					mult_modifier = {
						factor = 1.2
						FROM = { trait = hunter }
					}
					mult_modifier = {
						factor = 1.2
						trait = hunter
					}

					change_variable = {
						which = local_gath_res
						value = 1
					}
				}

				50 = { # Unsuccessful gathering
					mult_modifier = {
						factor = 1.3
						trait = drunkard
					}
				}
			}
		}

		FROM = {
			character_event = { id = MNM.1817 }
		}
	}
}

# Outcome and reaction gathering animal parts
character_event = {
	id = MNM.1817
	picture = GFX_evt_hunt
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1817_A
		trigger = {
			check_variable = {
				which = local_gath_res
				value >= 4
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1817_B
		trigger = {
			check_variable = {
				which = local_gath_res
				value < 4
			}
			check_variable = {
				which = local_gath_res
				value > 0
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1817_C
		trigger = {
			check_variable = {
				which = local_gath_res
				value < 1
			}
		}
	}

	is_triggered_only = yes

	trigger = { event_target:gathering_companion = { is_alive = yes } }

	option = {
		name = EVTOPTA_MNM_1817

		trigger = {
			check_variable = {
				which = local_gath_res
				value >= 4
			}
		}

		if = {
			limit = { has_quest = quest_hermetic_gather_ingredients }
			clr_quest = quest_hermetic_gather_ingredients
			sound_effect = hermetic_society_acquire_seed
			add_society_currency_medium_effect = yes
		}

		custom_tooltip = { text = EVTTOOLTIP_MNM_1817 }
	}

	option = {
		name = EVTOPTB_MNM_1817

		trigger = {
			check_variable = {
				which = local_gath_res
				value < 4
			}
			check_variable = {
				which = local_gath_res
				value > 0
			}
		}

		if = {
			limit = { has_quest = quest_hermetic_gather_ingredients }
			clr_quest = quest_hermetic_gather_ingredients
			sound_effect = hermetic_society_acquire_seed
			add_society_currency_minor_effect = yes
		}

		custom_tooltip = { text = EVTTOOLTIP_MNM_1817 }
	}

	option = {
		name = EVTOPTC_MNM_1817

		trigger = {
			check_variable = {
				which = local_gath_res
				value < 1
			}
		}

		if = {
			limit = { has_quest = quest_hermetic_gather_ingredients }

			clr_quest = {
				id = quest_hermetic_gather_ingredients
				failure = yes
			}
		}

		prestige = -25

		add_character_modifier = {
			name = disappointing_hunt
			years = 3
		}
	}

	after = {
		while = {
			limit = {
				check_variable = {
					which = local_gath_res
					value > 0
				}
			}

			hermetic_add_animal_ingredient_effect = yes

			change_variable = {
				which = local_gath_res
				value = -1
			}
		}

		clr_character_flag = do_not_disturb
		clr_character_flag = apprentice_hermetic_gathering
	}
}

character_event = {
	id = MNM.1820
	desc = EVTDESC_MNM_1820
	picture = GFX_evt_market
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { event_target:gathering_companion = { is_alive = yes } }

	option = { # Head out with companion to shop misc ingredients.
		name = {
			text = EVTOPTA_MNM_1820
			trigger = {
				diplomacy >= 11
				FROM = { diplomacy >= 11 }
			}
		}
		name = {
			text = EVTOPTB_MNM_1820
			trigger = {
				OR = {
					diplomacy < 11
					FROM = { diplomacy < 11 }
				}
				diplomacy >= 7
				FROM = { diplomacy >= 7 }
			}
		}
		name = {
			text = EVTOPTC_MNM_1820
			trigger = {
				OR = {
					diplomacy < 7
					FROM = { diplomacy < 7 }
				}
			}
		}

		event_target:gathering_companion = {
			character_event = {
				id = MNM.1821
				days = 50
				random = 40
			}
		}
	}
}

# Calculate outcome for shopping for misc ingredients
character_event = {
	id = MNM.1821

	hide_window = yes
	is_triggered_only = yes

	trigger = { FROM = { is_alive = yes } }

	immediate = {
		set_variable = {
			which = local_gath_res
			value = 0
		}

		while = {
			count = 5

			random_list = {
				50 = { # Successful gathering
					mult_modifier = {
						factor = 0.5
						FROM = { diplomacy < 4 }
					}
					mult_modifier = {
						factor = 0.5
						diplomacy < 4
					}
					mult_modifier = {
						factor = 0.6
						FROM = { diplomacy < 6 }
					}
					mult_modifier = {
						factor = 0.6
						diplomacy < 6
					}
					mult_modifier = {
						factor = 0.7
						FROM = { diplomacy < 8 }
					}
					mult_modifier = {
						factor = 0.7
						diplomacy < 8
					}
					mult_modifier = {
						factor = 1.2
						FROM = { diplomacy >= 11 }
					}
					mult_modifier = {
						factor = 1.2
						diplomacy >= 11
					}
					mult_modifier = {
						factor = 1.2
						FROM = { diplomacy >= 13 }
					}
					mult_modifier = {
						factor = 1.2
						diplomacy >= 13
					}
					mult_modifier = {
						factor = 1.2
						FROM = { diplomacy >= 15 }
					}
					mult_modifier = {
						factor = 1.2
						diplomacy >= 15
					}
					mult_modifier = {
						factor = 1.2
						FROM = { trait = gregarious }
					}
					mult_modifier = {
						factor = 1.2
						trait = gregarious
					}

					change_variable = {
						which = local_gath_res
						value = 1
					}
				}

				50 = { # Unsuccessful gathering
					mult_modifier = {
						factor = 1.3
						trait = drunkard
					}
				}
			}
		}

		FROM = {
			character_event = { id = MNM.1822 }
		}
	}
}

# Outcome and reaction shopping for misc ingredients
character_event = {
	id = MNM.1822
	picture = GFX_evt_market
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1822_A
		trigger = {
			check_variable = {
				which = local_gath_res
				value >= 4
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1822_B
		trigger = {
			check_variable = {
				which = local_gath_res
				value < 4
			}
			check_variable = {
				which = local_gath_res
				value > 0
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1822_C
		trigger = {
			check_variable = {
				which = local_gath_res
				value < 1
			}
		}
	}

	is_triggered_only = yes

	trigger = { event_target:gathering_companion = { is_alive = yes } }

	option = {
		name = EVTOPTA_MNM_1822

		trigger = {
			check_variable = {
				which = local_gath_res
				value >= 4
			}
		}

		wealth = -35

		if = {
			limit = { has_quest = quest_hermetic_gather_ingredients }
			clr_quest = quest_hermetic_gather_ingredients
			sound_effect = hermetic_society_acquire_seed
			add_society_currency_medium_effect = yes
		}

		custom_tooltip = { text = EVTTOOLTIP_MNM_1822 }
	}

	option = {
		name = EVTOPTB_MNM_1822

		trigger = {
			check_variable = {
				which = local_gath_res
				value < 4
			}
			check_variable = {
				which = local_gath_res
				value > 0
			}
		}

		wealth = -25

		if = {
			limit = { has_quest = quest_hermetic_gather_ingredients }
			clr_quest = quest_hermetic_gather_ingredients
			sound_effect = hermetic_society_acquire_seed
			add_society_currency_minor_effect = yes
		}

		custom_tooltip = { text = EVTTOOLTIP_MNM_1822 }
	}

	option = {
		name = EVTOPTC_MNM_1822

		trigger = {
			check_variable = {
				which = local_gath_res
				value < 1
			}
		}

		wealth = -15

		if = {
			limit = { has_quest = quest_hermetic_gather_ingredients }

			clr_quest = {
				id = quest_hermetic_gather_ingredients
				failure = yes
			}
		}
	}

	after = {
		while = {
			limit = {
				check_variable = {
					which = local_gath_res
					value > 0
				}
			}

			hermetic_add_misc_ingredient_effect = yes

			change_variable = {
				which = local_gath_res
				value = -1
			}
		}

		clr_character_flag = do_not_disturb
		clr_character_flag = apprentice_hermetic_gathering
	}
}

character_event = {
	id = MNM.1825

	hide_window = yes
	is_triggered_only = yes

	immediate = {
		clr_character_flag = do_not_disturb
		clr_character_flag = apprentice_hermetic_gathering
	}
}

######################################
# Invite Hermetic member to Stargazing
######################################
# Invitation events
letter_event = {
	id = MNM.1920
	desc = EVTDESC_MNM_1920
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes # invite_hermetic_to_stargazing, mnm_hermetics_decisions.txt

	option = { # Accept
		name = EVTOPTA_MNM_1920

		save_event_target_as = stargazing_guest

		hidden_effect = {
			set_variable = { which = local_stargazing_satisfaction value = 0 }
		}

		FROMFROM = {
			letter_event = { id = MNM.1921 }
		}

		tooltip = {
			opinion = {
				name = opinion_stargazing
				who = FROMFROM
				years = 1
			}
		}

		ai_chance = {
			factor = 20

			mult_modifier = {
				factor = 2
				OR = {
					trait = scholar
					trait = mystic
					trait = theologian
				}
			}
			mult_modifier = {
				factor = 2
				trait = gregarious
			}
			mult_modifier = {
				factor = 2
				trait = trusting
			}
			mult_modifier = {
				factor = 1.5
				OR = {
					trait = genius
					trait = quick
				}
			}
			mult_modifier = {
				factor = 1.5
				trait = shrewd
			}
			mult_modifier = {
				factor = 2
				opinion = { who = FROM value >= 30 }
			}
			mult_modifier = {
				factor = 3
				opinion = { who = FROM value >= 60 }
			}
			mult_modifier = {
				factor = 10
				is_friend = FROM
			}
		}
	}

	option = { # Decline
		name = EVTOPTB_MNM_1920

		FROMFROM = {
			letter_event = { id = MNM.1922 }
		}

		tooltip = {
			reverse_opinion = {
				name = opinion_disappointed
				who = FROMFROM
				years = 1
			}
		}

		ai_chance = {
			factor = 10

			mult_modifier = {
				factor = 2
				trait = content
			}
			mult_modifier = {
				factor = 2
				trait = shy
			}
			mult_modifier = {
				factor = 2
				trait = paranoid
			}
			mult_modifier = {
				factor = 2
				trait = slothful
			}
			mult_modifier = {
				factor = 1.5
				trait = envious
			}
			mult_modifier = {
				factor = 2
				OR = {
					trait = imbecile
					trait = slow
				}
			}
			mult_modifier = {
				factor = 2
				trait = dull
			}
			mult_modifier = {
				factor = 3
				opinion = { who = FROM value < -25 }
			}
			mult_modifier = {
				factor = 3
				opinion = { who = FROM value < -50 }
			}
			mult_modifier = {
				factor = 20
				is_rival = FROM
			}
		}
	}
}

# Invitation accepted
letter_event = {
	id = MNM.1921
	desc = EVTDESC_MNM_1921
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	option = {
		name = EXCELLENT

		save_event_target_as = stargazing_host

		reverse_opinion = {
			name = opinion_stargazing
			who = FROM
			years = 1
		}

		character_event = {
			id = MNM.1928
			months = 1
			random = 30
		}
	}
}

# Invitation declined
letter_event = {
	id = MNM.1922
	desc = EVTDESC_MNM_1922
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_11117 # That is disappointing

		opinion = {
			name = opinion_disappointed
			who = FROM
			years = 1
		}

		clr_character_flag = inviting_guests_to_stargazing_timer
		clr_character_flag = do_not_disturb

		hidden_effect = { remove_character_modifier = inviting_to_stargazing }
	}
}

# Cancel stargazing
character_event = {
	id = MNM.1926
	desc = EVTDESC_MNM_1926
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1926

		custom_tooltip = { text = EVTOPTA_MNM_1926_TOOLTIP }

		clr_character_flag = do_not_disturb

		event_target:stargazing_guest = {
			letter_event = { id = MNM.1927 }
		}

		hidden_effect = { remove_character_modifier = inviting_to_stargazing }
	}
}

letter_event = {
	id = MNM.1927
	desc = EVTDESC_MNM_1927
	border = GFX_event_letter_frame_religion

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_ZE_6005 # What a shame
	}
}

# Guest arrives - What to do before nightfall?
character_event = {
	id = MNM.1928
	desc = EVTDESC_MNM_1928
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	only_capable = yes
	war = no

	trigger = { society_member_of = hermetics }

	fail_trigger_effect = {
		clr_character_flag = inviting_guests_to_stargazing_timer
		character_event = { id = MNM.1926 } # Cancel stargazing due to unforeseen circumstances
	}

	immediate = {
		clr_character_flag = inviting_guests_to_stargazing_timer
	}

	option = { # Show observatory
		name = EVTOPTA_MNM_1928
		tooltip_info_custom = AVAILABLE_DUE_TO_OBSERVATORY

		trigger = { has_character_flag = built_observatory }

		custom_tooltip = { text = EVTOPTA_MNM_1928_TOOLTIP }

		event_target:stargazing_guest = {
			character_event = { id = MNM.1930 }
		}

		ai_chance = {
			factor = 10

			mult_modifier = {
				factor = 2
				trait = scholar
			}
		}
	}

	option = { # Show fancy equipment
		name = EVTOPTB_MNM_1928
		tooltip_info_custom = AVAILABLE_DUE_TO_OBSERVATORY_EQUIPMENT

		trigger = {
			has_character_flag = owns_observatory_equipment
			NOT = { has_character_flag = built_observatory }
		}

		custom_tooltip = { text = EVTOPTB_MNM_1928_TOOLTIP }

		event_target:stargazing_guest = {
			character_event = { id = MNM.1933 }
		}

		ai_chance = {
			factor = 10

			mult_modifier = {
				factor = 2
				trait = scholar
			}
		}
	}

	option = { # Show nearby location to use for stargazing
		name = EVTOPTC_MNM_1928

		trigger = {
			NOT = { has_character_flag = built_observatory }
		}

		custom_tooltip = { text = EVTOPTC_MNM_1928_TOOLTIP }

		event_target:stargazing_guest = {
			character_event = { id = MNM.1936 }
		}

		ai_chance = {
			factor = 10

			mult_modifier = {
				factor = 2
				trait = gardener
			}
		}
	}

	option = { # Sit down for a drink/conversation
		name = EVTOPTD_MNM_1928

		custom_tooltip = { text = EVTOPTD_MNM_1928_TOOLTIP }

		event_target:stargazing_guest = {
			character_event = { id = MNM.1939 }
		}

		ai_chance = {
			factor = 10

			mult_modifier = {
				factor = 4
				trait = gluttonous
			}
			mult_modifier = {
				factor = 2
				trait = hedonist
			}
			mult_modifier = {
				factor = 2
				trait = drunkard
			}
		}
	}

	option = { # Spend some time to study together
		name = EVTOPTE_MNM_1928

		custom_tooltip = { text = EVTOPTE_MNM_1928_TOOLTIP }

		event_target:stargazing_guest = {
			character_event = { id = MNM.1942 }
		}

		ai_chance = {
			factor = 10

			mult_modifier = {
				factor = 2
				trait = erudite
			}
			mult_modifier = {
				factor = 2
				trait = patient
			}
		}
	}

	after = {
		character_event = { id = MNM.1945 days = 20 random = 10 }
	}
}

# Show observatory
character_event = {
	id = MNM.1930
	desc = EVTDESC_MNM_1930
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = { # Guest is impressed
		name = EVTOPTA_MNM_1930

		reverse_opinion = {
			name = opinion_pleased
			who = FROM
			years = 1
		}

		hidden_effect = {
			if = {
				limit = {
					OR = {
						trait = scholar
						trait = mystic
						trait = theologian
						trait = humble
					}
				}
				change_variable = { which = local_stargazing_satisfaction value = 4 }
			}
			else = {
				change_variable = { which = local_stargazing_satisfaction value = 3 }
			}
		}

		event_target:stargazing_host = {
			character_event = {
				id = MNM.1931
				days = 7
				random = 7
			}
		}

		ai_chance = {
			factor = 10

			mult_modifier = {
				factor = 2
				trait = scholar
			}
			mult_modifier = {
				factor = 2
				trait = mystic
			}
			mult_modifier = {
				factor = 2
				trait = theologian
			}
			mult_modifier = {
				factor = 2
				trait = ambitious
			}
		}
	}

	option = { # Guest is not impressed
		name = EVTOPTB_MNM_1930

		reverse_opinion = {
			name = not_feeling_apreciated
			who = FROM
			years = 1
		}

		event_target:stargazing_host = {
			character_event = {
				id = MNM.1932
				days = 7
				random = 7
			}
		}

		ai_chance = {
			factor = 5

			mult_modifier = {
				factor = 5
				trait = envious
			}
			mult_modifier = {
				factor = 3
				trait = arbitrary
			}
		}
	}
}

character_event = {
	id = MNM.1931
	desc = EVTDESC_MNM_1931
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1931

		reverse_opinion = {
			name = opinion_impressed
			who = FROM
			years = 2
		}
	}
}

character_event = {
	id = MNM.1932
	desc = EVTDESC_MNM_1932
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1932

		reverse_opinion = {
			name = opinion_unimpressed
			who = FROM
			years = 2
		}
	}
}

# Show fancy equipment
character_event = {
	id = MNM.1933
	desc = EVTDESC_MNM_1933
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = { # Guest is impressed
		name = EVTOPTA_MNM_1933

		reverse_opinion = {
			name = opinion_pleased
			who = FROM
			years = 1
		}

		hidden_effect = {
			if = {
				limit = {
					OR = {
						trait = scholar
						trait = mystic
						trait = theologian
						trait = humble
					}
				}

				change_variable = { which = local_stargazing_satisfaction value = 3 }
			}
			else = {
				change_variable = { which = local_stargazing_satisfaction value = 2 }
			}
		}

		event_target:stargazing_host = {
			character_event = {
				id = MNM.1934
				days = 7
				random = 7
			}
		}

		ai_chance = {
			factor = 10

			mult_modifier = {
				factor = 2
				trait = scholar
			}
			mult_modifier = {
				factor = 2
				trait = mystic
			}
			mult_modifier = {
				factor = 2
				trait = theologian
			}
			mult_modifier = {
				factor = 2
				trait = ambitious
			}
		}
	}

	option = { # Guest is not impressed
		name = EVTOPTB_MNM_1933

		reverse_opinion = {
			name = not_feeling_apreciated
			who = FROM
			years = 1
		}

		event_target:stargazing_host = {
			character_event = {
				id = MNM.1935
				days = 7
				random = 7
			}
		}

		ai_chance = {
			factor = 5

			mult_modifier = {
				factor = 5
				trait = envious
			}
			mult_modifier = {
				factor = 3
				trait = arbitrary
			}
		}
	}
}

character_event = {
	id = MNM.1934
	desc = EVTDESC_MNM_1934
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1934

		reverse_opinion = {
			name = opinion_impressed
			who = FROM
			years = 2
		}
	}
}

character_event = {
	id = MNM.1935
	desc = EVTDESC_MNM_1935
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1935

		reverse_opinion = {
			name = opinion_unimpressed
			who = FROM
			years = 2
		}
	}
}

# Show nearby location to use for stargazing
character_event = {
	id = MNM.1936
	desc = EVTDESC_MNM_1936
	picture = GFX_evt_stone_church
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = { # Guest approves
		name = EVTOPTA_MNM_1936

		reverse_opinion = {
			name = opinion_pleased
			who = FROM
			years = 1
		}

		hidden_effect = {
			if = {
				limit = {
					OR = {
						trait = architect
						trait = gardener
						trait = diligent
					}
				}

				change_variable = { which = local_stargazing_satisfaction value = 2 }
			}
			else = {
				change_variable = { which = local_stargazing_satisfaction value = 1 }
			}
		}

		event_target:stargazing_host = {
			character_event = {
				id = MNM.1937
				days = 7
				random = 7
			}
		}

		ai_chance = {
			factor = 10

			mult_modifier = {
				factor = 2
				trait = architect
			}
			mult_modifier = {
				factor = 2
				trait = gardener
			}
			mult_modifier = {
				factor = 2
				trait = diligent
			}
		}
	}

	option = { # Guest does not approve
		name = EVTOPTB_MNM_1936

		reverse_opinion = {
			name = not_feeling_apreciated
			who = FROM
			years = 1
		}

		event_target:stargazing_host = {
			character_event = {
				id = MNM.1938
				days = 7
				random = 7
			}
		}

		ai_chance = {
			factor = 5

			mult_modifier = {
				factor = 5
				trait = slothful
			}
			mult_modifier = {
				factor = 2
				trait = paranoid
			}
		}
	}
}

character_event = {
	id = MNM.1937
	desc = EVTDESC_MNM_1937
	picture = GFX_evt_stone_church
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1937

		reverse_opinion = {
			name = opinion_impressed
			who = FROM
			years = 2
		}
	}
}

character_event = {
	id = MNM.1938
	desc = EVTDESC_MNM_1938
	picture = GFX_evt_stone_church
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1938

		reverse_opinion = {
			name = opinion_unimpressed
			who = FROM
			years = 2
		}
	}
}

# Sit down for a drink/conversation
character_event = {
	id = MNM.1939
	desc = EVTDESC_MNM_1939
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = { # Guest enjoyed it
		name = EVTOPTA_MNM_1939

		reverse_opinion = {
			name = opinion_pleased
			who = FROM
			years = 1
		}

		hidden_effect = {
			if = {
				limit = {
					OR = {
						trait = hedonist
						trait = socializer
						trait = gregarious
						trait = gluttonous
						trait = drunkard
					}
				}

				change_variable = { which = local_stargazing_satisfaction value = 2 }
			}
			else = {
				change_variable = { which = local_stargazing_satisfaction value = 1 }
			}
		}

		event_target:stargazing_host = {
			character_event = {
				id = MNM.1940
				days = 7
				random = 7
			}
		}

		ai_chance = {
			factor = 10

			mult_modifier = {
				factor = 3
				trait = gluttonous
			}
			mult_modifier = {
				factor = 2
				trait = hedonist
			}
			mult_modifier = {
				factor = 2
				trait = socializer
			}
			mult_modifier = {
				factor = 2
				trait = gregarious
			}
			mult_modifier = {
				factor = 2
				trait = drunkard
			}
			mult_modifier = {
				factor = 2
				trait = decadent
			}
		}
	}

	option = { # Guest did not enjoy it
		name = EVTOPTB_MNM_1939

		reverse_opinion = {
			name = not_feeling_apreciated
			who = FROM
			years = 1
		}

		event_target:stargazing_host = {
			character_event = {
				id = MNM.1941
				days = 7
				random = 7
			}
		}

		ai_chance = {
			factor = 5

			mult_modifier = {
				factor = 5
				trait = temperate
			}
			mult_modifier = {
				factor = 6
				religion_group = muslim
				NOT = { trait = decadent }
			}
			mult_modifier = {
				factor = 3
				trait = shy
			}
		}
	}
}

character_event = {
	id = MNM.1940
	desc = EVTDESC_MNM_1940
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1940

		reverse_opinion = {
			name = opinion_enjoyed_feast
			who = FROM
			years = 1
		}
	}
}

character_event = {
	id = MNM.1941
	desc = EVTDESC_MNM_1941
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1941

		reverse_opinion = {
			name = opinion_unimpressed
			who = FROM
			years = 2
		}
	}
}

# Spend some time to study together
character_event = {
	id = MNM.1942
	desc = EVTDESC_MNM_1942
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = { # Guest approves
		name = EVTOPTA_MNM_1942

		reverse_opinion = {
			name = opinion_pleased
			who = FROM
			years = 1
		}

		hidden_effect = {
			if = {
				limit = {
					OR = {
						trait = erudite
						trait = scholar
						trait = faqih
						trait = diligent
					}
				}

				change_variable = { which = local_stargazing_satisfaction value = 2 }
			}
			else = {
				change_variable = { which = local_stargazing_satisfaction value = 1 }
			}
		}

		event_target:stargazing_host = {
			character_event = {
				id = MNM.1943
				days = 7
				random = 7
			}
		}

		ai_chance = {
			factor = 10

			mult_modifier = {
				factor = 2
				trait = erudite
			}
			mult_modifier = {
				factor = 2
				trait = content
			}
			mult_modifier = {
				factor = 2
				trait = scholar
			}
			mult_modifier = {
				factor = 2
				trait = patient
			}
		}
	}

	option = { # Guest does not approve
		name = EVTOPTB_MNM_1942

		reverse_opinion = {
			name = not_feeling_apreciated
			who = FROM
			years = 1
		}

		event_target:stargazing_host = {
			character_event = {
				id = MNM.1944
				days = 7
				random = 7
			}
		}

		ai_chance = {
			factor = 5

			mult_modifier = {
				factor = 4
				trait = slothful
			}
			mult_modifier = {
				factor = 4
				trait = wroth
			}
			mult_modifier = {
				factor = 3
				trait = gregarious
			}
		}
	}
}

character_event = {
	id = MNM.1943
	desc = EVTDESC_MNM_1943
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1943

		reverse_opinion = {
			name = opinion_impressed
			who = FROM
			years = 2
		}
	}
}

character_event = {
	id = MNM.1944
	desc = EVTDESC_MNM_1944
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1944

		reverse_opinion = {
			name = opinion_unimpressed
			who = FROM
			years = 2
		}
	}
}

# Nightfall - Time to stargaze
character_event = {
	id = MNM.1945
	desc = EVTDESC_MNM_1945
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1945

		custom_tooltip = {
			text = PREPARE_STARGAZING

			random_list = {
				10 = { # Make observation about stars
					mult_modifier = {
						factor = 3
						has_character_flag = built_observatory
					}
					mult_modifier = {
						factor = 2
						has_character_flag = owns_observatory_equipment
						NOT = { has_character_flag = built_observatory }
					}

					character_event = {
						id = MNM.1947
						days = 5
						random = 5
					}
				}

				10 = { # Make observation about zodiacs
					mult_modifier = {
						factor = 3
						has_character_flag = built_observatory
					}
					mult_modifier = {
						factor = 2
						has_character_flag = owns_observatory_equipment
						NOT = { has_character_flag = built_observatory }
					}

					character_event = {
						id = MNM.1950
						days = 5
						random = 5
					}
				}

				10 = { # Saw a comet cross the sky
					mult_modifier = {
						factor = 2
						has_character_flag = built_observatory
					}
					mult_modifier = {
						factor = 1.5
						has_character_flag = owns_observatory_equipment
						NOT = { has_character_flag = built_observatory }
					}

					character_event = {
						id = MNM.1953
						days = 5
						random = 5
					}
				}

				20 = { # Learned something new - Nothing major
					character_event = {
						id = MNM.1955
						days = 5
						random = 5
					}
				}

				20 = { # Could not see anything of interest
					character_event = {
						id = MNM.1957
						days = 5
						random = 5
					}
				}

				10 = { # Bad weather ruined the night
					mult_modifier = {
						factor = 2
						OR = {
							month >= 11
							month < 3
						}
					}

					character_event = {
						id = MNM.1959
						days = 5
						random = 5
					}
				}
			}
		}
	}

	after = {
		character_event = {
			id = MNM.1961
			days = 10
			random = 5
		}
	}
}

# Make observation about stars
character_event = {
	id = MNM.1947
	desc = EVTDESC_MNM_1947
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		event_target:stargazing_guest = {
			character_event = { id = MNM.1948 }
		}
	}

	option = {
		name = EVTOPTA_MNM_1947

		random_list = {
			33 = { military_techpoints = 100 }
			33 = { economy_techpoints  = 100 }
			33 = { culture_techpoints  = 100 }
		}

		if = {
			limit = {
				NOT = { has_character_modifier = stargazer }
			}

			add_character_modifier = {
				name = stargazer
				years = 5
			}
		}

		set_character_flag = stargazing_good_outcome
	}
}

character_event = {
	id = MNM.1948
	desc = EVTDESC_MNM_1948
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1948

		random_list = {
			33 = { military_techpoints = 50 }
			33 = { economy_techpoints  = 50 }
			33 = { culture_techpoints  = 50 }
		}
	}
}

# Make observation about zodiacs
character_event = {
	id = MNM.1950
	desc = EVTDESC_MNM_1950
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		event_target:stargazing_guest = {
			character_event = { id = MNM.1951 }
		}
	}

	option = {
		name = EVTOPTA_MNM_1950

		military_techpoints = 50
		economy_techpoints  = 50
		culture_techpoints  = 50

		set_character_flag = stargazing_good_outcome
	}
}

character_event = {
	id = MNM.1951
	desc = EVTDESC_MNM_1951
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1951

		military_techpoints = 25
		economy_techpoints  = 25
		culture_techpoints  = 25
	}
}

# Saw a comet cross the sky
character_event = {
	id = MNM.1953
	desc = EVTDESC_MNM_1953
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		event_target:stargazing_guest = {
			character_event = { id = MNM.1954 }
		}
	}

	option = {
		name = EVTOPTA_MNM_1953

		military_techpoints = 30
		economy_techpoints  = 30
		culture_techpoints  = 30
		piety = 25

		random = {
			chance = 10
			add_trait_humble_effect = yes
		}

		set_character_flag = stargazing_good_outcome
	}
}

character_event = {
	id = MNM.1954
	desc = EVTDESC_MNM_1954
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1954

		military_techpoints = 20
		economy_techpoints  = 20
		culture_techpoints  = 20
		piety = 15

		random = {
			chance = 10
			add_trait_humble_effect = yes
		}
	}
}

# Learned something new - Nothing major
character_event = {
	id = MNM.1955
	desc = EVTDESC_MNM_1955
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		event_target:stargazing_guest = {
			character_event = { id = MNM.1956 }
		}
	}

	option = {
		name = EVTOPTA_MNM_1955

		set_character_flag = stargazing_good_outcome
	}
}

character_event = {
	id = MNM.1956
	desc = EVTDESC_MNM_1955 # Reused text
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1955 # Reused text
	}
}

# Could not see anything of interest
character_event = {
	id = MNM.1957
	desc = EVTDESC_MNM_1957
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		event_target:stargazing_guest = {
			character_event = { id = MNM.1958 }
		}
	}

	option = {
		name = EVTOPTA_MNM_1957

		set_character_flag = stargazing_bad_outcome
	}
}

character_event = {
	id = MNM.1958
	desc = EVTDESC_MNM_1958
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1958

		hidden_effect = {
			change_variable = { which = local_stargazing_satisfaction value = -1 }
		}
	}
}

# Bad weather ruined the night
character_event = {
	id = MNM.1959
	desc = EVTDESC_MNM_1959
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		event_target:stargazing_guest = {
			character_event = { id = MNM.1960 }
		}
	}

	option = {
		name = EVTOPTA_MNM_1959

		random = {
			chance = 5
			add_trait_depressed_effect = yes
		}

		set_character_flag = stargazing_bad_outcome
	}
}

character_event = {
	id = MNM.1960
	desc = EVTDESC_MNM_1959 # Reused text
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1959 # Reused text

		hidden_effect = {
			change_variable = { which = local_stargazing_satisfaction value = -1 }
		}
	}
}

# Check outcome
character_event = {
	id = MNM.1961

	is_triggered_only = yes
	hide_window = yes

	immediate = {
		hidden_effect = {
			random_list = {
				10 = { # Become friends
					trigger = {
						check_variable = { which = local_stargazing_satisfaction value >= 0 }
						NOT = { is_friend = event_target:stargazing_guest }
					}

					mult_modifier = {
						factor = 2
						check_variable = { which = local_stargazing_satisfaction value >= 3 }
					}
					mult_modifier = {
						factor = 2
						check_variable = { which = local_stargazing_satisfaction value >= 2 }
					}
					mult_modifier = {
						factor = 1.5
						check_variable = { which = local_stargazing_satisfaction value >= 1 }
					}
					mult_modifier = {
						factor = 2
						reverse_opinion = { who = event_target:stargazing_guest value >= 50 }
					}

					character_event = { id = MNM.1962 }
				}

				5 = { # Become rivals
					trigger = {
						NOR = {
							is_friend = event_target:stargazing_guest
							is_rival = event_target:stargazing_guest
						}

						check_variable = { which = local_stargazing_satisfaction value < 1 }
					}

					mult_modifier = {
						factor = 4
						check_variable = { which = local_stargazing_satisfaction value < 0 }
					}
					mult_modifier = {
						factor = 4
						reverse_opinion = { who = event_target:stargazing_guest value < -25 }
					}

					character_event = { id = MNM.1965 }
				}

				50 = { } # Nothing happens
			}

			character_event = {
				id = MNM.1968
				days = 10
				random = 5
			}
		}
	}
}

# Host and guest become friends
character_event = {
	id = MNM.1962
	desc = EVTDESC_MNM_1962
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		event_target:stargazing_guest = {
			character_event = { id = MNM.1963 }
		}
	}

	option = {
		name = EVTOPTA_MNM_1962

		add_friend = event_target:stargazing_guest
		set_character_flag = stargazing_become_friends
	}
}

character_event = {
	id = MNM.1963
	desc = EVTDESC_MNM_1963
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_MNM_1963

		tooltip = {
			add_friend = event_target:stargazing_host
		}
	}
}

# Host and guest become rivals
character_event = {
	id = MNM.1965
	desc = EVTDESC_MNM_1965
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		event_target:stargazing_guest = {
			character_event = { id = MNM.1966 }
		}
	}

	option = {
		name = EVTOPTA_MNM_1965

		add_rival = event_target:stargazing_guest
	}
}

character_event = {
	id = MNM.1966
	desc = EVTDESC_MNM_1966
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_MNM_1966

		tooltip = {
			add_rival = event_target:stargazing_host
		}
	}
}

# Morning arrives - Stargazing is over
character_event = {
	id = MNM.1968
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1968_A
		trigger = {
			has_character_flag = stargazing_good_outcome
		}
	}
	desc = {
		text = EVTDESC_MNM_1968_B
		trigger = {
			has_character_flag = stargazing_bad_outcome
			NOT = { has_character_flag = stargazing_become_friends }
		}
	}
	desc = {
		text = EVTDESC_MNM_1968_C
		trigger = {
			has_character_flag = stargazing_bad_outcome
			has_character_flag = stargazing_become_friends
		}
	}

	is_triggered_only = yes

	immediate = {
		event_target:stargazing_guest = {
			character_event = { id = MNM.1969 }
		}
	}

	option = {
		name = {
			text = EVTOPTA_MNM_1968_A
			trigger = {
				has_character_flag = stargazing_good_outcome
			}
		}
		name = {
			text = EVTOPTA_MNM_1968_B
			trigger = {
				has_character_flag = stargazing_bad_outcome
				NOT = { has_character_flag = stargazing_become_friends }
			}
		}
		name = {
			text = EVTOPTA_MNM_1968_C
			trigger = {
				has_character_flag = stargazing_bad_outcome
				has_character_flag = stargazing_become_friends
			}
		}

		hidden_effect = {
			add_character_modifier = {
				name = stargazing_timer
				years = 3
				hidden = yes
			}

			clr_character_flag = do_not_disturb
			clr_character_flag = stargazing_good_outcome
			clr_character_flag = stargazing_bad_outcome
			clr_character_flag = stargazing_become_friends
			remove_character_modifier = inviting_to_stargazing
		}
	}
}

character_event = {
	id = MNM.1969
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_1968_A
		trigger = {
			FROM = { has_character_flag = stargazing_good_outcome }
		}
	}
	desc = {
		text = EVTDESC_MNM_1968_B
		trigger = {
			FROM = {
				has_character_flag = stargazing_bad_outcome
				NOT = { has_character_flag = stargazing_become_friends }
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_1968_C
		trigger = {
			FROM = {
				has_character_flag = stargazing_bad_outcome
				has_character_flag = stargazing_become_friends
			}
		}
	}

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_MNM_1969
	}
}

### Magus Power: Write a Magnum Opus ###

# Write a Magnum Opus - Start Writing
character_event = {
	id = MNM.1610
	desc = EVTDESC_MNM_1610
	picture = GFX_evt_scientist
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # hermetics_write_magnum_opus, mnm_hermetics_decisions.txt

	option = { # It will be glorious!
		name = EVTOPTA_MNM_1610

		add_character_modifier = {
			name = writing_magnum_opus
			years = 2
		}

		character_event = {
			id = MNM.1600
			months = 3
			random = 60
		}
	}
}

# Write a Magnum Opus - Pick Pillar
character_event = {
	id = MNM.1600
	desc = EVTDESC_MNM_1600
	picture = GFX_evt_scientist
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { society_member_of = hermetics }

	option = { # write book on Theurgy
		name = EVTOPTA_MNM_1600

		trigger = {
			NAND = {
				OR = {
					has_artifact = magnum_opus_theurgy_ritual_1
					has_artifact = magnum_opus_theurgy_ritual_2
					has_artifact = magnum_opus_theurgy_ritual_3
					has_artifact = magnum_opus_theurgy_ritual_4
				}

				OR = {
					has_artifact = magnum_opus_theurgy_contemplation_1
					has_artifact = magnum_opus_theurgy_contemplation_2
					has_artifact = magnum_opus_theurgy_contemplation_3
					has_artifact = magnum_opus_theurgy_contemplation_4
				}
			}
		}

		custom_tooltip = { text = EVTOPTA_MNM_1600_TT }

		character_event = {
			id = MNM.1601
			months = 3
			random = 60
		}
	}

	option = { # write book on Astrology
		name = EVTOPTB_MNM_1600

		trigger = {
			NAND = {
				OR = {
					has_artifact = magnum_opus_astrology_stars_1
					has_artifact = magnum_opus_astrology_stars_2
					has_artifact = magnum_opus_astrology_stars_3
					has_artifact = magnum_opus_astrology_stars_4
				}

				OR = {
					has_artifact = magnum_opus_astrology_planets_1
					has_artifact = magnum_opus_astrology_planets_2
					has_artifact = magnum_opus_astrology_planets_3
					has_artifact = magnum_opus_astrology_planets_4
				}
			}
		}

		custom_tooltip = { text = EVTOPTB_MNM_1600_TT }

		character_event = {
			id = MNM.1602
			months = 3
			random = 60
		}
	}

	option = { # write book on Alchemy
		name = EVTOPTC_MNM_1600

		trigger = {
			NAND = {
				OR = {
					has_artifact = magnum_opus_alchemy_panacea_1
					has_artifact = magnum_opus_alchemy_panacea_2
					has_artifact = magnum_opus_alchemy_panacea_3
					has_artifact = magnum_opus_alchemy_panacea_4
				}

				OR = {
					has_artifact = magnum_opus_alchemy_transmutation_1
					has_artifact = magnum_opus_alchemy_transmutation_2
					has_artifact = magnum_opus_alchemy_transmutation_3
					has_artifact = magnum_opus_alchemy_transmutation_4
				}
			}
		}

		custom_tooltip = { text = EVTOPTC_MNM_1600_TT }

		character_event = {
			id = MNM.1603
			months = 3
			random = 60
		}
	}
}

# Write a Magnum Opus - Pick type of Theurgy
character_event = {
	id = MNM.1601
	desc = EVTDESC_MNM_1601
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { society_member_of = hermetics }

	option = { # Focus on Rituals/Invocation
		name = EVTOPTA_MNM_1601

		trigger = {
			NOR = {
				has_artifact = magnum_opus_theurgy_ritual_1
				has_artifact = magnum_opus_theurgy_ritual_2
				has_artifact = magnum_opus_theurgy_ritual_3
				has_artifact = magnum_opus_theurgy_ritual_4
			}
		}

		custom_tooltip = { text = EVTOPTA_MNM_1601_TT }

		character_event = {
			id = MNM.1604
			months = 3
			random = 60
		}
	}

	option = { # Focus on Contemplation
		name = EVTOPTB_MNM_1601

		trigger = {
			NOR = {
				has_artifact = magnum_opus_theurgy_contemplation_1
				has_artifact = magnum_opus_theurgy_contemplation_2
				has_artifact = magnum_opus_theurgy_contemplation_3
				has_artifact = magnum_opus_theurgy_contemplation_4
			}
		}

		custom_tooltip = { text = EVTOPTB_MNM_1601_TT }

		character_event = {
			id = MNM.1605
			months = 3
			random = 60
		}
	}
}

# Write a Magnum Opus - Pick type of Astrology
character_event = {
	id = MNM.1602
	desc = EVTDESC_MNM_1602
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { society_member_of = hermetics }

	option = { # Focus on Stars
		name = EVTOPTA_MNM_1602

		trigger = {
			NOR = {
				has_artifact = magnum_opus_astrology_stars_1
				has_artifact = magnum_opus_astrology_stars_2
				has_artifact = magnum_opus_astrology_stars_3
				has_artifact = magnum_opus_astrology_stars_4
			}
		}

		custom_tooltip = { text = EVTOPTA_MNM_1602_TT }

		character_event = {
			id = MNM.1606
			months = 3
			random = 60
		}
	}

	option = { # Focus on Planets
		name = EVTOPTB_MNM_1602

		trigger = {
			NOR = {
				has_artifact = magnum_opus_astrology_planets_1
				has_artifact = magnum_opus_astrology_planets_2
				has_artifact = magnum_opus_astrology_planets_3
				has_artifact = magnum_opus_astrology_planets_4
			}
		}

		custom_tooltip = { text = EVTOPTB_MNM_1602_TT }

		character_event = {
			id = MNM.1607
			months = 3
			random = 60
		}
	}
}

# Write a Magnum Opus - Pick type of Alchemy
character_event = {
	id = MNM.1603
	desc = EVTDESC_MNM_1603
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { society_member_of = hermetics }

	option = { # Focus on Universal Panacea
		name = EVTOPTA_MNM_1603

		trigger = {
			NOR = {
				has_artifact = magnum_opus_alchemy_panacea_1
				has_artifact = magnum_opus_alchemy_panacea_2
				has_artifact = magnum_opus_alchemy_panacea_3
				has_artifact = magnum_opus_alchemy_panacea_4
			}
		}

		custom_tooltip = { text = EVTOPTA_MNM_1603_TT }

		character_event = {
			id = MNM.1608
			months = 3
			random = 60
		}
	}

	option = { # Focus on Transmutation
		name = EVTOPTB_MNM_1603

		trigger = {
			NOR = {
				has_artifact = magnum_opus_alchemy_transmutation_1
				has_artifact = magnum_opus_alchemy_transmutation_2
				has_artifact = magnum_opus_alchemy_transmutation_3
				has_artifact = magnum_opus_alchemy_transmutation_4
			}
		}

		custom_tooltip = { text = EVTOPTB_MNM_1603_TT }

		character_event = {
			id = MNM.1609
			months = 3
			random = 60
		}
	}
}

# Write a Magnum Opus - Finish book on Ritualistic/Invocative Theurgy
character_event = {
	id = MNM.1604
	desc = EVTDESC_MNM_1604
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = { # Awesome!
		name = EVTOPTA_MNM_1604

		if = {
			limit = { learning < 12 }
			prestige = 50
			add_artifact = magnum_opus_theurgy_ritual_1
		}
		else_if = {
			limit = { learning < 18 }
			prestige = 100
			add_artifact = magnum_opus_theurgy_ritual_2
		}
		else_if = {
			limit = { learning < 25 }
			prestige = 150
			add_artifact = magnum_opus_theurgy_ritual_3
		}
		else = {
			prestige = 200
			add_artifact = magnum_opus_theurgy_ritual_4
		}

		remove_character_modifier = writing_magnum_opus
	}
}

# Write a Magnum Opus - Finish book on Contemplative Theurgy
character_event = {
	id = MNM.1605
	desc = EVTDESC_MNM_1605
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = { # Awesome!
		name = EVTOPTA_MNM_1605

		if = {
			limit = { learning < 12 }
			prestige = 50
			add_artifact = magnum_opus_theurgy_contemplation_1
		}
		else_if = {
			limit = { learning < 18 }
			prestige = 100
			add_artifact = magnum_opus_theurgy_contemplation_2
		}
		else_if = {
			limit = { learning < 25 }
			prestige = 150
			add_artifact = magnum_opus_theurgy_contemplation_3
		}
		else = {
			prestige = 200
			add_artifact = magnum_opus_theurgy_contemplation_4
		}

		remove_character_modifier = writing_magnum_opus
	}
}

# Write a Magnum Opus - Finish book on Astrology with focus on Stars
character_event = {
	id = MNM.1606
	desc = EVTDESC_MNM_1606
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = { # Awesome!
		name = EVTOPTA_MNM_1606

		if = {
			limit = { learning < 12 }
			prestige = 50
			add_artifact = magnum_opus_astrology_stars_1
		}
		else_if = {
			limit = { learning < 18 }
			prestige = 100
			add_artifact = magnum_opus_astrology_stars_2
		}
		else_if = {
			limit = { learning < 25 }
			prestige = 150
			add_artifact = magnum_opus_astrology_stars_3
		}
		else = {
			prestige = 200
			add_artifact = magnum_opus_astrology_stars_4
		}

		remove_character_modifier = writing_magnum_opus
	}
}

# Write a Magnum Opus - Finish book on Astrology with focus on Planets
character_event = {
	id = MNM.1607
	desc = EVTDESC_MNM_1607
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = { # Awesome!
		name = EVTOPTA_MNM_1607

		if = {
			limit = { learning < 12 }
			prestige = 50
			add_artifact = magnum_opus_astrology_planets_1
		}
		else_if = {
			limit = { learning < 18 }
			prestige = 100
			add_artifact = magnum_opus_astrology_planets_2
		}
		else_if = {
			limit = { learning < 25 }
			prestige = 150
			add_artifact = magnum_opus_astrology_planets_3
		}
		else = {
			prestige = 200
			add_artifact = magnum_opus_astrology_planets_4
		}

		remove_character_modifier = writing_magnum_opus
	}
}

# Write a Magnum Opus - Finish book on Alchemy with focus on Universal Panacea
character_event = {
	id = MNM.1608
	desc = EVTDESC_MNM_1608
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = { # Awesome!
		name = EVTOPTA_MNM_1608

		if = {
			limit = { learning < 12 }
			prestige = 50
			add_artifact = magnum_opus_alchemy_panacea_1
		}
		else_if = {
			limit = { learning < 18 }
			prestige = 100
			add_artifact = magnum_opus_alchemy_panacea_2
		}
		else_if = {
			limit = { learning < 25 }
			prestige = 150
			add_artifact = magnum_opus_alchemy_panacea_3
		}
		else = {
			prestige = 200
			add_artifact = magnum_opus_alchemy_panacea_4
		}

		remove_character_modifier = writing_magnum_opus
	}
}

# Write a Magnum Opus - Finish book on Alchemy with focus on Transmutation
character_event = {
	id = MNM.1609
	desc = EVTDESC_MNM_1609
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = { # Awesome!
		name = EVTOPTA_MNM_1609

		if = {
			limit = { learning < 12 }
			prestige = 50
			add_artifact = magnum_opus_alchemy_transmutation_1
		}
		else_if = {
			limit = { learning < 18 }
			prestige = 100
			add_artifact = magnum_opus_alchemy_transmutation_2
		}
		else_if = {
			limit = { learning < 25 }
			prestige = 150
			add_artifact = magnum_opus_alchemy_transmutation_3
		}
		else = {
			prestige = 200
			add_artifact = magnum_opus_alchemy_transmutation_4
		}

		remove_character_modifier = writing_magnum_opus
	}
}

####################################################
# Quest: Observe stars/planets
####################################################

society_quest_event = {
	id = MNM.1829
	desc = EVTDESC_MNM_1829
	portrait = event_target:hermetic_collaborator

	is_triggered_only = yes

	option = {
		name = ACCEPT

		set_quest = quest_hermetics_observe_sky
		character_event = { id = MNM.1830 days = 5 }
	}

	option = {
		name = DECLINE

		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			days = 1000
			hidden = yes
		}

		ai_chance = { factor = 0 }
	}
}

character_event = {
	id = MNM.1830
	desc = EVTDESC_MNM_1830
	picture = GFX_evt_book_carolingian_script
	border = GFX_event_normal_frame_religion
	portrait = event_target:hermetic_collaborator

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1830

		add_character_modifier = {
			name = astronomical_insights_1
			duration = -1
		}

		character_event = {
			id = MNM.1835
			days = 40
			random = 15
		}
	}
}

character_event = { # progress event tombola
	id = MNM.1835

	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_list = {
			30 = { # Productive evening
				character_event = { id = MNM.1840 }
			}

			30 = { # Neglect interacting with your spouse
				trigger = {
					NOT = { is_married = event_target:hermetic_collaborator }
					any_spouse = { prisoner = no }
				}

				character_event = { id = MNM.1841 }
			}

			30 = { # Child wants help to sleep
				trigger = {
					any_child = {
						age >= 4
						age < 14
					}
				}

				character_event = { id = MNM.1842 }
			}

			30 = { # Neglect taking care of accounting
				character_event = { id = MNM.1843 }
			}

			30 = { # Friends upset about missed event
				trigger = { num_of_friends > 0 }
				character_event = { id = MNM.1844 }
			}

			30 = { # Absent-mindedness in meetings
				trigger = {
					any_courtier_or_vassal = {
						count >= 2
						has_job_title = yes
					}
				}

				character_event = { id = MNM.1845 }
			}

			30 = { # Use ingredients
				trigger = {
					has_a_herb_ingredient_trigger = yes

					any_artifact = {
						count >= 2
						has_artifact_flag = ingredient
					}
				}

				character_event = { id = MNM.1855 }
			}
		}
	}
}

character_event = { # ending event tombola
	id = MNM.1836

	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_list = {
			30 = { character_event = { id = MNM.1846 } } # Tracking planets
			30 = { character_event = { id = MNM.1847 } } # Predicting Comet
			30 = { character_event = { id = MNM.1848 } } # Name a newly found star
			30 = { long_character_event = { id = MNM.1850 } } # Observe zodiac stars

			120 = { # Fail to observe anything of interest
				mult_modifier = {
					factor = 0.5
					has_character_modifier = astronomical_insights_2
				}
				mult_modifier = {
					factor = 0.5
					has_character_modifier = astronomical_insights_3
				}
				mult_modifier = {
					factor = 0.5
					has_character_modifier = astronomical_insights_4
				}

				character_event = { id = MNM.1851 }
			}
		}
	}
}

character_event = { # continue studying or conclude my findings?
	id = MNM.1837
	picture = GFX_evt_ritual_scroll
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESCA_MNM_1837
		trigger = { has_character_modifier = astronomical_insights_1 }
	}
	desc = {
		text = EVTDESCB_MNM_1837
		trigger = { has_character_modifier = astronomical_insights_2 }
	}
	desc = {
		text = EVTDESCC_MNM_1837
		trigger = { has_character_modifier = astronomical_insights_3 }
	}
	desc = {
		text = EVTDESCD_MNM_1837
		trigger = { has_character_modifier = astronomical_insights_4 }
	}

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_MNM_1837

		trigger = {
			NOT = { has_character_modifier = astronomical_insights_4 }
		}

		custom_tooltip = { text = EVTOPTA_MNM_1837_TT }
		character_event = { id = MNM.1835 months = 2 random = 20 }
	}

	option = {
		name = EVTOPTB_MNM_1837

		trigger = {
			NOT = { has_character_modifier = astronomical_insights_4 }
		}

		custom_tooltip = { text = EVTOPTB_MNM_1837_TT }
		character_event = { id = MNM.1836 days = 20 }
	}

	option = {
		name = EVTOPTC_MNM_1837

		trigger = { has_character_modifier = astronomical_insights_4 }

		custom_tooltip = { text = EVTOPTB_MNM_1837_TT }
		custom_tooltip = { text = EVTTOOLTIP_MNM_1837 }
		character_event = { id = MNM.1836 days = 20 }
	}
}

character_event = { # Progress - Productive evening
	id = MNM.1840
	desc = EVTDESC_MNM_1840
	picture = GFX_evt_monk
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_MNM_1840

		add_society_currency_trivial_effect = yes
	}

	option = {
		name = EVTOPTB_MNM_1840

		trigger = { trait = slothful }

		random = {
			chance = 30
			remove_trait_slothful_effect = yes
		}
	}

	option = {
		name = EVTOPTC_MNM_1840

		trigger = { trait = depressed }

		random = {
			chance = 30
			remove_trait_depressed_effect = yes
		}
	}

	option = {
		name = EVTOPTD_MNM_1840

		trigger = { trait = envious }

		random = {
			chance = 30
			remove_trait_envious_effect = yes
		}
	}

	after = {
		increase_astronomical_insights_modifier_effect = yes
		character_event = { id = MNM.1837 days = 5 }
	}
}

character_event = { # Progress - Neglect interacting with your spouse
	id = MNM.1841
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_religion
	portrait = event_target:target_spouse

	desc = {
		text = EVTDESCA_MNM_1841
		trigger = {
			event_target:target_spouse = {
				NOR = {
					has_opinion_modifier = {
						name = opinion_out_of_touch
						who = ROOT
					}

					has_opinion_modifier = {
						name = opinion_out_of_touch_mild
						who = ROOT
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_MNM_1841
		trigger = {
			event_target:target_spouse = {
				OR = {
					has_opinion_modifier = {
						name = opinion_out_of_touch
						who = ROOT
					}

					has_opinion_modifier = {
						name = opinion_out_of_touch_mild
						who = ROOT
					}
				}
			}
		}
	}

	is_triggered_only = yes

	immediate = {
		random_spouse = {
			limit = { prisoner = no }
			save_event_target_as = target_spouse
		}
	}

	option = {
		name = {
			text = EVTOPTA_MNM_1841_1
			trigger = {
				event_target:target_spouse = {
					NOR = {
						has_opinion_modifier = {
							name = opinion_out_of_touch
							who = ROOT
						}

						has_opinion_modifier = {
							name = opinion_out_of_touch_mild
							who = ROOT
						}
					}
				}
			}
		}
		name = {
			text = EVTOPTA_MNM_1841_2
			trigger = {
				event_target:target_spouse = {
					OR = {
						has_opinion_modifier = {
							name = opinion_out_of_touch
							who = ROOT
						}

						has_opinion_modifier = {
							name = opinion_out_of_touch_mild
							who = ROOT
						}
					}
				}
			}
		}

		increase_astronomical_insights_modifier_effect = yes

		event_target:target_spouse = {
			show_scope_change = no

			if = {
				limit = { is_lover = ROOT }

				random = {
					chance = 35

					mult_modifier = {
						factor = 2

						OR = {
							has_opinion_modifier = {
								name = opinion_out_of_touch
								who = ROOT
							}

							has_opinion_modifier = {
								name = opinion_out_of_touch_mild
								who = ROOT
							}
						}
					}

					remove_lover = ROOT
				}
			}

			opinion = {
				name = opinion_out_of_touch
				who = ROOT
				years = 10
			}
		}
	}

	option = {
		name = {
			text = EVTOPTB_MNM_1841_1
			trigger = {
				event_target:target_spouse = {
					NOR = {
						has_opinion_modifier = {
							name = opinion_out_of_touch
							who = ROOT
						}

						has_opinion_modifier = {
							name = opinion_out_of_touch_mild
							who = ROOT
						}
					}
				}
			}
		}
		name = {
			text = EVTOPTB_MNM_1841_2
			trigger = {
				event_target:target_spouse = {
					OR = {
						has_opinion_modifier = {
							name = opinion_out_of_touch
							who = ROOT
						}

						has_opinion_modifier = {
							name = opinion_out_of_touch_mild
							who = ROOT
						}
					}
				}
			}
		}

		reverse_opinion = {
			name = opinion_relieved
			who = event_target:target_spouse
			years = 10
		}
	}

	after = {
		character_event = { id = MNM.1837 days = 5 }
	}
}

character_event = { # Progress - Child wants help to sleep
	id = MNM.1842
	desc = EVTDESCA_MNM_1842
	picture = GFX_evt_daughter_asking_father
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		random_child = {
			limit = {
				age >= 4
				age < 14
			}

			save_event_target_as = target_child
		}

		if = {
			limit = { has_a_herb_ingredient_trigger = yes }
			select_random_hermetic_ingredient_herb_effect = yes
		}
		else_if = {
			limit = { has_an_animal_part_ingredient_trigger = yes }
			select_random_hermetic_ingredient_animal_part_effect = yes
		}
		else_if = {
			limit = { has_a_powder_ingredient_trigger = yes }
			select_random_hermetic_ingredient_powder_effect = yes
		}
		else_if = {
			limit = { has_a_liquid_ingredient_trigger = yes }
			select_random_hermetic_ingredient_liquid_effect = yes
		}
	}

	option = {
		name = EVTOPTA_MNM_1842

		increase_astronomical_insights_modifier_effect = yes

		event_target:target_child = {
			show_scope_change = no

			if = {
				limit = {
					has_dlc = "Conclave"
				}

				random_list = {
					20 = {
						if = {
							limit = {
								NOT = { trait = timid }
							}

							add_trait = timid
						}
					}

					20 = {
						if = {
							limit = {
								NOT = { trait = indolent }
							}

							add_trait = indolent
						}
					}

					20 = {
						if = {
							limit = {
								NOT = { trait = fussy }
							}

							add_trait = fussy
						}
					}

					40 = { }
				}
			}
			else = {
				random_list = {
					20 = { add_trait_fully_slothful_effect = yes }
					20 = { add_trait_fully_envious_effect = yes }
					20 = { add_trait_fully_arbitrary_effect = yes }
					40 = { }
				}
			}
		}

		reverse_opinion = {
			name = opinion_bad_parent
			who = event_target:target_child
			years = 25
		}
	}

	option = {
		name = EVTOPTB_MNM_1842

		reverse_opinion = {
			name = opinion_bad_parent
			who = event_target:target_child
			years = 25
		}
	}

	option = { # this will help you sleep (uses ingredient)
		name = {
			text = EVTOPTC_MNM_1842_herb
			trigger = { has_selected_herb_ingredient_1_trigger = yes }
		}
		name = {
			text = EVTOPTC_MNM_1842_animal_part
			trigger = { has_selected_animal_part_ingredient_1_trigger = yes }
		}
		name = {
			text = EVTOPTC_MNM_1842_powder
			trigger = { has_selected_powder_ingredient_1_trigger = yes }
		}
		name = {
			text = EVTOPTC_MNM_1842_liquid
			trigger = { has_selected_liquid_ingredient_1_trigger = yes }
		}

		tooltip_info_custom = ingredient_option_available_tt

		trigger = {
			any_artifact = { has_artifact_flag = ingredient }
		}

		increase_astronomical_insights_modifier_effect = yes

		if = { # if you gave them a herbal tea...
			limit = { has_selected_herb_ingredient_1_trigger = yes }

			reverse_opinion = {
				name = comforted_opinion
				who = event_target:target_child
				years = 5
			}
		}

		else_if = { # if you gave them animal part broth...
			limit = { has_selected_animal_part_ingredient_1_trigger = yes }

			reverse_opinion = {
				name = opinion_cheered_up
				who = event_target:target_child
				years = 2
			}
		}

		else_if = { # if you gave them a metal powder...
			limit = { has_selected_powder_ingredient_1_trigger = yes }

			event_target:target_child = {
				show_scope_change = no

				add_character_modifier = {
					name = nauseous_from_potion
					years = 1
				}
			}
		}

		else_if = { # if you fed them mercury, for instance...
			limit = { has_selected_liquid_ingredient_1_trigger = yes }

			event_target:target_child = {
				show_scope_change = no

				add_character_modifier = {
					name = nauseous_from_potion
					years = 1
				}
			}
		}

		destroy_selected_ingredient_1_effect = yes
	}

	after = {
		character_event = { id = MNM.1837 days = 5 }
		remove_selection_of_ingredients_effect = yes
	}
}

character_event = { # Progress - Neglect taking care of accounting
	id = MNM.1843
	desc = EVTDESC_MNM_1843
	picture = GFX_evt_relic_box
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1843

		increase_astronomical_insights_modifier_effect = yes

		add_character_modifier = {
			name = neglected_accounting
			years = 5
		}

		scaled_wealth = {
			value = -0.5
			min = -25
			max = -70
		}
	}

	option = {
		name = EVTOPTB_MNM_1843

		scaled_wealth = {
			value = -0.3
			min = -15
			max = -40
		}
	}

	after = {
		character_event = { id = MNM.1837 days = 5 }
	}
}

character_event = { # Progress - Friends upset about missed event
	id = MNM.1844
	desc = EVTDESC_MNM_1844
	picture = GFX_evt_bad_news
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		random_friend = {
			save_event_target_as = target_friend
		}

		if = {
			limit = { has_a_herb_ingredient_trigger = yes }
			select_random_hermetic_ingredient_herb_effect = yes
		}
		else_if = {
			limit = { has_an_animal_part_ingredient_trigger = yes }
			select_random_hermetic_ingredient_animal_part_effect = yes
		}
		else_if = {
			limit = { has_a_powder_ingredient_trigger = yes }
			select_random_hermetic_ingredient_powder_effect = yes
		}
		else_if = {
			limit = { has_a_liquid_ingredient_trigger = yes }
			select_random_hermetic_ingredient_liquid_effect = yes
		}
	}

	option = {
		name = EVTOPTA_MNM_1844

		increase_astronomical_insights_modifier_effect = yes

		event_target:target_friend = {
			show_scope_change = no

			random = {
				chance = 30
				remove_friend = ROOT
			}

			opinion = {
				name = opinion_forgot_important_occasion
				who = ROOT
				years = 15
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_1844

		reverse_opinion = {
			name = opinion_forgot_important_occasion_mild
			who = event_target:target_friend
			years = 15
		}
	}

	option = {
		name = {
			text = EVTOPTC_MNM_1844_herb
			trigger = { has_selected_herb_ingredient_1_trigger = yes }
		}
		name = {
			text = EVTOPTC_MNM_1844_animal_part
			trigger = { has_selected_animal_part_ingredient_1_trigger = yes }
		}
		name = {
			text = EVTOPTC_MNM_1844_powder
			trigger = { has_selected_powder_ingredient_1_trigger = yes }
		}
		name = {
			text = EVTOPTC_MNM_1844_liquid
			trigger = { has_selected_liquid_ingredient_1_trigger = yes }
		}

		tooltip_info_custom = ingredient_option_available_tt

		trigger = {
			any_artifact = { has_artifact_flag = ingredient }
		}

		increase_astronomical_insights_modifier_effect = yes

		if = { # if you gave them a herbal tea...
			limit = { has_selected_herb_ingredient_1_trigger = yes }

			reverse_opinion = {
				name = comforted_opinion
				who = event_target:target_friend
				years = 5
			}
		}

		else_if = { # if you gave them animal part broth...
			limit = { has_selected_animal_part_ingredient_1_trigger = yes }

			reverse_opinion = {
				name = opinion_cheered_up
				who = event_target:target_friend
				years = 5
			}
		}

		else_if = { # if you gave them a metal powder...
			limit = { has_selected_powder_ingredient_1_trigger = yes }

			reverse_opinion = {
				name = opinion_cheered_up
				who = event_target:target_friend
				years = 5
			}
		}

		else_if = { # if you fed them mercury, for instance...
			limit = { has_selected_liquid_ingredient_1_trigger = yes }

			event_target:target_friend = {
				show_scope_change = no

				add_character_modifier = {
					name = nauseous_from_potion
					years = 1
				}
			}
		}

		destroy_selected_ingredient_1_effect = yes
	}

	after = {
		character_event = { id = MNM.1837 days = 5 }
		remove_selection_of_ingredients_effect = yes
	}
}

character_event = { # Progress - Absent-mindedness in meetings
	id = MNM.1845
	desc = EVTDESC_MNM_1845
	picture = GFX_evt_state_diplomacy
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		any_voter = {
			score_value = { # Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
				prev_dislikes_this_score = yes
			}

			save_event_target_as = councillor1
		}

		any_voter = {
			limit = {
				NOT = { character = event_target:councillor1 }
			}

			score_value = { # Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
				prev_likes_this_score = yes
			}

			save_event_target_as = councillor2
		}
	}

	option = {
		name = EVTOPTA_MNM_1845

		increase_astronomical_insights_modifier_effect = yes

		event_target:councillor2 = {
			show_scope_change = no

			opinion = {
				name = opinion_fired_from_council
				who = ROOT
				years = 5
			}

			trigger_switch = {
				on_trigger = has_job_title

				job_chancellor = { remove_title = job_chancellor }
				job_marshal    = { remove_title = job_marshal }
				job_treasurer  = { remove_title = job_treasurer }
				job_spymaster  = { remove_title = job_spymaster }
				job_spiritual  = { remove_title = job_spiritual }
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_1845

		reverse_opinion = {
			name = opinion_angry
			who = event_target:councillor1
			years = 5
		}
	}

	after = {
		character_event = { id = MNM.1837 days = 5 }
	}
}

# Progress event: use ingredients
character_event = {
	id = MNM.1855
	desc = EVTDESC_MNM_1855
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		select_random_hermetic_ingredient_herb_effect = yes
		select_random_hermetic_ingredient_animal_part_effect = yes
		select_random_hermetic_ingredient_liquid_effect = yes
		select_random_hermetic_ingredient_powder_effect = yes
	}

	option = { # Smoke something...!
		name = EVTOPTA_MNM_1855

		trigger = { has_selected_herb_ingredient_1_trigger = yes }

		random = {
			chance = 30
			increase_astronomical_insights_modifier_effect = yes
		}

		destroy_selected_ingredient_1_effect = yes
	}

	option = { # Cook something...!
		name = EVTOPTB_MNM_1855

		trigger = { has_selected_animal_part_ingredient_2_trigger = yes }

		random = {
			chance = 40
			increase_astronomical_insights_modifier_effect = yes
		}

		destroy_selected_ingredient_2_effect = yes
	}

	option = { # I'll keep it under my pillow
		name = EVTOPTC_MNM_1855

		trigger = { has_selected_powder_ingredient_2_trigger = yes }

		random = {
			chance = 50
			increase_astronomical_insights_modifier_effect = yes
		}

		destroy_selected_ingredient_2_effect = yes
	}

	option = { # Combine several somethings...!
		name = EVTOPTD_MNM_1855

		tooltip_info_custom = multiple_ingredient_option_available_tt

		trigger = { has_selected_liquid_ingredient_2_trigger = yes }

		random_list = {
			85 = { increase_astronomical_insights_modifier_effect = yes }
			15 = { add_maimed_trait_effect = yes }
		}

		destroy_selected_ingredient_1_and_2_effect = yes
	}

	option = { # I'd rather not...
		name = EVTOPTE_MNM_1855
	}

	after = {
		character_event = { id = MNM.1837 days = 5 }
		remove_selection_of_ingredients_effect = yes
	}
}

character_event = { # Outcome - Tracking planets
	id = MNM.1846
	desc = EVTDESC_MNM_1846
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1846

		random = {
			chance = 15
			add_trait_fully_patient_effect = yes
		}

		clr_quest = quest_hermetics_observe_sky
		sound_effect = hermetic_society_observe_planet
		add_mission_succeed_influence_effect = yes
		add_society_currency_medium_effect = yes
		remove_astronomical_insight_modifier_effect = yes
	}
}

character_event = { # Outcome - Predicting star-fall
	id = MNM.1847
	desc = EVTDESC_MNM_1847
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1847 # Invite everyone to this occasion

		long_character_event = {
			id = MNM.1853
			days = 190
			random = 70
		}
	}

	option = {
		name = EVTOPTB_MNM_1847 # I'll remember the day and observe it myself

		long_character_event = {
			id = MNM.1854
			days = 190
			random = 70
		}
	}
}

character_event = { # Outcome - Name a newly found star
	id = MNM.1848
	desc = EVTDESC_MNM_1848
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		random_child = {
			limit = {
				NOR = {
					has_character_modifier = got_named_star

					any_sibling = { # Oldest child without the modifier first
						is_older_than = PREV
						is_child_of = ROOT
						NOT = { has_character_modifier = got_named_star }
					}
				}
			}

			save_event_target_as = target_child
		}

		random_spouse = {
			limit = {
				NOT = { has_character_modifier = got_named_star }
			}

			save_event_target_as = target_spouse
		}

		random_friend = {
			limit = {
				NOT = { has_character_modifier = got_named_star }
			}

			save_event_target_as = target_friend
		}
	}

	option = { # Name it after my child
		name = EVTOPTA_MNM_1848

		trigger = {
			event_target:target_child = { always = yes }
		}

		event_target:target_child = {
			show_scope_change = no

			add_character_modifier = {
				name = got_named_star
				duration = -1
			}

			opinion = {
				name = opinion_gift_from_above
				who = ROOT
				years = 20
			}

			character_event = { id = MNM.1852 } # Notify
		}
	}

	option = { # Name it after my spouse
		name = EVTOPTB_MNM_1848

		trigger = {
			event_target:target_spouse = { always = yes }
		}

		event_target:target_spouse = {
			show_scope_change = no

			add_character_modifier = {
				name = got_named_star
				duration = -1
			}

			if = {
				limit = {
					opinion = {
						who = ROOT
						value >= 20
					}
				}

				add_lover = ROOT
			}
			else = {
				opinion = {
					name = opinion_gift_from_above
					who = ROOT
					years = 20
				}
			}

			character_event = { id = MNM.1852 } # Notify
		}
	}

	option = { # Name it after a friend
		name = EVTOPTC_MNM_1848

		trigger = {
			event_target:target_friend = { always = yes }
		}

		event_target:target_friend = {
			show_scope_change = no

			add_character_modifier = {
				name = got_named_star
				duration = -1
			}

			opinion = {
				name = opinion_gift_from_above
				who = ROOT
				years = 20
			}

			character_event = { id = MNM.1852 } # Notify
		}
	}

	option = { # Name it after myself
		name = EVTOPTD_MNM_1848

		trigger = {
			NOT = { has_character_modifier = got_named_star }
		}

		add_trait_fully_silently_proud_effect = yes

		add_character_modifier = {
			name = got_named_star
			duration = -1
		}
	}

	after = {
		clr_quest = quest_hermetics_observe_sky
		sound_effect = hermetic_society_observe_planet
		add_mission_succeed_influence_effect = yes
		add_society_currency_medium_effect = yes
		remove_astronomical_insight_modifier_effect = yes
	}
}

long_character_event = { # Outcome - Observe zodiac stars
	id = MNM.1850
	desc = EVTDESC_MNM_1850
	picture = GFX_evt_comet
	border = GFX_event_long_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1850

		add_western_zodiac_trait_effect = yes
		clr_quest = quest_hermetics_observe_sky
		sound_effect = hermetic_society_observe_planet
		add_mission_succeed_influence_effect = yes
		add_society_currency_medium_effect = yes
		remove_astronomical_insight_modifier_effect = yes
	}
}

character_event = { # Outcome - Fail to observe anything of interest
	id = MNM.1851
	desc = EVTDESC_MNM_1851
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_1851

		clr_quest = {
			id = quest_hermetics_observe_sky
			failure = yes
		}

		add_mission_fail_influence_effect = yes
		remove_astronomical_insight_modifier_effect = yes
	}
}

character_event = { # Notification - Named star
	id = MNM.1852
	desc = EVTDESC_MNM_1852
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_MNM_1852

		tooltip = {
			add_character_modifier = {
				name = got_named_star
				duration = -1
			}
		}
	}
}

# You invited everyone to this star-fall observation
long_character_event = {
	id = MNM.1853
	picture = GFX_evt_comet
	border = GFX_event_long_frame_religion

	is_triggered_only = yes

	desc = {
		text = EVTDESCA_MNM_1853
		trigger = { has_character_flag = comet_success }
	}
	desc = {
		text = EVTDESCB_MNM_1853
		trigger = { has_character_flag = comet_failure }
	}

	immediate = {
		random_list = {
			50 = { set_character_flag = comet_success }

			50 = {
				mult_modifier = {
					factor = 0.5
					has_character_modifier = astronomical_insights_2
				}
				mult_modifier = {
					factor = 0.5
					has_character_modifier = astronomical_insights_3
				}
				mult_modifier = {
					factor = 0.5
					has_character_modifier = astronomical_insights_4
				}

				set_character_flag = comet_failure
			}
		}
	}

	option = {
		name = EVTOPTA_MNM_1853

		trigger = { has_character_flag = comet_success }

		add_trait_fully_silently_proud_effect = yes
		prestige = 100
		clr_quest = quest_hermetics_observe_sky
		sound_effect = hermetic_society_observe_planet
		add_mission_succeed_influence_effect = yes
		add_society_currency_medium_effect = yes
	}

	option = {
		name = EVTOPTB_MNM_1853

		trigger = { has_character_flag = comet_failure }

		add_character_modifier = {
			name = failed_to_predict_star_fall
			years = 5
		}

		clr_quest = {
			id = quest_hermetics_observe_sky
			failure = yes
		}

		add_mission_fail_influence_effect = yes
	}

	after = {
		clr_character_flag = comet_success
		clr_character_flag = comet_failure
		remove_astronomical_insight_modifier_effect = yes
	}
}

# You observed the star-fall alone
long_character_event = {
	id = MNM.1854
	picture = GFX_evt_comet
	border = GFX_event_long_frame_religion

	desc = {
		text = EVTDESCA_MNM_1854
		trigger = { has_character_flag = comet_success }
	}
	desc = {
		text = EVTDESCB_MNM_1854
		trigger = { has_character_flag = comet_failure }
	}

	is_triggered_only = yes

	immediate = {
		random_list = {
			50 = { set_character_flag = comet_success }

			50 = {
				mult_modifier = {
					factor = 0.5
					has_character_modifier = astronomical_insights_2
				}
				mult_modifier = {
					factor = 0.5
					has_character_modifier = astronomical_insights_3
				}
				mult_modifier = {
					factor = 0.5
					has_character_modifier = astronomical_insights_4
				}

				set_character_flag = comet_failure
			}
		}
	}

	option = {
		name = EVTOPTA_MNM_1854

		trigger = { has_character_flag = comet_success }

		clr_quest = quest_hermetics_observe_sky
		sound_effect = hermetic_society_observe_planet
		add_mission_succeed_influence_effect = yes
		add_society_currency_medium_effect = yes
	}

	option = {
		name = EVTOPTB_MNM_1854

		trigger = { has_character_flag = comet_failure }

		clr_quest = {
			id = quest_hermetics_observe_sky
			failure = yes
		}

		add_mission_fail_influence_effect = yes
	}

	after = {
		clr_character_flag = comet_success
		clr_character_flag = comet_failure
		remove_astronomical_insight_modifier_effect = yes
	}
}

###########################################################
#########    Inherited ingredient set-up event    #########
###########################################################

# ROOT is new artifact owner
# FROM is inherited artifact
# FROMFROM is previous owner
# Dealing with inherited ingredients - delays the visible event
character_event = {
	id = MNM.5108

	is_triggered_only = yes
	hide_window = yes

	trigger = {
		NOT = { has_character_flag = dealing_with_inherited_ingredients }
	}

	immediate = {
		# FROMFROM = { save_event_target_as = previous_ingredient_owner } # does this work on dead folk?

		if = {
			limit = { ai = yes }
			FROM = { destroy_artifact = yes }
		}
		else = {
			set_character_flag = dealing_with_inherited_ingredients
			character_event = { id = MNM.5109 days = 10 } # send visible event
		}
	}
}

# Inherited ingredients - keep or no?
character_event = {
	id = MNM.5109
	picture = GFX_evt_experiment
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_5109_hermetic
		trigger = { society_member_of = hermetics }
	}
	desc = {
		text = EVTDESC_MNM_5109_other_society
		trigger = {
			NOT = { society_member_of = hermetics }
			is_in_society = yes
		}
	}
	desc = {
		text = EVTDESC_MNM_5109_no_society
		trigger = { is_in_society = no }
	}
	desc = {
		text = EVTDESC_MNM_5109_child
		trigger = { is_adult = no }
	}

	is_triggered_only = yes

	trigger = {
		any_artifact = {
			count >= 2
			has_artifact_flag = ingredient
		}
	}

	fail_trigger_effect = {
		clr_character_flag = dealing_with_inherited_ingredients
	}

	immediate = {
		select_random_hermetic_ingredient_effect = yes
		select_random_hermetic_ingredient_effect = yes
	}

	option = {
		name = EVTOPTA_MNM_5109

		destroy_selected_ingredient_1_and_2_effect = yes
		piety = 25
	}

	option = {
		name = EVTOPTB_MNM_5109

		destroy_all_ingredients_effect = yes
		piety = 25
		prestige = 25
	}

	option = {
		name = EVTOPTC_MNM_5109
	}

	after = {
		remove_selection_of_ingredients_effect = yes
		clr_character_flag = dealing_with_inherited_ingredients
	}
}

# Paranoid ward-making
character_event = {
	id = MNM.5110
	desc = EVTDESC_MNM_5110
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes # on_society_bi_yearly_pulse, random_events

	has_dlc = "Mystics"
	only_capable = yes

	trigger = {
		society_member_of = hermetics

		NOR = {
			has_character_flag = small_defense_against_dark_forces
			has_character_flag = medium_defense_against_dark_forces
			has_character_flag = large_defense_against_dark_forces
		}

		NAND = {
			has_game_rule = {
				name = supernatural_events
				value = off
			}

			has_game_rule = {
				name = devil_worshipers
				value = none
			}
		}

		any_artifact = {
			count >= 3
			has_artifact_flag = ingredient
		}
	}

	immediate = {
		select_random_hermetic_ingredient_effect = yes
		select_random_hermetic_ingredient_effect = yes
	}

	option = { # One ingredient is fine
		name = EVTOPTA_MNM_5110

		prestige = 15
		piety = -10
		destroy_selected_ingredient_1_effect = yes
		set_character_flag = small_defense_against_dark_forces
	}

	option = { # I want to use both ingredients
		name = EVTOPTB_MNM_5110

		prestige = 25
		piety = -20
		destroy_selected_ingredient_1_and_2_effect = yes
		set_character_flag = medium_defense_against_dark_forces
	}

	option = { # I'll cover my quarters in these things!
		name = EVTOPTC_MNM_5110

		prestige = 35
		piety = -30
		destroy_all_ingredients_effect = yes
		set_character_flag = large_defense_against_dark_forces

		ai_chance = { factor = 10 }
	}

	option = { # this is paranoia!
		name = EVTOPTD_MNM_5110

		ai_chance = { factor = 0 }
	}

	after = {
		remove_selection_of_ingredients_effect = yes
	}
}