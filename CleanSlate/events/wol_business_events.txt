###########################################
#										#
# Way of Life business events			#
#										#
# ID WoL.10000-WoL.10999				#
#										#
###########################################

# Written by Joel Hansson

namespace = WoL

# Fire events
character_event = {
	id = WoL.10000

	hide_window = yes
	is_triggered_only = yes # on_focus_pulse, random_events

	only_playable = yes
	only_capable = yes
	prisoner = no
	in_command = no

	trigger = {
		has_focus = focus_business
		demesne_size >= 1
		is_inaccessible_trigger = no
		NOT = { trait = infirm }
	}

	immediate = {
		random_list = {
			15 = {
				trigger = {
					NOT = { trait = stressed }
				}

				character_event = { id = WoL.10401 }
			}

			30 = {
				trigger = {
					any_demesne_province = {
						owned_by = PREV

						any_province_holding = {
							holding_type = city

							holder_scope = {
								is_vassal_or_below_of = ROOT
							}
						}

						NOR = {
							has_province_modifier = artisan_workshop
							has_province_flag = workshop_construction
						}
					}
				}

				random_demesne_province = {
					limit = {
						owned_by = PREV

						any_province_holding = {
							holding_type = city

							holder_scope = {
								is_vassal_or_below_of = ROOT
							}
						}

						NOR = {
							has_province_modifier = artisan_workshop
							has_province_flag = workshop_construction
						}
					}

					set_province_flag = workshop_construction
					save_event_target_as = artisan_province
				}

				character_event = { id = WoL.10440 }
			}

			30 = {
				trigger = {
					NOT = { has_character_modifier = sell_land_cd }

					capital_scope = {
						NOT = { has_province_modifier = sold_off_land }

						any_province_holding = {
							holding_type = city

							holder_scope = {
								is_vassal_or_below_of = ROOT
							}
						}
					}
				}

				add_character_modifier = {
					name = sell_land_cd
					years = 5
					hidden = yes
				}

				capital_scope = {
					random_province_holding = {
						limit = {
							holding_type = city

							holder_scope = {
								is_vassal_or_below_of = ROOT
							}
						}

						holder_scope = {
							save_event_target_as = rich_mayor
						}
					}
				}

				character_event = { id = WoL.10430 }
			}

			30 = {
				trigger = {
					NOT = { has_character_modifier = wol_debase_timer }
				}

				character_event = { id = WoL.10420 }
			}

			30 = {
				trigger = {
					year >= 1000

					any_demesne_province = {
						owned_by = PREV

						any_province_holding = {
							holding_type = city

							holder_scope = {
								is_vassal_or_below_of = ROOT
							}
						}

						NOR = {
							has_province_modifier = carpenters_guild
							has_province_modifier = outlawed_guild
						}
					}
				}

				random_demesne_province = {
					limit = {
						owned_by = PREV

						any_province_holding = {
							holding_type = city

							holder_scope = {
								is_vassal_or_below_of = ROOT
							}
						}

						NOR = {
							has_province_modifier = carpenters_guild
							has_province_modifier = outlawed_guild
						}
					}

					save_event_target_as = carpenters_province
				}

				long_character_event = { id = WoL.10410 }
			}

			30 = {
				trigger = {
					has_character_modifier = trader
					lifestyle_traits < 1
					is_tribal = no
					is_nomadic = no

					NOR = {
						has_character_flag = hedge_maze
						has_character_flag = tower_start
						has_character_flag = tower_end
					}
				}

				character_event = { id = WoL.10200 }
			}

			30 = {
				trigger = {
					has_character_modifier = trader
					lifestyle_traits < 1

					NOR = {
						has_character_flag = hedge_maze
						has_character_flag = maze_end
						has_character_flag = tower_start
					}
				}

				character_event = { id = WoL.10300 }
			}

			30 = {
				trigger = {
					job_treasurer = { always = yes }
					NOT = { has_character_flag = est_trade_route }

					any_independent_ruler = {
						is_adult = yes
						ai = yes
						mercenary = no
						holy_order = no
						is_incapable = no
						prisoner = no

						NOR = {
							is_rival = ROOT
							is_liege_or_above_of = ROOT
						}
					}
				}

				mult_modifier = {
					factor = 0.1
					has_character_flag = trade_route_progress
				}

				job_treasurer = {
					save_event_target_as = steward
					character_event = { id = WoL.10101 }
				}
			}

			1 = { } # No event
		}
	}
}

### Trade route for exotic goods
# Start of chain (Steward)
character_event = {
	id = WoL.10101
	desc = EVTDESC_WOL_10101
	picture = GFX_evt_council
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10101

		FROM = {
			character_event = { id = WoL.10102 }
		}
	}

	option = {
		name = EVTOPTB_WOL_10101

		ai_chance = { factor = 0 }
	}
}

# Steward presents an opportunity
character_event = {
	id = WoL.10102
	desc = EVTDESC_WOL_10102
	picture = GFX_evt_council
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10102

		set_character_flag = trade_route_progress

		if = {
			limit = {
				capital_scope = {
					OR = {
						region = world_steppe
						region = world_persia
					}
				}
			}

			set_character_flag = trade_is_land
		}

		character_event = { id = WoL.10103 }
	}

	option = {
		name = EVTOPTB_WOL_10102

		clr_character_flag = trade_route_progress
	}
}

# Setting up a trade route
character_event = {
	id = WoL.10103
	border = GFX_event_normal_frame_economy

	desc = {
		text = EVTDESC_WOL_10103
		picture = GFX_evt_merchant_caravan
		trigger = { has_character_flag = trade_is_land }
	}
	desc = {
		text = EVTDESC_WOL_10104
		picture = GFX_evt_busy_trading_dock_republic
		trigger = { NOT = { has_character_flag = trade_is_land } }
	}

	is_triggered_only = yes

	option = { # Hire crew
		name = {
			text = EVTOPTA_WOL_10103
			trigger = { has_character_flag = trade_is_land }
		}
		name = {
			text = EVTOPTA_WOL_10104
			trigger = { NOT = { has_character_flag = trade_is_land } }
		}

		scaled_wealth = {
			value = -1
			min = -25
			max = -200
		}

		character_event = {
			id = WoL.10105
			days = 3
		}
	}

	option = { # Hire bandits to steal ship/carrying animals
		name = {
			text = EVTOPTB_WOL_10103
			trigger = { has_character_flag = trade_is_land }
		}
		name = {
			text = EVTOPTB_WOL_10104
			trigger = { NOT = { has_character_flag = trade_is_land } }
		}

		set_character_flag = trade_bandits

		scaled_wealth = {
			value = -0.4
			min = -10
			max = -80
		}

		add_trait_fully_silently_arbitrary_effect = yes

		hidden_effect = {
			random_list = {
				20 = {
					mult_modifier = {
						factor = 0.7
						intrigue >= 8
					}

					mult_modifier = {
						factor = 0.7
						intrigue >= 11
					}

					mult_modifier = {
						factor = 0.7
						intrigue >= 14
					}

					set_character_flag = trade_bandits_fail
				}

				80 = { }
			}
		}

		character_event = {
			id = WoL.10105
			days = 3
		}
	}

	option = { # This is too expensive
		name = {
			text = EVTOPTC_WOL_10103
			trigger = { has_character_flag = trade_is_land }
		}
		name = {
			text = EVTOPTC_WOL_10104
			trigger = { NOT = { has_character_flag = trade_is_land } }
		}

		clr_character_flag = trade_route_progress
	}
}

# Clergy wants to come along and can finance some of the costs ## might be angered/get in trouble later
character_event = {
	id = WoL.10105
	desc = EVTDESC_WOL_10105
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10105

		scaled_wealth = {
			value = 0.4
			min = 5
			max = 80
		}

		set_character_flag = trade_priest

		if = {
			limit = { has_character_flag = trade_bandits_fail }

			character_event = {
				id = WoL.10110
				days = 7
			}
		}

		else = {
			character_event = {
				id = WoL.10111
				days = 14
			}

			hidden_effect = {
				random = {
					chance = 50

					random_independent_ruler = {
						limit = {
							is_merchant_republic = yes
							is_within_diplo_range = ROOT
						}

						character_event = { id = WoL.10107 }
					}
				}
			}
		}
	}

	option = {
		name = EVTOPTB_WOL_10105

		any_vassal = {
			show_scope_change = no

			limit = {
				is_priest = yes
				religion = ROOT
			}

			opinion = {
				name = opinion_disappointed
				who = ROOT
				years = 5
			}
		}

		if = {
			limit = { has_character_flag = trade_bandits_fail }

			character_event = {
				id = WoL.10110
				days = 7
			}
		}
		else = {
			character_event = {
				id = WoL.10111
				days = 7
			}
		}
	}
}

# Clergy annoyed with bandits
character_event = {
	id = WoL.10106
	desc = EVTDESC_WOL_10106
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10106

		piety = -15
	}

	option = {
		name = EVTOPTB_WOL_10106
		tooltip_info = diplomacy

		trigger = { diplomacy >= 12 }
	}
}

# Doge responds to venture
character_event = {
	id = WoL.10107
	desc = EVTDESC_WOL_10107
	picture = GFX_evt_doge_republic
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = { # Demand compensation
		name = EVTOPTA_WOL_10107

		FROM = {
			show_scope_change = no

			opinion = {
				name = opinion_irritated
				who = ROOT
				years = 3
			}

			letter_event = { id = WoL.10108 }
		}
	}

	option = { # Never mind
		name = EVTOPTB_WOL_10107
	}
}

# Nearby Doge angered by trade competition
letter_event = {
	id = WoL.10108
	desc = EVTDESC_WOL_10108

	is_triggered_only = yes

	option = { # Monetary compensation
		name = EVTOPTA_WOL_10108

		wealth = -50

		FROM = {
			show_scope_change = no

			set_character_flag = trade_compensation

			letter_event = {
				id = WoL.10109
				days = 3
			}

			opinion = {
				name = opinion_happy
				who = ROOT
				years = 5
			}
		}
	}

	option = { # Refuse
		name = EVTOPTB_WOL_10108

		FROM = {
			show_scope_change = no

			letter_event = {
				id = WoL.10109
				days = 3
			}

			opinion = {
				name = opinion_angry
				who = ROOT
				years = 5
			}
		}
	}
}

# Doge gets response
letter_event = {
	id = WoL.10109

	desc = {
		text = EVTDESCA_WOL_10109
		trigger = { has_character_flag = trade_compensation }
	}
	desc = {
		text = EVTDESCB_WOL_10109
		trigger = { NOT = { has_character_flag = trade_compensation } }
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10109

		trigger = { has_character_flag = trade_compensation }

		wealth = 50
	}

	option = {
		name = EVTOPTB_WOL_10109

		trigger = { NOT = { has_character_flag = trade_compensation } }
	}

	after = {
		clr_character_flag = trade_compensation
	}
}

# Bandits fail to steal ship/carrying animals
character_event = {
	id = WoL.10110
	picture = GFX_evt_bad_news
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	desc = {
		text = EVTDESCA_WOL_10110
		trigger = { has_character_flag = trade_is_land }
	}
	desc = {
		text = EVTDESCB_WOL_10110
		trigger = { NOT = { has_character_flag = trade_is_land } }
	}

	option = {
		name = EVTOPTA_WOL_10110

		prestige = -50
		clr_character_flag = trade_is_land
		character_event = { id = WoL.10128 }
	}
}

# Heading out
character_event = {
	id = WoL.10111
	desc = EVTDESC_WOL_10111
	picture = GFX_evt_market
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes
	hide_from = yes

	immediate = {
		random_independent_ruler = {
			limit = {
				ai = yes
				controls_religion = no
				is_adult = yes
				is_incapable = no
				mercenary = no
				holy_order = no
				prisoner = no

				primary_title = {
					is_landless_type_title = no
				}

				NOR = {
					is_rival = ROOT
					is_liege_or_above_of = ROOT
				}
			}

			preferred_limit = {
				NOT = { religion_group = ROOT }
				is_within_diplo_range = ROOT
			}

			preferred_limit = {
				NOT = { religion = ROOT }
				is_within_diplo_range = ROOT
			}

			preferred_limit = {
				NOT = { religion_group = ROOT }
			}

			preferred_limit = {
				NOT = { religion = ROOT }
			}

			preferred_limit = {
				is_within_diplo_range = ROOT
			}

			save_event_target_as = foreign_ruler
		}
	}

	option = {
		name = EVTOPTA_WOL_10111

		if = {
			limit = {
				has_character_flag = trade_bandits
				has_character_flag = trade_priest
			}

			character_event = {
				id = WoL.10106
				days = 10
			}
		}

		if = {
			limit = {
				event_target:foreign_ruler = { always = yes }
			}

			character_event = {
				id = WoL.10114
				days = 35
				random = 15
			}
		}
		else = {
			character_event = {
				id = WoL.10999
				days = 35
				random = 15
			}
		}
	}
}

# Failed to find target
character_event = {
	id = WoL.10999
	desc = EVTDESC_WOL_10999
	picture = GFX_evt_market
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10999

		log = "WoL.10112: [Root.GetTitledName] failed to find a suitable trade target."
		clr_character_flag = trade_bandits
		clr_character_flag = trade_is_land
		clr_character_flag = trade_route_progress
		clr_character_flag = trade_priest
		clr_character_flag = trade_friend
		clr_character_flag = trade_success
		clr_character_flag = trade_rival
	}
}

# Arriving at destination - present a gift?
character_event = {
	id = WoL.10114
	desc = EVTDESC_WOL_10114
	picture = GFX_evt_market
	border = GFX_event_normal_frame_economy
	portrait = event_target:foreign_ruler

	is_triggered_only = yes

	option = {
		name = { # A dozen of strong horses
			text = EVTOPTA_WOL_10114_HORSES
			trigger = {
				OR = {
					religion_group = christian
					religion_group = zoroastrian_group
					religion_group = jewish_group
					religion = taoist
				}
			}
		}
		name = { # A dozen of sturdy camels
			text = EVTOPTA_WOL_10114_CAMELS
			trigger = { religion_group = muslim }
		}
		name = { # An elephant
			text = EVTOPTA_WOL_10114_ELEPHANT
			trigger = { has_dharmic_religion_trigger = yes }
		}
		name = { # A dozen of tough warriors
			text = EVTOPTA_WOL_10114_WARRIORS
			trigger = { religion_group = pagan_group }
		}

		wealth = -30

		reverse_opinion = {
			name = opinion_flattered # +25
			who = event_target:foreign_ruler
			years = 5
		}
	}

	option = {
		name = EVTOPTB_WOL_10114

		wealth = -15

		reverse_opinion = {
			name = opinion_fine_gift # +10
			who = event_target:foreign_ruler
			years = 3
		}
	}

	option = {
		name = EVTOPTC_WOL_10114

		wealth = -5
	}

	option = {
		name = EVTOPTD_WOL_10114

		reverse_opinion = {
			name = opinion_mildly_disappointed # -5
			who = event_target:foreign_ruler
			years = 3
		}
	}

	after = {
		character_event = {
			id = WoL.10116
			days = 7
		}
	}
}

# Cultural differences
character_event = {
	id = WoL.10116
	desc = EVTDESC_WOL_10116
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_economy
	portrait = event_target:foreign_ruler

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10116
		tooltip_info = learning

		trigger = { learning >= 10 }
	}

	option = {
		name = EVTOPTB_WOL_10116

		reverse_opinion = {
			name = opinion_angry
			who = event_target:steward
			years = 1
		}
	}

	option = {
		name = EVTOPTC_WOL_10116

		reverse_opinion = {
			name = opinion_disrespecting_culture
			who = event_target:foreign_ruler
			years = 1
		}
	}

	after = {
		if = {
			limit = {
				has_character_flag = trade_priest
				NOT = { religion = event_target:foreign_ruler }
			}

			character_event = {
				id = WoL.10118
				days = 7
			}
		}
		else = {
			character_event = {
				id = WoL.10120
				days = 7
			}
		}
	}
}

# Clergy theological debate, endangering venture
character_event = {
	id = WoL.10118
	desc = EVTDESC_WOL_10118
	picture = GFX_evt_bishop_pagan_group
	border = GFX_event_normal_frame_economy
	portrait = event_target:foreign_ruler

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10118

		any_vassal = {
			show_scope_change = no

			limit = {
				is_priest = yes
				religion = ROOT
			}

			opinion = {
				name = opinion_angry
				who = ROOT
				years = 5
			}
		}

	}

	option = {
		name = EVTOPTB_WOL_10118
		tooltip_info = gregarious

		trigger = { trait = gregarious }
	}

	option = {
		name = {
			text = EVTOPTC_WOL_10118
			trigger = {
				religion_group = event_target:foreign_ruler
				NOT = { religion = event_target:foreign_ruler }
			}
		}
		name = {
			text = EVTOPTD_WOL_10118
			trigger = {
				NOT = { religion_group = event_target:foreign_ruler }
			}
		}

		random = {
			chance = 50
			add_trait_fully_zealous_effect = yes
		}

		reverse_opinion = {
			name = opinion_religious_quarrel
			who = event_target:foreign_ruler
			years = 1
		}
	}

	after = {
		character_event = {
			id = WoL.10120
			days = 7
		}
	}
}

# Foreign ruler responds
character_event = {
	id = WoL.10120
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_economy
	portrait = event_target:foreign_ruler

	is_triggered_only = yes

	immediate = {
		random_list = {
			30 = {
				trigger = {
					reverse_personal_opinion = {
						who = event_target:foreign_ruler
						value >= 0
					}
				}

				mult_modifier = {
					factor = 2

					reverse_personal_opinion = {
						who = event_target:foreign_ruler
						value >= 20
					}
				}

				mult_modifier = {
					factor = 2

					reverse_personal_opinion = {
						who = event_target:foreign_ruler
						value >= 40
					}
				}

				mult_modifier = {
					factor = 1.3
					stewardship >= 10
				}

				mult_modifier = {
					factor = 1.3
					stewardship >= 13
				}

				set_character_flag = trade_friend
			}

			30 = {
				mult_modifier = {
					factor = 1.3
					stewardship >= 10
				}

				mult_modifier = {
					factor = 1.3
					stewardship >= 13
				}

				reverse_opinion = {
					name = opinion_trade_partner
					who = event_target:foreign_ruler
					years = 10
				}

				set_character_flag = trade_success
			}

			30 = {
				trigger = {
					reverse_personal_opinion = {
						who = event_target:foreign_ruler
						value < -10
					}
				}

				mult_modifier = {
					factor = 2

					reverse_personal_opinion = {
						who = event_target:foreign_ruler
						value < -40
					}
				}

				mult_modifier = {
					factor = 2

					reverse_personal_opinion = {
						who = event_target:foreign_ruler
						value < -65
					}
				}

				set_character_flag = trade_rival
			}
		}
	}

	desc = {
		text = EVTDESCA_WOL_10120
		trigger = { has_character_flag = trade_friend }
	}
	desc = {
		text = EVTDESCB_WOL_10120
		trigger = { has_character_flag = trade_success }
	}
	desc = {
		text = EVTDESCC_WOL_10120
		trigger = { has_character_flag = trade_rival }
	}

	option = {
		name = EVTOPTA_WOL_10120

		trigger = { has_character_flag = trade_friend }

		add_friend = event_target:foreign_ruler

		random = {
			chance = 50

			character_event = {
				id = WoL.10123 # Learn about stewardship in foreign court
				days = 3
			}
		}

		character_event = {
			id = WoL.10125
			days = 7
		}
	}

	option = {
		name = EVTOPTB_WOL_10120

		trigger = { has_character_flag = trade_success }

		random = {
			chance = 50

			character_event = {
				id = WoL.10123 # Learn about stewardship in foreign court
				days = 3
			}
		}

		character_event = {
			id = WoL.10125
			days = 7
		}
	}

	option = {
		name = EVTOPTC_WOL_10120

		trigger = { has_character_flag = trade_rival }

		add_rival = event_target:foreign_ruler

		opinion = {
			name = grievously_offended
			who = event_target:foreign_ruler
			years = 10
		}

		hidden_effect = {
			reverse_opinion = {
				name = grievously_offended
				who = event_target:foreign_ruler
				years = 10
			}
		}

		character_event = {
			id = WoL.10128
			days = 5
		}
	}

	after = {
		clr_character_flag = trade_rival
		clr_character_flag = trade_success
		clr_character_flag = trade_friend
	}
}

# Learn stewardship in foreign court
character_event = {
	id = WoL.10123
	desc = EVTDESC_WOL_10123
	picture = GFX_evt_relaxed_ruler
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	trigger = {
		OR = {
			trait = fortune_builder
			trait = thrifty_clerk
			trait = indulgent_wastrel
		}
	}

	option = {
		name = EVTOPTA_WOL_10123

		trigger_switch = {
			on_trigger = trait

			indulgent_wastrel = {
				hidden_effect = { remove_trait = indulgent_wastrel }
				add_trait = thrifty_clerk
			}

			thrifty_clerk = {
				hidden_effect = { remove_trait = thrifty_clerk }
				add_trait = fortune_builder
			}

			fortune_builder = {
				hidden_effect = { remove_trait = fortune_builder }
				add_trait = midas_touched
			}
		}
	}
}

# Successful expedition
character_event = {
	id = WoL.10125
	desc = EVTDESC_WOL_10125
	picture = GFX_evt_relaxed_ruler
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				ai = no
				is_ironman = yes
			}

			set_character_flag = achievement_were_in_business
		}
	}

	option = {
		name = EVTOPTA_WOL_10125

		scaled_wealth = {
			value = 2.5
			min = 100
			max = 500
		}

		prestige = 150
		set_character_flag = est_trade_route
		clr_character_flag = trade_route_progress
		clr_character_flag = trade_priest

		capital_scope = {
			show_scope_change = no

			hidden_effect = {
				remove_province_modifier = trade_route
			}

			add_province_modifier = {
				name = trade_route
				years = 30
			}

			hidden_effect = {
				add_province_modifier = {
					name = refresh_trade_route_timer
					years = 25
					hidden = yes
				}

				province_event = {
					id = WoL.10130
					years = 28
				}
			}

			if = {
				limit = { has_dlc = "Reapers" }

				custom_tooltip = {
					text = capital_prospers_custom_tooltip

					change_variable = {
						which = prosperity_value
						value = 6
					}
				}
			}
		}

		if = {
			limit = {
				NOR = {
					trait = architect
					trait = gardener
				}
			}

			hidden_effect = {
				remove_character_modifier = aspiring_trader
			}

			add_character_modifier = {
				name = trader
				duration = -1
			}
		}

		add_character_modifier = {
			name = business_contacts
			duration = -1
		}

		character_event = {
			id = WoL.10126
			days = 5
		}
	}
}

# Reward steward?
character_event = {
	id = WoL.10126
	desc = EVTDESC_WOL_10126
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10126

		transfer_scaled_wealth = {
			to = event_target:steward
			value = 0.5
			max = 200
		}

		event_target:steward = {
			show_scope_change = no

			# set_character_flag = trade_rewarded
			# character_event = { id = WoL.10127 }

			opinion = {
				name = opinion_grateful
				who = ROOT
				years = 5
			}
		}
	}

	option = {
		name = EVTOPTB_WOL_10126

		random = {
			chance = 50
			add_trait_fully_greedy_effect = yes
		}

		event_target:steward = {
			show_scope_change = no

			# character_event = { id = WoL.10127 }

			opinion = {
				name = opinion_disappointed
				who = ROOT
				years = 5
			}
		}
	}
}

# Steward conclusion
# character_event = {
#	id = WoL.10127
#
#	is_triggered_only = yes
#	hide_window = yes # TODO: Fix if time
#
#	option = {
#		trigger = { has_character_flag = trade_rewarded }
#
#		tooltip = {
#			transfer_scaled_wealth = {
#				from = FROM
#				value = 0.4
#			}
#		}
#
#		clr_character_flag = trade_rewarded
#	}
#
#	option = {
#		trigger = {
#			NOT = { has_character_flag = trade_rewarded }
#		}
#	}
# }

# Failed expedition
character_event = {
	id = WoL.10128
	desc = EVTDESC_WOL_10128
	picture = GFX_evt_stressed_ruler
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = { # At least I learned something
		name = EVTOPTA_WOL_10128

		if = {
			limit = {
				NOR = {
					has_character_modifier = trader
					trait = architect
					trait = gardener
				}
			}

			if = {
				limit = { has_character_modifier = aspiring_trader }

				hidden_effect = {
					remove_character_modifier = aspiring_trader
				}

				add_character_modifier = {
					name = trader
					duration = -1
				}
			}
			else = {
				add_character_modifier = {
					name = aspiring_trader
					duration = -1
				}
			}
		}

		clr_character_flag = trade_bandits_fail
		clr_character_flag = trade_bandits
		clr_character_flag = trade_is_land
		clr_character_flag = trade_priest
		clr_character_flag = trade_friend
		clr_character_flag = trade_success
		clr_character_flag = trade_rival
	}
}

# Refresh trade route
province_event = {
	id = WoL.10130
	border = GFX_event_normal_frame_economy

	desc = {
		text = EVTDESC_WOL_10130
		picture = GFX_evt_merchant_caravan
		trigger = {
			OR = {
				region = world_steppe
				region = world_persia
				region = world_himalayas
			}
		}
	}
	desc = {
		text = EVTDESC_WOL_10131
		picture = GFX_evt_busy_trading_dock_republic
		trigger = {
			NOR = {
				region = world_steppe
				region = world_persia
				region = world_himalayas
			}
		}
	}

	is_triggered_only = yes

	trigger = {
		has_province_modifier = trade_route
		NOT = { has_province_modifier = refresh_trade_route_timer }
	}

	option = {
		name = EVTOPTA_WOL_10130

		owner = {
			show_scope_change = no

			scaled_wealth = {
				value = -2.5
				max = -200
			}
		}

		hidden_effect = {
			remove_province_modifier = trade_route
		}

		add_province_modifier = {
			name = trade_route
			years = 30
		}

		hidden_effect = {
			add_province_modifier = {
				name = refresh_trade_route_timer
				years = 25
				hidden = yes
			}

			province_event = {
				id = WoL.10130
				years = 28
			}
		}
	}

	option = {
		name = EVTOPTB_WOL_10130

		owner = {
			show_scope_change = no

			prestige = -25
		}

		ai_chance = { factor = 3 }
	}
}

### Build a tower
# Undertake the project
character_event = {
	id = WoL.10200
	desc = EVTDESC_WOL_10200
	picture = GFX_evt_relaxed_ruler
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = { # I'll build a tower
		name = EVTOPTA_WOL_10200

		set_character_flag = tower_start

		character_event = {
			id = WoL.10201
			days = 7
			tooltip = tower_start
		}
	}

	option = { # Nope
		name = EVTOPTB_WOL_10200
	}
}

# Find a mason to do the stone details
character_event = {
	id = WoL.10201
	desc = EVTDESC_WOL_10201
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = { # I know a craftsman who has the skill
		name = EVTOPTA_WOL_10201

		scaled_wealth = -1

		create_character = {
			random_traits = no
			dynasty = none
			religion = ROOT
			culture = capital_scope
			age = 28
			add_trait = thrifty_clerk
			add_trait = quick
			add_trait = diligent
			add_trait = lustful
			add_trait = cynical
			add_trait = gregarious

			attributes = {
				diplomacy = 9
				martial = 1
				stewardship = 6
				intrigue = 4
				learning = 6
			}
		}

		new_character = {
			set_defacto_liege = ROOT
			save_event_target_as = stonemason
		}
	}

	option = { # A street boy will do fine
		name = EVTOPTB_WOL_10201
		tooltip_info = greedy

		trigger = { trait = greedy }

		hidden_effect = { } # for new random seed. Do not remove! CleanSlate: Why is this seed needed?

		scaled_wealth = -0.08

		create_character = {
			random_traits = no
			dynasty = none
			religion = capital_scope
			culture = capital_scope
			age = 17
			add_trait = indulgent_wastrel
			add_trait = humble
			add_trait = slothful
			add_trait = shy
			add_trait = trusting

			attributes = {
				diplomacy = 4
				martial = 5
				stewardship = 5
				intrigue = 6
				learning = 2
			}
		}

		new_character = {
			set_defacto_liege = ROOT
			save_event_target_as = stonemason
			set_character_flag = is_street_mason
		}

		set_character_flag = tower_street_mason
	}

	after = {
		character_event = {
			id = WoL.10202
			days = 7
		}
	}
}

# Burghers react to tower building
character_event = {
	id = WoL.10202
	desc = EVTDESC_WOL_10202
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_economy
	portrait = event_target:stonemason

	is_triggered_only = yes
	hide_new = yes

	immediate = {
		while = {
			count = 4

			random_vassal = {
				limit = {
					is_republic = yes
					is_adult = yes
					is_incapable = no
					prisoner = no
					NOT = { has_character_flag = selected_vassal }
				}

				set_character_flag = selected_vassal
			}
		}
	}

	option = {
		name = EVTOPTA_WOL_10202

		any_vassal = {
			show_scope_change = no

			limit = { has_character_flag = selected_vassal }

			opinion = {
				name = opinion_impressed
				years = 2
				who = ROOT
			}
		}

		character_event = {
			id = WoL.10204
			days = 20
		}
	}
}

# More funding to lay out the plan
character_event = {
	id = WoL.10204
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_economy
	portrait = event_target:stonemason

	is_triggered_only = yes
	hide_new = yes

	desc = {
		text = EVTDESCA_WOL_10204
		trigger = { has_character_flag = tower_street_mason }
	}
	desc = {
		text = EVTDESCB_WOL_10204
		trigger = { NOT = { has_character_flag = tower_street_mason } }
	}

	option = {
		name = EVTOPTA_WOL_10204

		trigger = {
			NOT = { has_character_flag = tower_street_mason }
		}

		scaled_wealth = -1
	}

	option = { # You're just using the money on lustful adventures
		name = EVTOPTB_WOL_10204
		tooltip_info = intrigue

		trigger = {
			intrigue >= 10
			NOT = { has_character_flag = tower_street_mason }
		}
	}

	option = {
		name = EVTOPTC_WOL_10204

		trigger = { has_character_flag = tower_street_mason }

		scaled_wealth = -0.08
	}

	option = {
		name = EVTOPTD_WOL_10204

		trigger = { has_character_flag = tower_street_mason }

		random = {
			chance = 50
			add_trait_fully_cruel_effect = yes
		}
	}

	after = {
		character_event = {
			id = WoL.10205
			days = 7
		}
	}
}

# Fix building materials
character_event = {
	id = WoL.10205
	desc = EVTDESC_WOL_10205
	picture = GFX_evt_stressed_ruler
	border = GFX_event_normal_frame_economy
	portrait = event_target:stonemason

	is_triggered_only = yes
	hide_new = yes

	option = { # Import the stone
		name = EVTOPTA_WOL_10205

		scaled_wealth = -1
	}

	option = { # Construct a Quarry
		name = EVTOPTB_WOL_10205

		scaled_wealth = -3

		capital_scope = {
			show_scope_change = no

			hidden_effect = {
				remove_province_modifier = stone_quarry
			}

			province_event = {
				id = WoL.10207
				years = 80
			}

			add_province_modifier = {
				name = stone_quarry
				years = 80
			}

			if = {
				limit = { has_dlc = "Reapers" }

				custom_tooltip = {
					text = capital_prospers_custom_tooltip

					change_variable = {
						which = prosperity_value
						value = 6
					}
				}
			}
		}
	}

	option = { # Recycle old building materials
		name = EVTOPTC_WOL_10205
		tooltip_info = greedy

		trigger = { trait = greedy }

		wealth = -10
	}

	after = {
		character_event = {
			id = WoL.10206
			months = 2
		}
	}
}

# Accident at the construction site
character_event = {
	id = WoL.10206
	desc = EVTDESC_WOL_10206
	picture = GFX_evt_peasants
	border = GFX_event_normal_frame_economy
	portrait = event_target:stonemason

	is_triggered_only = yes
	hide_new = yes

	option = {
		name = EVTOPTA_WOL_10206

		capital_scope = {
			show_scope_change = no

			add_province_modifier = {
				name = construction_accident
				years = 1
			}
		}

		add_trait_fully_silently_cruel_effect = yes

		character_event = {
			id = WoL.10208
			months = 4
		}
	}

	option = {
		name = EVTOPTB_WOL_10206

		scaled_wealth = -0.5

		character_event = {
			id = WoL.10208
			months = 10
		}
	}
}

# Quarry operations shut down notification
province_event = {
	id = WoL.10207
	desc = EVTDESC_WOL_10207
	picture = GFX_evt_construction_site
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10207

		remove_province_modifier = stone_quarry
	}
}

# Select bishop
character_event = {
	id = WoL.10208

	is_triggered_only = yes
	hide_window = yes

	immediate = {
		if = {
			limit = {
				NOR = {
					religion_group = indian_group
					religion_group = pagan_group
				}

				any_vassal = {
					is_priest = yes
					religion = ROOT
					ai = yes
				}
			}

			random_vassal = {
				limit = {
					is_priest = yes
					religion = ROOT
					ai = yes
				}

				save_event_target_as = responding_bishop
			}

			character_event = { id = WoL.10210 }
		}
		else = {
			long_character_event = {
				id = WoL.10216
				months = 2
			}
		}
	}
}

# Bishop upset that you're trying to cheat your way into heaven
character_event = {
	id = WoL.10210
	desc = EVTDESC_WOL_10210
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_economy
	portrait = event_target:responding_bishop

	is_triggered_only = yes
	hide_new = yes

	option = {
		name = EVTOPTA_WOL_10210

		reverse_opinion = {
			name = opinion_annoyed
			who = event_target:responding_bishop
			years = 1
		}

		long_character_event = {
			id = WoL.10216
			months = 2
		}
	}

	option = { # I guess we can cut some meters of the top of the tower
		name = EVTOPTB_WOL_10210

		prestige = -50

		reverse_opinion = {
			name = opinion_happy
			who = event_target:responding_bishop
			years = 20
		}

		rightful_religious_head_scope = {
			show_scope_change = no

			opinion = {
				name = opinion_happy
				who = ROOT
				years = 20
			}
		}

		long_character_event = {
			id = WoL.10216
			months = 2
		}
	}

	option = { # I'm just following the words of 'God'
		name = EVTOPTC_WOL_10210
		tooltip_info = possessed

		trigger = { trait = possessed }

		add_trait_fully_silently_zealous_effect = yes

		rightful_religious_head_scope = {
			show_scope_change = no

			opinion = {
				name = opinion_religious_agenda
				who = ROOT
				years = 5
			}
		}

		long_character_event = {
			id = WoL.10216
			months = 2
		}
	}

	option = { # He's onto me. He must disappear.
		name = EVTOPTD_WOL_10210
		tooltip_info = lunatic

		trigger = { trait = lunatic }

		character_event = {
			id = WoL.10212
			days = 3
			tooltip = EVTTOOLTIPWOL10210
		}
	}
}

# Attempt to show bishop the top of the tower followed by the low of the ground
character_event = {
	id = WoL.10212
	desc = EVTDESC_WOL_10212
	picture = GFX_evt_lunatic
	border = GFX_event_normal_frame_economy
	portrait = event_target:responding_bishop

	is_triggered_only = yes
	hide_new = yes

	option = {
		name = EVTOPTA_WOL_10212

		custom_tooltip = {
			text = EVTTOOLTIPWOL10212

			random_list = {
				10 = { character_event = { id = WoL.10214 } }
				90 = { character_event = { id = WoL.10215 } }
			}
		}
	}
}

# Bishop randomly dodges and you fall
character_event = {
	id = WoL.10214
	desc = EVTDESC_WOL_10214
	picture = GFX_evt_bad_news
	border = GFX_event_normal_frame_economy
	portrait = event_target:responding_bishop

	is_triggered_only = yes
	hide_new = yes

	immediate = {
		if = {
			limit = { multiplayer = yes }
			death = { death_reason = death_accident_fall }
		}
	}

	option = {
		name = EVTOPTA_WOL_10214

		if = {
			limit = { multiplayer = no }
			death = { death_reason = death_accident_fall }
		}
		else = {
			tooltip = {
				death = { death_reason = death_accident_fall }
			}
		}
	}
}

# Bishop falls
character_event = {
	id = WoL.10215
	desc = EVTDESC_WOL_10215
	picture = GFX_evt_drunk
	border = GFX_event_normal_frame_economy
	portrait = event_target:responding_bishop

	is_triggered_only = yes
	hide_new = yes

	immediate = {
		event_target:responding_bishop = {
			death = {
				death_reason = death_murder_unknown_fall
				killer = ROOT
			}
		}
	}

	option = {
		name = EVTOPTA_WOL_10215

		tooltip = {
			event_target:responding_bishop = {
				show_scope_change = no

				death = {
					death_reason = death_murder_unknown_fall
					killer = ROOT
				}
			}
		}

		long_character_event = {
			id = WoL.10216
			days = 57
		}
	}
}

# Construction complete
long_character_event = {
	id = WoL.10216
	desc = EVTDESC_WOL_10216
	picture = GFX_evt_powerful_tower
	border = GFX_event_long_frame_economy
	portrait = event_target:stonemason

	is_triggered_only = yes
	hide_new = yes

	immediate = {
		save_event_target_as = tower_founder
		set_character_flag = is_tower_founder
		clr_character_flag = tower_start
		set_character_flag = tower_end
	}

	option = {
		name = EVTOPTA_WOL_10216

		prestige = 100
		add_trait = architect
		remove_character_modifier = trader
	}

	option = {
		name = EVTOPTB_WOL_10216

		prestige = 250
	}

	after = {
		add_character_modifier = {
			name = great_tower
			duration = -1
		}

		if = {
			limit = { random < 2 } # 2%

			if = {
				limit = {
					capital_scope = {
						OR = {
							has_province_modifier = leaning_tower
							has_province_modifier = leaning_tower_bad
						}
					}
				}

				random_demesne_province = {
					limit = {
						owned_by = PREV

						NOR = {
							has_province_modifier = leaning_tower
							has_province_modifier = leaning_tower_bad
						}
					}

					province_event = {
						id = WoL.10217
						years = 10
					}
				}
			}

			else = {
				capital_scope = {
					province_event = {
						id = WoL.10217
						years = 10
					}
				}
			}
		}
		else = {
			character_event = { id = WoL.10222 } # Clear flags
		}
	}
}

# Tower beginning to lean
province_event = {
	id = WoL.10217
	picture = GFX_evt_bad_news
	border = GFX_event_normal_frame_economy

	desc = {
		text = EVTDESCA_WOL_10217
		trigger = { owned_by = event_target:tower_founder }
	}
	desc = {
		text = EVTDESCB_WOL_10217
		trigger = {
			NOT = { owned_by = event_target:tower_founder }
		}
	}

	is_triggered_only = yes
	hide_new = yes
	hide_from = yes

	trigger = {
		owner = { ai = no }
	}

	option = { # Blame the stonemason
		name = EVTOPTA_WOL_10217

		trigger = {
			owner = {
				has_character_flag = is_tower_founder
				is_liege_of = event_target:stonemason
			}
		}

		owner = {
			show_scope_change = no

			reverse_imprison = event_target:stonemason
			set_character_flag = tower_blamed_mason
			remove_character_modifier = great_tower

			character_event = {
				id = WoL.10218
				months = 1
			}
		}

		add_province_modifier = {
			name = leaning_tower_bad
			duration = -1
		}
	}

	option = { # Blame the workers
		name = EVTOPTB_WOL_10217

		trigger = {
			owner = { has_character_flag = is_tower_founder }
		}

		add_province_modifier = {
			name = peasant_unrest
			years = 1
		}

		owner = {
			hidden_effect = {
				remove_character_modifier = great_tower
			}

			character_event = {
				id = WoL.10218
				months = 1
			}
		}

		add_province_modifier = {
			name = leaning_tower_bad
			duration = -1
		}
	}

	option = { # Take the blame yourself
		name = EVTOPTC_WOL_10217

		trigger = {
			owner = { has_character_flag = is_tower_founder }
		}

		owner = {
			show_scope_change = no

			if = {
				limit = { trait = proud }
				prestige = -100
			}
			else = {
				prestige = -50
			}

			hidden_effect = {
				remove_character_modifier = great_tower
			}

			character_event = {
				id = WoL.10218
				months = 1
			}
		}

		add_province_modifier = {
			name = leaning_tower_bad
			duration = -1
		}
	}

	option = { # How unfortunate
		name = EVTOPTD_WOL_10217

		trigger = {
			owner = {
				NOT = { has_character_flag = is_tower_founder }
			}
		}

		add_province_modifier = {
			name = leaning_tower_bad
			duration = -1
		}

		owner = {
			character_event = {
				id = WoL.10218
				months = 1
			}
		}
	}
}

# Save the tower effort
character_event = {
	id = WoL.10218
	desc = EVTDESC_WOL_10218
	picture = GFX_evt_leaning_tower
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes
	hide_new = yes
	hide_from = yes

	option = { # Major reconstruction effort
		name = EVTOPTA_WOL_10218

		scaled_wealth = -2

		random_list = {
			99 = {
				mult_modifier = {
					factor = 0.7
					has_character_flag = tower_street_mason
				}

				character_event = {
					id = WoL.10219
					days = 10
					tooltip = tower_stands
				}
			}

			1 = {
				long_character_event = {
					id = WoL.10220
					days = 10
					tooltip = tower_topples
				}
			}
		}
	}

	option = { # Minor reconstruction effort
		name = EVTOPTB_WOL_10218

		scaled_wealth = -0.5

		random_list = {
			70 = {
				mult_modifier = {
					factor = 0.7
					has_character_flag = tower_street_mason
				}

				character_event = {
					id = WoL.10219
					days = 10
					tooltip = tower_stands
				}
			}

			30 = {
				long_character_event = {
					id = WoL.10220
					days = 10
					tooltip = tower_topples
				}
			}
		}
	}

	option = { # No reconstruction effort
		name = EVTOPTC_WOL_10218

		random_list = {
			50 = {
				mult_modifier = {
					factor = 0.7
					has_character_flag = tower_street_mason
				}

				character_event = {
					id = WoL.10219
					days = 10
					tooltip = tower_stands
				}
			}

			50 = {
				long_character_event = {
					id = WoL.10220
					days = 10
					tooltip = tower_topples
				}
			}
		}
	}
}

# Tower stands
character_event = {
	id = WoL.10219
	picture = GFX_evt_leaning_tower
	border = GFX_event_normal_frame_economy

	desc = {
		text = EVTDESCA_WOL_10219
		trigger = { character = event_target:tower_founder }
	}
	desc = {
		text = EVTDESCB_WOL_10219
		trigger = {
			NOT = { character = event_target:tower_founder }
		}
	}

	is_triggered_only = yes
	hide_new = yes
	hide_from = yes

	option = {
		name = EVTOPTA_WOL_10219

		long_character_event = {
			id = WoL.10221
			years = 3
		}
	}
}

# Tower topples
long_character_event = {
	id = WoL.10220
	desc = EVTDESC_WOL_10220
	picture = GFX_evt_bad_news
	border = GFX_event_long_frame_economy

	is_triggered_only = yes
	hide_new = yes
	hide_from = yes

	option = {
		name = EVTOPTA_WOL_10220

		FROMFROM = {
			show_scope_change = no

			remove_province_modifier = leaning_tower_bad

			add_province_modifier = {
				name = construction_accident
				years = 1
			}
		}

		prestige = -50
		character_event = { id = WoL.10222 } # Clear flags
	}
}

# Foreign dignitary visits the tower
long_character_event = {
	id = WoL.10221
	picture = GFX_evt_leaning_tower
	border = GFX_event_long_frame_economy

	desc = {
		text = EVTDESCA_WOL_10221
		trigger = {
			NOR = {
				has_character_flag = tower_blamed_mason
				has_character_flag = tower_street_mason
				event_target:stonemason = { has_character_flag = is_street_mason }
			}
		}
	}
	desc = {
		text = EVTDESCB_WOL_10221
		trigger = {
			NOT = { has_character_flag = tower_blamed_mason }

			OR = {
				has_character_flag = tower_street_mason
				event_target:stonemason = { has_character_flag = is_street_mason }
			}
		}
	}
	desc = {
		text = EVTDESCC_WOL_10221
		trigger = {
			has_character_flag = tower_blamed_mason

			NOR = {
				has_character_flag = tower_street_mason
				event_target:stonemason = { has_character_flag = is_street_mason }
			}
		}
	}
	desc = {
		text = EVTDESCD_WOL_10221
		trigger = {
			has_character_flag = tower_blamed_mason

			OR = {
				has_character_flag = tower_street_mason
				event_target:stonemason = { has_character_flag = is_street_mason }
			}
		}
	}

	is_triggered_only = yes
	hide_new = yes
	hide_from = yes

	option = { # Uhm. Of course I'll bring him to you from my, humm... court.
		name = EVTOPTA_WOL_10221

		trigger = {
			has_character_flag = tower_blamed_mason
			has_character_flag = is_tower_founder

			event_target:stonemason = {
				prisoner = yes
				vassal_of = ROOT
				host = { character = ROOT }
			}
		}

		event_target:stonemason = {
			show_scope_change = no

			imprison = no
			prestige = 500
		}

		scaled_wealth = 0.5
	}

	option = { # I'll bring him to you right away.
		name = EVTOPTB_WOL_10221

		trigger = {
			is_liege_of = event_target:stonemason
			has_character_flag = tower_blamed_mason
			has_character_flag = is_tower_founder
			NOT = { has_character_flag = tower_street_mason }
		}

		event_target:stonemason = {
			show_scope_change = no

			if = {
				limit = { prisoner = yes }
				imprison = no
			}

			prestige = 500
		}

		scaled_wealth = 0.5
	}

	option = { # He's not here. He's got more important matters
		name = EVTOPTC_WOL_10221

		trigger = {
			has_character_flag = tower_blamed_mason
			has_character_flag = is_tower_founder

			NOR = {
				has_character_flag = tower_street_mason
				is_liege_of = event_target:stonemason
			}
		}
	}

	option = { # You are talking to him right now.
		name = EVTOPTD_WOL_10221

		trigger = {
			has_character_flag = is_tower_founder
			NOT = { has_character_flag = tower_blamed_mason }
		}

		prestige = 250
	}

	option = { # It was constructed here before my rule.
		name = EVTOPTE_WOL_10221

		trigger = {
			NOT = { has_character_flag = is_tower_founder }
		}
	}

	option = { # Uhm. Of course I'll bring him to you from my, humm... court.
		name = EVTOPTF_WOL_10221

		trigger = {
			has_character_flag = tower_street_mason
			is_liege_of = event_target:stonemason
		}

		event_target:stonemason = {
			show_scope_change = no

			if = {
				limit = { prisoner = yes }
				imprison = no
			}

			prestige = 500

			if = {
				limit = { is_ruler = no }

				random_independent_ruler = {
					show_scope_change = no

					limit = {
						ai = yes
						demesne_size >= 2

						NOR = {
							character = ROOT
							is_liege_or_above_of = ROOT
						}
					}

					set_defacto_vassal = PREV

					random_demesne_title = {
						show_scope_change = no

						limit = {
							tier = COUNT

							location = {
								OR = {
									has_castle = yes
									has_temple = yes
									has_city = yes
									has_tribal = yes
								}
							}
						}

						grant_title = PREVPREV
					}
				}
			}
		}

		scaled_wealth = 0.5
	}

	option = { # He's not here. He's got more important matters
		name = EVTOPTG_WOL_10221

		trigger = {
			has_character_flag = tower_street_mason
			NOT = { is_liege_of = event_target:stonemason }
		}

	}

	after = {
		if = {
			limit = {
				NOT = { has_character_modifier = great_tower }
			}

			add_character_modifier = {
				name = great_tower
				duration = -1
			}
		}

		FROMFROMFROM = {
			show_scope_change = no

			hidden_effect = {
				remove_province_modifier = leaning_tower_bad
			}

			add_province_modifier = {
				name = leaning_tower
				duration = -1
			}
		}

		character_event = { id = WoL.10222 } # Clear flags
	}
}

# Flag-clearing
character_event = {
	id = WoL.10222

	is_triggered_only = yes
	hide_window = yes

	immediate = {
		clr_character_flag = tower_street_mason
		clr_character_flag = is_tower_founder
		clr_character_flag = tower_blamed_mason
	}
}

######## The hedge maze
# Start plantation
character_event = {
	id = WoL.10300
	desc = EVTDESC_WOL_10300
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = { # let's build a hedge maze
		name = EVTOPTA_WOL_10300

		set_character_flag = hedge_maze

		character_event = {
			id = WoL.10301
			days = 7
		}
	}

	option = { # nope
		name = EVTOPTB_WOL_10300
	}
}

# Cleaning out weeds
character_event = {
	id = WoL.10301
	desc = EVTDESC_WOL_10301
	picture = GFX_evt_son_asking_father
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = { # I'll do it myself
		name = EVTOPTA_WOL_10301

		if = {
			limit = { trait = slothful }
			remove_trait = slothful
		}
		else = {
			random = {
				chance = 50
				add_trait_diligent_effect = yes
			}
		}
	}

	option = { # Acquire a helping hand
		name = EVTOPTB_WOL_10301

		trigger = {
			any_courtier = {
				is_adult = yes
				in_command = no
				is_incapable = no
				prisoner = no

				NOR = {
					character = ROOT
					is_friend = ROOT
					is_rival = ROOT
					trait = infirm
				}
			}
		}

		random_courtier = {
			show_scope_change = no

			limit = {
				is_adult = yes
				in_command = no
				is_incapable = no
				prisoner = no

				NOR = {
					character = ROOT
					is_friend = ROOT
					is_rival = ROOT
					trait = infirm
				}
			}

			add_friend = ROOT
		}
	}

	option = { # Let the servants do it
		name = EVTOPTC_WOL_10301
		tooltip_info = slothful

		trigger = { trait = slothful }

		random = {
			chance = 50
			add_trait_fully_cruel_effect = yes
		}
	}

	after = {
		character_event = {
			id = WoL.10302
			days = 28
		}
	}
}

# Add statues
character_event = {
	id = WoL.10302
	desc = EVTDESC_WOL_10302
	picture = GFX_evt_castle_garden
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = { # of family members
		name = EVTOPTA_WOL_10302

		set_character_flag = maze_statues
		add_trait_fully_silently_proud_effect = yes

		custom_tooltip = {
			text = EVTTOOLTIPWOL10302

			hidden_effect = {
				any_dynasty_member = {
					opinion = {
						name = opinion_family_statues
						who = ROOT
						years = 150
					}
				}
			}
		}

		scaled_wealth = -0.6
	}

	option = {
		name = EVTOPTB_WOL_10302

		trigger = {
			NOR = {
				religion_group = muslim
				religion = iconoclast
			}
		}

		set_character_flag = maze_statues
		scaled_wealth = -0.6

		rightful_religious_head_scope = {
			show_scope_change = no

			opinion = {
				name = opinion_impressed
				who = ROOT
				years = 10
			}
		}

		random_vassal = {
			show_scope_change = no

			limit = {
				is_priest = yes
				religion = ROOT
				NOT = { rightful_religious_head = THIS }
			}

			opinion = {
				name = opinion_impressed
				who = ROOT
				years = 10
			}
		}
	}

	option = {
		name = EVTOPTC_WOL_10302

		prestige = -25
	}

	after = {
		character_event = {
			id = WoL.10303
			days = 28
		}
	}
}

# Build fountain
character_event = {
	id = WoL.10303
	desc = EVTDESC_WOL_10303
	picture = GFX_evt_castle_garden
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10303

		add_character_modifier = {
			name = maze_fountain
			duration = -1
		}

		scaled_wealth = -1
	}

	option = {
		name = EVTOPTB_WOL_10303

		trigger = {
			trigger_if = {
				limit = { religion_group = muslim }
				trait = decadent
			}
		}

		add_character_modifier = {
			name = maze_fountain_extravagant
			duration = -1
		}

		if = {
			limit = { trait = temperate }
			remove_trait = temperate
		}
		else = {
			random = {
				chance = 33
				add_trait_gluttonous_effect = yes
			}
		}

		scaled_wealth = -3
	}

	option = {
		name = EVTOPTC_WOL_10303
	}

	after = {
		character_event = {
			id = WoL.10304
			days = 28
		}
	}
}

# Import flowers
character_event = {
	id = WoL.10304
	desc = EVTDESC_WOL_10304
	picture = GFX_evt_castle_garden
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10304

		set_character_flag = maze_flowers
		scaled_wealth = -0.3
	}

	option = {
		name = EVTOPTB_WOL_10304
	}

	after = {
		character_event = {
			id = WoL.10305
			days = 28
		}
	}
}

# Build pavilion
character_event = {
	id = WoL.10305
	desc = EVTDESC_WOL_10305
	picture = GFX_evt_castle_garden
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10305

		add_character_modifier = {
			name = maze_pavilion
			duration = -1
		}

		scaled_wealth = -0.5
	}

	option = {
		name = EVTOPTB_WOL_10305
	}

	after = {
		character_event = {
			id = WoL.10306
			days = 28
		}
	}
}

# Completion
character_event = {
	id = WoL.10306
	picture = GFX_evt_castle_garden
	border = GFX_event_normal_frame_economy

	desc = {
		text = EVTDESCA_WOL_10306
		trigger = { has_character_flag = magnificent_maze }
	}
	desc = {
		text = EVTDESCB_WOL_10306
		trigger = { NOT = { has_character_flag = magnificent_maze } }
	}

	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				calc_true_if = {
					amount >= 3

					has_character_flag = maze_statues
					has_character_flag = maze_flowers
					has_character_modifier = maze_pavilion

					OR = {
						has_character_modifier = maze_fountain
						has_character_modifier = maze_fountain_extravagant
					}
				}
			}

			set_character_flag = magnificent_maze
		}

		clr_character_flag = maze_flowers
		clr_character_flag = maze_statues
		clr_character_flag = maze_start
		clr_character_flag = hedge_maze
	}

	option = {
		name = EVTOPTA_WOL_10306

		add_trait = gardener
		remove_character_modifier = trader
	}

	option = {
		name = EVTOPTB_WOL_10306

		if = {
			limit = {
				NOT = { has_character_modifier = aspiring_gardener }
			}

			add_character_modifier = {
				name = aspiring_gardener
				duration = -1
			}
		}
	}

	after = {
		if = {
			limit = { has_character_flag = magnificent_maze }

			add_character_modifier = {
				name = magnificent_maze
				duration = -1
			}

			clr_character_flag = magnificent_maze
		}

		set_character_flag = maze_end
	}
}

### Minor events

# Gain Stressed
character_event = {
	id = WoL.10401
	desc = EVTDESC_WOL_10401
	picture = GFX_evt_stressed_ruler
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10401

		add_trait = stressed
	}
}

### Support carpenter's guild
long_character_event = {
	id = WoL.10410
	desc = EVTDESC_WOL_10410
	picture = GFX_evt_construction_site
	border = GFX_event_long_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10410

		event_target:carpenters_province = {
			show_scope_change = no

			add_province_modifier = {
				name = carpenters_guild
				years = 10
			}

			if = {
				limit = { has_dlc = "Reapers" }

				custom_tooltip = {
					text = capital_prospers_custom_tooltip

					change_variable = {
						which = prosperity_value
						value = 6
					}
				}
			}
		}

		random = {
			chance = 50
			character_event = { id = WoL.10500 } # Level up
		}
	}

	option = {
		name = EVTOPTB_WOL_10410

		add_character_modifier = {
			name = despised_aristocrat
			duration = -1
		}

		event_target:carpenters_province = {
			show_scope_change = no

			add_province_modifier = {
				name = outlawed_guild # outlawed a guild
				years = 10
			}
		}

		random = {
			chance = 50
			character_event = { id = WoL.10500 } # Level up
		}
	}
}

### Coin minting - debasing / true coins
character_event = {
	id = WoL.10420
	desc = EVTDESC_WOL_10420
	picture = GFX_evt_spymaster
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	immediate = {
		add_character_modifier = {
			name = wol_debase_timer
			years = 2
			hidden = yes
		}
	}

	option = {
		name = EVTOPTA_WOL_10420

		wealth = -100
		prestige = 100

		random = {
			chance = 50

			character_event = {
				id = WoL.10500 # Level up
				days = 7
			}
		}
	}

	option = {
		name = EVTOPTB_WOL_10420

		wealth = 100
		prestige = 100
		add_trait_fully_silently_greedy_effect = yes

		random = {
			chance = 25
			add_trait_fully_deceitful_effect = yes
		}

		hidden_effect = {
			random_list = {
				75 = { } # nothing

				25 = { # discovered
					character_event = {
						id = WoL.10421
						years = 1
					}
				}
			}
		}

		random = {
			chance = 50

			character_event = {
				id = WoL.10500 # Level up
				days = 7
			}
		}
	}

	option = {
		name = EVTOPTC_WOL_10420
	}
}

character_event = {
	id = WoL.10421
	desc = EVTDESC_WOL_10421
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10421

		prestige = -200
	}
}

### Rich mayor wants to buy a bit of land
character_event = {
	id = WoL.10430
	desc = EVTDESC_WOL_10430
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_economy
	portrait = event_target:rich_mayor

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10430

		transfer_scaled_wealth = {
			from = event_target:rich_mayor
			value = 1
			min = 150
			max = 150
		}

		prestige = -25

		capital_scope = {
			show_scope_change = no

			add_province_modifier = {
				name = sold_off_land
				years = 10
			}
		}

		character_event = {
			id = WoL.10500 # Level up
			days = 7
		}
	}

	option = {
		name = EVTOPTB_WOL_10430
	}
}

### Artisan workshop
character_event = {
	id = WoL.10440
	desc = EVTDESC_WOL_10440
	picture = GFX_evt_construction_site
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10440

		wealth = -50

		custom_tooltip = {
			text = EVTTOOLTIPWOL10440

			random_list = {
				65 = {
					character_event = {
						id = WoL.10441
						years = 2
					}
				}

				35 = {
					character_event = {
						id = WoL.10442
						years = 2
					}
				}
			}
		}
	}

	option = {
		name = EVTOPTB_WOL_10440

		event_target:artisan_province = {
			clr_province_flag = workshop_construction
		}
	}
}

character_event = {
	id = WoL.10441
	desc = EVTDESC_WOL_10441
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10441

		wealth = 100

		event_target:artisan_province = {
			show_scope_change = no

			add_province_modifier = {
				name = artisan_workshop
				years = 10
			}

			clr_province_flag = workshop_construction

			if = {
				limit = { has_dlc = "Reapers" }

				custom_tooltip = {
					text = capital_prospers_custom_tooltip

					change_variable = {
						which = prosperity_value
						value = 6
					}
				}
			}
		}

		character_event = {
			id = WoL.10500 # Level up
			days = 7
		}
	}
}

character_event = {
	id = WoL.10442
	desc = EVTDESC_WOL_10442
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	option = {
		name = EVTOPTA_WOL_10442

		event_target:artisan_province = {
			clr_province_flag = workshop_construction
		}
	}
}

### Level up
character_event = {
	id = WoL.10500
	desc = EVTDESC_WOL_10500
	picture = GFX_evt_relaxed_ruler
	border = GFX_event_normal_frame_economy

	is_triggered_only = yes

	trigger = {
		NOR = {
			has_character_modifier = trader
			trait = gardener
			trait = architect
		}
	}

	option = {
		name = EVTOPTA_WOL_10500

		if = {
			limit = { has_character_modifier = aspiring_trader }

			hidden_effect = {
				remove_character_modifier = aspiring_trader
			}

			add_character_modifier = {
				name = trader
				duration = -1
			}
		}
		else = {
			add_character_modifier = {
				name = aspiring_trader
				duration = -1
			}
		}
	}
}