###########################################
#                                         #
# M&M Secret religious cults              #
#                                         #
# ID MNM.3000-MNM.3999                    #
#                                         #
###########################################

# IDs:
# 3100-3199 David	CleanSlate: no events with these ids exist
# 3200-3399 Milla	CleanSlate: 3260-3269 actually used by mnm_monastic_orders_events.txt
# 3400-3599 Mathilda
# 3600-3799 Drikus
# 3800-3948 Joel
# 3949-3997 Jakob

# Useful triggers
# is_christian_secret_religious_society_member_trigger
# is_muslim_secret_religious_society_member_trigger
# is_indian_secret_religious_society_member_trigger
# has_sympathy_for_true_religion_of_prev_trigger
# is_in_prevs_interesting_society_trigger

# Useful effects
# add_sympathy_for_prevs_true_religion_effect

namespace = MNM

# JOINING

# Sat in house of worship, approached by someone sat next to me
character_event = {
	id = MNM.3420
	desc = EVTDESC_MNM_3420
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # secret_religions_recruit, mnm_secret_religious_societies_decisions.txt; MNM.3411, MNM.10011
	hide_from = yes

	immediate = {
		# The inductor
		if = {
			limit = {
				NOT = { event_target:secret_religion_recruiter = { always = yes } }
			}

			random_society_member = { # backup
				limit = {
					is_in_prevs_interesting_society_trigger = yes
					ai = yes
				}

				preferred_limit = { # a courtier
					at_location = ROOT
				}

				preferred_limit = { # same realm
					same_realm = ROOT
				}

				preferred_limit = { # diplo range
					is_within_diplo_range = ROOT
				}

				save_event_target_as = secret_religion_recruiter
			}
		}

		save_event_target_as = secret_religion_recruit

		# For loc
		random_courtier_or_vassal = {
			preferred_limit = { is_priest = yes }

			preferred_limit = {
				trigger_if = {
					limit = { is_female = yes }
					ROOT = { religion_allows_female_temple_holders = yes }
				}
				trigger_else = {
					ROOT = { religion_allows_male_temple_holders = yes }
				}
			}

			save_event_target_as = spiritual_gender
		}

		random_list = {
			50 = {
				random_courtier_or_vassal = {
					limit = { is_female = yes }
					save_event_target_as = stranger
				}
			}

			50 = {
				random_courtier_or_vassal = {
					limit = { is_female = no }
					save_event_target_as = stranger
				}
			}
		}
	}

	# Follow them
	option = {
		name = EVTOPTA_MNM_3420

		custom_tooltip = { text = EVTOPTA_MNM_3420_TT }

		character_event = { id = MNM.3421 days = 3 }

		ai_chance = {
			factor = 100

			mult_modifier = {
				factor = 10
				trait = brave
			}
			mult_modifier = {
				factor = 5
				trait = just
			}
			mult_modifier = {
				factor = 5
				trait = trusting
			}
		}
	}

	# Remain seated
	option = {
		name = EVTOPTB_MNM_3420

		custom_tooltip = { text = EVTOPTB_MNM_3420_TT }

		# notification of failure
		event_target:secret_religion_recruiter = {
			character_event = {
				id = MNM.3423
				days = 1
			}
		}

		ai_chance = {
			factor = 10

			mult_modifier = {
				factor = 15
				trait = craven
			}
			mult_modifier = {
				factor = 5
				trait = paranoid
			}
			mult_modifier = {
				factor = 5
				trait = arbitrary
			}
			mult_modifier = {
				factor = 5
				trait = content
			}
		}
	}
}

# Came with them, they offered me to join
character_event = {
	id = MNM.3421
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_religion
	portrait = event_target:secret_religion_recruiter

	desc = {
		text = EVTDESC_MNM_3421_A
		trigger = {
			event_target:secret_religion_recruiter = {
				character_knows_prev_trigger = yes
			}
		}
	}
	 desc = {
		text = EVTDESC_MNM_3421_B
		trigger = {
			event_target:secret_religion_recruiter = {
				character_knows_prev_trigger = no
			}
		}
	}

	is_triggered_only = yes

	# Yes
	option = {
		name = EVTOPTA_MNM_3421

		custom_tooltip = { text = EVTOPTA_MNM_3421_TT }

		event_target:secret_religion_recruiter = {
			character_event = { id = MNM.3422 days = 1 }
		}

		ai_chance = {
			factor = 80

			trigger = { is_in_society = no } # Cannot join a new society when they're already in a society
		}
	}

	# No
	option = {
		name = EVTOPTB_MNM_3421

		custom_tooltip = { text = EVTOPTB_MNM_3421_TT }

		event_target:secret_religion_recruiter = {
			character_event = { id = MNM.3423 days = 1 } # notification of failure
		}

		ai_chance = { factor = 20 }
	}
}

# The interested party accepted
character_event = {
	id = MNM.3422
	desc = EVTDESC_MNM_3422
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		society = { save_event_target_as = recruiter_society }
	}

	option = {
		name = EVTOPTA_MNM_3422

		tooltip = {
			event_target:secret_religion_recruit = {
				show_scope_change = no

				join_society = event_target:recruiter_society
			}
		}

		 event_target:secret_religion_recruit = {
			character_event = { id = MNM.3424 days = 2 }
		}
	}
}

# The interested party rejected
character_event = {
	id = MNM.3423
	desc = EVTDESC_MNM_3423
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_MNM_3423
	}
}

# Confirmation for joiner on joining
character_event = {
	id = MNM.3424
	desc = EVTDESC_MNM_3424
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3424

		join_society = event_target:recruiter_society
	}
}

# MISSIONS

# Mission tombola
# CleanSlate: Offset to avoid firing events on same day as random society events. Previously occured between tombola and quest event.
character_event = {
	id = MNM.3000

	hide_window = yes
	is_triggered_only = yes # on_society_bi_yearly_pulse

	immediate = {
		character_event = {
			id = MNM.3001
			days = 7
			random = 7
		}
	}
}

character_event = {
	id = MNM.3001

	hide_window = yes
	is_triggered_only = yes

	only_capable = yes
	prisoner = no

	trigger = {
		society_member_of = secret_religious_cult
		is_society_grandmaster = no
		has_any_quest = no
		is_inaccessible_trigger = no
		NOT = { has_character_modifier = quest_cooldown_timer }

		society = {
			leader = { always = yes }
		}
	}

	fail_trigger_effect = {
		# If the society has no Grandmaster, disband it
		society = {
			if = {
				limit = {
					NOT = { leader = { always = yes } }
				}

				any_society_member = {
					leave_society = yes
				}

				ROOT = { leave_society = yes }
			}
		}
	}

	immediate = {
		society = {
			leader = { save_event_target_as = society_leader }
		}

		random_list = {
			10 = { # Induct a ruler
				trigger = {
					ai = no
					society_rank > 1

					top_liege = {
						any_realm_lord = {
							ok_sr_induction_mission_target_trigger = yes
						}
					}
				}

				society_quest_event = { id = MNM.3401 }
			}

			10 = { # Make ruler sympathetic
				trigger = {
					ai = no
					society_rank > 1

					top_liege = {
						any_realm_lord = {
							ok_sr_sympathy_mission_target_trigger = yes
						}
					}
				}

				society_quest_event = { id = MNM.3403 }
			}

			10 = { # Prepare Grounds
				trigger = {
					society_rank > 2
					
					any_demesne_province = {
						owned_by = PREV
						province_without_secret_religious_community_of_root = yes
					}
				}

				society_quest_event = { id = MNM.3901 }
			}

			10 = { # Blend In
				trigger = {
					any_courtier = {
						religion = ROOT
						is_adult = yes

						NOR = {
							secret_religion = ROOT
							same_society_as = ROOT
						}
					}
				}

				mult_modifier = {
					factor = 1.5
					check_variable = { which = visibility_value value >= 10 }
				}
				mult_modifier = {
					factor = 2
					check_variable = { which = visibility_value value >= 20 }
				}

				society_quest_event = { id = MNM.3398 }
			}

			10 = { # Conduct Secret Ceremony
				trigger = {
					society = {
						any_society_member = {
							ai = yes
							in_command = no
							is_inaccessible_or_incapable_trigger = no
							is_within_diplo_range = ROOT
							NOT = { character = ROOT }
						}
					}
				}

				society_quest_event = { id = MNM.3234 }
			}

			120 = { # AI bypasses missions at times
				trigger = { ai = yes }

				random_list = {
					70 = {
						mult_modifier = {
							factor = 0.9
							society_influence >= 30
						}
						mult_modifier = {
							factor = 0.9
							society_influence >= 40
						}
						mult_modifier = {
							factor = 0.8
							society_influence >= 50
						}
						mult_modifier = {
							factor = 0.7
							society_influence >= 70
						}
						mult_modifier = {
							factor = 0.6
							society_influence >= 80
						}
						mult_modifier = {
							factor = 0.5
							society_influence >= 90
						}

						add_mission_succeed_influence_effect = yes

						if = { # AI Members of Secret Religious Cults level up more often
							limit = {
								society_rank < 3
								society_can_rank_up = yes
							}

							random = {
								chance = 50
								society_rank_up = 1
							}
						}
					}

					30 = { add_mission_fail_influence_effect = yes }
				}
			}
		}
	}
}

# QUEST: Blending In
society_quest_event = {
	id = MNM.3398
	desc = EVTDESC_3398_BLEND_IN
	border = GFX_event_letter_frame_religion
	portrait = event_target:society_leader

	is_triggered_only = yes

	option = {
		name = ACCEPT

		set_quest = quest_secret_religions_societies_blend_in
	}

	option = {
		name = DECLINE

		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			days = 1000
			hidden = yes
		}

		ai_chance = { factor = 0 }
	}
}

# Blending In-mission start
character_event = {
	id = MNM.3399
	picture = GFX_evt_dark_prayer
	desc = EVTDESC_3399
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # secret_religions_blend_in, mnm_secret_religious_societies_decisions.txt

	option = {
		name = EVTOPTA_MNM_3399

		hidden_effect = {
			set_variable = { which = blending_in_points value = 0 }
		}

		set_character_flag = blending_in_timer

		character_event = { # Sends the tombola
			id = MNM.3200
			days = 40
			random = 30
		}
	}
}

# Mission: Blend in - outcome evaluator for blending in
character_event = {
	id = MNM.3200

	hide_window = yes
	is_triggered_only = yes

	trigger = { has_quest = quest_secret_religions_societies_blend_in }

	immediate = {
		if = {
			limit = { has_character_modifier = attempting_to_blend_in }

			if = {
				limit = {
					check_variable = { which = blending_in_points value >= -2 }
					check_variable = { which = blending_in_points value < 4 }
				}

				random_list = { # Next opportunity...
					10 = { # Convince a particular character (that doesn't exactly love you)
						trigger = {
							NOT = { has_character_flag = attempting_to_convince_stubborn_courtier }

							any_courtier = {
								host = { character = ROOT }
								religion = ROOT
								is_adult = yes
								prisoner = no
								NOT = { same_society_as = ROOT }

								opinion = {
									who = ROOT
									value >= -50
								}

								opinion = {
									who = ROOT
									value < 10
								}
							}
						}

						set_character_flag = attempting_to_convince_stubborn_courtier
						character_event = { id = MNM.3202 }
					}

					10 = { # Convince a particular character (that does care about you)
						trigger = {
							NOT = { has_character_flag = attempting_to_convince_concerned_friend }

							any_courtier = {
								host = { character = ROOT }
								religion = ROOT
								is_adult = yes
								prisoner = no
								NOT = { same_society_as = ROOT }

								opinion = {
									who = ROOT
									value >= 50
								}
							}
						}

						set_character_flag = attempting_to_convince_concerned_friend
						character_event = { id = MNM.3209 }
					}

					30 = { # struggle with trait
						trigger = {
							NOT = { has_character_flag = blend_in_struggled_with_trait }

							NAND = {
								trait = paranoid
								trait = gregarious
								trait = deceitful
							}

							any_courtier = {
								religion = ROOT
								is_adult = yes

								NOR = {
									secret_religion = ROOT
									same_society_as = ROOT
								}

								opinion = {
									who = ROOT
									value >= 0
								}
							}
						}

						set_character_flag = blend_in_struggled_with_trait
						character_event = { id = MNM.3220 }
					}

					10 = { # Attend [Root.HouseOfWorship]
						trigger = {
							NOT = { has_character_flag = blend_in_attended_house_of_worship }
						}

						set_character_flag = blend_in_attended_house_of_worship
						character_event = { id = MNM.3225 }
					}

					5 = { # General progress
						mult_modifier = {
							factor = 1.2
							intrigue >= 15
						}
						mult_modifier = {
							factor = 1.2
							trait = deceitful
						}
						mult_modifier = {
							factor = 1.1
							is_learned_trigger = yes
						}
						mult_modifier = {
							factor = 0.1
							is_dumb_trigger = yes
						}
						mult_modifier = {
							factor = 1.2
							is_smart_trigger = yes
						}

						set_character_flag = blend_in_general_progress
						character_event = { id = MNM.3230 }
					}

					10 = { # If all missions have been done already....
						trigger = {
							has_character_flag = blend_in_attended_house_of_worship
							has_character_flag = blend_in_general_progress

							# We need this special flag but can't get it
							trigger_if = {
								limit = {
									NOT = { has_character_flag = blend_in_struggled_with_trait }
								}

								OR = {
									AND = {
										trait = paranoid
										trait = gregarious
										trait = deceitful
									}

									NOT = {
										any_courtier = {
											religion = ROOT
											is_adult = yes

											NOR = {
												secret_religion = ROOT
												same_society_as = ROOT
											}

											opinion = {
												who = ROOT
												value >= 0
											}
										}
									}
								}
							}

							# We need this special flag but can't get it
							trigger_if = {
								limit = {
									NOT = { has_character_flag = attempting_to_convince_stubborn_courtier }
								}

								NOT = {
									any_courtier = {
										host = { character = ROOT }
										religion = ROOT
										is_adult = yes
										prisoner = no
										NOT = { same_society_as = ROOT }

										opinion = {
											who = ROOT
											value >= -50
										}

										opinion = {
											who = ROOT
											value < 10
										}
									}
								}
							}

							# We need this special flag but can't get it
							trigger_if = {
								limit = {
									NOT = { has_character_flag = attempting_to_convince_concerned_friend }
								}

								NOT = {
									any_courtier = {
										host = { character = ROOT }
										religion = ROOT
										is_adult = yes
										prisoner = no
										NOT = { same_society_as = ROOT }

										opinion = {
											who = ROOT
											value >= 50
										}
									}
								}
							}
						}

						clr_character_flag = attempting_to_convince_stubborn_courtier
						clr_character_flag = attempting_to_convince_concerned_friend
						clr_character_flag = blend_in_struggled_with_trait
						clr_character_flag = blend_in_attended_house_of_worship
						clr_character_flag = blend_in_general_progress
					}
				}

				repeat_event = { # Sends the tombola again
					id = MNM.3200
					days = 40
					random = 30
				}
			}
			# Mission success/fail
			else = {
				society = {
					leader = {
						save_event_target_as = society_leader
					}
				}

				if = {
					limit = { check_variable = { which = blending_in_points value >= 4 } }
					letter_event = { id = MNM.3251 } # successful mission
				}
				else = {
					letter_event = { id = MNM.3252 } # mission failed
				}

				clr_character_flag = attempting_to_convince_stubborn_courtier
				clr_character_flag = attempting_to_convince_concerned_friend
				clr_character_flag = blend_in_struggled_with_trait
				clr_character_flag = blend_in_attended_house_of_worship
				clr_character_flag = blend_in_general_progress
			}
		}
	}
}

## Opportunity 01 - The Stubborn Courtier
character_event = { # Your stubborn courtier confronts you about your faith
	id = MNM.3202
	desc = EVTDESC_MNM_3202
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_diplomacy
	portrait = event_target:stubborn_courtier

	is_triggered_only = yes

	immediate = {
		random_courtier = {
			limit = {
				host = { character = ROOT }
				religion = ROOT
				is_adult = yes
				prisoner = no
				NOT = { same_society_as = ROOT }

				opinion = {
					who = ROOT
					value >= -50
				}

				opinion = {
					who = ROOT
					value < 10
				}
			}

			preferred_limit = {
				has_pious_trait_trigger = yes
			}

			save_event_target_as = stubborn_courtier
		}
	}

	# Quote their Holy Book at them - smaller chance to succeed, bigger pay-off, small penalty
	option = {
		name = EVTOPTA_MNM_3202

		random_list = {
			50 = {
				mult_modifier = {
					factor = 1.1
					learning >= 15
				}
				mult_modifier = {
					factor = 1.5
					is_smart_trigger = yes
				}
				mult_modifier = {
					factor = 1.5
					event_target:stubborn_courtier = {
						OR = {
							trait = trusting
							NOT = { trait = zealous }
						}
					}
				}

				custom_tooltip = { text = EVTOPTA_MNM_3202_TOOLTIP_SUCCESS }
				long_character_event = { id = MNM.3204 days = 2 }
			}

			50 = {
				mult_modifier = {
					factor = 1.5
					event_target:stubborn_courtier = { is_dumb_trigger = yes }
				}
				mult_modifier = {
					factor = 1.5
					event_target:stubborn_courtier = { trait = cynical }
				}

				custom_tooltip = { text = EVTOPTA_MNM_3202_TOOLTIP_FAILURE }
				long_character_event = { id = MNM.3205 days = 2 }
			}
		}
	}

	# Intimidate them - bigger chance to succeed, smaller pay-off, big penalty
	option = {
		name = EVTOPTB_MNM_3202

		random_list = {
			65 = {
				mult_modifier = {
					factor = 1.5
					is_benevolent_trigger = yes
				}
				mult_modifier = {
					factor = 1.5
					has_pleasant_personality_trigger = yes
				}

				custom_tooltip = { text = EVTOPTB_MNM_3202_TOOLTIP_SUCCESS }
				long_character_event = { id = MNM.3206 days = 2 }
			}

			35 = {
				mult_modifier = {
					factor = 1.5
					is_evil_trigger = yes
				}
				mult_modifier = {
					factor = 1.5
					has_unpleasant_personality_trigger = yes
				}

				custom_tooltip = { text = EVTOPTB_MNM_3202_TOOLTIP_FAILURE }
				long_character_event = { id = MNM.3207 days = 2 }
			}
		}
	}

	# Bribe # CleanSlate: The tooltip seems like a lie
	option = {
		name = EVTOPTC_MNM_3202

		custom_tooltip = {
			text = EVTOPTC_MNM_3202_TOOLTIP
			change_variable = { which = blending_in_points value = -1 }
		}

		wealth = -20

		random_list = {
			80 = { # They will not mention this again
				mult_modifier = {
					factor = 1.5
					trait = greedy
				}

				reverse_opinion = {
					name = opinion_grateful
					who = event_target:stubborn_courtier
					years = 5
				}
			}

			20 = { # They are insulted
				mult_modifier = {
					factor = 1.5
					trait = honest
				}
				mult_modifier = {
					factor = 1.5
					is_pious_trigger = yes
				}

				reverse_opinion = {
					name = insulted
					who = event_target:stubborn_courtier
					years = 5
				}
			}
		}
	}
}

# You quoted scripture correctly
long_character_event = {
	id = MNM.3204
	desc = EVTDESC_MNM_3204
	picture = GFX_evt_secret_ceremony
	border = GFX_event_long_frame_diplomacy
	portrait = event_target:stubborn_courtier

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3204

		custom_tooltip = {
			text = EVTOPTA_MNM_3204_TOOLTIP_SUCCESS
			change_variable = { which = blending_in_points value = 2 }
		}

		event_target:stubborn_courtier = {
			show_scope_change = no

			add_trait_partially_humble_effect = yes
		}

		reverse_opinion = {
			name = opinion_impressed
			who = event_target:stubborn_courtier
			years = 10
		}
	}
}

# You quoted scripture poorly
long_character_event = {
	id = MNM.3205
	desc = EVTDESC_MNM_3205
	picture = GFX_evt_secret_ceremony
	border = GFX_event_long_frame_diplomacy
	portrait = event_target:stubborn_courtier

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3205

		custom_tooltip = {
			text = EVTOPTA_MNM_3205_TOOLTIP_FAILURE
			change_variable = { which = blending_in_points value = -1 }
		}

		event_target:stubborn_courtier = {
			show_scope_change = no

			random = {
				chance = 15
				add_trait_zealous_effect = yes
			}
		}
	}
}

# Successful intimidation of stubborn courtier
long_character_event = {
	id = MNM.3206
	desc = EVTDESC_MNM_3206
	picture = GFX_evt_secret_ceremony
	border = GFX_event_long_frame_diplomacy
	portrait = event_target:stubborn_courtier

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3206

		custom_tooltip = {
			text = EVTOPTC_MNM_3206_TOOLTIP_SUCCESS
			change_variable = { which = blending_in_points value = 1 }
		}
	}
}

# Failed intimidation of stubborn courtier
long_character_event = {
	id = MNM.3207
	desc = EVTDESC_MNM_3207
	picture = GFX_evt_secret_ceremony
	border = GFX_event_long_frame_diplomacy
	portrait = event_target:stubborn_courtier

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3207

		custom_tooltip = {
			text = EVTOPTC_MNM_3207_TOOLTIP_FAILURE
			change_variable = { which = blending_in_points value = -2 }
		}

		add_character_modifier = {
			name = embarrassed_believer
			years = 3
		}

		reverse_opinion = {
			name = opinion_unimpressed
			who = event_target:stubborn_courtier
			years = 5
		}
	}
}

## Opportunity 02 - The Concerned Friend
character_event = { # Your concerned friend needs reassurance of your devoutness
	id = MNM.3209
	desc = EVTDESC_MNM_3209
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_diplomacy
	portrait = event_target:concerned_friend

	is_triggered_only = yes

	immediate = {
		random_courtier = {
			limit = {
				host = { character = ROOT }
				religion = ROOT
				is_adult = yes
				prisoner = no
				NOT = { same_society_as = ROOT }

				opinion = {
					who = ROOT
					value >= 50
				}
			}

			preferred_limit = {
				is_friend = ROOT
			}

			preferred_limit = {
				is_lover = ROOT
			}

			save_event_target_as = concerned_friend
		}
	}

	# Tell them of bad dreams - smaller chance to succeed, bigger pay-off, small penalty
	option = {
		name = EVTOPTA_MNM_3209

		random_list = {
			50 = {
				mult_modifier = {
					factor = 1.5
					is_smart_trigger = yes
				}
				mult_modifier = {
					factor = 1.5
					event_target:concerned_friend = {
						OR = {
							trait = trusting
							NOT = { trait = zealous }
						}
					}
				}
				mult_modifier = {
					factor = 1.1
					learning >= 15
				}

				custom_tooltip = { text = EVTOPTA_MNM_3209_TOOLTIP_SUCCESS }
				character_event = { id = MNM.3211 days = 2 }
			}

			50 = {
				mult_modifier = {
					factor = 1.5
					event_target:concerned_friend = { is_dumb_trigger = yes }
				}
				mult_modifier = {
					factor = 1.5
					event_target:concerned_friend = { trait = cynical }
				}

				custom_tooltip = { text = EVTOPTA_MNM_3209_TOOLTIP_FAILURE }
				character_event = { id = MNM.3212 days = 2 }
			}
		}
	}

	# Say all is well - bigger chance to succeed, smaller pay-off, big penalty
	option = {
		name = EVTOPTB_MNM_3209

		random_list = {
			65 = {
				mult_modifier = {
					factor = 1.5
					is_benevolent_trigger = yes
				}
				mult_modifier = {
					factor = 1.5
					has_pleasant_personality_trigger = yes
				}

				custom_tooltip = { text = EVTOPTB_MNM_3209_TOOLTIP_SUCCESS }
				character_event = { id = MNM.3213 days = 2 }
			}

			35 = {
				mult_modifier = {
					factor = 1.5
					is_evil_trigger = yes
				}
				mult_modifier = {
					factor = 1.5
					has_unpleasant_personality_trigger = yes
				}

				custom_tooltip = { text = EVTOPTB_MNM_3209_TOOLTIP_FAILURE }
				character_event = { id = MNM.3214 days = 2 }
			}
		}
	}

	# Distract them
	option = {
		name = EVTOPTC_MNM_3209

		custom_tooltip = {
			text = EVTOPTC_MNM_3209_TOOLTIP
			change_variable = { which = blending_in_points value = -1 }
		}

		random_list = {
			50 = { # They are happily distracted
				mult_modifier = {
					factor = 1.5
					event_target:concerned_friend = { trait = trusting }
				}
				mult_modifier = {
					factor = 1.5
					event_target:concerned_friend = { trait = arbitrary }
				}

				reverse_opinion = {
					name = opinion_approves
					who = event_target:concerned_friend
					years = 5
				}
			}

			50 = { # They are confused
				mult_modifier = {
					factor = 1.5
					event_target:concerned_friend = { trait = cynical }
				}
				mult_modifier = {
					factor = 1.5
					event_target:concerned_friend = { is_lover = ROOT }
				}
				mult_modifier = {
					factor = 1.5
					event_target:concerned_friend = { is_friend = ROOT }
				}

				reverse_opinion = {
					name = opinion_confused
					who = event_target:concerned_friend
					years = 5
				}
			}
		}
	}
}

# You convinced them you have bad dreams
character_event = {
	id = MNM.3211
	desc = EVTDESC_MNM_3211
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_diplomacy
	portrait = event_target:concerned_friend

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3211 # They are a good friend

		custom_tooltip = {
			text = EVTOPTA_MNM_3211_TOOLTIP_SUCCESS
			change_variable = { which = blending_in_points value = 2 }
		}

		if = {
			limit = {
				NOT = { is_friend = event_target:concerned_friend }
			}

			add_friend = event_target:concerned_friend
		}

		reverse_opinion = {
			name = opinion_approves
			who = event_target:concerned_friend
			years = 5
		}
	}
}

# You spill your guts?
character_event = {
	id = MNM.3212
	desc = EVTDESC_MNM_3212
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_diplomacy
	portrait = event_target:concerned_friend

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3212

		custom_tooltip = {
			text = EVTOPTA_MNM_3212_TOOLTIP_FAILURE
			change_variable = { which = blending_in_points value = -1 }
		}

		reverse_opinion = {
			name = opinion_worried
			who = event_target:concerned_friend
			years = 5
		}
	}
}

# Successfully dismissed concerned friend
character_event = {
	id = MNM.3213
	desc = EVTDESC_MNM_3213
	picture = GFX_evt_state_diplomacy
	border = GFX_event_normal_frame_diplomacy
	portrait = event_target:concerned_friend

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3213

		custom_tooltip = {
			text = EVTOPTA_MNM_3213_TOOLTIP_SUCCESS
			change_variable = { which = blending_in_points value = 1 }
		}
	}
}

# Failed dismissing concerned friend
character_event = {
	id = MNM.3214
	desc = EVTDESC_MNM_3214
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_diplomacy
	portrait = event_target:concerned_friend

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3214

		custom_tooltip = {
			text = EVTOPTA_MNM_3214_TOOLTIP_FAILURE
			change_variable = { which = blending_in_points value = -2 }
		}

		random = {
			chance = 20
			add_trait_paranoid_effect = yes
		}

		reverse_opinion = {
			name = opinion_disappointed
			who = event_target:concerned_friend
			years = 5
		}
	}
}

## Opportunity 3
# Blend In: Dealing with trait
character_event = {
	id = MNM.3220
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_3220_TRUSTING
		trigger = { has_character_flag = blend_in_trusting }
	}
	desc = {
		text = EVTDESC_3220_SHY
		trigger = { has_character_flag = blend_in_shy }
	}
	desc = {
		text = EVTDESC_3220_HONEST
		trigger = { has_character_flag = blend_in_honest }
	}

	is_triggered_only = yes

	immediate = {
		random_list = {
			33 = {
				trigger = {
					NOT = { trait = paranoid }
				}

				set_character_flag = blend_in_trusting
			}

			33 = {
				trigger = {
					NOT = { trait = gregarious }
				}

				set_character_flag = blend_in_shy
			}

			33 = {
				trigger = {
					NOT = { trait = deceitful }
				}

				set_character_flag = blend_in_honest
			}
		}

		random_courtier = {
			limit = {
				religion = ROOT
				is_adult = yes

				NOR = {
					secret_religion = ROOT
					same_society_as = ROOT
				}

				opinion = { who = ROOT value >= 0 }
			}

			preferred_limit = {
				opinion = { who = ROOT value >= 75 }
			}
			preferred_limit = {
				opinion = { who = ROOT value >= 45 }
			}
			preferred_limit = {
				opinion = { who = ROOT value >= 25 }
			}

			save_event_target_as = trusted_friend
		}

		random_spouse = {
			limit = {
				religion = ROOT

				NOR = {
					secret_religion = ROOT
					same_society_as = ROOT
				}

				opinion = { who = ROOT value >= 45 }
			}

			save_event_target_as = trusted_friend
		}

		random_lover = {
			limit = {
				religion = ROOT

				NOR = {
					secret_religion = ROOT
					same_society_as = ROOT
				}

				opinion = { who = ROOT value >= 20 }
			}

			save_event_target_as = trusted_friend
		}

		random_friend = {
			limit = {
				religion = ROOT
				is_adult = yes

				NOR = {
					secret_religion = ROOT
					same_society_as = ROOT
				}
			}

			save_event_target_as = trusted_friend
		}
	}

	# Indulge (trusting or honest)
	option = {
		name = {
			text = EVTOPTA_3220_TRUSTING
			trigger = { has_character_flag = blend_in_trusting }
		}
		name = {
			text = EVTOPTA_3220_HONEST
			trigger = { has_character_flag = blend_in_honest }
		}

		show_portrait = event_target:trusted_friend

		trigger = {
			OR = {
				has_character_flag = blend_in_trusting
				has_character_flag = blend_in_honest
			}
		}

		random_list = {
			65 = {
				custom_tooltip = {
					text = EVTOPTB_MNM_3209_TOOLTIP_SUCCESS
					character_event = { id = MNM.3221 days = 3 }
				}
			}

			35 = {
				custom_tooltip = {
					text = EVTOPTA_MNM_3209_TOOLTIP_FAILURE
					character_event = { id = MNM.3222 days = 3 }
				}
			}
		}
	}

	# Indulge (shy)
	option = {
		name = EVTOPTA_3220_SHY

		trigger = { has_character_flag = blend_in_shy }

		random_list = {
			65 = {
				custom_tooltip = {
					text = EVTOPTB_MNM_3209_TOOLTIP_SUCCESS
					character_event = { id = MNM.3221 days = 3 }
				}
			}
			35 = {
				custom_tooltip = {
					text = EVTOPTA_MNM_3209_TOOLTIP_FAILURE
					character_event = { id = MNM.3222 days = 3 }
				}
			}
		}
	}


	# Fight it (trusting or honest)
	option = {
		name = {
			trigger = { has_character_flag = blend_in_trusting }
			text = EVTOPTB_3220_TRUSTING
		}
		name = {
			trigger = { has_character_flag = blend_in_honest }
			text = EVTOPTB_3220_HONEST
		}

		show_portrait = event_target:trusted_friend

		trigger = {
			OR = {
				has_character_flag = blend_in_trusting
				has_character_flag = blend_in_honest
			}
		}

		random_list = {
			40 = {
				custom_tooltip = {
					text = EVTOPTA_MNM_3209_TOOLTIP_SUCCESS
					character_event = { id = MNM.3223 days = 14 }
				}
			}

			60 = {
				custom_tooltip = {
					text = EVTOPTB_MNM_3209_TOOLTIP_FAILURE
					character_event = { id = MNM.3224 days = 14 }
				}
			}
		}
	}

	# Fight it (shy)
	option = {
		name = EVTOPTB_3220_SHY

		trigger = { has_character_flag = blend_in_shy }

		random_list = {
			40 = {
				custom_tooltip = {
					text = EVTOPTA_MNM_3209_TOOLTIP_SUCCESS
					character_event = { id = MNM.3223 days = 14 }
				}
			}

			60 = {
				custom_tooltip = {
					text = EVTOPTB_MNM_3209_TOOLTIP_FAILURE
					character_event = { id = MNM.3224 days = 14 }
				}
			}
		}

	}
}

# Trait outcome - small success
character_event = {
	id = MNM.3221
	picture = GFX_evt_state_diplomacy
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_3221_TRUSTING
		trigger = { has_character_flag = blend_in_trusting }
	}
	desc = {
		text = EVTDESC_3221_SHY
		trigger = { has_character_flag = blend_in_shy }
	}
	desc = {
		text = EVTDESC_3221_HONEST
		trigger = { has_character_flag = blend_in_honest }
	}

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = {
			text = EVTOPTA_3221_TRUSTING
			trigger = { has_character_flag = blend_in_trusting }
		}
		name = {
			text = EVTOPTA_3221_SHY
			trigger = { has_character_flag = blend_in_shy }
		}
		name = {
			text = EVTOPTA_3221_HONEST
			trigger = { has_character_flag = blend_in_honest }
		}

		custom_tooltip = {
			text = EVTOPTA_3221_TOOLTIP
			change_variable = { which = blending_in_points value = 1 }
		}


		clr_character_flag = blend_in_trusting
		clr_character_flag = blend_in_shy
		clr_character_flag = blend_in_honest
	}
}

# Trait outcome - small failure
character_event = {
	id = MNM.3222
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_3222_TRUSTING
		trigger = { has_character_flag = blend_in_trusting }
	}
	desc = {
		text = EVTDESC_3222_SHY
		trigger = { has_character_flag = blend_in_shy }
	}
	desc = {
		text = EVTDESC_3222_HONEST
		trigger = { has_character_flag = blend_in_honest }
	}

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = {
			text = EVTOPTA_3222_TRUSTING
			trigger = { has_character_flag = blend_in_trusting }
		}
		name = {
			text = EVTOPTA_3222_SHY
			trigger = { has_character_flag = blend_in_shy }
		}
		name = {
			text = EVTOPTA_3222_HONEST
			trigger = { has_character_flag = blend_in_honest }
		}

		custom_tooltip = {
			text = EVTOPTA_3222_TOOLTIP
			change_variable = { which = blending_in_points value = -1 }
		}

		clr_character_flag = blend_in_trusting
		clr_character_flag = blend_in_shy
		clr_character_flag = blend_in_honest
	}
}

# Trait outcome big success
character_event = {
	id = MNM.3223
	picture = GFX_evt_state_diplomacy
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_3223_TRUSTING
		trigger = { has_character_flag = blend_in_trusting }
	}
	desc = {
		text = EVTDESC_3223_SHY
		trigger = { has_character_flag = blend_in_shy }
	}
	desc = {
		text = EVTDESC_3223_HONEST
		trigger = { has_character_flag = blend_in_honest }
	}

	is_triggered_only = yes
	# hide_from = yes

	option = {
		name = {
			text = EVTOPTA_3223_TRUSTING
			trigger = { has_character_flag = blend_in_trusting }
		}
		name = {
			text = EVTOPTA_3223_SHY
			trigger = { has_character_flag = blend_in_shy }
		}
		name = {
			text = EVTOPTA_3223_HONEST
			trigger = { has_character_flag = blend_in_honest }
		}

		custom_tooltip = {
			text = EVTOPTA_3223_TOOLTIP
			change_variable = { which = blending_in_points value = 2 }
		}


		trigger_switch = {
			on_trigger = has_character_flag

			blend_in_trusting = {
				clr_character_flag = blend_in_trusting

				random = {
					chance = 50
					remove_trait_trusting_effect = yes
				}
			}

			blend_in_shy = {
				clr_character_flag = blend_in_shy

				random = {
					chance = 50
					add_trait_partially_gregarious_effect = yes
				}
			}

			blend_in_honest = {
				clr_character_flag = blend_in_honest

				random = {
					chance = 50
					add_trait_partially_deceitful_effect = yes
				}
			}
		}

		add_character_modifier = {
			name = great_believer
			years = 3
		}
	}
}

# Trait outcome - big failure
character_event = {
	id = MNM.3224
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_3224_TRUSTING
		picture = GFX_evt_brothel
		trigger = { has_character_flag = blend_in_trusting }
	}
	desc = {
		text = EVTDESC_3224_SHY
		trigger = { has_character_flag = blend_in_shy }
	}
	desc = {
		text = EVTDESC_3224_HONEST
		trigger = { has_character_flag = blend_in_honest }
	}

	is_triggered_only = yes
	# hide_from = yes

	option = {
		name = {
			text = EVTOPTA_3224_TRUSTING
			trigger = { has_character_flag = blend_in_trusting }
		}
		name = {
			text = EVTOPTA_3224_SHY
			trigger = { has_character_flag = blend_in_shy }
		}
		name = {
			text = EVTOPTA_3224_HONEST
			trigger = { has_character_flag = blend_in_honest }
		}

		custom_tooltip = {
			text = EVTOPTA_3224_TOOLTIP
			change_variable = { which = blending_in_points value = -5 }
		}

		trigger_switch = {
			on_trigger = has_character_flag

			blend_in_trusting = {
				clr_character_flag = blend_in_trusting

				random = {
					chance = 30
					add_trait_trusting_effect = yes
				}
			}

			blend_in_shy = {
				clr_character_flag = blend_in_shy

				random = {
					chance = 30
					add_trait_shy_effect = yes
				}
			}

			blend_in_honest = {
				clr_character_flag = blend_in_honest

				random = {
					chance = 30
					add_trait_honest_effect = yes
				}
			}
		}

		add_character_modifier = {
			name = awkward_believer
			years = 3
		}
	}
}

# Religion specific visiting of house of worship
# TODO: no desc assigned for bon, aztec, or taoist
character_event = {
	id = MNM.3225
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_3225_A
		trigger = {
			OR = {
				religion_group = christian
				religion_group = jewish_group
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_3225_D
		trigger = { religion_group = muslim }
	}
	desc = {
		text = EVTDESC_MNM_3225_E
		trigger = { religion_group = zoroastrian_group }
	}
	desc = {
		text = EVTDESC_MNM_3225_G
		trigger = {
			OR = {
				religion = hindu
				religion = jain
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_3225_H
		trigger = { religion = buddhist }
	}
	desc = {
		text = EVTDESC_MNM_3225_J
		trigger = {
			OR = {
				religion_openly_norse_or_reformed_trigger = yes
				religion_openly_baltic_or_reformed_trigger = yes
				religion_openly_finnish_or_reformed_trigger = yes
				religion_openly_slavic_or_reformed_trigger = yes
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_3225_N
		trigger = {
			religion_openly_tengri_or_reformed_trigger = yes
		}
	}
	desc = {
		text = EVTDESC_MNM_3225_O
		trigger = {
			religion_openly_west_african_or_reformed_trigger = yes
		}
	}
	desc = {
		text = EVTDESC_MNM_3225_P
		trigger = {
			OR = {
				religion_openly_zun_or_reformed_trigger = yes
				religion_openly_hellenic_or_reformed_trigger = yes
				religion = pagan
			}
		}
	}

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTB_MNM_3225

		random_list = {
			50 = { # good outcome (big)
				trigger = {
					NOT = { trait = imbecile }
				}

				mult_modifier = {
					factor = 1.1
					diplomacy >= 15
				}
				mult_modifier = {
					factor = 1.1
					diplomacy >= 16
				}
				mult_modifier = {
					factor = 1.1
					diplomacy >= 17
				}
				mult_modifier = {
					factor = 1.1
					diplomacy >= 18
				}
				mult_modifier = {
					factor = 1.1
					diplomacy >= 19
				}
				mult_modifier = {
					factor = 1.1
					diplomacy >= 20
				}
				mult_modifier = {
					factor = 1.1
					diplomacy >= 21
				}
				mult_modifier = {
					factor = 1.1
					diplomacy >= 22
				}
				mult_modifier = {
					factor = 1.1
					trait = deceitful
				}
				mult_modifier = {
					factor = 1.1
					trait = gregarious
				}
				mult_modifier = {
					factor = 1.1
					trait = zealous
				}
				mult_modifier = {
					factor = 1.1
					trait = cynical
				}

				custom_tooltip = {
					text = EVTOPTA_MNM_3209_TOOLTIP_SUCCESS
					long_character_event = { id = MNM.3228 }
				}
			}

			50 = { # bad outcome (big)
				trigger = {
					NOT = { trait = genius }
				}

				mult_modifier = {
					factor = 1.1
					diplomacy < 10
				}
				mult_modifier = {
					factor = 1.1
					diplomacy < 9
				}
				mult_modifier = {
					factor = 1.1
					diplomacy < 8
				}
				mult_modifier = {
					factor = 1.1
					diplomacy < 7
				}
				mult_modifier = {
					factor = 1.1
					diplomacy < 6
				}
				mult_modifier = {
					factor = 1.1
					diplomacy < 5
				}
				mult_modifier = {
					factor = 1.2
					diplomacy < 4
				}
				mult_modifier = {
					factor = 1.3
					diplomacy < 3
				}
				mult_modifier = {
					factor = 1.4
					diplomacy < 2
				}
				mult_modifier = {
					factor = 1.5
					diplomacy < 1
				}
				mult_modifier = {
					factor = 1.1
					trait = shy
				}
				mult_modifier = {
					factor = 1.1
					trait = content
				}

				custom_tooltip = {
					text = EVTOPTB_MNM_3209_TOOLTIP_FAILURE
					long_character_event = { id = MNM.3229 }
				}
			}
		}
	}

	option = {
		name = EVTOPTA_MNM_3225

		# add negative effect, trait or loss of something

		random_list = {
			70 = { # good outcome (small)
				trigger = {
					NOT = { trait = imbecile }
				}

				mult_modifier = {
					factor = 1.1
					diplomacy >= 15
				}
				mult_modifier = {
					factor = 1.1
					diplomacy >= 16
				}
				mult_modifier = {
					factor = 1.1
					diplomacy >= 17
				}
				mult_modifier = {
					factor = 1.1
					diplomacy >= 18
				}
				mult_modifier = {
					factor = 1.1
					diplomacy >= 19
				}
				mult_modifier = {
					factor = 1.1
					diplomacy >= 20
				}
				mult_modifier = {
					factor = 1.1
					diplomacy >= 21
				}
				mult_modifier = {
					factor = 1.1
					diplomacy >= 22
				}
				mult_modifier = {
					factor = 1.1
					trait = deceitful
				}
				mult_modifier = {
					factor = 1.1
					trait = gregarious
				}
				mult_modifier = {
					factor = 1.1
					trait = zealous
				}
				mult_modifier = {
					factor = 1.1
					trait = cynical
				}

				custom_tooltip = {
					text = EVTOPTB_MNM_3209_TOOLTIP_SUCCESS
					long_character_event = { id = MNM.3226 }
				}
			}

			30 = { # bad outcome (small)
				trigger = {
					NOT = { trait = genius }
				}

				mult_modifier = {
					factor = 1.1
					diplomacy < 10
				}
				mult_modifier = {
					factor = 1.1
					diplomacy < 9
				}
				mult_modifier = {
					factor = 1.1
					diplomacy < 8
				}
				mult_modifier = {
					factor = 1.1
					diplomacy < 7
				}
				mult_modifier = {
					factor = 1.1
					diplomacy < 6
				}
				mult_modifier = {
					factor = 1.1
					diplomacy < 5
				}
				mult_modifier = {
					factor = 1.2
					diplomacy < 4
				}
				mult_modifier = {
					factor = 1.3
					diplomacy < 3
				}
				mult_modifier = {
					factor = 1.4
					diplomacy < 2
				}
				mult_modifier = {
					factor = 1.5
					diplomacy < 1
				}
				mult_modifier = {
					factor = 1.1
					trait = shy
				}
				mult_modifier = {
					factor = 1.1
					trait = content
				}

				custom_tooltip = {
					text = EVTOPTA_MNM_3209_TOOLTIP_FAILURE
					long_character_event = { id = MNM.3227 }
				}
			}
		}
	}
}

# Outcome 1 (small gain)
# TODO: no desc assigned for bon, aztec, or taoist
long_character_event = {
	id = MNM.3226
	picture = GFX_evt_secret_ceremony
	border = GFX_event_long_frame_religion

	desc = {
		text = EVTDESC_MNM_3226_A
		trigger = {
			OR = {
				religion_group = christian
				religion_group = jewish_group
				religion = pagan
				religion_openly_hellenic_or_reformed_trigger = yes
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_3226_D
		trigger = {
			OR = {
				is_sunni_branch = yes
				is_ibadi_branch = yes
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_3226_E
		trigger = { religion_group = zoroastrian_group }
	}
	desc = {
		text = EVTDESC_MNM_3226_F
		trigger = {
			is_shiite_branch = yes
		}
	}
	desc = {
		text = EVTDESC_MNM_3226_G
		trigger = {
			OR = {
				religion = hindu
				religion = jain
				religion_openly_baltic_or_reformed_trigger = yes
				religion_openly_finnish_or_reformed_trigger = yes
				religion_openly_slavic_or_reformed_trigger = yes
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_3226_H
		trigger = { religion = buddhist }
	}
	desc = {
		text = EVTDESC_MNM_3226_J
		trigger = {
			religion_openly_norse_or_reformed_trigger = yes
		}
	}
	desc = {
		text = EVTDESC_MNM_3226_N
		trigger = {
			religion_openly_tengri_or_reformed_trigger = yes
		}
	}
	desc = {
		text = EVTDESC_MNM_3226_O
		trigger = {
			religion_openly_west_african_or_reformed_trigger = yes
		}
	}
	desc = {
		text = EVTDESC_MNM_3226_P
		trigger = {
			religion_openly_zun_or_reformed_trigger = yes
		}
	}

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_MNM_3226

		custom_tooltip = {
			text = EVTOPTA_3221_TOOLTIP
			change_variable = { which = blending_in_points value = 1 }
		}
	}
}

# Outcome 2 (small loss)
# TODO: no desc assigned for bon, aztec, or taoist
long_character_event = {
	id = MNM.3227
	picture = GFX_evt_uncomfortable
	border = GFX_event_long_frame_religion

	desc = {
		text = EVTDESC_MNM_3227_A
		trigger = {
			OR = {
				religion_group = christian
				religion_group = jewish_group
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_3227_D
		trigger = {
			OR = {
				is_sunni_branch = yes
				is_ibadi_branch = yes
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_3227_E
		trigger = { religion_group = zoroastrian_group }
	}
	desc = {
		text = EVTDESC_MNM_3227_F
		trigger = { is_shiite_branch = yes }
	}
	desc = {
		text = EVTDESC_MNM_3227_G
		trigger = { has_dharmic_religion_trigger = yes }
	}
	desc = {
		text = EVTDESC_MNM_3227_J
		trigger = {
			OR = {
				religion_openly_norse_or_reformed_trigger = yes
				religion_openly_baltic_or_reformed_trigger = yes
				religion_openly_finnish_or_reformed_trigger = yes
				religion_openly_slavic_or_reformed_trigger = yes
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_3227_N
		trigger = {
			religion_openly_tengri_or_reformed_trigger = yes
		}
	}
	desc = {
		text = EVTDESC_MNM_3227_O
		trigger = {
			religion_openly_west_african_or_reformed_trigger = yes
		}
	}
	desc = {
		text = EVTDESC_MNM_3227_P
		trigger = {
			OR = {
				religion_openly_zun_or_reformed_trigger = yes
				religion_openly_hellenic_or_reformed_trigger = yes
				religion = pagan
			}
		}
	}

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_MNM_3227

		custom_tooltip = {
			text = EVTOPTA_3222_TOOLTIP
			change_variable = { which = blending_in_points value = -1 }
		}
	}
}

# Outcome 3 (big gain)
# TODO: no desc assigned for bon, aztec, or taoist
long_character_event = {
	id = MNM.3228
	picture = GFX_evt_secret_ceremony
	border = GFX_event_long_frame_religion

	is_triggered_only = yes
	hide_from = yes

	desc = {
		text = EVTDESC_MNM_3228_A
		trigger = {
			OR = {
				religion_group = christian
				religion_group = jewish_group
				religion_group = muslim
				religion_group = zoroastrian_group
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_3228_G
		trigger = { religion = hindu }
	}
	desc = {
		text = EVTDESC_MNM_3228_H
		trigger = {
			OR = {
				religion = buddhist
				religion = jain
				religion_openly_norse_or_reformed_trigger = yes
				religion_openly_baltic_or_reformed_trigger = yes
				religion_openly_finnish_or_reformed_trigger = yes
				religion_openly_slavic_or_reformed_trigger = yes
				religion_openly_tengri_or_reformed_trigger = yes
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_3228_O
		trigger = {
			OR = {
				religion = pagan
				religion_openly_hellenic_or_reformed_trigger = yes
				religion_openly_west_african_or_reformed_trigger = yes
				religion_openly_zun_or_reformed_trigger = yes
			}
		}
	}

	option = {
		name = EVTOPTA_MNM_3228

		custom_tooltip = {
			text = EVTOPTA_3223_TOOLTIP
			change_variable = { which = blending_in_points value = 2 }
		}
	}
}

# Outcome 4 (big loss)
# TODO: no desc assigned for bon, aztec, or taoist
long_character_event = {
	id = MNM.3229
	picture = GFX_evt_uncomfortable
	border = GFX_event_long_frame_religion

	desc = {
		text = EVTDESC_MNM_3229_A
		trigger = { religion_group = christian }
	}
	desc = {
		text = EVTDESC_MNM_3229_C
		trigger = { religion_group = jewish_group }
	}
	desc = {
		text = EVTDESC_MNM_3229_D
		trigger = {
			OR = {
				religion_group = muslim
				religion_group = zoroastrian_group
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_3229_G
		trigger = {
			OR = {
				religion = pagan
				has_dharmic_religion_trigger = yes
				religion_openly_hellenic_or_reformed_trigger = yes
				religion_openly_norse_or_reformed_trigger = yes
				religion_openly_baltic_or_reformed_trigger = yes
				religion_openly_finnish_or_reformed_trigger = yes
				religion_openly_slavic_or_reformed_trigger = yes
				religion_openly_tengri_or_reformed_trigger = yes
				religion_openly_west_african_or_reformed_trigger = yes
				religion_openly_zun_or_reformed_trigger = yes
			}
		}
	}

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_MNM_3229

		custom_tooltip = {
			text = EVTOPTA_3224_TOOLTIP
			change_variable = { which = blending_in_points value = -2 }
		}
	}
}


character_event = { # Generic progress (small)
	id = MNM.3230
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_3230_A
		trigger = { has_character_flag = desc_flag_A }
	}
	desc = {
		text = EVTDESC_MNM_3230_B
		trigger = { has_character_flag = desc_flag_B }
	}
	desc = {
		text = EVTDESC_MNM_3230_C
		trigger = { has_character_flag = desc_flag_C }
	}
	desc = {
		text = EVTDESC_MNM_3230_D
		trigger = { has_character_flag = desc_flag_D }
	}
	desc = {
		text = EVTDESC_MNM_3230_E
		trigger = { has_character_flag = desc_flag_E }
	}
	desc = {
		text = EVTDESC_MNM_3230_F
		trigger = { has_character_flag = desc_flag_F }
	}

	is_triggered_only = yes

	immediate = {
		random_list = {
			10 = {
				trigger = {
					job_spiritual = { always = yes }
				}

				set_character_flag = desc_flag_A
			}

			10 = {
				trigger = {
					job_spiritual = { always = yes }
				}

				set_character_flag = desc_flag_B
			}

			10 = { set_character_flag = desc_flag_C }
			10 = { set_character_flag = desc_flag_D }
			10 = { set_character_flag = desc_flag_E }
			10 = { set_character_flag = desc_flag_F }
		}
	}

	hide_from = yes

	option = {
		name = {
			text = EVTOPTA_MNM_3230_C
			trigger = { has_character_flag = desc_flag_C }
		}
		name = {
			text = EVTOPTA_MNM_3230_D
			trigger = { has_character_flag = desc_flag_D }
		}
		name = {
			text = EVTOPTA_MNM_3230_E
			trigger = { has_character_flag = desc_flag_E }
		}
		name = {
			text = EVTOPTA_MNM_3230_F
			trigger = { has_character_flag = desc_flag_F }
		}

		trigger = {
			NOR = {
				has_character_flag = desc_flag_A
				has_character_flag = desc_flag_B
			}
		}

		clr_character_flag = desc_flag_C
		clr_character_flag = desc_flag_D
		clr_character_flag = desc_flag_E
		clr_character_flag = desc_flag_F
	}

	option = { # gives opinion boost with court chaplain (desc A + B only)
		name = {
			text = EVTOPTA_MNM_3230_A
			trigger = { has_character_flag = desc_flag_A }
		}
		name = {
			text = EVTOPTA_MNM_3230_B
			trigger = { has_character_flag = desc_flag_B }
		}

		trigger = {
			OR = {
				has_character_flag = desc_flag_A
				has_character_flag = desc_flag_B
			}
		}

		reverse_opinion = {
			name = opinion_approves
			who = job_spiritual
			years = 5
		}

		clr_character_flag = desc_flag_A
		clr_character_flag = desc_flag_B
	}

	after = {
		custom_tooltip = {
			text = EVTOPTA_3221_TOOLTIP
			change_variable = { which = blending_in_points value = 1 }
		}
	}
}

# Blend In-mission success
letter_event = {
	id = MNM.3251
	desc = EVTDESC_MNM_3251
	border = GFX_event_letter_frame_religion
	portrait = event_target:society_leader

	is_triggered_only = yes

	option = {
		name = VERY_WELL

		if = {
			limit = { has_quest = quest_secret_religions_societies_blend_in }

			clr_quest = quest_secret_religions_societies_blend_in
			sound_effect = secret_cults_blend_in
			remove_character_modifier = attempting_to_blend_in
			clr_character_flag = blending_in_timer
		}

		add_society_currency_medium_effect = yes
		decrease_visibility_effect = yes
	}
}

# Blend In-mission failure
letter_event = {
	id = MNM.3252
	desc = EVTDESC_MNM_3252
	border = GFX_event_letter_frame_religion
	portrait = event_target:society_leader

	is_triggered_only = yes

	option = {
		name = CURSES

		if = {
			limit = { has_quest = quest_secret_religions_societies_blend_in }

			clr_quest = {
				id = quest_secret_religions_societies_blend_in
				failure = yes
			}

			remove_character_modifier = attempting_to_blend_in
			clr_character_flag = blending_in_timer
		}
	}
}

# QUEST: Conduct Secret Ceremony
society_quest_event = {
	id = MNM.3234
	desc = EVTDESC_3234_CONDUCT_SECRET_CEREMONY
	border = GFX_event_letter_frame_religion
	portrait = event_target:society_leader

	is_triggered_only = yes

	option = {
		name = ACCEPT
		set_quest = quest_secret_religions_conduct_secret_ceremony
	}

	option = {
		name = DECLINE

		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			days = 1000
			hidden = yes
		}

		ai_chance = { factor = 0 }
	}
}

### MISSION: Conduct Secret Ceremony to your Secret God(s)
# Conduct secret ceremony - Fellow member approaches you
character_event = {
	id = MNM.3237
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_diplomacy
	portrait = event_target:fellow_member

	desc = {
		text = EVTDESC_MNM_3237
		trigger = {
			event_target:fellow_member = {
				NOT = { host = { character = ROOT } }
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_3237_COURT
		trigger = {
			event_target:fellow_member = {
				host = { character = ROOT }
			}
		}
	}

	is_triggered_only = yes # mnm_secret_religious_societies_decisions.txt

	immediate = {
		# First look for someone at court
		society = {
			random_society_member = {
				limit = {
					ai = yes
					in_command = no
					is_inaccessible_or_incapable_trigger = no
					is_within_diplo_range = ROOT
					NOT = { character = ROOT }
				}

				preferred_limit = { # First look for someone at court
					host = { character = ROOT }
				}

				preferred_limit = { # Then look for someone in the same realm
					same_realm = ROOT
				}

				save_event_target_as = fellow_member

				set_quest_target = {
					id = quest_secret_religions_conduct_secret_ceremony
					holder = ROOT
				}
			}
		}
	}

	option = {
		name = EVTOPTA_MNM_3237 # Can't wait

		custom_tooltip = { text = EVTOPTA_MNM_3237_TT }

		character_event = {
			id = MNM.3239
			days = 15
			random = 10
		}
	}

	option = {
		name = EVTOPTB_MNM_3237 # I changed my mind

		detract_society_currency_minor_effect = yes

		reverse_opinion = {
			name = opinion_unimpressed
			who = event_target:fellow_member
			years = 5
		}

		ai_chance = { factor = 0 }
	}
}

# The Secret Ceremony - Result
character_event = {
	id = MNM.3239
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_diplomacy
	portrait = event_target:fellow_member

	desc = {
		text = EVTDESC_MNM_3239_TRAGIC_FAIL
		picture = GFX_evt_secluded_in_prayer
		trigger = { has_character_flag = secret_ceremony_tragic_failure }
	}
	desc = {
		text = EVTDESC_MNM_3239_SMALL_FAIL
		picture = GFX_evt_secluded_in_prayer
		trigger = { has_character_flag = secret_ceremony_small_failure }
	}
	desc = {
		text = EVTDESC_MNM_3239_NEUTRAL_OUTCOME
		picture = GFX_evt_secluded_in_prayer
		trigger = { has_character_flag = secret_ceremony_neutral_outcome }
	}
	desc = {
		text = EVTDESC_MNM_3239_SMALL_SUCCESS
		picture = GFX_evt_secluded_in_prayer
		trigger = {
			has_character_flag = secret_ceremony_small_success

			NOR = {
				has_character_flag = secret_ceremony_romance
				has_character_flag = secret_ceremony_friendship
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_3239_SMALL_SUCCESS_N_FRIENDSHIP
		picture = GFX_evt_secluded_in_prayer
		trigger = {
			has_character_flag = secret_ceremony_small_success
			has_character_flag = secret_ceremony_friendship
		}
	}
	desc = {
		text = EVTDESC_MNM_3239_SMALL_SUCCESS_N_ROMANCE
		picture = GFX_evt_secluded_in_prayer
		trigger = {
			has_character_flag = secret_ceremony_small_success
			has_character_flag = secret_ceremony_romance
			NOT = { is_rival = event_target:fellow_member }
		}
	}
	desc = {
		text = EVTDESC_MNM_3239_SMALL_SUCCESS_N_RIVAL_ROMANCE
		picture = GFX_evt_secluded_in_prayer
		trigger = {
			has_character_flag = secret_ceremony_small_success
			has_character_flag = secret_ceremony_romance
			is_rival = event_target:fellow_member
		}
	}
	desc = {
		text = EVTDESC_MNM_3239_BIG_SUCCESS
		picture = GFX_evt_secluded_in_prayer
		trigger = {
			has_character_flag = secret_ceremony_big_success

			NOR = {
				has_character_flag = secret_ceremony_romance
				has_character_flag = secret_ceremony_friendship
			}
		}
	}
	desc = {
		text = EVTDESC_MNM_3239_BIG_SUCCESS_N_FRIENDSHIP
		picture = GFX_evt_secluded_in_prayer
		trigger = {
			has_character_flag = secret_ceremony_big_success
			has_character_flag = secret_ceremony_friendship
		}
	}
	desc = {
		text = EVTDESC_MNM_3239_BIG_SUCCESS_N_ROMANCE
		picture = GFX_evt_secluded_in_prayer
		trigger = {
			has_character_flag = secret_ceremony_big_success
			has_character_flag = secret_ceremony_romance
			NOT = { is_rival = event_target:fellow_member }
		}
	}
	desc = {
		text = EVTDESC_MNM_3239_BIG_SUCCESS_N_RIVAL_ROMANCE
		picture = GFX_evt_secluded_in_prayer
		trigger = {
			has_character_flag = secret_ceremony_big_success
			has_character_flag = secret_ceremony_romance
			is_rival = event_target:fellow_member
		}
	}

	is_triggered_only = yes

	trigger = {
		event_target:fellow_member = { is_alive = yes }
		has_quest = quest_secret_religions_conduct_secret_ceremony
	}

	immediate = {
		random_list = {
			5 = { # Random courtier accidentally discovers you and fellow member kills them (by accident?)
				trigger = {
					# zero chance of happening if there is no potential threat within your court...
					any_courtier = {
						is_adult = yes
						is_ruler = no
						prisoner = no
						is_incapable = no

						NOR = {
							character = ROOT
							character = event_target:fellow_member
							is_married = ROOT
							is_close_relative = ROOT
							secret_religion = ROOT
							same_society_as = ROOT
						}
					}
				}

				hidden_effect = {
					random_courtier = { # find a potential threat, who stumbles in on your ceremony...
						limit = {
							is_adult = yes
							is_ruler = no
							prisoner = no
							is_incapable = no

							NOR = {
								character = ROOT
								character = event_target:fellow_member
								is_married = ROOT
								is_close_relative = ROOT
								secret_religion = ROOT
								same_society_as = ROOT
							}
						}

						save_event_target_as = unfortunate_interrupter

						death = {
							death_reason = death_murder_unknown
							killer = ROOT
						}
					}
				}

				set_character_flag = feel_different_negative
				set_character_flag = secret_ceremony_tragic_failure
			}

			10 = { # You feel stressed out by the ordeal...
				set_character_flag = feel_different_negative
				set_character_flag = secret_ceremony_small_failure
			}

			10 = { # You are satisfied, you guess...
				set_character_flag = secret_ceremony_neutral_outcome
			}

			30 = { # The ceremony leaves you at peace...
				random = {
					chance = 25
					set_character_flag = feel_different_positive
				}

				random = {
					chance = 50

					if = {
						limit = {
							event_target:fellow_member = { root_attraction_trigger = yes }
							NOT = { is_lover = event_target:fellow_member }
						}

						set_character_flag = secret_ceremony_romance
					}
					else_if = {
						limit = {
							event_target:fellow_member = { root_attraction_trigger = no }
							NOT = { is_friend = event_target:fellow_member }
						}

						set_character_flag = secret_ceremony_friendship
					}
				}

				set_character_flag = secret_ceremony_small_success
			}

			30 = { # The ceremony reinvigorates you completely...!
				random = {
					chance = 50

					if = {
						limit = {
							event_target:fellow_member = { root_attraction_trigger = yes }
							NOT = { is_lover = event_target:fellow_member }
						}

						set_character_flag = secret_ceremony_romance
					}
					else_if = {
						limit = {
							event_target:fellow_member = { root_attraction_trigger = no }
							NOT = { is_friend = event_target:fellow_member }
						}

						set_character_flag = secret_ceremony_friendship
					}
				}

				set_character_flag = feel_different_positive
				set_character_flag = secret_ceremony_big_success
			}
		}

		if = { # if you just gained this flag, you gain a random trait! (unless you already have all the traits)
			limit = { has_character_flag = feel_different_positive }

			random_list = {
				20 = {
					trigger = {
						NOT = { trait = gregarious }
					}

					modifier = {
						factor = 2
						has_education_diplomacy_trigger = yes
					}

					set_character_flag = gregarious_flag
				}

				20 = {
					trigger = {
						NOT = { trait = brave }
					}

					modifier = {
						factor = 2
						has_education_martial_trigger = yes
					}

					set_character_flag = brave_flag
				}

				20 = {
					trigger = {
						NOT = { trait = diligent }
					}

					modifier = {
						factor = 2
						has_education_stewardship_trigger = yes
					}

					set_character_flag = diligent_flag
				}

				20 = {
					trigger = {
						NOT = { trait = patient }
					}

					modifier = {
						factor = 2
						has_education_intrigue_trigger = yes
					}

					set_character_flag = patient_flag
				}

				20 = {
					# Only guaranteed to gain a trait if you have none of them yet
					trigger = {
						OR = {
							trait = gregarious
							trait = brave
							trait = diligent
							trait = patient
						}
					}

					clr_character_flag = feel_different_positive
				}
			}
		}
	}

	option = {
		name = {
			text = EVTOPTA_MNM_3239_TRAGIC_FAIL
			trigger = { has_character_flag = secret_ceremony_tragic_failure }
		}
		name = {
			text = EVTOPTA_MNM_3239_SMALL_FAIL
			trigger = { has_character_flag = secret_ceremony_small_failure }
		}
		name = {
			text = EVTOPTA_MNM_3239_NEUTRAL_OUTCOME
			trigger = { has_character_flag = secret_ceremony_neutral_outcome }
		}
		name = {
			text = EVTOPTA_MNM_3239_SMALL_SUCCESS
			trigger = { has_character_flag = secret_ceremony_small_success }
		}
		name = {
			text = EVTOPTA_MNM_3239_BIG_SUCCESS
			trigger = { has_character_flag = secret_ceremony_big_success }
		}

		trigger_switch = {
			on_trigger = has_character_flag

			secret_ceremony_tragic_failure = {
				custom_tooltip = { text = EVTOPTA_MNM_3239_TRAGIC_FAIL_TT }
			}

			secret_ceremony_small_failure = {
				custom_tooltip = { text = EVTOPTA_MNM_3239_SMALL_FAIL_TT }
			}

			secret_ceremony_neutral_outcome = {
				custom_tooltip = { text = EVTOPTA_MNM_3239_NEUTRAL_OUTCOME_TT }
			}

			secret_ceremony_small_success = {
				if = {
					limit = { has_character_flag = secret_ceremony_romance }
					custom_tooltip = { text = EVTOPTA_MNM_3239_SMALL_SUCCESS_TT_2 }
				}
				else = {
					custom_tooltip = { text = EVTOPTA_MNM_3239_SMALL_SUCCESS_TT_1 }
				}
			}

			secret_ceremony_big_success = {
				if = {
					limit = { has_character_flag = secret_ceremony_romance }
					custom_tooltip = { text = EVTOPTA_MNM_3239_BIG_SUCCESS_TT_2 }
				}
				else = {
					custom_tooltip = { text = EVTOPTA_MNM_3239_BIG_SUCCESS_TT_1 }
				}
			}
		}

		if = { # the ceremony sparked something between the two of you
			limit = { has_character_flag = secret_ceremony_romance }

			if = {
				limit = { is_rival = event_target:fellow_member }
				remove_rival = event_target:fellow_member
			}

			if = {
				limit = {
					has_opinion_modifier = {
						name = opinion_budding_romance
						who = event_target:fellow_member
					}

					reverse_has_opinion_modifier = {
						name = opinion_budding_romance
						who = event_target:fellow_member
					}
				}

				add_lover = event_target:fellow_member
			}
			else = {
				reverse_opinion = {
					name = opinion_budding_romance
					who = event_target:fellow_member
					years = 10
				}

				opinion = {
					name = opinion_budding_romance
					who = event_target:fellow_member
					years = 10
				}
			}
		}

		else_if = { # the ceremony brought you closer together
			limit = { has_character_flag = secret_ceremony_friendship }

			if = {
				limit = { is_rival = event_target:fellow_member }

				remove_rival = event_target:fellow_member

				reverse_opinion = {
					name = opinion_budding_friendship
					who = event_target:fellow_member
					years = 10
				}

				opinion = {
					name = opinion_budding_friendship
					who = event_target:fellow_member
					years = 10
				}
			}
			else = {
				add_friend = event_target:fellow_member
			}

		}

		trigger_switch = { # Which trait to handle
			on_trigger = has_character_flag

			gregarious_flag = {
				clr_character_flag = gregarious_flag
				add_trait_partially_silently_gregarious_effect = yes
			}

			brave_flag = {
				clr_character_flag = brave_flag
				add_trait_partially_silently_brave_effect = yes
			}

			diligent_flag = {
				clr_character_flag = diligent_flag
				add_trait_partially_silently_diligent_effect = yes
			}

			patient_flag = {
				clr_character_flag = patient_flag
				add_trait_partially_silently_patient_effect = yes
			}
		}

		if = {
			limit = { has_character_flag = feel_different_negative }

			random = {
				chance = 20
				add_trait_stressed_effect = yes
			}
		}

		trigger_switch = {
			on_trigger = has_character_flag

			secret_ceremony_small_failure   = { add_society_currency_minor_effect = yes }
			secret_ceremony_neutral_outcome = { add_society_currency_minor_effect = yes }
			secret_ceremony_small_success   = { add_society_currency_medium_effect = yes }
			secret_ceremony_big_success     = { add_society_currency_medium_effect = yes }
		}

		# unless you tragically failed, you succeed
		if = {
			limit = { has_character_flag = secret_ceremony_tragic_failure }

			event_target:unfortunate_interrupter = {
				show_scope_change = no

				tooltip = {
					death = {
						death_reason = death_murder_unknown
						killer = ROOT
					}
				}
			}

			clr_quest = {
				id = quest_secret_religions_conduct_secret_ceremony
				failure = yes
			}
		}
		else = {
			clr_quest = quest_secret_religions_conduct_secret_ceremony
		}

		clr_character_flag = secret_ceremony_tragic_failure
		clr_character_flag = secret_ceremony_small_failure
		clr_character_flag = secret_ceremony_neutral_outcome
		clr_character_flag = secret_ceremony_small_success
		clr_character_flag = secret_ceremony_big_success
		clr_character_flag = secret_ceremony_friendship
		clr_character_flag = secret_ceremony_romance
		clr_character_flag = feel_different_positive
		clr_character_flag = feel_different_negative
		clr_character_flag = conduct_secret_ceremony_timer
	}
}

#------------------ Secret ceremony end--------------------


# MISSION: Induct a ruler
society_quest_event = {
	id = MNM.3401
	desc = EVTDESC_MNM_3401
	portrait = event_target:society_leader
	quest_target = event_target:induction_target

	is_triggered_only = yes

	immediate = {
		if = {
			limit = { society_rank >= 3 }

			top_liege = {
				if = { # Top liege only if all other duke+ rulers are taken
					limit = { ok_sr_induction_mission_target_trigger = yes }
					save_event_target_as = induction_target
				}

				random_realm_lord = { # For high level ppl, duke+ ruler # CleanSlate: Unsure if this comment is inaccurate due to typo or intentional change
					limit = {
						higher_real_tier_than = BARON
						ok_sr_induction_mission_target_trigger = yes
					}

					save_event_target_as = induction_target
				}

				if = { # Backup
					limit = {
						NOT = { event_target:induction_target = { always = yes } }
					}

					random_realm_lord = {
						limit = { ok_sr_induction_mission_target_trigger = yes }

						save_event_target_as = induction_target
					}
				}
			}
		}
		else = {
			top_liege = {
				random_realm_lord = { # Baron-count for low levels
					limit = { ok_sr_induction_mission_target_trigger = yes }

					preferred_limit = { lower_real_tier_than = DUKE }

					save_event_target_as = induction_target
				}
			}
		}
	}

	option = { # accept
		name = ACCEPT

		event_target:induction_target = {
			show_scope_change = no

			set_quest_target = {
				id = quest_secret_religious_societies_induct_ruler
				holder = ROOT
			}
		}
	}

	option = { # nah thx
		name = DECLINE

		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			days = 1000
			hidden = yes
		}

		ai_chance = { factor = 0 }
	}
}


# MISSION: evoke a ruler's sympathy
society_quest_event = {
	id = MNM.3403
	desc = EVTDESC_MNM_3403
	portrait = event_target:society_leader
	quest_target = event_target:sympathy_target

	is_triggered_only = yes

	immediate = {
		if = {
			limit = { society_rank >= 3 }

			top_liege = {
				if = { # Top liege only if all other duke+ rulers are taken
					limit = { ok_sr_sympathy_mission_target_trigger = yes }
					save_event_target_as = sympathy_target
				}

				random_realm_lord = { # For high level ppl, duke+ ruler # CleanSlate: Unsure if this comment is inaccurate due to typo or intentional change
					limit = {
						higher_tier_than = BARON
						ok_sr_sympathy_mission_target_trigger = yes
					}

					save_event_target_as = sympathy_target
				}

				if = { # Backup
					limit = {
						NOT = { event_target:sympathy_target = { always = yes } }
					}

					random_realm_lord = {
						limit = { ok_sr_sympathy_mission_target_trigger = yes }

						save_event_target_as = sympathy_target
					}
				}
			}
		}
		else = {
			top_liege = {
				random_realm_lord = { # Baron-count for low levels
					limit = { ok_sr_sympathy_mission_target_trigger = yes }

					preferred_limit = { lower_tier_than = DUKE }

					save_event_target_as = sympathy_target
				}
			}
		}
	}

	option = { # accept
		name = ACCEPT

		event_target:sympathy_target = {
			show_scope_change = no

			set_quest_target = {
				id = quest_secret_religious_societies_sympathy_ruler
				holder = ROOT
			}
		}
	}

	option = { # nah thx
		name = DECLINE

		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			days = 1000
			hidden = yes
		}

		ai_chance = { factor = 0 }
	}
}


# POWERS
# Power: Attempt to make a character sympathetic
character_event = {
	id = MNM.3404
	desc = EVTDESC_MNM_3404
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # secret_religions_evoke_sympathy, mnm_secret_religious_societies_decisions.txt

	# How to make your argument?

	# Friends & family
	option = {
		name = EVTOPTA_MNM_3404

		custom_tooltip = { text = EVTOPTA_MNM_3404_TT }

		set_character_flag = sympathy_argument_friends_family

	}

	# Home & business
	option = {
		name = EVTOPTB_MNM_3404

		custom_tooltip = { text = EVTOPTB_MNM_3404_TT }

		set_character_flag = sympathy_argument_trauma
	}

	# Logical option
	option = {
		name = EVTOPTC_MNM_3404

		custom_tooltip = { text = EVTOPTC_MNM_3404_TT }

		set_character_flag = sympathy_argument_profit
	}

	# Stress your own opinion
	option = {
		name = EVTOPTD_MNM_3404

		custom_tooltip = { text = EVTOPTD_MNM_3404_TT }

		set_character_flag = sympathy_argument_personal
	}

	after = {
		FROM = { character_event = { id = MNM.3405 days = 5 } }
	}
}

# Person is approached with touching story, develop sympathy or not?
character_event = {
	id = MNM.3405
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy

	desc = {
		text = EVTDESC_MNM_3405_A
		trigger = { FROM = { has_character_flag = sympathy_argument_friends_family } }
	}
	desc = {
		text = EVTDESC_MNM_3405_B
		trigger = { FROM = { has_character_flag = sympathy_argument_trauma } }
	}
	desc = {
		text = EVTDESC_MNM_3405_C
		trigger = { FROM = { has_character_flag = sympathy_argument_profit } }
	}
	desc = {
		text = EVTDESC_MNM_3405_D
		trigger = { FROM = { has_character_flag = sympathy_argument_personal } }
	}

	is_triggered_only = yes

	# Yes I agree
	option = {
		name = EVTOPTA_MNM_3405

		remove_trait_silently_zealous_effect = yes

		FROM = {
			show_scope_change = no

			ROOT = {
				show_scope_change = no
				add_sympathy_for_prevs_true_religion_effect = yes
			}

			character_event = { id = MNM.3406 days = 1 }
		}

		reverse_opinion = {
			name = opinion_open_minded
			who = FROM
			years = 10
		}


		ai_chance = {
			factor = 60

			trigger = { controls_religion = no }

			mult_modifier = { trait = kind factor = 3 }
			mult_modifier = { trait = just factor = 2 }
			mult_modifier = { trait = trusting factor = 2 }
			mult_modifier = { trait = patient factor = 1.5 }
			mult_modifier = { trait = charitable factor = 1.5 }
			mult_modifier = { FROM = { diplomacy >= 12 } factor = 1.4 }
			mult_modifier = { FROM = { diplomacy >= 14 } factor = 1.3 }
			mult_modifier = { FROM = { diplomacy >= 16 } factor = 1.2 }

			mult_modifier = {
				factor = 3
				FROM = { has_character_flag = sympathy_argument_friends_family }

				OR = {
					trait = gregarious
					trait = socializer
					trait = kind
					num_of_friends > 0
					has_lover = yes
					has_education_diplomacy_trigger = yes

					any_child = {
						reverse_opinion = {
							who = ROOT
							value >= 35
						}
					}
				}
			}

			mult_modifier = {
				factor = 3
				FROM = { has_character_flag = sympathy_argument_trauma }

				OR = {
					trait = craven
					trait = kind
					has_scarred_trait_trigger = yes
					is_weak_trigger = yes
					character_disease_trigger = yes
					has_injury_trigger = yes
					has_disability_trigger = yes
					has_mental_disorder_trigger = yes
					has_negative_congenital_trigger = yes
				}
			}

			mult_modifier = {
				factor = 3
				FROM = { has_character_flag = sympathy_argument_profit }

				OR = {
					trait = greedy
					trait = ambitious
					trait = cynical
					trait = administrator
					trait = diligent
					is_smart_trigger = yes
					has_education_stewardship_trigger = yes
				}
			}

			mult_modifier = {
				factor = 3
				FROM = { has_character_flag = sympathy_argument_personal }

				opinion = {
					who = FROM
					value >= 15
				}

				OR = {
					is_close_relative = FROM
					is_friend = FROM
					is_lover = FROM
					vassal_of = FROM
					top_liege = { character = FROM }
					FROM = { diplomacy >= 15 }

					opinion = {
						who = FROM
						value >= 50
					}
				}
			}
		}
	}

	# No I don't care
	option = {
		name = EVTOPTB_MNM_3405

		reverse_opinion = {
			name = opinion_narrow_minded
			who = FROM
			years = 10
		}

		FROM = { character_event = { id = MNM.3407 days = 1 } }

		ai_chance = {
			factor = 40

			mult_modifier = { trait = zealous factor = 5 }
			mult_modifier = { trait = cruel factor = 3 }
			mult_modifier = { trait = arbitrary factor = 3 }
			mult_modifier = { is_priest = yes factor = 2 }
			mult_modifier = { FROM = { diplomacy < 8 } factor = 2 }
			mult_modifier = { real_tier = COUNT factor = 1.2 }
			mult_modifier = { real_tier = DUKE factor = 1.4 }
			mult_modifier = { real_tier = KING factor = 1.7 }
			mult_modifier = { real_tier = EMPEROR factor = 2 }
		}
	}

	after = {
		FROM = {
			clr_character_flag = sympathy_argument_friends_family
			clr_character_flag = sympathy_argument_trauma
			clr_character_flag = sympathy_argument_profit
			clr_character_flag = sympathy_argument_personal
		}
	}
}

# They gained sympathy
character_event = {
	id = MNM.3406
	desc = EVTDESC_MNM_3406
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3406

		tooltip = {
			FROM = {
				show_scope_change = no

				add_sympathy_for_prevs_true_religion_effect = yes
			}
		}

		if = {
			limit = {
				has_quest = quest_secret_religious_societies_sympathy_ruler
				FROM = { is_quest_target_of = ROOT }
			}

			clr_quest = quest_secret_religious_societies_sympathy_ruler
			add_society_currency_medium_effect = yes
		}
	}
}

# They did not gain sympathy
character_event = {
	id = MNM.3407
	desc = EVTDESC_MNM_3407
	picture = GFX_evt_courtiers_talking
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3407

		if = {
			limit = {
				has_quest = quest_secret_religious_societies_sympathy_ruler
				FROM = { is_quest_target_of = ROOT }
			}

			clr_quest = {
				id = quest_secret_religious_societies_sympathy_ruler
				failure = yes
			}
		}
		else_if = {
			limit = {
				has_quest = quest_secret_religious_societies_induct_ruler
				FROM = { is_quest_target_of = ROOT }
			}

			clr_quest = {
				id = quest_secret_religious_societies_induct_ruler
				failure = yes
			}
		}
	}
}


# POWER: Induct character to secret faith
character_event = {
	id = MNM.3408
	desc = EVTDESC_MNM_3408
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # secret_religions_induct_character, mnm_secret_religious_societies_decisions.txt

	immediate = {
		save_event_target_as = secret_religion_inductor
		FROM = { save_event_target_as = secret_religion_inductee }
	}

	# A passage about great warriors of the faith
	option = {
		name = EVTOPTA_MNM_3408

		custom_tooltip = { text = EVTOPTA_MNM_3408_TT }

		set_character_flag = induction_argument_war
	}

	# A passage about community
	option = {
		name = EVTOPTB_MNM_3408

		custom_tooltip = { text = EVTOPTB_MNM_3408_TT }

		 set_character_flag = induction_argument_community
	}

	# An interesting passage on matters of ethics and philosophy
	option = {
		name = EVTOPTC_MNM_3408

		custom_tooltip = { text = EVTOPTC_MNM_3408_TT }

		 set_character_flag = induction_argument_theology
	}

	# A passage about a succesful and fair ruler
	option = {
		name = EVTOPTD_MNM_3408

		custom_tooltip = { text = EVTOPTD_MNM_3408_TT }

		set_character_flag = induction_argument_stewardship
	}

	after = {
		event_target:secret_religion_inductee = {
			character_event = { id = MNM.3409 days = 3 }
		}
	}
}

# Finds a holy book
character_event = {
	id = MNM.3409
	picture = GFX_evt_library
	desc = EVTDESC_MNM_3409
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	hide_from = yes

	# Read it
	option = {
		name = EVTOPTA_MNM_3409

		custom_tooltip = { text = EVTOPTA_MNM_3409_TT }

		character_event = { id = MNM.3410 days = 12 }
	}

	# Hide it
	option = {
		name = EVTOPTC_MNM_3409

		custom_tooltip = { text = EVTOPTC_MNM_3409_TT }

		event_target:secret_religion_inductor = {
			character_event = { id = MNM.3413 days = 3 } # fail event
		}

		random = {
			chance = 10
			add_trait_paranoid_effect = yes
		}

		ai_chance = { factor = 0 }
	}
}

# Reading the holy book
character_event = {
	id = MNM.3410
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_3410_A
		trigger = { event_target:secret_religion_inductor = { has_character_flag = induction_argument_war } }
	}
	desc = {
		text = EVTDESC_MNM_3410_B
		trigger = { event_target:secret_religion_inductor = { has_character_flag = induction_argument_community } }
	}
	desc = {
		text = EVTDESC_MNM_3410_C
		trigger = { event_target:secret_religion_inductor = { has_character_flag = induction_argument_theology } }
	}
	desc = {
		text = EVTDESC_MNM_3410_D
		trigger = { event_target:secret_religion_inductor = { has_character_flag = induction_argument_stewardship } }
	}

	hide_from = yes

	is_triggered_only = yes

	# It speaks the truth
	option = {
		name = EVTOPTA_MNM_3410

		# custom_tooltip = { text = EVTOPTA_MNM_3410_TT }

		hidden_effect = {
			clear_secret_religion = yes
		}

		# Add new secret religion
		set_secret_religion = event_target:secret_religion_inductor

		event_target:secret_religion_inductor = {
			character_event = { id = MNM.3411 days = 3 } # And update the inductor
		}

		ai_chance = {
			factor = 60

			trigger = { controls_religion = no }

			mult_modifier = { trait = trusting factor = 2 }
			mult_modifier = { event_target:secret_religion_inductor = { diplomacy >= 12 } factor = 1.4 }
			mult_modifier = { event_target:secret_religion_inductor = { diplomacy >= 14 } factor = 1.4 }
			mult_modifier = { event_target:secret_religion_inductor = { diplomacy >= 16 } factor = 1.3 }
			mult_modifier = { event_target:secret_religion_inductor = { diplomacy >= 18 } factor = 1.3 }
			mult_modifier = { event_target:secret_religion_inductor = { diplomacy >= 20 } factor = 1.2 }
			mult_modifier = { event_target:secret_religion_inductor = { diplomacy >= 22 } factor = 1.2 }

			mult_modifier = {
				factor = 3
				event_target:secret_religion_inductor = { has_character_flag = induction_argument_war }

				OR = {
					trait = brave
					has_education_martial_trigger = yes
					has_lifestyle_martial_trigger = yes
					has_job_title = job_marshal
				}
			}

			mult_modifier = {
				factor = 3
				event_target:secret_religion_inductor = { has_character_flag = induction_argument_community }

				OR = {
					trait = gregarious
					num_of_friends > 0
					has_lover = yes
					has_education_diplomacy_trigger = yes
					has_lifestyle_diplomacy_trigger = yes

					any_child = {
						reverse_opinion = {
							who = ROOT
							value >= 35
						}
					}
				}
			}

			mult_modifier = {
				factor = 3
				event_target:secret_religion_inductor = { has_character_flag = induction_argument_theology }

				OR = {
					trait = erudite
					has_education_learning_trigger = yes
					has_lifestyle_learning_trigger = yes
				}
			}

			mult_modifier = {
				factor = 3
				event_target:secret_religion_inductor = { has_character_flag = induction_argument_stewardship }

				OR = {
					trait = ambitious
					trait = just
					has_lifestyle_stewardship_trigger = yes
					has_education_stewardship_trigger = yes
				}
			}
		}
	}

	# Reaffirmed my belief
	option = {
		name = EVTOPTB_MNM_3410

		piety = 25

		event_target:secret_religion_inductor = {
			character_event = { id = MNM.3413 days = 3 } # fail event
		}

		ai_chance = {
			factor = 40

			mult_modifier = { is_priest = yes factor = 4 }
			mult_modifier = { trait = paranoid factor = 10 }
			mult_modifier = { trait = zealous factor = 100 }
			mult_modifier = { FROM = { diplomacy < 8 } factor = 2 }
			mult_modifier = { real_tier = BARON factor = 2 }
			mult_modifier = { real_tier = COUNT factor = 3 }
			mult_modifier = { real_tier = DUKE factor = 4 }
			mult_modifier = { real_tier = KING is_nomadic = no factor = 16 }
			mult_modifier = { real_tier = EMPEROR is_nomadic = no factor = 32 }
		}
	}

	after = {
		hidden_effect = {
			event_target:secret_religion_inductor = {
				clr_character_flag = induction_argument_war
				clr_character_flag = induction_argument_community
				clr_character_flag = induction_argument_theology
				clr_character_flag = induction_argument_stewardship
			}
		}
	}
}

# The inductee did accept my secret religion
character_event = {
	id = MNM.3411
	desc = EVTDESC_MNM_3411
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	trigger = { society_member_of = secret_religious_cult }

	is_triggered_only = yes

	# Attempt to recruit them
	option = {
		name = EVTOPTA_MNM_3411
		custom_tooltip = { text = EVTOPTA_MNM_3411_TT }

		# Recruitment
		hidden_effect = {
			save_event_target_as = secret_religion_recruiter

			event_target:secret_religion_inductee = {
				character_event = { id = MNM.3420 days = 14 }

				add_character_modifier = {
					name = secret_religions_recruitment_timer
					years = 5
					hidden = yes
				}
			}
		}

		ai_chance = {
			factor = 1

			trigger = {
				# don't recruit characters interested in something else
				event_target:secret_religion_inductee = {
					ai = yes
					interested_in_society = secret_religious_cult
				}
			}

			mult_modifier = { event_target:secret_religion_inductee = { is_ruler = yes } factor = 20 }
			mult_modifier = { event_target:secret_religion_inductee = { diplomacy >= 12 } factor = 5 }
			mult_modifier = { event_target:secret_religion_inductee = { diplomacy >= 15 } factor = 4 }
		}
	}

	# Good
	option = {
		name = EVTOPTB_MNM_3411

		ai_chance = { factor = 2 }
	}

	after = {
		event_target:secret_religion_inductee = {
			show_scope_change = no

			tooltip = { set_secret_religion = event_target:secret_religion_inductor }

			if = {
				limit = {
					ROOT = { has_quest = quest_secret_religious_societies_induct_ruler }
					is_quest_target_of = ROOT
				}

				ROOT = {
					show_scope_change = no
					clr_quest = quest_secret_religious_societies_induct_ruler
					add_society_currency_major_effect = yes
				}
			}
		}
	}
}


# Fail: Inductee hid/didn't read book
character_event = {
	id = MNM.3413
	desc = EVTDESC_MNM_3413
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = { society_member_of = secret_religious_cult }

	option = {
		name = EVTOPTA_MNM_3412

		if = {
			limit = {
				has_quest = quest_secret_religious_societies_induct_ruler
				FROM = { is_quest_target_of = ROOT }
			}

			clr_quest = {
				id = quest_secret_religious_societies_induct_ruler
				failure = yes
			}
		}
	}
}

# openly_adopt_faith - Convert cultists
character_event = {
	id = MNM.3800
	desc = EVTDESC_MNM_3800
	picture = GFX_evt_society_joining
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # secret_religions_openly_adopt_faith, mnm_secret_religious_societies_decisions.txt

	trigger = {
		trigger_if = {
			limit = {
				ai = no
				is_nomadic = no
			}

			FROM = { has_safe_secret_religion = yes }
		}
	}

	fail_trigger_effect = {
		set_character_flag = currently_part_of_secret_religion_uncovering
		set_variable = { which = visibility_value value = 0 }
		remove_character_modifier = highly_suspect
		remove_character_modifier = under_suspicion
	}

	immediate = {
		set_character_flag = currently_part_of_secret_religion_uncovering
		set_character_flag = convert_secret
		set_variable = { which = visibility_value value = 0 }
		remove_character_modifier = highly_suspect
		remove_character_modifier = under_suspicion
	}

	option = {
		name = EVTOPTA_MNM_3800

		abdicate_all_primary_type_titles_effect = yes

		# Workaround for automatic usurption of theocratic characters
		convert_religion_failsafe_effect = yes

		if = {
			limit = { is_in_society = yes }
			leave_society = yes
		}

		if = {
			limit = { ai = yes }
			set_character_flag = ai_flag_refuse_conversion
		}
	}
}

# openly_adopt_faith - Allow sympathisers the chance to flip
character_event = {
	id = MNM.3810
	desc = EVTDESC_MNM_3810
	picture = GFX_evt_society_joining
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # secret_religions_openly_adopt_faith, mnm_secret_religious_societies_decisions.txt

	trigger = {
		trigger_if = {
			limit = {
				ai = no
				is_nomadic = no
			}

			FROM = {
				true_religion_scope = {
					has_safe_religion = yes
				}
			}
		}
	}

	immediate = {
		FROM = {
			true_religion_scope = { save_event_target_as = target_religion }
		}
	}

	option = {
		name = EVTOPTA_MNM_3810

		ai_chance = {
			factor = 20

			mult_modifier = {
				factor = 1.3
				FROM = { diplomacy >= 7 }
			}
			mult_modifier = {
				factor = 1.3
				FROM = { diplomacy >= 10 }
			}
			mult_modifier = {
				factor = 1.3
				FROM = { diplomacy >= 13 }
			}
			mult_modifier = {
				factor = 1.25
				FROM = { diplomacy >= 15 }
			}
			mult_modifier = {
				factor = 1.25
				FROM = { diplomacy >= 17 }
			}
			mult_modifier = {
				factor = 1.2
				FROM = { diplomacy >= 19 }
			}
			mult_modifier = {
				factor = 1.2
				FROM = { diplomacy >= 21 }
			}
			mult_modifier = {
				factor = 1.2
				FROM = { diplomacy >= 23 }
			}
			mult_modifier = {
				factor = 1.2
				FROM = { diplomacy >= 25 }
			}
		}

		abdicate_all_primary_type_titles_effect = yes

		# Workaround for automatic usurption of theocratic characters
		convert_religion_failsafe_effect = yes
		clear_secret_religion = yes

		if = {
			limit = { ai = yes }
			set_character_flag = ai_flag_refuse_conversion
		}
	}

	option = {
		name = EVTOPTB_MNM_3810

		ai_chance = {
			factor = 80

			mult_modifier = {
				factor = 0.05

				secret_religion = {
					target = FROM
					target_type = true
				}
			}
		}
	}

	after = {
		set_character_flag = currently_part_of_secret_religion_uncovering
	}
}

character_event = { # Openly Adopt Faith event (for the character who actually fires all of it)
	id = MNM.3811
	desc = EVTDESC_MNM_3811
	picture = GFX_evt_dark_prayer
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # secret_religions_openly_adopt_faith, mnm_secret_religious_societies_decisions.txt

	immediate = {
		set_variable = { which = visibility_value value = 0 }
		remove_character_modifier = highly_suspect
		remove_character_modifier = under_suspicion
	}

	option = {
		name = EVTOPTA_MNM_3811

		custom_tooltip = { text = EVTOPTA_MNM_3811_TT }

		add_character_modifier = {
			name = devout_leader
			duration = -1
		}

		if = {
			limit = { ai = yes }
			set_character_flag = ai_flag_refuse_conversion
		}
	}
}


# openly_adopt_faith - appear to flip players' provinces with local cult modifier
character_event = {
	id = MNM.3820
	desc = EVTDESC_MNM_3820
	picture = GFX_evt_society_joining
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # mnm_secret_religious_societies_decisions.txt

	immediate = {
		display_provinces_flipping_setup_effect = yes
	}

	option = {
		name = EVTOPTA_MNM_3820

		display_provinces_flipping_effect = yes
	}
}

# openly_adopt_faith - Inform lieges unless they're part of the cult flipping
character_event = {
	id = MNM.3830
	desc = EVTDESC_MNM_3830
	picture = GFX_evt_society_joining
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # mnm_secret_religious_societies_decisions.txt

	option = {
		name = EVTOPTA_MNM_3830
	}
}

### INTERACTIONS###

# Interaction: I am so stressed , do I find support?
character_event = {
	id = MNM.3502
	desc = EVTDESC_MNM_3502
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_diplomacy
	portrait = event_target:supportive_sr_member

	is_triggered_only = yes # on_society_bi_yearly_pulse, random_events

	only_playable = yes
	only_capable = yes
	prisoner = no

	trigger = {
		OR = {
			trait = stressed
			trait = depressed
		}

		society_member_of = secret_religious_cult

		society = {
			any_society_member = {
				ai = yes
				block_general_event_trigger = no
				is_within_diplo_range = ROOT

				opinion = {
					who = ROOT
					value >= 20
				}

				reverse_opinion = {
					who = ROOT
					value >= 20
				}

				NOR = {
					character = ROOT
					is_lover = ROOT

					has_opinion_modifier = {
						name = opinion_distressing_encounter
						who = ROOT
					}
				}

				OR = {
					is_friend = ROOT

					trigger_if = {
						limit = { root_attraction_trigger = yes }

						trigger_if = {
							limit = { is_close_relative = ROOT }
							religion_has_incest = yes
							ROOT = { religion_has_incest = yes }
						}
					}
				}
			}
		}
	}

	immediate = {
		society = {
			random_society_member = {
				limit = {
					ai = yes
					block_general_event_trigger = no
					is_within_diplo_range = ROOT

					opinion = {
						who = ROOT
						value >= 20
					}

					reverse_opinion = {
						who = ROOT
						value >= 20
					}

					NOR = {
						character = ROOT
						is_lover = ROOT

						has_opinion_modifier = {
							name = opinion_distressing_encounter
							who = ROOT
						}
					}

					OR = {
						is_friend = ROOT

						trigger_if = {
							limit = { root_attraction_trigger = yes }

							trigger_if = {
								limit = { is_close_relative = ROOT }
								religion_has_incest = yes
								ROOT = { religion_has_incest = yes }
							}
						}
					}
				}

				preferred_limit = {
					at_location = ROOT
				}

				preferred_limit = {
					same_realm = ROOT
				}

				save_event_target_as = supportive_sr_member
			}
		}
	}

	# Friend
	option = {
		name = EVTOPTA_MNM_3502

		if = {
			limit = { is_friend = event_target:supportive_sr_member }
			custom_tooltip = { text = EVTOPTC_MNM_3502_TT }
		}
		else = {
			add_friend = event_target:supportive_sr_member
		}

		ai_chance = { factor = 100 }
	}

	# Lover?
	option = {
		name = EVTOPTB_MNM_3502

		trigger = {
			event_target:supportive_sr_member = {
				root_attraction_trigger = yes

				trigger_if = {
					limit = { is_close_relative = ROOT }
					religion_has_incest = yes
					ROOT = { religion_has_incest = yes }
				}
			}
		}

		custom_tooltip = { text = EVTOPTB_MNM_3502_TT }

		event_target:supportive_sr_member = {
			character_event = { id = MNM.6906 days = 3 }
		}

		ai_chance = {
			factor = 10

			mult_modifier = {
				factor = 10

				OR = {
					trait = lustful
					trait = master_seducer
					trait = master_seductress
					trait = gregarious
					trait = socializer
				}
			}
			mult_modifier = {
				factor = 5
				event_target:supportive_sr_member = { has_attractive_trait_trigger = yes }
			}
		}
	}

	after = {
		remove_trait_silently_stressed_effect = yes
		remove_trait_silently_depressed_effect = yes

		event_target:supportive_sr_member = {
			show_scope_change = no

			remove_trait_stressed_effect = yes
			remove_trait_depressed_effect = yes
		}
	}
}

# Interaction: Get help from another member with problematic trait
character_event = {
	id = MNM.3505

	hide_window = yes
	is_triggered_only = yes # on_society_bi_yearly_pulse, random_events

	only_playable = yes
	only_capable = yes
	prisoner = no

	trigger = {
		society_member_of = secret_religious_cult
		is_inaccessible_trigger = no

		check_variable = {
			which = visibility_value
			value >= 1
		}

		OR = {
			trait = honest
			trait = slothful
			trait = wroth
			trait = trusting
			intrigue < 8
		}
	}

	immediate = {
		clr_character_flag = sr_too_honest
		clr_character_flag = sr_too_wroth
		clr_character_flag = sr_too_slothful
		clr_character_flag = sr_too_trusting
		clr_character_flag = sr_too_indiscreet

		random_list = {
			20 = { # Root is too honest
				trigger = {
					trait = honest

					society = {
						any_society_member = {
							block_general_event_trigger = no

							NOR = {
								character = ROOT
								trait = honest
							}
						}
					}
				}

				set_character_flag = sr_too_honest

				society = {
					random_society_member = {
						limit = {
							block_general_event_trigger = no

							NOR = {
								character = ROOT
								trait = honest
							}
						}

						character_event = { id = MNM.3506 days = 3 }
					}
				}
			}

			20 = { # Root is too slothful
				trigger = {
					trait = slothful

					society = {
						any_society_member = {
							block_general_event_trigger = no

							NOR = {
								character = ROOT
								trait = slothful
							}
						}
					}
				}

				set_character_flag = sr_too_slothful

				society = {
					random_society_member = {
						limit = {
							block_general_event_trigger = no

							NOR = {
								character = ROOT
								trait = slothful
							}
						}

						character_event = { id = MNM.3506 days = 3 }
					}
				}
			}

			20 = { # Root is too wroth
				trigger = {
					trait = wroth

					society = {
						any_society_member = {
							block_general_event_trigger = no

							NOR = {
								character = ROOT
								trait = wroth
							}
						}
					}
				}

				set_character_flag = sr_too_wroth

				society = {
					random_society_member = {
						limit = {
							block_general_event_trigger = no

							NOR = {
								character = ROOT
								trait = wroth
							}
						}

						character_event = { id = MNM.3506 days = 3 }
					}
				}
			}

			20 = { # Root is too trusting
				trigger = {
					trait = trusting

					society = {
						any_society_member = {
							block_general_event_trigger = no

							NOR = {
								character = ROOT
								trait = trusting
							}
						}
					}
				}

				set_character_flag = sr_too_trusting

				society = {
					random_society_member = {
						limit = {
							block_general_event_trigger = no

							NOR = {
								character = ROOT
								trait = trusting
							}
						}

						character_event = { id = MNM.3506 days = 3 }
					}
				}
			}

			20 = { # Root is too indiscreet
				trigger = {
					intrigue < 8

					society = {
						any_society_member = {
							block_general_event_trigger = no
							intrigue >= 12
							NOT = { character = ROOT }
						}
					}
				}

				set_character_flag = sr_too_indiscreet

				society = {
					random_society_member = {
						limit = {
							block_general_event_trigger = no
							intrigue >= 12
							NOT = { character = ROOT }
						}

						character_event = { id = MNM.3506 days = 3 }
					}
				}
			}
		}
	}
}

# This person is too suspicious, what do?
character_event = {
	id = MNM.3506
	picture = GFX_evt_catching_heretic
	border = GFX_event_normal_frame_diplomacy

	desc = {
		text = EVTDESC_MNM_3506_A
		trigger = { FROM = { has_character_flag = sr_too_honest } }
	}
	desc = {
		text = EVTDESC_MNM_3506_B
		trigger = { FROM = { has_character_flag = sr_too_wroth } }
	}
	desc = {
		text = EVTDESC_MNM_3506_C
		trigger = { FROM = { has_character_flag = sr_too_slothful } }
	}
	desc = {
		text = EVTDESC_MNM_3506_D
		trigger = { FROM = { has_character_flag = sr_too_trusting } }
	}
	desc = {
		text = EVTDESC_MNM_3506_E
		trigger = { FROM = { has_character_flag = sr_too_indiscreet } }
	}

	is_triggered_only = yes

	trigger = { society_member_of = secret_religious_cult }

	immediate = {
		clr_character_flag = free_help
		clr_character_flag = help_for_cost
	}

	# Offer help freely
	option = {
		name = EVTOPTA_MNM_3506

		custom_tooltip = { text = EVTOPTA_MNM_3506_TT }

		set_character_flag = free_help

		FROM = { character_event = { id = MNM.3507 } }

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 3

				OR = {
					trait = content
					is_benevolent_trigger = yes

					opinion = {
						who = FROM
						value = 50
					}
				}
			}
		}
	}

	# Offer help for a cost
	option = {
		name = EVTOPTB_MNM_3506

		trigger = { FROM = { has_society_currency_minor_trigger = yes } }

		custom_tooltip = { text = EVTOPTB_MNM_3506_TT }

		set_character_flag = help_for_cost

		FROM = { character_event = { id = MNM.3507 } }

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 3

				OR = {
					trait = ambitious
					trait = greedy
					is_evil_trigger = yes
					intrigue >= 15
				}
			}
		}
	}

	# Do not help
	option = {
		name = EVTOPTC_MNM_3506

		custom_tooltip = { text = EVTOPTC_MNM_3506_TT }

		hidden_effect = {
			FROM = {
				clr_character_flag = sr_too_honest
				clr_character_flag = sr_too_wroth
				clr_character_flag = sr_too_slothful
				clr_character_flag = sr_too_trusting
				clr_character_flag = sr_too_indiscreet
			}
		}

		ai_chance = { factor = 0 }
	}
}

# I am offered help to hide my true religion
character_event = {
	id = MNM.3507
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_diplomacy

	desc = {
		text = EVTDESC_MNM_3507_A
		trigger = { has_character_flag = sr_too_honest }
	}
	desc = {
		text = EVTDESC_MNM_3507_B
		trigger = { has_character_flag = sr_too_wroth }
	}
	desc = {
		text = EVTDESC_MNM_3507_C
		trigger = { has_character_flag = sr_too_slothful }
	}
	desc = {
		text = EVTDESC_MNM_3507_D
		trigger = { has_character_flag = sr_too_trusting }
	}
	desc = {
		text = EVTDESC_MNM_3507_E
		trigger = { has_character_flag = sr_too_indiscreet }
	}

	is_triggered_only = yes

	trigger = { society_member_of = secret_religious_cult }

	option = {
		name = EVTOPTA_MNM_3507

		trigger = { FROM = { has_character_flag = free_help } }

		custom_tooltip = { text = EVTOPTA_MNM_3507_TT }

		random_list = {
			50 = {
				mult_modifier = { FROM = { intrigue >= 12 } factor = 1.2 }
				mult_modifier = { FROM = { intrigue >= 14 } factor = 1.2 }
				mult_modifier = { FROM = { intrigue >= 16 } factor = 1.2 }
				mult_modifier = { FROM = { intrigue >= 18 } factor = 1.2 }
				mult_modifier = { FROM = { intrigue >= 20 } factor = 1.2 }

				custom_tooltip = { text = EVTOPT_MNM_3507_SUCCESS_TT }
				FROM = { character_event = { id = MNM.3508 days = 21 } }

				tooltip = {
					trigger_switch = {
						on_trigger = has_character_flag

						sr_too_honest     = { remove_trait = honest }
						sr_too_wroth      = { remove_trait = wroth }
						sr_too_slothful   = { remove_trait = slothful }
						sr_too_trusting   = { remove_trait = trusting }
						sr_too_indiscreet = { change_intrigue = 2 }
					}
				}
			}

			50 = {
				custom_tooltip = { text = EVTOPT_MNM_3507_FAIL_TT }
				FROM = { character_event = { id = MNM.3509 days = 21 } }
			}
		}

		tooltip = {
			reverse_opinion = {
				name = opinion_took_my_advice
				who = FROM
				years = 5
			}
		}

		ai_chance = {
			factor = 2

			mult_modifier = { FROM = { intrigue >= 12 } factor = 1.2 }
			mult_modifier = { FROM = { intrigue >= 14 } factor = 1.2 }
			mult_modifier = { FROM = { intrigue >= 16 } factor = 1.2 }
			mult_modifier = { FROM = { intrigue >= 18 } factor = 1.2 }
			mult_modifier = { FROM = { intrigue >= 20 } factor = 1.2 }
		}
	}

	option = {
		name = EVTOPTB_MNM_3507

		trigger = { FROM = { has_character_flag = help_for_cost } }

		custom_tooltip = { text = EVTOPTB_MNM_3507_TT }

		detract_society_currency_minor_effect = yes

		random_list = {
			50 = {
				mult_modifier = { FROM = { intrigue >= 12 } factor = 1.2 }
				mult_modifier = { FROM = { intrigue >= 14 } factor = 1.2 }
				mult_modifier = { FROM = { intrigue >= 16 } factor = 1.2 }
				mult_modifier = { FROM = { intrigue >= 18 } factor = 1.2 }
				mult_modifier = { FROM = { intrigue >= 20 } factor = 1.2 }

				custom_tooltip = { text = EVTOPT_MNM_3507_SUCCESS_TT }
				FROM = { character_event = { id = MNM.3508 days = 21 } }

				tooltip = {
					trigger_switch = {
						on_trigger = has_character_flag

						sr_too_honest     = { remove_trait = honest }
						sr_too_wroth      = { remove_trait = wroth }
						sr_too_slothful   = { remove_trait = slothful }
						sr_too_trusting   = { remove_trait = trusting }
						sr_too_indiscreet = { change_intrigue = 2 }
					}
				}
			}

			50 = {
				custom_tooltip = { text = EVTOPT_MNM_3507_FAIL_TT }
				FROM = { character_event = { id = MNM.3509 days = 21 } }
			}
		}

		tooltip = {
			reverse_opinion = {
				name = opinion_took_my_advice
				who = FROM
				years = 5
			}
		}

		ai_chance = {
			factor = 2

			mult_modifier = { FROM = { intrigue >= 12 } factor = 1.2 }
			mult_modifier = { FROM = { intrigue >= 14 } factor = 1.2 }
			mult_modifier = { FROM = { intrigue >= 16 } factor = 1.2 }
			mult_modifier = { FROM = { intrigue >= 18 } factor = 1.2 }
			mult_modifier = { FROM = { intrigue >= 20 } factor = 1.2 }
		}
	}

	option = {
		name = EVTOPTC_MNM_3507

		FROM = { character_event = { id = MNM.3510 days = 7 } }

		tooltip = {
			reverse_opinion = {
				name = opinion_did_not_take_my_advice
				who = FROM
				years = 5
			}
		}
	}
}

# Successful help - giver
character_event = {
	id = MNM.3508
	desc = EVTDESC_MNM_3508
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	trigger = { society_member_of = secret_religious_cult }

	option = {
		name = EXCELLENT

		custom_tooltip = { text = EVTOPTA_MNM_3508_TT }

		if = {
			limit = { has_character_flag = help_for_cost }
			add_society_currency_medium_effect = yes
		}

		tooltip = {
			FROM = {
				trigger_switch = {
					on_trigger = has_character_flag

					sr_too_honest     = { remove_trait = honest }
					sr_too_wroth      = { remove_trait = wroth }
					sr_too_slothful   = { remove_trait = slothful }
					sr_too_trusting   = { remove_trait = trusting }
					sr_too_indiscreet = { change_intrigue = 2 }
				}
			}
		}

		opinion = {
			name = opinion_took_my_advice
			who = FROM
			years = 5
		}

		clr_character_flag = free_help
		clr_character_flag = help_for_cost
		FROM = { character_event = { id = MNM.3511 } }
	}
}

# Unsuccessful help - giver
character_event = {
	id = MNM.3509
	desc = EVTDESC_MNM_3509
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_diplomacy

	trigger = { society_member_of = secret_religious_cult }

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3509

		if = {
			limit = { has_character_flag = help_for_cost }
			add_society_currency_medium_effect = yes
		}

		opinion = {
			name = opinion_took_my_advice
			who = FROM
			years = 5
		}

		clr_character_flag = free_help
		clr_character_flag = help_for_cost
		FROM = { character_event = { id = MNM.3512 } }
	}
}

# They didn't want my help
character_event = {
	id = MNM.3510
	desc = EVTDESC_MNM_3510
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_diplomacy

	trigger = { society_member_of = secret_religious_cult }

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3509

		opinion = {
			name = opinion_did_not_take_my_advice
			who = FROM
			years = 5
		}

		clr_character_flag = free_help
		clr_character_flag = help_for_cost

		hidden_effect = {
			FROM = {
				clr_character_flag = sr_too_honest
				clr_character_flag = sr_too_wroth
				clr_character_flag = sr_too_slothful
				clr_character_flag = sr_too_trusting
				clr_character_flag = sr_too_indiscreet
			}
		}
	}
}

# Successful help - receiver
character_event = {
	id = MNM.3511
	desc = EVTDESC_MNM_3511
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_diplomacy

	trigger = { society_member_of = secret_religious_cult }

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3511

		custom_tooltip = { text = EVTOPTA_MNM_3511_TT }

		trigger_switch = {
			on_trigger = has_character_flag

			sr_too_honest     = { remove_trait = honest   clr_character_flag = sr_too_honest }
			sr_too_wroth      = { remove_trait = wroth    clr_character_flag = sr_too_wroth }
			sr_too_slothful   = { remove_trait = slothful clr_character_flag = sr_too_slothful }
			sr_too_trusting   = { remove_trait = trusting clr_character_flag = sr_too_trusting }
			sr_too_indiscreet = { change_intrigue = 2     clr_character_flag = sr_too_indiscreet }
		}

		decrease_visibility_effect = yes
	}
}


# Unsuccessful help - receiver
character_event = {
	id = MNM.3512
	desc = EVTDESC_MNM_3512
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	trigger = { society_member_of = secret_religious_cult }

	option = {
		name = EVTOPTA_MNM_3512

		clr_character_flag = sr_too_honest
		clr_character_flag = sr_too_wroth
		clr_character_flag = sr_too_slothful
		clr_character_flag = sr_too_trusting
		clr_character_flag = sr_too_indiscreet
	}
}



### MISC###

# Misc: convert child to secret religion

# Start from the decision secret_religions_induct_child - Parent/educator/guardian ping event
character_event = {
	id = MNM.3438

	hide_window = yes
	is_triggered_only = yes # secret_religions_induct_child, mnm_secret_religious_societies_decisions.txt

	immediate = {
		FROM = { character_event = { id = MNM.3431 } }
	}
}

# Start on on_adolescence - Ping event from child
character_event = {
	id = MNM.3429

	hide_window = yes
	is_triggered_only = yes # on_adolescence

	trigger = {
		OR = {
			educator = {
				has_secret_religion = yes
				NOT = { society_member_of = secret_religious_cult }
				any_ward = { character = PREV }
			}

			guardian = {
				has_secret_religion = yes
				NOT = { society_member_of = secret_religious_cult }
			}

			mother = {
				has_secret_religion = yes
				NOT = { society_member_of = secret_religious_cult }
			}

			father = {
				has_secret_religion = yes
				NOT = { society_member_of = secret_religious_cult }
			}
		}
	}

	immediate = {
		if = {
			limit = {
				educator = { has_secret_religion = yes }
			}

			educator = { save_event_target_as = secret_religion_influencer }
		}
		else_if = {
			limit = {
				guardian = { has_secret_religion = yes }
			}

			guardian = { save_event_target_as = secret_religion_influencer }
		}
		else = {
			random_close_relative = {
				limit = {
					has_secret_religion = yes
					is_parent_of = ROOT
					is_liege_of = ROOT
				}

				preferred_limit = {
					is_playable = yes
				}

				save_event_target_as = secret_religion_influencer
			}
		}

		event_target:secret_religion_influencer = {
			character_event = {
				id = MNM.3430
				days = 3
				random = 9
			}
		}
	}
}

# Should I read my holy scripture to child?
character_event = {
	id = MNM.3430
	desc = EVTDESC_MNM_3430
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	trigger = {
		has_secret_religion = yes
		NOT = { true_religion = FROM } # Child openly follows the guardian's secret religion.
		FROM = { has_secret_religion = no }
	}

	# Yes
	option = {
		name = EVTOPTA_MNM_3430

		custom_tooltip = { text = EVTOPTA_MNM_3430_TT }

		save_event_target_as = secret_religion_inductor # TODO: is this used at all?

		FROM = {
			character_event = { id = MNM.3431 days = 1 }
		}

		ai_chance = {
			factor = 100

			mult_modifier = { trait = brave factor = 3 }
		}
	}

	# No
	option = {
		name = EVTOPTB_MNM_3430

		custom_tooltip = { text = EVTOPTB_MNM_3430_TT }

		ai_chance = {
			factor = 20

			mult_modifier = { trait = craven factor = 5 }
			mult_modifier = { trait = paranoid factor = 5 }
			mult_modifier = { trait = arbitrary factor = 5 }
		}
	}
}

# Child gets holy scripture read to them, do they like it?
character_event = {
	id = MNM.3431
	picture = GFX_evt_secluded_in_prayer
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_3431_A
		trigger = { FROM = { NOT = { true_religion_group = PREV } } }
	}
	desc = {
		text = EVTDESC_MNM_3431_B
		trigger = { FROM = { true_religion_group = PREV } }
	}

	is_triggered_only = yes

	# tell me more
	option = {
		name = EVTOPTC_MNM_3431

		set_secret_religion = FROM

		FROM = { character_event = { id = MNM.3432 days = 14 } }

		ai_chance = {
			factor = 20

			mult_modifier = { opinion = { who = FROM value >= 30 } factor = 1.5 }
			mult_modifier = { opinion = { who = FROM value >= 50 } factor = 1.5 }
			mult_modifier = { opinion = { who = FROM value >= 70 } factor = 1.6 }
			mult_modifier = { FROM = { diplomacy >= 10 } factor = 1.2 }
			mult_modifier = { FROM = { diplomacy >= 12 } factor = 1.2 }
			mult_modifier = { FROM = { diplomacy >= 14 } factor = 1.2 }
			mult_modifier = { FROM = { diplomacy >= 16 } factor = 1.2 }
			mult_modifier = { FROM = { diplomacy >= 18 } factor = 1.2 }

			mult_modifier = {
				factor = 1.6
				is_child_of = FROM
			}
			mult_modifier = {
				factor = 2
				OR = {
					trait = trusting
					trait = affectionate
				}
			}
			mult_modifier = {
				factor = 1.5
				OR = {
					trait = craven
					trait = timid
				}
			}
		}
	}

	# interesting
	option = {
		name = EVTOPTA_MNM_3431

		trigger = { # Can get sympathy
			FROM = {
				ROOT = { has_sympathy_for_true_religion_of_prev_trigger = no }
				NOT = { true_religion_group = ROOT }
			}
		}

		FROM = {
			show_scope_change = no

			ROOT = {
				show_scope_change = no

				add_sympathy_for_prevs_true_religion_effect = yes
			}

			character_event = { id = MNM.3433 days = 14 }
		}

		ai_chance = {
			factor = 40

			mult_modifier = { opinion = { who = FROM value >= 30 } factor = 1.2 }
			mult_modifier = { opinion = { who = FROM value >= 50 } factor = 1.2 }
			mult_modifier = { opinion = { who = FROM value >= 70 } factor = 1.2 }
			mult_modifier = { FROM = { diplomacy >= 10 } factor = 1.1 }
			mult_modifier = { FROM = { diplomacy >= 12 } factor = 1.1 }
			mult_modifier = { FROM = { diplomacy >= 14 } factor = 1.1 }
			mult_modifier = { FROM = { diplomacy >= 16 } factor = 1.1 }
			mult_modifier = { FROM = { diplomacy >= 18 } factor = 1.1 }

			mult_modifier = {
				factor = 1.4
				is_child_of = FROM
			}
			mult_modifier = {
				factor = 2
				OR = {
					trait = trusting
					trait = affectionate
				}
			}
			mult_modifier = {
				factor = 1.5
				OR = {
					trait = craven
					trait = timid
				}
			}
		}
	}

	# this is stupid!
	option = {
		name = EVTOPTB_MNM_3431

		FROM = { character_event = { id = MNM.3434 days = 14 } }

		ai_chance = {
			factor = 40

			mult_modifier = { opinion = { who = FROM value < 0 } factor = 1.5 }
			mult_modifier = { opinion = { who = FROM value < -20 } factor = 1.5 }
			mult_modifier = { opinion = { who = FROM value < -40 } factor = 1.5 }
			mult_modifier = { FROM = { diplomacy < 8 } factor = 1.5 }
			mult_modifier = { FROM = { diplomacy < 6 } factor = 1.5 }

			mult_modifier = {
				factor = 5
				OR = {
					trait = zealous
					trait = idolizer
				}
			}
			mult_modifier = {
				factor = 1.5
				OR = {
					trait = willful
					trait = stubborn
				}
			}
			mult_modifier = {
				factor = 1.5
				OR = {
					trait = cynical
					trait = curious
				}
			}
		}
	}
}

# They seemed to like the holy scripture!
character_event = {
	id = MNM.3432
	desc = EVTDESC_MNM_3432
	picture = GFX_evt_child_reading
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_MNM_3432

		tooltip = {
			FROM = {
				show_scope_change = no

				set_secret_religion = ROOT
			}
		}
	}
}

# They were intrigued by the holy scripture
character_event = {
	id = MNM.3433
	desc = EVTDESC_MNM_3433
	picture = GFX_evt_child_reading
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_MNM_3433

		tooltip = {
			FROM = {
				show_scope_change = no

				add_sympathy_for_prevs_true_religion_effect = yes
			}
		}
	}
}

# They weren't impressed...
character_event = {
	id = MNM.3434
	desc = EVTDESC_MNM_3434
	picture = GFX_evt_child_play
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	# Try anyway
	option = {
		name = EVTOPTA_MNM_3434

		trigger = {
			OR = {
				trait = patient
				NOT = { has_character_modifier = out_of_patience }
			}
		}

		tooltip = {
			FROM = {
				show_scope_change = no

				random_list = {
					60 = { # Success
						mult_modifier = { opinion = { who = ROOT value = 30 } factor = 1.5 }
						mult_modifier = { opinion = { who = ROOT value = 50 } factor = 1.5 }
						mult_modifier = { opinion = { who = ROOT value = 70 } factor = 1.6 }
						mult_modifier = { ROOT = { diplomacy >= 10 } factor = 1.2 }
						mult_modifier = { ROOT = { diplomacy >= 12 } factor = 1.2 }
						mult_modifier = { ROOT = { diplomacy >= 14 } factor = 1.2 }
						mult_modifier = { ROOT = { diplomacy >= 16 } factor = 1.2 }
						mult_modifier = { ROOT = { diplomacy >= 18 } factor = 1.2 }

						mult_modifier = {
							factor = 1.6
							is_child_of = ROOT
						}
						mult_modifier = {
							factor = 2
							OR = {
								trait = trusting
								trait = affectionate
							}
						}
						mult_modifier = {
							factor = 1.5
							OR = {
								trait = craven
								trait = timid
							}
						}

						set_secret_religion = ROOT
					}
					40 = { # Fail
						mult_modifier = { opinion = { who = ROOT value < 0 } factor = 1.5 }
						mult_modifier = { opinion = { who = ROOT value < -20 } factor = 1.5 }
						mult_modifier = { opinion = { who = ROOT value < -40 } factor = 1.5 }
						mult_modifier = { ROOT = { diplomacy < 8 } factor = 1.5 }
						mult_modifier = { ROOT = { diplomacy < 6 } factor = 1.5 }

						mult_modifier = {
							factor = 5
							OR = {
								trait = zealous
								trait = idolizer
							}
						}
						mult_modifier = {
							factor = 1.5
							OR = {
								trait = willful
								trait = stubborn
							}
						}
						mult_modifier = {
							factor = 1.5
							OR = {
								trait = cynical
								trait = curious
							}
						}

						if = {
							limit = {
								has_dlc = "Conclave"
								NOT = { trait = idolizer }
							}

							add_trait = idolizer
						}
						else_if = {
							limit = {
								NOR = {
									has_dlc = "Conclave"
									trait = zealous
								}
							}

							add_trait = zealous
						}

						add_rival = ROOT
					}
				}
			}
		}

		if = {
			limit = {
				NOT = { trait = patient }
			}

			add_character_modifier = {
				name = out_of_patience
				years = 3
			}
		}

		FROM = { character_event = { id = MNM.3435 days = 1 } }

		ai_chance = {
			factor = 20

			mult_modifier = {
				factor = 5
				is_parent_of = FROM
			}
			mult_modifier = {
				factor = 5
				FROM = { is_primary_heir = ROOT }
			}
		}
	}

	# Let it be
	option = {
		name = EVTOPTB_MNM_3434

		ai_chance = { factor = 80 }
	}
}

# They're trying to force the scripture on me again
character_event = {
	id = MNM.3435
	desc = EVTDESC_MNM_3435
	picture = GFX_evt_child_reading
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3435

		set_secret_religion = FROM

		FROM = {
			character_event = { id = MNM.3436 days = 14 }
		}

		ai_chance = {
			factor = 60

			mult_modifier = { opinion = { who = FROM value = 30 } factor = 1.5 }
			mult_modifier = { opinion = { who = FROM value = 50 } factor = 1.5 }
			mult_modifier = { opinion = { who = FROM value = 70 } factor = 1.6 }
			mult_modifier = { FROM = { diplomacy >= 10 } factor = 1.2 }
			mult_modifier = { FROM = { diplomacy >= 12 } factor = 1.2 }
			mult_modifier = { FROM = { diplomacy >= 14 } factor = 1.2 }
			mult_modifier = { FROM = { diplomacy >= 16 } factor = 1.2 }
			mult_modifier = { FROM = { diplomacy >= 18 } factor = 1.2 }

			mult_modifier = {
				factor = 1.6
				is_child_of = FROM
			}
			mult_modifier = {
				factor = 2
				OR = {
					trait = trusting
					trait = affectionate
				}
			}
			mult_modifier = {
				factor = 1.5
				OR = {
					trait = craven
					trait = timid
				}
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_3435

		if = {
			limit = {
				has_dlc = "Conclave"
				NOT = { trait = idolizer }
			}

			add_trait = idolizer
		}
		else_if = {
			limit = {
				NOR = {
					has_dlc = "Conclave"
					trait = zealous
				}
			}

			add_trait = zealous
		}

		add_rival = FROM

		FROM = { character_event = { id = MNM.3437 days = 14 } }

		ai_chance = {
			factor = 40

			mult_modifier = { opinion = { who = ROOT value < 0 } factor = 1.5 }
			mult_modifier = { opinion = { who = ROOT value < -20 } factor = 1.5 }
			mult_modifier = { opinion = { who = ROOT value < -40 } factor = 1.5 }
			mult_modifier = { ROOT = { diplomacy < 8 } factor = 1.5 }
			mult_modifier = { ROOT = { diplomacy < 6 } factor = 1.5 }

			mult_modifier = {
				factor = 5
				OR = {
					trait = zealous
					trait = idolizer
				}
			}
			mult_modifier = {
				factor = 1.5
				OR = {
					trait = willful
					trait = stubborn
				}
			}
			mult_modifier = {
				factor = 1.5
				OR = {
					trait = cynical
					trait = curious
				}
			}
		}
	}
}

# It worked out, in the end!
character_event = {
	id = MNM.3436
	desc = EVTDESC_MNM_3436
	picture = GFX_evt_child_reading
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_MNM_3436

		tooltip = {
			FROM = {
				show_scope_change = no
				set_secret_religion = ROOT
			}
		}
	}
}

# I failed and now they are zealous
character_event = {
	id = MNM.3437
	desc = EVTDESC_MNM_3437
	picture = GFX_evt_child_sword
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_MNM_3412

		tooltip = {
			FROM = {
				show_scope_change = no

				if = {
					limit = {
						has_dlc = "Conclave"
						NOT = { trait = idolizer }
					}

					add_trait = idolizer
				}
				else_if = {
					limit = {
						NOR = {
							has_dlc = "Conclave"
							trait = zealous
						}
					}

					add_trait = zealous
				}

				add_rival = ROOT
			}
		}
	}
}

# personally_openly_adopt_faith - inform liege
character_event = {
	id = MNM.3840
	desc = EVTDESC_MNM_3840
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # secret_religions_personally_adopt_secret_religion, mnm_secret_religious_societies_decisions.txt

	ai = no

	option = {
		name = EVTOPTA_MNM_3840
	}
}

# prepare_grounds - safety flag clear
character_event = {
	id = MNM.3849

	hide_window = yes
	is_triggered_only = yes # secret_religions_prepare_grounds, mnm_secret_religious_societies_decisions.txt

	immediate = { clr_character_flag = preparing_grounds_in_@FROM }
}

# prepare_grounds - Start progress
character_event = {
	id = MNM.3850
	desc = EVTDESC_MNM_3850
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # secret_religions_prepare_grounds, mnm_secret_religious_societies_decisions.txt

	option = {
		name = EVTOPTA_MNM_3850

		custom_tooltip = {
			text = EVTTOOLTIP_MNM_3850

			random_list = {
				20 = {
					mult_modifier = {
						factor = 0.1
						NOT = { owns = event_target:target_province }
					}
					mult_modifier = {
						factor = 1.1
						diplomacy >= 12
					}
					mult_modifier = {
						factor = 1.1
						diplomacy >= 14
					}
					mult_modifier = {
						factor = 1.1
						diplomacy >= 16
					}
					mult_modifier = {
						factor = 1.1
						diplomacy >= 18
					}
					mult_modifier = {
						factor = 1.1
						diplomacy >= 20
					}

					if = {
						limit = { owns = event_target:target_province }

						character_event = {
							id = MNM.3860
							days = 300
							random = 50
						}
					}
					else = {
						character_event = {
							id = MNM.3860
							days = 500
							random = 50
						}
					}
				}

				50 = {
					mult_modifier = {
						factor = 0.2
						NOT = { owns = event_target:target_province }
					}
					mult_modifier = {
						factor = 1.1
						diplomacy >= 12
					}
					mult_modifier = {
						factor = 1.1
						diplomacy >= 14
					}
					mult_modifier = {
						factor = 1.1
						diplomacy >= 16
					}
					mult_modifier = {
						factor = 1.1
						diplomacy >= 18
					}
					mult_modifier = {
						factor = 1.1
						diplomacy >= 20
					}

					if = {
						limit = { owns = event_target:target_province }

						character_event = {
							id = MNM.3870
							days = 300
							random = 50
						}
					}
					else = {
						character_event = {
							id = MNM.3870
							days = 500
							random = 50
						}
					}
				}

				30 = {
					if = {
						limit = { owns = event_target:target_province }

						character_event = {
							id = MNM.3880
							days = 300
							random = 50
						}
					}
					else = {
						character_event = {
							id = MNM.3880
							days = 500
							random = 50
						}
					}
				}
			}
		}

		character_event = { id = MNM.3859 days = 30 }
	}
}

character_event = {
	id = MNM.3858
	desc = EVTDESC_MNM_3858
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3858

		if = {
			limit = {
				has_quest = quest_secret_religions_societies_prepare_grounds

				event_target:target_province = {
					is_quest_target_of = ROOT
				}
			}

			clr_quest = {
				id = quest_secret_religions_societies_prepare_grounds
				failure = yes
			}
		}

		clear_delayed_event = { id = MNM.3849 }
		clear_delayed_event = { id = MNM.3859 }
		clr_character_flag = preparing_grounds_in_@event_target:target_province
	}
}

character_event = {
	id = MNM.3859

	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				# OR = { # see effect clause of 'secret_religions_prepare_grounds' decision
				#	NOT = {
				#		society = {
				#			event_target:original_society = {
				#				society_type = PREV
				#			}
				#		}
				#	}
					event_target:target_province = {
						county = {
							holder_scope = {
								NOT = { same_realm = ROOT }
							}
						}
					}
				# }
			}

			clear_delayed_event = { id = MNM.3860 }
			clear_delayed_event = { id = MNM.3870 }
			clear_delayed_event = { id = MNM.3880 }
			clear_delayed_event = { id = MNM.3890 }
			character_event = { id = MNM.3858 }
		}
		else = {
			repeat_event = { id = MNM.3859 days = 30 }
		}
	}
}

character_event = {
	id = MNM.3860
	desc = EVTDESC_MNM_3860
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3860

		character_event = {
			id = MNM.3890
			days = 150
			random = 50
		}
	}
}

character_event = {
	id = MNM.3870
	desc = EVTDESC_MNM_3870
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3870

		character_event = {
			id = MNM.3890
			days = 350
			random = 50
		}
	}
}

character_event = {
	id = MNM.3880
	desc = EVTDESC_MNM_3880
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3880

		scaled_wealth = {
			value = -0.3
			min = -50
			max = -250
		}

		character_event = {
			id = MNM.3890
			days = 450
			random = 50
		}
	}

	option = {
		name = EVTOPTB_MNM_3880

		if = {
			limit = {
				has_quest = quest_secret_religions_societies_prepare_grounds
				event_target:target_province = {
					is_quest_target_of = ROOT
				}
			}

			clr_quest = {
				id = quest_secret_religions_societies_prepare_grounds
				failure = yes
			}
		}

		clear_delayed_event = { id = MNM.3859 }
		clear_delayed_event = { id = MNM.3849 }
		clr_character_flag = preparing_grounds_in_@event_target:target_province
	}
}

character_event = {
	id = MNM.3890
	desc = EVTDESC_MNM_3890
	picture = GFX_evt_secret_ceremony
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_MNM_3890

		add_secret_religious_community_to_event_target = yes

		if = {
			limit = {
				has_quest = quest_secret_religions_societies_prepare_grounds

				event_target:target_province = {
					is_quest_target_of = ROOT
				}
			}

			clr_quest = quest_secret_religions_societies_prepare_grounds

			add_society_currency_minor_effect = yes
		}

		clear_delayed_event = { id = MNM.3849 }
		clear_delayed_event = { id = MNM.3859 }
		clr_character_flag = preparing_grounds_in_@event_target:target_province

	}
}

# Mission: Prepare Grounds
society_quest_event = {
	id = MNM.3901
	desc = EVTDESC_MNM_3901
	border = GFX_event_letter_frame_religion
	portrait = event_target:society_leader

	is_triggered_only = yes

	immediate = {
		random_demesne_province = {
			limit = {
				owned_by = PREV
				province_without_secret_religious_community_of_root = yes
			}

			save_event_target_as = target_province
		}
	}

	option = {
		name = ACCEPT

		event_target:target_province = {
			show_scope_change = no

			set_quest_target = {
				id = quest_secret_religions_societies_prepare_grounds
				holder = ROOT
			}
		}
	}

	option = {
		name = DECLINE

		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			days = 1000
			hidden = yes
		}

		ai_chance = { factor = 0 }
	}
}


# Character gets option to secretly keep old religion
character_event = {
	id = MNM.3949
	desc = EVTDESC_MNM_3949
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # 39700, itself fired from on_vassal_accepts_religious_conversion
	hide_from = yes

	trigger = {
		has_secret_religion = no
	}

	immediate = {
		FROMFROMFROM = { save_event_target_as = demander }
	}

	option = {
		name = EVTOPTA_MNM_3949

		log = "persistent_event_target:old_religion: [old_religion.GetName] - [This.GetTitledNameWithNick] ([This.GetID])"
		set_secret_religion = persistent_event_target:old_religion
		custom_tooltip = { text = EVTOPTA_MNM_3949_TT }

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 1.5
				trait = zealous
			}
			mult_modifier = {
				factor = 1.5
				trait = brave
			}
			mult_modifier = {
				factor = 500
				persistent_event_target:old_religion = {
					ROOT = {
						liege = {
							secret_religion = PREVPREV
						}
					}
				}
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_3949

		custom_tooltip = { text = EVTOPTB_MNM_3949_TT }

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 0.3
				trait = craven
			}
		}
	}
}

# Secret religion - Member thinks it's too stressful to keep practising their secret religion.
character_event = {
	id = MNM.3920
	desc = EVTDESC_MNM_3920
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # on_society_bi_yearly_pulse, random_events

	only_playable = yes
	only_capable = yes
	prisoner = no

	trigger = {
		society_member_of = secret_religious_cult
		is_inaccessible_trigger = no

		society = {
			any_society_member = {
				ai = yes
				is_society_grandmaster = no
				is_within_diplo_range = ROOT
				NOT = { character = ROOT }
			}
		}
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 0.05
			ai = yes
		}
		mult_modifier = {
			factor = 2
			society = {
				any_society_member = {
					OR = {
						trait = paranoid
						trait = stressed
					}
				}
			}
		}
		mult_modifier = {
			factor = 2
			society = {
				any_society_member = {
					count >= 5

					OR = {
						trait = paranoid
						trait = stressed
					}
				}
			}
		}
		mult_modifier = {
			factor = 2
			society = {
				any_society_member = {
					count >= 10

					OR = {
						trait = paranoid
						trait = stressed
					}
				}
			}
		}
	}

	immediate = {
		# Find a suitable person
		society = {
			random_society_member = {
				limit = {
					ai = yes
					is_society_grandmaster = no
					is_within_diplo_range = ROOT
					NOT = { character = ROOT }
				}

				preferred_limit = {
					same_realm = ROOT

					OR = {
						trait = paranoid
						trait = stressed
					}
				}

				preferred_limit = {
					same_realm = ROOT
				}

				preferred_limit = {
					OR = {
						trait = paranoid
						trait = stressed
					}
				}

				save_event_target_as = worried_secret_member
			}
		}
	}

	option = { # Try to convince by talking about solidarity
		name = EVTOPTA_MNM_3920

		hidden_effect = {
			random_list = {
				40 = { # Success
					mult_modifier = {
						factor = 1.3
						diplomacy >= 9
					}
					mult_modifier = {
						factor = 1.3
						diplomacy >= 11
					}
					mult_modifier = {
						factor = 1.3
						diplomacy >= 13
					}
					mult_modifier = {
						factor = 1.3
						diplomacy >= 15
					}
					mult_modifier = {
						factor = 1.3
						diplomacy >= 17
					}
					mult_modifier = {
						factor = 1.3
						diplomacy >= 19
					}
					mult_modifier = {
						factor = 2
						event_target:worried_secret_member = { trait = charitable }
					}
					mult_modifier = {
						factor = 2
						event_target:worried_secret_member = { trait = kind }
					}
					mult_modifier = {
						factor = 2
						event_target:worried_secret_member = { trait = honest }
					}
					mult_modifier = {
						factor = 0.5
						event_target:worried_secret_member = { trait = craven }
					}
					mult_modifier = {
						factor = 0.5
						event_target:worried_secret_member = { trait = cynical }
					}

					set_character_flag = solidarity_success
				}

				20 = { # Failure
					mult_modifier = { # ai can't deem what would be a good choice
						factor = 0.5
						ai = yes
					}

					set_character_flag = solidarity_failure
				}
			}

			character_event = { id = MNM.3921 days = 14 }
		}
	}

	option = { # Try to convince by talking about devotion
		name = EVTOPTB_MNM_3920

		hidden_effect = {
			random_list = {
				40 = { # Success
					mult_modifier = {
						factor = 1.3
						diplomacy >= 9
					}
					mult_modifier = {
						factor = 1.3
						diplomacy >= 11
					}
					mult_modifier = {
						factor = 1.3
						diplomacy >= 13
					}
					mult_modifier = {
						factor = 1.3
						diplomacy >= 15
					}
					mult_modifier = {
						factor = 1.3
						diplomacy >= 17
					}
					mult_modifier = {
						factor = 1.3
						diplomacy >= 19
					}
					mult_modifier = {
						factor = 2
						event_target:worried_secret_member = { trait = patient }
					}
					mult_modifier = {
						factor = 2
						event_target:worried_secret_member = { trait = diligent }
					}
					mult_modifier = {
						factor = 2
						event_target:worried_secret_member = { trait = brave }
					}
					mult_modifier = {
						factor = 0.5
						event_target:worried_secret_member = { trait = paranoid }
					}
					mult_modifier = {
						factor = 0.5
						event_target:worried_secret_member = { trait = arbitrary }
					}

					set_character_flag = devotion_success
				}

				20 = { # Failure
					mult_modifier = { # ai can't deem what would be a good choice
						factor = 0.5
						ai = yes
					}

					set_character_flag = devotion_failure
				}
			}

			character_event = { id = MNM.3921 days = 14 }
		}
	}

	option = { # Use smooth talking to calm her
		name = EVTOPTC_MNM_3920
		tooltip_info = gregarious

		trigger = { trait = gregarious }

		set_character_flag = gregarious_success
		character_event = { id = MNM.3921 days = 14 }
	}

	option = { # She is free to leave if she feels that way
		name = EVTOPTD_MNM_3920

		event_target:worried_secret_member = {
			show_scope_change = no

			leave_society = yes
			clear_secret_religion = yes
		}
	}
}

character_event = {
	id = MNM.3921
	picture = GFX_evt_uncomfortable
	border = GFX_event_normal_frame_religion

	desc = {
		text = EVTDESC_MNM_3921_A
		trigger = { has_character_flag = solidarity_success }
	}
	desc = {
		text = EVTDESC_MNM_3921_B
		trigger = { has_character_flag = solidarity_failure }
	}
	desc = {
		text = EVTDESC_MNM_3921_C
		trigger = { has_character_flag = devotion_success }
	}
	desc = {
		text = EVTDESC_MNM_3921_D
		trigger = { has_character_flag = devotion_failure }
	}
	desc = {
		text = EVTDESC_MNM_3921_E
		trigger = { has_character_flag = gregarious_success }
	}

	is_triggered_only = yes

	trigger = { society_member_of = secret_religious_cult }

	option = {
		name = EVTOPTA_MNM_3921

		trigger = {
			OR = {
				has_character_flag = solidarity_success
				has_character_flag = devotion_success
				has_character_flag = gregarious_success
			}
		}

		if = {
			limit = { has_character_flag = gregarious_success }

			event_target:worried_secret_member = {
				show_scope_change = no

				remove_trait_silently_paranoid_effect = yes
				remove_trait_silently_stressed_effect = yes
			}
		}
	}

	option = {
		name = EVTOPTB_MNM_3921

		trigger = {
			NOR = {
				has_character_flag = solidarity_success
				has_character_flag = devotion_success
				has_character_flag = gregarious_success
			}
		}

		event_target:worried_secret_member = {
			show_scope_change = no

			leave_society = yes
			clear_secret_religion = yes
		}
	}

	after = {
		clr_character_flag = solidarity_success
		clr_character_flag = solidarity_failure
		clr_character_flag = devotion_success
		clr_character_flag = devotion_failure
		clr_character_flag = gregarious_success
	}
}

### Secret religions - commission painting
character_event = {
	id = MNM.3910
	desc = EVTDESC_MNM_3910
	picture = GFX_evt_dharmic_pilgrims
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # on_yearly_pulse, random_events

	min_age = 16
	only_playable = yes
	only_capable = yes
	prisoner = no

	trigger = {
		NOT = { has_character_flag = commissioned_painting }
		is_inaccessible_trigger = no

		trigger_if = {
			limit = { society_member_of = secret_religious_cult }

			society = {
				any_society_member = {
					NOT = { character = ROOT }
					same_realm = ROOT
				}
			}
		}
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 0.05
			NOT = { society_member_of = secret_religious_cult }
		}
	}

	immediate = {
		set_character_flag = commissioned_painting
	}

	option = {
		name = EVTOPTA_MNM_3910

		scaled_wealth = {
			value = -0.3
			min = -25
			max = -125
		}

		character_event = {
			id = MNM.3911
			days = 60
			random = 20
		}
	}

	option = {
		name = EVTOPTB_MNM_3910
	}
}

# Add hidden religious symbols to the painting?
character_event = {
	id = MNM.3911
	desc = EVTDESC_MNM_3911
	picture = GFX_evt_dharmic_pilgrims
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = { # Ask artist to add symbols
		name = EVTOPTA_MNM_3911

		trigger = { society_member_of = secret_religious_cult }

		scaled_wealth = {
			value = -0.05
			min = -5
			max = -30
		}

		if = {
			limit = { random < 50 }
			custom_tooltip = { text = EVTTOOLTIPA_MNM_3911_FEMALE }
		}
		else = {
			custom_tooltip = { text = EVTTOOLTIPA_MNM_3911_MALE }
		}

		hidden_effect = {
			random_list = {
				95 = {
					character_event = {
						id = MNM.3912
						days = 25
						random = 5
					}
				}

				5 = {
					add_character_modifier = {
						name = unfaithful_rumors
						years = 3
					}

					scaled_wealth = {
						value = -0.05
						min = -5
						max = -30
					}
				}
			}
		}
	}

	option = { # Add symbols yourself
		name = EVTOPTB_MNM_3911

		trigger = { society_member_of = secret_religious_cult }

		custom_tooltip = {
			text = EVTTOOLTIPB_MNM_3911

			random_list = {
				60 = { # Success
					character_event = {
						id = MNM.3912
						days = 35
						random = 10
					}
				}

				40 = { # Avant Garde
					character_event = {
						id = MNM.3914
						days = 35
						random = 10
					}
				}
			}
		}
	}

	option = { # Keep as is
		name = EVTOPTC_MNM_3911

		add_artifact = magnificent_painting
	}
}

character_event = {
	id = MNM.3912
	desc = EVTDESC_MNM_3912
	picture = GFX_evt_ritual_scroll
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		society = {
			random_society_member = {
				limit = {
					NOT = { character = ROOT }
					same_realm = ROOT
				}

				preferred_limit = {
					trigger_if = {
						limit = {
							ROOT = { society_rank == 1 }
						}

						society_rank > 1
					}
					trigger_else_if = {
						limit = {
							ROOT = { society_rank == 2 }
						}

						society_rank > 2
					}
					trigger_else_if = {
						limit = {
							ROOT = { society_rank == 3 }
						}

						society_rank > 3
					}
				}

				save_event_target_as = society_art_observer
			}
		}
	}

	option = {
		name = EVTOPTA_3912

		add_artifact = magnificent_painting
		add_society_currency_minor_effect = yes

		opinion = {
			name = opinion_budding_friendship
			who = event_target:society_art_observer
			years = 10
		}

		reverse_opinion = {
			name = opinion_budding_friendship
			who = event_target:society_art_observer
			years = 10
		}
	}
}

character_event = {
	id = MNM.3914
	desc = EVTDESC_MNM_3914
	picture = GFX_evt_ritual_scroll
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_3914

		add_artifact = avant_garde_painting
	}

	option = {
		name = EVTOPTB_3914

		prestige = -100
	}
}

### Fellow society member asks you to go for a round of drinks
character_event = {
	id = MNM.3930
	desc = EVTDESC_MNM_3930
	picture = GFX_evt_brothel
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes # on_society_bi_yearly_pulse, random_events

	only_capable = yes
	prisoner = no

	trigger = {
		is_inaccessible_trigger = no
		society_member_of = secret_religious_cult

		society = {
			any_society_member = {
				NOT = { character = ROOT }
				ai = yes
			}
		}
	}

	immediate = {
		society = {
			random_society_member = {
				limit = {
					NOT = { character = ROOT }
					ai = yes
				}

				preferred_limit = {
					same_realm = ROOT
				}

				save_event_target_as = society_character
			}
		}
	}

	option = { # Of course
		name = EVTOPTA_3930

		custom_tooltip = { text = EVTTOOLTIP_MNM_3930 }

		character_event = {
			id = MNM.3932
			days = 21
			random = 7
		}
	}

	option = { # I don't have time for that
		name = EVTOPTB_3930
	}
}

# Argument with local
character_event = {
	id = MNM.3932
	desc = EVTDESC_MNM_3932
	picture = GFX_evt_brothel
	border = GFX_event_normal_frame_religion
	portrait = event_target:society_character

	is_triggered_only = yes

	trigger = { society_member_of = secret_religious_cult }

	option = { # diplomatically calm the situation
		name = EVTOPTA_MNM_3932

		custom_tooltip = { text = EVTTOOLTIPA_MNM_3932 }

		character_event = { id = MNM.3933 days = 7 }
	}

	option = { # fight the local
		name = EVTOPTB_MNM_3932

		custom_tooltip = { text = EVTTOOLTIPB_MNM_3932 }

		character_event = { id = MNM.3934 days = 7 }
	}
}

character_event = {
	id = MNM.3933
	picture = GFX_evt_brothel
	border = GFX_event_normal_frame_religion
	portrait = event_target:society_character

	desc = {
		text = EVTDESC_MNM_3933_SUCCESS
		trigger = {
			has_character_flag = sr_bar_fight_success
		}
	}
	desc = {
		text = EVTDESC_MNM_3933_FAILURE
		trigger = {
			NOT = { has_character_flag = sr_bar_fight_success }
		}
	}

	is_triggered_only = yes

	immediate = {
		random_list = { # Diplomacy check
			30 = { # success
				mult_modifier = {
					factor = 1.3
					diplomacy >= 7
				}
				mult_modifier = {
					factor = 1.3
					diplomacy >= 9
				}
				mult_modifier = {
					factor = 1.3
					diplomacy >= 11
				}
				mult_modifier = {
					factor = 1.3
					diplomacy >= 13
				}

				set_character_flag = sr_bar_fight_success
			}

			70 = { } # failure
		}
	}

	option = {
		name = EVTOPTA_MNM_3933

		trigger = { has_character_flag = sr_bar_fight_success }

		clr_character_flag = sr_bar_fight_success

		add_character_modifier = {
			name = mediator
			years = 2
		}
	}

	option = {
		name = EVTOPTB_MNM_3933

		trigger = {
			NOT = { has_character_flag = sr_bar_fight_success }
		}

		if = {
			limit = {
				OR = {
					trait = wounded
					trait = maimed
				}
			}

			prestige = -50
		}
		else = {
			add_trait = wounded
		}

		event_target:society_character = {
			show_scope_change = no

			if = {
				limit = {
					OR = {
						trait = wounded
						trait = maimed
					}
				}

				prestige = -50
			}
			else = {
				add_trait = wounded
			}
		}

		add_character_modifier = {
			name = bruised_knuckles
			months = 6
		}
	}

	after = {
		reverse_opinion = {
			name = opinion_happy
			who = event_target:society_character
			years = 5
		}

		hidden_effect = {
			opinion = {
				name = opinion_happy
				who = event_target:society_character
				years = 5
			}
		}
	}
}

character_event = {
	id = MNM.3934
	picture = GFX_evt_brothel
	border = GFX_event_normal_frame_religion
	portrait = event_target:society_character

	desc = {
		text = EVTDESC_MNM_3934_SUCCESS
		trigger = { has_character_flag = sr_bar_fight_success }
	}
	desc = {
		text = EVTDESC_MNM_3934_FAILURE
		trigger = {
			NOT = { has_character_flag = sr_bar_fight_success }
		}
	}

	is_triggered_only = yes

	immediate = {
		random_list = { # Martial check
			30 = { # success
				mult_modifier = {
					factor = 1.3
					martial >= 7
				}
				mult_modifier = {
					factor = 1.3
					martial >= 9
				}
				mult_modifier = {
					factor = 1.3
					martial >= 11
				}
				mult_modifier = {
					factor = 1.3
					martial >= 13
				}

				set_character_flag = sr_bar_fight_success
			}

			70 = { } # failure
		}
	}

	option = {
		name = EVTOPTA_MNM_3934

		trigger = { has_character_flag = sr_bar_fight_success }

		clr_character_flag = sr_bar_fight_success
		change_society_currency = 30
		increase_visibility_effect = yes
	}

	option = {
		name = EVTOPTB_MNM_3934

		trigger = {
			NOT = { has_character_flag = sr_bar_fight_success }
		}

		increase_visibility_effect = yes

		if = {
			limit = {
				OR = {
					trait = wounded
					trait = maimed
				}
			}

			prestige = -50
		}
		else = {
			add_trait = wounded
		}

		event_target:society_character = {
			show_scope_change = no

			if = {
				limit = {
					OR = {
						trait = wounded
						trait = maimed
					}
				}

				prestige = -50
			}
			else = {
				add_trait = wounded
			}
		}
	}

	after = {
		add_character_modifier = {
			name = bruised_knuckles
			months = 6
		}

		reverse_opinion = {
			name = opinion_happy
			who = event_target:society_character
			years = 5
		}

		hidden_effect = {
			opinion = {
				name = opinion_happy
				who = event_target:society_character
				years = 5
			}
		}
	}
}

# Feedback event for found_religious_cult decision
character_event = {
	id = MNM.3950
	desc = EVTDESC_MNM_3950
	picture = GFX_evt_secret_ceremony

	is_triggered_only = yes # secret_religions_found_secret_religious_society, mnm_secret_religious_societies_decisions.txt

	ai = no

	option = {
		name = EVTOPTA_MNM_3950
	}
}

# Feedback event for falsely_confess_faith decision
character_event = {
	id = MNM.3951
	desc = EVTDESC_MNM_3951
	picture = GFX_evt_secluded_in_prayer

	is_triggered_only = yes # secret_religions_falsely_confess_faith, mnm_secret_religious_societies_decisions.txt

	ai = no

	option = {
		name = EVTOPTA_MNM_3951
	}
}

# rare ai only - secretly convert to spouse/friend/province's religion
# TODO: trigger was borked, so make sure it doesn't fire too often
character_event = {
	id = MNM.3948

	hide_window = yes
	is_triggered_only = yes # on_yearly_pulse, random_events

	ai = yes
	only_playable = yes

	trigger = {
		has_secret_religion = no

		OR = {
			any_spouse = {
				NOT = { true_religion = ROOT }
			}

			any_consort = {
				NOT = { true_religion = ROOT }
			}

			any_demesne_province = {
				owned_by = PREV

				NOT = {
					religion = {
						target_type = true
						target = ROOT
					}
				}
			}

			any_friend = {
				NOT = { true_religion = ROOT }
			}
		}
	}

	immediate = {
		if = {
			limit = {
				any_spouse = {
					NOT = { true_religion = ROOT }
				}
			}

			random_spouse = {
				limit = {
					NOT = { true_religion = ROOT }
				}

				true_religion_scope = {
					save_event_target_as = secret_religion_target
				}
			}
		}
		else_if = {
			limit = {
				any_consort = {
					NOR = {
						character = ROOT
						true_religion = ROOT
					}
				}
			}

			random_consort = {
				limit = {
					NOR = {
						character = ROOT
						true_religion = ROOT
					}
				}

				true_religion_scope = {
					save_event_target_as = secret_religion_target
				}
			}
		}
		else_if = {
			limit = {
				any_demesne_province = {
					owned_by = PREV

					NOT = {
						religion = {
							target_type = true
							target = ROOT
						}
					}
				}
			}

			random_demesne_province = {
				limit = {
					owned_by = PREV

					NOT = {
						religion = {
							target_type = true
							target = ROOT
						}
					}
				}

				religion_scope = {
					save_event_target_as = secret_religion_target
				}
			}
		}
		else = {
			random_friend = {
				limit = {
					NOT = { true_religion = ROOT }
				}

				true_religion_scope = {
					save_event_target_as = secret_religion_target
				}
			}
		}

		set_secret_religion = event_target:secret_religion_target

		any_spouse = {
			limit = {
				ai = yes
				has_secret_religion = no
				NOT = { true_religion = event_target:secret_religion_target }
			}

			set_secret_religion = event_target:secret_religion_target
		}

		any_child = {
			limit = {
				ai = yes
				has_secret_religion = no
				NOT = { true_religion = event_target:secret_religion_target }
			}

			set_secret_religion = event_target:secret_religion_target
		}
	}
}
